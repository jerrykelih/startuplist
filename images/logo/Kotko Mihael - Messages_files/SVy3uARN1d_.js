/*!CK:3605873826!*//*1384964524,178158909*/

if (self.CavalryLogger) { CavalryLogger.start_js(["b3kKx"]); }

__d("NodeHighlighter",["concatMap","createArrayFrom","escapeRegex","TokenizeUtil","DOM"],function(a,b,c,d,e,f){var g=b('concatMap'),h=b('createArrayFrom'),i=b('escapeRegex'),j=b('TokenizeUtil'),k=b('DOM'),l={};function m(p,q){var r=k.getText(p).split(q),s=r.map(function(t){if(q.test(t))return n(t);return t||'';});return r.length>1?s:null;}function n(p){return k.create('span',{'class':'highlightNode'},p);}var o={getTextNodes:function(p){if(this.isLeafNode(p)||this.isStopNode(p)){return p;}else if(this.isDiscardNode(p))return [];return g(this.getTextNodes.bind(this),h(p.childNodes));},getHighlightCandidates:function(){return [];},isLeafNode:function(p){return k.isTextNode(p);},isStopNode:function(p){return false;},isDiscardNode:function(p){return false;},createSegmentedRegex:function(p){var q=j.getPunctuation();p=this.escapeAndAddBidirectionalCharsToTokens(p);return '(^|\\s|'+q+')('+p.join('|')+')(?=(?:$|\\s|'+q+'))';},createNonSegmentedRegex:function(p){return '('+p.map(i).join('|')+')';},escapeAndAddBidirectionalCharsToTokens:function(p){var q='[\\u200E\\u200F\\u202A\\u202B\\u202C\\u202D\\u202E]*';return p.map(function(r){return q+String(r).split('').map(i).join(q)+q;});},createRegex:function(p){var q=p.join('|');if(l[q])return l[q];var r=/[\u0E00-\u109F\u2000-\uFFFF]/,s=[],t=[];p.forEach(function(w){if(r.test(w)){t.push(w);}else s.push(w);});var u='';if(s.length){u+=this.createSegmentedRegex(s);u+=(t.length)?'|':'';}if(t.length)u+=this.createNonSegmentedRegex(t);var v=new RegExp(u,'i');l[q]=v;return v;},highlight:function(p,q){if(!q||q.length===0||!p)return;var r=g(function(t){return g(this.getTextNodes.bind(this),k.scry(p,t));}.bind(this),this.getHighlightCandidates()),s=this.createRegex(q);r.forEach(function(t){var u=m(t,s);if(u)if(this.isStopNode(t)){k.setContent(t,u);}else k.replace(t,u);}.bind(this));}};e.exports=o;});
__d("BrowseFacebarHighlighter",["copyProperties","CSS","csx","NodeHighlighter"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('CSS'),i=b('csx'),j=b('NodeHighlighter'),k={};g(k,j,{getHighlightCandidates:function(){return ["._53ad"];},isDiscardNode:function(l){return h.hasClass(l,'DefaultText');},createSegmentedRegex:function(l){l=this.escapeAndAddBidirectionalCharsToTokens(l);return '(^|\\s|\\b)('+l.join('|')+')';}});e.exports=k;});
__d("BrowseNUXCheckpoint",["AsyncRequest","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('emptyFunction');function i(l,m){new g('/ajax/browse/nux_checkpoint.php').setData(l).setFinallyHandler(m||h).send();}var j=null,k={SHOW_MEGAPHONE:0,RESULTS_VIEW:1,COMPLETED:2,init:function(l){j=l;},getStep:function(){return j;},setStep:function(l,m){j=l;i({nextStep:l},m);},setFinished:function(l){j=k.COMPLETED;i({finished:true},l);}};e.exports=k;});
__d("TextSelection",[],function(a,b,c,d,e,f){var g=window.getSelection,h=document.selection,i={getSelection:function(){if(g){return g()+'';}else if(h)return h.createRange().text;return null;},clearSelection:function(){if(g){g().removeAllRanges();}else if(h)h.empty();},selectAllInNode:function(j){var k=document.body.createTextRange;if(k){var l=k();l.moveToElementText(j);l.select();}else if(g){var m=g(),n=document.createRange();n.selectNodeContents(j);m.removeAllRanges();m.addRange(n);}}};e.exports=i;});
__d("BrowseNUXTourDialog",["Event","Animation","CSS","DOMQuery","LayerSlowlyFadeOnShow","TextSelection","copyProperties","csx","cx","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Animation'),i=b('CSS'),j=b('DOMQuery'),k=b('LayerSlowlyFadeOnShow'),l=b('TextSelection'),m=b('copyProperties'),n=b('csx'),o=b('cx'),p=b('emptyFunction');function q(r,s){this.dialog=r;this.typeahead=s;this.dialog.enableBehavior(k);this._closeButtonHandler=null;i.addClass(this.dialog.getRoot(),"_a5c");i.addClass(this.dialog.getContent(),"_a5d");this.subscription=this.dialog.subscribe('beforehide',p.thatReturnsFalse);}m(q.prototype,{showWithContext:function(r,s){this.resultIndex=s;this.dialog.setContext(r).show();l.clearSelection();},getButton:function(){return j.find(this.dialog.getRoot(),"a._a08");},getCloseButton:function(){return j.find(this.dialog.getRoot(),"a._5234");},activateCloseButton:function(r){var s=this.getCloseButton();this._closeButtonHandler=g.listen(s,'click',function(event){this.reset();r(event);}.bind(this));i.show(s);},showButton:function(){var r=this.getButton();i.removeClass(r,'invisible_elem');new h(r).to('opacity',1).go();},setNextHandler:function(r){var s=g.listen(this.getButton(),'click',function(event){s.remove();this.reset();r(event);}.bind(this));},reset:function(){this.subscription.unsubscribe();this._closeButtonHandler&&this._closeButtonHandler.remove();this._closeButtonHandler=null;this.dialog.hide();}});e.exports=q;});
__d("AutoTypewriter",[],function(a,b,c,d,e,f){var g=[null,null],h={request:function(i,j,k){k=k||200;var l=false,m=1,n=g.length;(function o(){if(l)return;var p=j.substr(0,m);if(p===j){i(p,true);g[n]=null;}else{i(p,false);m++;setTimeout(o,k);}})();g[n]=function(){l=true;};return n;},cancel:function(i){if(!g[i])return false;g[i]();g[i]=null;return true;}};e.exports=h;});
__d("BrowseNUXTypewriter",["Arbiter","AutoTypewriter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AutoTypewriter'),i=b('copyProperties');function j(k){this.structuredInput=k;}i(j.prototype,{typeValue:function(k,l){this._type(k,function(m,n){g.inform("BrowseNUX/typing");this.structuredInput.setText(m);this.structuredInput.togglePlaceholder();this.structuredInput.moveSelectionToEnd();}.bind(this),l);},prependFragment:function(k,l){var m=this.structuredInput,n=m.getStructure();this._type(k.text,function(o){g.inform("BrowseNUX/typing");k.text=o;m.setStructure([k].concat(n));m.setSelection({offset:o.length,length:0});},l);},abort:function(){if(this._token){h.cancel(this._token);this._cleanup();}},_type:function(k,l,m){this.abort();var n=this.structuredInput;this._wasEnabled=n.getEnabled();n.setEnabled(true);n.focus();this._token=h.request(function(o,p){l(o);if(p){this._cleanup();m&&m();}}.bind(this),k,100);},_cleanup:function(){this.structuredInput.setEnabled(this._wasEnabled);delete this._token;delete this._wasEnabled;}});e.exports=j;});
__d("FacebarSemanticQuery",["URI","copyProperties","Env"],function(a,b,c,d,e,f){var g=b('URI'),h=b('copyProperties'),i=b('Env'),j='str',k=/\*[\w\-]+\(/g;function l(v){var w={me:i.user};return h(w,v.semantic_map);}function m(v,w){var x=l(v);if(typeof x[w]!=='undefined')return String(x[w]);return w;}function n(v){return new g("/profile.php").addQueryData({id:v});}function o(v,w){var x=[w],y=[],z=v.browse_functions,aa=v.search_path;while(x.length>0){var ba=x.pop();if(!r(ba)){y.push(ba);continue;}var ca=ba.substring(0,ba.indexOf('(')),da=ca,ea=s(ba);if(!z[ca]){y=[];break;}var fa=z[ca].minNumParams,ga=z[ca].maxNumParams;if(x.length>0)if(z[ca].numParamsUnbounded){if(y.length>0)ca+='-'+ea.length;}else if((ea.length!=1&&ea.length>fa)||(ea.length===0&&fa!=ga))ca+='-'+ea.length;x.push(ca);for(var ha=0;ha<ea.length;ha++){if(ea[ha].length===0)continue;if(z[da].allowsFreeText){x.push(j+'/'+encodeURIComponent(ea[ha]));}else x.push(ea[ha]);}}return g(aa+y.join('/'));}function p(v){return v.replace(/['"\[\]]/g,'');}function q(v,w){var x=JSON.parse(w),y=[];if(x.length>0)y=[x[0]];var z=[],aa=v.browse_functions,ba=v.search_path;while(y.length>0){var ca=y.pop();if(typeof(ca)!=='object'){z.push(p(ca));continue;}var da=Object.keys(ca)[0],ea=da,fa=ca[da];if(!aa[da]){z=[];break;}var ga=aa[da].minNumParams,ha=aa[da].maxNumParams;if(y.length>0)if(aa[da].numParamsUnbounded){if(z.length>0)da+='-'+fa.length;}else if((fa.length!=1&&fa.length>ga)||(fa.length===0&&ga!=ha))da+='-'+fa.length;y.push(da);for(var ia=0;ia<fa.length;ia++){if(fa[ia].length===0)continue;if(aa[ea].allowsFreeText){y.push(j+'/'+encodeURIComponent(fa[ia]));}else y.push(fa[ia]);}}return g(ba+z.join('/'));}function r(v){return (/^[a-z\-]+\(.*\)$/).test(v);}function s(v){if(!r(v)&&v.indexOf('param_')!==0)return [v];var w=v.substring(v.indexOf('(')+1,v.length-1);if(w.length===0)return [];return t(w);}function t(v){var w=[],x=0,y=0;for(var z=0;z<v.length;++z)if(v[z]==','&&y===0){w.push(v.substring(x,z));x=z+1;}else if(v[z]=='('){y++;}else if(v[z]==')')y--;w.push(v.substring(x,v.length));return w;}function u(v,w,x){"use strict";this.facebarConfig=v;this.unmapped=(w||"").trim();this.mapped=m(v,this.unmapped);this.position=null;this.$FacebarSemanticQuery0=typeof x!=='undefined'?x:false;}u.prototype.isEntity=function(){"use strict";return (/^\d+$/).test(this.mapped);};u.prototype.isShortcut=function(){"use strict";return this.mapped.indexOf('shortcut(')===0;};u.prototype.isImplemented=function(){"use strict";return this.mapped&&!this.mapped.match(k);};u.prototype.isSemanticForest=function(){"use strict";return this.$FacebarSemanticQuery0;};u.prototype.getUnimplemented=function(){"use strict";return (this.mapped.match(k)||[]).map(function(v){return v.substr(1,v.length-2);});};u.prototype.getURI=function(){"use strict";if(this.isEntity()){return n(this.mapped);}else if(this.isShortcut()){return new g(this.mapped.substr(9,this.mapped.length-10));}else if(this.isSemanticForest()){return q(this.facebarConfig,this.unmapped);}else return o(this.facebarConfig,this.unmapped);};e.exports=u;});
__d("FacebarURI",["URI","Env","FacebarSemanticQuery"],function(a,b,c,d,e,f){var g=b('URI'),h=b('Env'),i=b('FacebarSemanticQuery'),j={getSearchRawPrefix:function(){return 'search';},getSearchPath:function(){return '/'+this.getSearchRawPrefix()+'/';},getURI:function(k,l){var m=null,n=!l.song&&!l.isExtendedResult&&l.path;if(n){m=new g(n);if(l.type=='user')m.addQueryData({fref:'ts'});}else{var o=new i(k,l.semantic);if(o&&o.isImplemented())m=o.getURI();}return m&&j.getQualifiedURI(m);},getQualifiedURI:function(k){var l=new g(k);if(!l.getDomain()){var m=g(h.www_base);l.setProtocol(m.getProtocol()).setDomain(m.getDomain()).setPort(m.getPort());}return l;}};e.exports=j;});
__d("BrowseNUXController",["Event","function-extensions","AsyncRequest","Arbiter","BrowseLogger","BrowseNUXCheckpoint","BrowseNUXTourDialog","BrowseNUXTypewriter","CSS","DOM","DOMScroll","FacebarStructuredText","FacebarURI","invariant","KeyEventController","LayerSlowlyFadeOnShow","ModalMask","PageTransitions","Parent","Run","SubscriptionsHandler","URI","Vector","copyProperties","csx","cx","emptyFunction","startsWith"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('AsyncRequest'),i=b('Arbiter'),j=b('BrowseLogger'),k=b('BrowseNUXCheckpoint'),l=b('BrowseNUXTourDialog'),m=b('BrowseNUXTypewriter'),n=b('CSS'),o=b('DOM'),p=b('DOMScroll'),q=b('FacebarStructuredText'),r=b('FacebarURI'),s=b('invariant'),t=b('KeyEventController'),u=b('LayerSlowlyFadeOnShow'),v=b('ModalMask'),w=b('PageTransitions'),x=b('Parent'),y=b('Run'),z=b('SubscriptionsHandler'),aa=b('URI'),ba=b('Vector'),ca=b('copyProperties'),da=b('csx'),ea=b('cx'),fa=b('emptyFunction'),ga=b('startsWith'),ha={registerFacebar:function(la){s(!ha.facebar);ha.facebar=la;},restartTour:function(){ha.restart=true;ha.startTour();},startTour:function(){if(!ha.started){ha.started=true;i.inform('BrowseNUX/starting');new h('/ajax/browse/nux.php').setAllowCrossPageTransition(true).send();}},initTour:function(la){ca(ha,{fragments:la.fragments,resultURI:la.resultURI,buttons:la.buttons,dialogs:la.dialogs,endDialog:la.endDialog});i.inform('BrowseNUX/initialized');k.init(la.nextStep);ha.prefetchResults();if(ha.restart){ha.showSearchBarTour();}else ha.startAtNextStep();},startAtNextStep:function(){var la=w.getNextURI().getPath();switch(k.getStep()){case k.SHOW_MEGAPHONE:ha.showSearchBarTour();break;case k.RESULTS_VIEW:if(ga(la,r.getSearchPath())){setTimeout(function(){ha.showEndDialog();},2000);}else j.logNUXStep('abandon');break;default:return;}y.onAfterLoad(function(){w.setCompletionCallback(ha.startAtNextStep);});},prefetchResults:function(){var la=ha.facebar.typeahead.getData(),ma=ha.fragments;la.query(q.fromStruct([ma.page]));la.query(q.fromStruct([ma.edge,ma.page]));},showSearchBarTour:function(la){var ma=ha.dialogs;j.logNUXStep('start');var na=ha.facebar.input,oa=ha.facebar.typeahead,pa=ka(oa);t.registerKey('BACKSPACE',fa.thatReturnsFalse);na.setEnabled(false);v.show();var qa=new l(ma.search,oa),ra=new m(na),sa=ha.fragments.page,ta=sa.text.toLowerCase(),ua=function(){qa.showWithContext(na.getRoot(),0);},va=function(){na.focus();ra.typeValue(ta,function(){setTimeout(function(){na.setStructure([sa]);na.moveSelectionToEnd();ia(oa,function(){qa.showButton();});},1000);});};setTimeout(ua,0);setTimeout(va,2000);var wa=new l(ma.phrase,oa),xa=ha.fragments.edge;ma.phrase.setOffsetY(-10);qa.setNextHandler(function(){j.logNUXStep('phrase');na.setStructure([sa]);ra.prependFragment(xa,function(){ia(oa,function(){var za=oa.getView().getItems()[0];if(za){var ab=o.find(za,"span._7gk");wa.showWithContext(ab,1);}else wa.showWithContext(na.getRoot(),0);setTimeout(wa.showButton.bind(wa),2000);});});});wa.setNextHandler(function(){j.logNUXStep('personalized');k.setStep(k.RESULTS_VIEW,function(){pa.release();var za=aa(ha.resultURI).addQueryData({view:'list'}).addQueryData({rn:Math.random()});w.go(za);});});n.addClass(document.body,"_474s");function ya(){ra.abort();pa.release();qa.reset();wa.reset();v.hide();na.setEnabled(true);n.removeClass(document.body,"_474s");}if(la){qa.activateCloseButton(ya);wa.activateCloseButton(ya);}ja(ya);},showEndDialog:function(){var la=ha.facebar.input,ma=ha.facebar.typeahead,na=ha.endDialog;na.enableBehavior(u);na.show();j.logNUXStep('end_dialog');k.setFinished();i.inform('BrowseNUX/finished');var oa=function(ra){la.setStructure([]);la.togglePlaceholder();la.focus();if(n.hasClass(document.documentElement,'tinyViewport')){var sa=new ba(0,0,'document');p.scrollTo(sa,true,false,false,ra);}else if(ra)ra();},pa=na.subscribe('button',function(ra,sa){na.hide();switch(sa.getAttribute('data-action')){case 'replay':ha.showSearchBarTour(true);j.logNUXStep('replay');break;case 'search':oa();j.logNUXStep('search');break;case 'cancel':j.logNUXStep('cancel');break;}}),qa=g.listen(na.getRoot(),'click',function(event){var ra=event.getTarget();if(ra){var sa;if(ra.getAttribute('data-action')){sa=ra.getAttribute('data-action');}else sa=ra.parentNode.getAttribute('data-action');if(sa)j.logNUXStep(sa);}var ta=x.byClass(ra,"_a0z");if(!ta||event.isDefaultRequested())return;na.hide();oa(function(){var ua=ta.getAttribute('data-query')+' ',va=new m(la),wa=ka(ma);setTimeout(function(){va.typeValue(ua,function(){ia(ma,function(){wa.release();w.go(ta.getAttribute('href'));});});},1000);});return false;});ja(function(){qa.remove();pa.unsubscribe();});}};function ia(la,ma){var na=new i();na.registerCallback(ma,['timeout','render']);setTimeout(na.inform.bind(na,'timeout'),2000);var oa=setTimeout(qa,6000),pa=la.subscribe('render',qa);function qa(){pa.unsubscribe();clearTimeout(oa);na.inform('render');}ja(pa.unsubscribe.bind(pa));}function ja(la){w.registerHandler(la,10);}function ka(la){var ma=new z('FacebarTypeaheadLock');ma.addSubscriptions(g.listen(ha.facebar.input.getRichInput(),'keydown',fa.thatReturnsFalse),la.getCore().subscribe('close',fa.thatReturnsFalse),la.getView().subscribe(['beforeHighlight','beforeSelect'],fa.thatReturnsFalse));return ma;}e.exports=ha;});
__d("BrowseNUXMegaphone",["Event","function-extensions","Animation","ArbiterMixin","Button","CSS","cx","DOM","Ease","MegaphoneHelper","Style","Vector","$","copyProperties","csx"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Animation'),i=b('ArbiterMixin'),j=b('Button'),k=b('CSS'),l=b('cx'),m=b('DOM'),n=b('Ease'),o=b('MegaphoneHelper'),p=b('Style'),q=b('Vector'),r=b('$'),s=b('copyProperties'),t=b('csx');function u(v,w){this.megaphone=v;this.storyData=w;this.contentArea=null;this.className=null;this.startButton=m.find(this.megaphone,"a._a06");this.hideLink=m.find(this.megaphone,"a._53o0");g.listen(this.startButton,'click',this._handleStart.bind(this));g.listen(this.hideLink,'click',this._handleHide.bind(this));}s(u.prototype,i,{_attachListener:function(){var v=1,w=function(){var x=this._getScrollOpacity();if(x!==v){p.set(this.megaphone,'opacity',x===1?'':x);k.conditionShow(this.megaphone,x>0);v=x;}}.bind(this);this.listener=g.listen(window,'scroll',w);w();},_removeListener:function(){if(this.listener){this.listener.remove();this.listener=null;}},_getScrollOpacity:function(){var v=q.getElementPosition(r('globalContainer'),'viewport'),w=Math.max(0,Math.min(1,(v.y+70)/40));return n.circOut(w);},_handleStart:function(){j.setEnabled(this.startButton,false);this.inform('start');},_handleHide:function(){o.hideStory(this.storyData.id,this.storyData.location);this.inform('hide');this.hide();},setClass:function(v){this.className&&k.removeClass(this.megaphone,this.className);k.addClass(this.megaphone,v);this.className=v;},show:function(v){if(this.shown)return;this.shown=true;this.contentArea=v;var w=5,x=r('blueBarHolder').offsetHeight-w;p.set(this.megaphone,'top',x+'px');p.set(this.megaphone,'opacity',0);m.appendContent(r('pageHead'),this.megaphone);k.show(this.megaphone);var y=(this.megaphone.offsetHeight||90)-w;if(k.hasClass(document.body,"_561r"))y=0;new h(v).to('marginTop',y).duration(500).ease(n.sineOut).go();var z=this._getScrollOpacity();if(z){new h(this.megaphone).duration(250).checkpoint().to('opacity',z).duration(250).ease(n.makePowerIn(2)).ondone(function(){if(z===1)p.set(this.megaphone,'opacity','');this._attachListener();}.bind(this)).go();}else{this._attachListener();k.hide(this.megaphone);}},hide:function(){if(!this.shown)return;this.shown=false;this._removeListener();new h(this.megaphone).to('opacity',0).duration(250).ease(n.makePowerOut(2)).go();new h(this.contentArea).to('marginTop',0).duration(500).ease(n.sineIn).ondone(m.remove.curry(this.megaphone)).go();}});e.exports=u;});
__d("BrowseNUXBootstrap",["Arbiter","BrowseNUXController","BrowseNUXMegaphone","BrowseLogger","ge","PageTransitions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('BrowseNUXController'),i=b('BrowseNUXMegaphone'),j=b('BrowseLogger'),k=b('ge'),l=b('PageTransitions'),m={registerStoryMegaphone:function(n,o){var p=k('contentArea')||k('content');if(p){var q=new i(n,o);q.show(p);m.initMegaphone(q);g.subscribe('page_transition',q.hide.bind(q));}},registerTypeaheadMegaphone:function(n){m.initMegaphone(n);},triggerResults:function(){h.startTour();},initMegaphone:function(n){g.inform('BrowseNUX/megaphone',n,g.BEHAVIOR_STATE);var o=false,p=n.subscribe('start',function(){o=true;h.startTour();}),q=n.subscribe('hide',function(){o=true;j.logNUXStep('hide');});g.subscribe('BrowseNUX/initialized',function(){n.hide();});j.logNUXStep('show_megaphone');l.registerHandler(function(){o||j.logNUXStep('ignore');p.unsubscribe();q.unsubscribe();},10);}};e.exports=m;});
__d("TypeaheadFacepileX.react",["React"],function(a,b,c,d,e,f){var g=b('React'),h=g.createClass({displayName:'TypeaheadFacepile',renderPic:function(i,j){return (g.DOM.span({className:'splitpic '+j},g.DOM.img({alt:"",src:i})));},renderPics:function(){var i=this.props.photos,j=this.props.size;if(j>=3){return [this.renderPic(i[0],'leftpic'),this.renderPic(i[1],'toppic'),this.renderPic(i[2],'bottompic')];}else return [this.renderPic(i[0],'leftpic'),this.renderPic(i[1],'')];},render:function(){return this.transferPropsTo(g.DOM.span({className:"splitpics clearfix"},this.renderPics()));}});e.exports=h;});
__d("LitestandChromeHomeCount",["Arbiter","CSS","DOM","LitestandMessages","LitestandNewsfeedCountUpdater","$","csx","cx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('LitestandMessages'),k=b('LitestandNewsfeedCountUpdater'),l=b('$'),m=b('csx'),n=b('cx'),o=20,p,q,r,s,t={init:function(u){s=u;q=i.find(l('pageHead'),"._5ahz");p=q.parentNode;r=false;g.subscribe(j.UPDATE_HOME_COUNT,function(v,w){t.updateBadge(w.onHome?0:w.count);});k.init();t.updateBadge(s);},updateBadge:function(u){s=u;var v=u>0;t.toggleBadge(v);if(v){var w=u>o?o+'+':u;i.setContent(q,w);}},toggleBadge:function(u){if(r===u)return;r=u;h.conditionClass(p,"_5ahy",!u);}};e.exports=t;});
__d("FacebarKeywordSearchUtils",["FacebarURI","FacebarStructuredText","KeywordsSearchResultConfig","URI","startsWith"],function(a,b,c,d,e,f){var g=b('FacebarURI'),h=b('FacebarStructuredText'),i=b('KeywordsSearchResultConfig'),j=b('URI'),k=b('startsWith'),l={addExactMatch:function(m,n,o){if(!n.length)return;var p,q;for(var r=0,s=n.length;r<s;r++){q=n[r];if(q.type==='grammar')continue;p=true;break;}if(!p)return;var t=this.getExactMatchKeywordResult(m);if(!t)return;var u=Math.min(n.length,o),v=u;for(r=0;r<u;r++){q=n[r];if(q.exactMatchKeywords)return;if(q.cost>i.default_cost)--v;if(q.type!==i.result_type)continue;t.backendCost=q.cost+i.exact_match_cost_delta_from_best;t.cost=q.backendCost;n.splice(r,0,t);return;}n.filter(function(w){return !w.exactMatchKeywords;});n.splice(Math.min(Math.min(u,o-1),v),0,t);},getExactMatchKeywordResult:function(m){if(!m||m.is_empty||!m.raw_text)return;var n=m.raw_text.toLowerCase().replace(/\s{2,}/g,' ').trim(),o=i.query_prefix_blacklist;for(var p=0;p<o.length;p++)if(k(n,o[p]))return;var q=this.makeFacebarEntry(n);return this._makeFacebarResult(q,m.cache_id.length);},makeFacebarEntry:function(m){var n=g.getQualifiedURI(j(i.results_page_url).addQueryData('q',m)),o=i.shortcut+'('+n.toString()+')';return {semantic:o,text:m,type:i.result_type,resultsSetType:i.result_set_type,uid:i.uid_prefix+m,iconClass:i.icon_class,uri:n,structure:new h()};},_makeFacebarResult:function(m,n){var o={semantic:m.semantic,structure:[{type:'grammar',text:m.text,uid:m.semantic}],type:m.type,resultsSetType:m.resultsSetType,cost:i.default_cost,cache_id_length:n,parse:{display:[{type:'grammar',uid:i.uid_prefix+m.text}],remTokens:[],suffix:''},iconClass:m.iconClass,exactMatchKeywords:true};o.tuid=JSON.stringify({semantic:o.semantic,structure:o.structure});return o;}};e.exports=l;});
__d("FacebarResultStore",["copyProperties","concatMap","FacebarGlobalOptions","FacebarJSConstants","FacebarKeywordSearchUtils","FacebarResultStoreUtils","FacebarStructuredText","KeywordsSearchResultConfig","TokenizeUtil"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('concatMap'),i=b('FacebarGlobalOptions'),j=b('FacebarJSConstants'),k=b('FacebarKeywordSearchUtils'),l=b('FacebarResultStoreUtils'),m=b('FacebarStructuredText'),n=b('KeywordsSearchResultConfig'),o=b('TokenizeUtil'),p='unimplemented';function q(r,s,t,u){"use strict";this.facebarConfig=r;this.facebarConfig.grammar_stop_words_penalty=this.facebarConfig.grammar_stop_words_penalty||2;this.facebarConfig.grammar_stop_words=this.facebarConfig.grammar_stop_words||{};this.facebarConfig.options=u;this.tokenize=s;this.getEntry=t;this.typeaheadTypeMap=this.facebarConfig.mapped_types;this.facebarConfig.typeahead_types.forEach(function(v){this.typeaheadTypeMap[v]=v;}.bind(this));this.resetCaches();this.cacheEnabled(true);}q.prototype.transformStructured=function(r){"use strict";var s=[],t=[],u='',v='';r.forEach(function(y,z){if(y.isType('text')){u+=y.getText();v=(v==null)?null:v+y.getText();}else{var aa=u.match(/\"/g);if(aa&&aa.length%2)u=u.replace(/\s+$/,'')+'"';if(u.length){Array.prototype.push.apply(s,this.tokenize(u));t.push(u);u='';}s.push(y.toStruct());t.push({uid:String(y.getUID()),type:this._getFBObjectType(y.getTypePart(1)),text:y.getText()});v=null;}}.bind(this));if(u.length){if(u[u.length-1]=='\'')u=u.substr(0,u.length-1);Array.prototype.push.apply(s,this.tokenize(u));t.push(u);if(u[u.length-1]==' ')s.push('');}var w=JSON.stringify(t),x=w.replace(/\]$/,'').replace(/\"$/,'');x=x.replace(/\s{2,}/g,' ');return {tokens:s,text_form:w,is_empty:!!w.match(/^\[(\"\s*\")?\]$/),raw_text:v,cache_id:x};};q.prototype.resetCaches=function(){"use strict";this.bootstrapCache={};this.queryCache={'':{tokens:[],results:[]}};};q.prototype.setNullState=function(r){"use strict";this.facebarConfig.null_state=r.map(this._extractStructure.bind(this));};q.prototype.addEntryToNullState=function(r){"use strict";if(this.facebarConfig.null_state){var s=this.facebarConfig.entity_cost+r.grammar_costs['{'+r.type+'}'],t=l.processEntityResult(r.type,r.uid,r.text,s);this.facebarConfig.null_state.unshift(t);}};q.prototype.setSortFunction=function(r){"use strict";this._sortFunction=r;};q.prototype.addBootstrap=function(r){"use strict";var s=this.bootstrapCache;r.forEach(function(t){var u=this.getEntry(t);u.bootstrapped=true;var v=this.tokenize(u.textToIndex,true);if(u.tokens)Array.prototype.push.apply(v,u.tokens.split(' '));v.forEach(function(w){if(!s.hasOwnProperty(w))s[w]={};s[w][t]=true;});},this);};q.prototype.addNullStateToQueryCache=function(r){"use strict";this.saveResults(this.facebarConfig.null_state,r,true);};q.prototype.extendResult=function(r,s){"use strict";var t=r.cache_id.substr(s.cache_id_length);if(t.indexOf("\"")>=0||s.tokens.length===0)return null;var u;if(s.tokens[s.tokens.length-1].length===0){u=s.ext_text+" "+t;}else u=s.ext_text+t;if(u.length===0)return null;s.ext_node.text=u;s.parse.entTokens=[u];s.parse.suffix="";this._extractStructure(s);if(!this._punctRegexp)this._punctRegexp=new RegExp(o.getPunctuation(),'g');s.semantic=s.ext_semantic.replace('(ext_string)','('+u.replace(this._punctRegexp,"")+')');s.isExtendedResult=true;return s;};q.prototype.getResults=function(r,s){"use strict";if(r.tokens.length===0||(r.tokens.length==1&&r.tokens[0]===''))return {results:this.facebarConfig.null_state||[],null_state:true};var t=this._getBestQueryCache(r.cache_id),u=t.results,v={},w=this._getBootstrapMatchByType(r.tokens,v),x=this._addMatchingBootstrapResults(r.tokens,w[0]||{});Array.prototype.push.apply(x,h(this._getResultsFromCache.bind(this,w,r),u));var y={},z=[],aa=false,ba=0;x.sort(this._sortFunction);if(i.keywordSearchEnabled)k.addExactMatch(r,x,s);x.forEach(function(ca){var da=m.fromStruct(ca.structure);if(da.hasType('blank')){z.push(ca);return;}ca.semantic=ca.semantic.toLowerCase();if(!ca.termMatches)ca.termMatches=v[parseInt(ca.semantic,10)];var ea=q.getUniqueSemantic(ca.semantic);if(!ea)return;if(y[ea]){if(ca.isJSBootstrapMatch){y[ea].isJSBootstrapMatch=true;y[ea].bootstrapCost=ca.bootstrapCost;}else if(y[ea].isJSBootstrapMatch&&ca.backendCost!==undefined&&y[ea].backendCost===undefined)y[ea].backendCost=ca.backendCost;if(!!ca.tags)g(y[ea].tags,ca.tags);return;}if(aa&&ca.blankFilled)return;if(ca.type.indexOf('browse_type')>=0){ba+=1;if(this.facebarConfig.maxGrammarResults!==undefined&&ba>this.facebarConfig.maxGrammarResults)return;}aa=aa||!!ca.blankFilled;y[ea]=ca;z.push(ca);}.bind(this));return {results:z,webSuggOnTop:t.webSuggOnTop,webSuggLimit:t.webSuggLimit,webSuggLimitSeeMore:t.webSuggLimitSeeMore};};q.prototype.cacheEnabled=function(r){"use strict";this._enableCache=r;};q.prototype.saveResults=function(r,s,t,u){"use strict";r=r.map(this._processBackendResult.bind(this));var v=[];if(this._enableCache){var w={},x={};r.forEach(function(z){x[z.semantic]=true;z.parse&&z.parse.disambiguation&&z.parse.disambiguation.forEach(function(aa){w[aa]=true;});});var y=this._getBestQueryCache(s.cache_id);y.results.forEach(function(z){if(z.type==='websuggestion')return;if(z.exactMatchKeywords)return;if(z.isExtendedResult)return;if(z.semanticForest in w)return;var aa=this._getDifferenceArrayTokens(z.tokens,s.tokens),ba=this._getNumTokensMatching(aa,z);ba=this._tryMatchingFinalInsertedEntity(aa,ba,z);if(ba>0&&ba==aa.length){z.cacheOnlyResult=!x[z.semantic];v.push(z);}}.bind(this));}r.forEach(function(z){z.tokens=s.tokens;z.cache_id_length=s.cache_id.length;v.push(z);}.bind(this));if(this.queryCache[s.cache_id]===undefined)this.queryCache[s.cache_id]={};g(this.queryCache[s.cache_id],{tokens:s.tokens,results:v,incomplete:t});g(this.queryCache[s.cache_id],u);};q.prototype.alreadyKnown=function(r){"use strict";return !!this.queryCache[r]&&!this.queryCache[r].incomplete;};q.prototype.stripBrackets=function(r){"use strict";return r.replace(/^[\[\{]/,'').replace(/[\]\}]$/,'');};q.prototype._extractStructure=function(r){"use strict";function s(v,w,x){return {type:v==='ent:extend_string'?'text':v,text:w,uid:x||null};}function t(v,w){v.split(' ').forEach(function(x){if(x!==''){if(w)r.chunks.push(r.structure.length);r.structure.push(s('text',x));}r.structure.push(s('text',' '));});r.structure.pop();}function u(v){if(r.structure.length!==0||j.nonGrammarTypes[r.type])return v;return v.charAt(0).toUpperCase()+v.substr(1);}r.structure=[];r.chunks=[];r.parse.display.forEach(function(v){if(typeof v==='string'){t(u(v),true);}else if(v.type==='ent:extend_string'){t(v.text,true);}else if(v.uid){var w=this.getEntry(v.uid,v.fetchType);r.chunks.push(r.structure.length);if(w==null)throw new Error('No entry found for uid \"'+v.uid+'\", type \"'+v.fetchType+'\" and piece text \"'+v.text+'\"');if(w.grammar_like){t(u(w.text),false);}else{var x=v.type;if(v.fetchType)x+=':'+v.fetchType;r.structure.push(s(x,w.text,v.uid));}}else if(v.type=='blank'){r.chunks.push(r.structure.length);r.structure.push(s(v.type,'...'));}}.bind(this));return r;};q.prototype._getDifferenceArrayTokens=function(r,s){"use strict";if(!r.length)return [''].concat(s);var t=r.length-1,u=r[t];if(u==='')u=r[--t];var v='';if(typeof(u)=='string'&&t<s.length)v=s[t].substr(u.length);return [v].concat(s.slice(t+1));};q.prototype._processBackendResult=function(r){"use strict";r.semantic=r.semantic.toString();r.backendCost=r.cost;this._extractStructure(r);if(r.type.match(/^\{.*\}$/))r.useExtendedIndex=true;if(r.parse.extendable){var s=null;r.parse.display.forEach(function(y){if(y.type!=="ent:extend_string")return;s=y;}.bind(this));if(!s||r.semantic.match(/\[.*\]/).length!==1){r.parse.extendable=false;}else{r.ext_node=s;r.ext_semantic=r.semantic.replace(/\[(.*)\]/g,'ext_string');r.ext_text=s.text;}}if(r.semantic.match(/\[\d*\]/)){var t=r.parse,u=t.pos;if(u===undefined){r.semantic=r.semantic.replace(/\[(\d*)\]/g,'$1');}else{var v=t.remTokens[t.remTokens.length-1];if(t.remTokens.length&&r.structure[r.chunks[v]]&&r.structure[r.chunks[v]].uid){u=t.remTokens[t.remTokens.length-1];r.completed=true;}var w=r.structure[r.chunks[u]].uid;if(w===null){r.semantic=r.semantic.replace(/\[(\d*)\]/g,'$1');}else{var x=new RegExp('\\['+w+'\\]','g');r.unsubstituted_semantic=r.semantic;r.semantic=r.semantic.replace(x,w);if(t&&t.disambiguation&&t.disambiguation.length>0){t.disambiguation=t.disambiguation.filter(function(y){return y.indexOf('['+w+']')!==-1;});t.unsubstituted_disambiguation=t.disambiguation.splice(0);t.disambiguation=t.disambiguation.map(function(y){return y.replace(x,w);});}}}}r.semantic=r.semantic.replace(/\[(.*)\]/g,'$1');r.tuid=JSON.stringify({semantic:r.semantic,structure:r.structure});return r;};q.prototype._sortFunction=function(r,s){"use strict";return (r.cost||0)-(s.cost||0);};q.prototype._getResultsFromCache=function(r,s,t){"use strict";var u=s.tokens,v=this._getDifferenceArrayTokens(t.tokens,u),w=[],x=this._getNumTokensMatching(v,t),y=this._tryMatchingFinalInsertedEntity(v,x,t);if(t.parse.extendable||t.isExtendedResult){var z=this.extendResult(s,t);if(z)w.push(z);if(t.isExtendedResult)return w;}if(y>0&&y==v.length&&!(t.type===n.result_type&&v.length===1&&v[0]==='"'))w.push(t);if(i.disableJavascriptSubstitution)return w;Array.prototype.push.apply(w,this._trySubstitutingBootstrapResult(r[u.length-v.length],t,v));if(x<=0)return w;var aa=v.slice(x);x+=u.length-v.length;if(x==u.length){--x;if(x<0)return w;}if(x==u.length-1&&u[x]===''){--x;if(x<0)return w;}Array.prototype.push.apply(w,this._tryMatchingFinalBootstrapResult(r[x],aa,t));return w;};q.prototype._addMatchingBootstrapResults=function(r,s){"use strict";return h(function(t){var u=s[t];if(u===undefined)return [];var v=[];u.forEach(function(w){var x=this.getEntry(w,t);if(!this._isTitleTermMatch(r,x))return;var y=this._isExactNameMatch(r,x)?0:this.facebarConfig.non_title_term_match_penalty,z=this._isNonGrammarTermMatch(r,x),aa=x.grammar_costs['{'+t+'}']+y+this.facebarConfig.entity_cost+this.facebarConfig.grammar_stop_words_penalty*!z,ba=l.processEntityResult(t,w,x.text,aa);ba.bootstrapCost=aa;ba.isJSBootstrapMatch=true;v.push(ba);}.bind(this));return v;}.bind(this),this.facebarConfig.bootstrap_types);};q.prototype._isTitleTermMatch=function(r,s){"use strict";var t=r[0]||{};if(typeof(t)=='object')return false;var u=s.titleToIndex;return r.length===1?o.isPrefixMatch(t,u):o.isExactMatch(t,u);};q.prototype._isExactNameMatch=function(r,s){"use strict";var t=r[0]||{};if(typeof(t)=='object')return 0;var u=s.text;if(r.length===1?o.isPrefixMatch(t,u):o.isExactMatch(t,u))return true;return r.length==1&&s.alias!==undefined&&o.isExactMatch(t,s.alias);};q.prototype._isNonGrammarTermMatch=function(r,s){"use strict";var t=o.parse(s.titleToIndex.toLowerCase()),u=t.tokens.filter(function(x){return x!==''&&!this.facebarConfig.grammar_stop_words[x];}.bind(this));u=u.join(' ');for(var v=0;v<r.length;++v){if(typeof(r[v])=='object')return true;var w=v===r.length-1?o.isPrefixMatch(r[v],u):o.isQueryMatch(r[v],u);if(w)return true;}return false;};q.prototype._getBootstrapMatchByType=function(r,s){"use strict";if(r.length===0)return [];var t=r.map(function(){return {};}),u=(r[r.length-1]===''),v={},w,x=(u?r.length-1:r.length);if(x&&r[x-1].uid){this._pushBootstrapEntryAtPosition(t,x-1,r[x-1].uid);return t;}for(var y in this.bootstrapCache)if(x&&y.indexOf(r[x-1])===0&&(!u||y===r[x-1]))for(w in this.bootstrapCache[y])if(!v[w]){v[w]=1;this._addMatchedTerm(w,y,s);this._pushBootstrapEntryAtPosition(t,x-1,w);}for(var z=x-2;z>=0;z--){if(typeof(r[z])=='object')break;if(r[z].length&&r[z][0]=='"')break;for(w in this.bootstrapCache[r[z]]){if(!v[w])v[w]=0;if(v[w]+z==x-1){++v[w];this._addMatchedTerm(w,r[z],s);this._pushBootstrapEntryAtPosition(t,z,w);}}}return t;};q.prototype._addMatchedTerm=function(r,s,t){"use strict";(t[r]=t[r]||[]).push(s);return t;};q.prototype._pushBootstrapEntryAtPosition=function(r,s,t){"use strict";var u=this.getEntry(t);if(!u)return;for(var v in u.grammar_costs){var w=this.stripBrackets(v);if(r[s][w]===undefined)r[s][w]=[];r[s][w].push(t);}};q.prototype._getNumTokensMatching=function(r,s){"use strict";var t=0,u=s.parse,v=r.length,w=null,x=null;if(u.pos!==undefined){var y=s.structure[s.chunks[u.pos]];if(y){w=y.uid;x=y.type.split(':')[2];}}s.outputTokensUsed=[];s.termMatches=[];if(w){t=this._prefixMatchEntity(r,u,w,s.outputTokensUsed,x,!!s.useExtendedIndex,s.termMatches);if(t===0||t===v)return t;}else if(u.suffix&&v==1&&u.suffix.indexOf(r[0])===0){return v;}else if(u.suffix==r[0]){++t;}else return 0;var z=[];for(var aa=0;aa<u.remTokens.length;aa++){if(typeof(r[t])!='string'||s.chunks.length<=u.remTokens[aa]||s.structure.length<=s.chunks[u.remTokens[aa]]||s.structure[s.chunks[u.remTokens[aa]]].uid)break;var ba=s.structure[s.chunks[u.remTokens[aa]]].text;z.push(ba.toLowerCase());}t=this._greedyMatchText(z,r,t,u.remTokens,s.outputTokensUsed);if(t==v-1&&r[t]==='')return v;return t;};q.prototype._prefixMatchEntity=function(r,s,t,u,v,w,x){"use strict";if(s.entTokens.length===0){if(r[0]!=='')return 0;if(s.possessive&&r.length>1&&r[1]=='\'s'){u.push([s.pos+1]);return 2;}else return 1;}var y=false,z=this.getEntry(t,v);if(typeof(v)!=='undefined'&&v!==z.fetchType)return 0;var aa=this.tokenize(w?z.textToIndex:z.text,true),ba=[];for(var ca=0;ca<r.length+s.entTokens.length-1;ca++)if(ca<s.entTokens.length-1){ba.push(s.entTokens[ca]);}else if(ca==s.entTokens.length-1){ba.push(s.entTokens[ca]+r[0]);}else ba.push(r[ca-s.entTokens.length+1]);var da=-s.entTokens.length+1;for(var ea=0;ea<ba.length;++ea){var fa=ba[ea];if(typeof(fa)!='string')break;if(fa===''){da++;continue;}var ga=false;for(var ha=0;ha<aa.length;ha++)if(aa[ha]==fa||(ea===ba.length-1&&aa[ha].indexOf(fa)===0)){if(x)x.push(aa[ha]);aa[ha]='';ga=true;++da;break;}if(ga)continue;if(!s.possessive||fa.length<=2||fa.substr(fa.length-2)!='\'s')break;var ia=fa.substr(0,fa.length-2);for(ha=0;ha<aa.length;ha++)if(aa[ha]==ia){++da;if(u)y=true;break;}break;}if(da>0){if(y)u.push([s.pos+1]);return da;}if(u===undefined)return 0;var ja=r[0],ka=ja;if(s.possessive&&ja.length>=2&&ja.substr(ja.length-2)=='\'s')ka=ja.substr(0,ja.length-2);if((r.length==1&&s.suffix.indexOf(ja)===0)||s.suffix==ka||s.suffix==ja){if(ka!=ja&&s.suffix==ka)u.push([s.pos+1]);return 1;}return 0;};q.prototype._tryMatchingFinalInsertedEntity=function(r,s,t){"use strict";if(!t.completed||s<0)return s;var u=t.parse,v=u.remTokens[u.remTokens.length-1],w=t.structure[t.chunks[v]],x=this.getEntry(w.uid,w.type),y=this.tokenize(x.text,true);s=this._greedyMatchText(y,r,s);if(s==r.length-1&&r[s]==='')return r.length;return s;};q.prototype._greedyMatchText=function(r,s,t,u,v){"use strict";for(var w=0;w<r.length;w++){var x=r[w];if(x==s[t]){if(v!==undefined)v.push(u[w]);++t;continue;}if(t===s.length-1&&x.indexOf(s[t])===0){if(v!==undefined)if(x==s[t]){v.push([u[w]]);}else v.push([u[w],s[t].length]);return s.length;}}return t;};q.prototype._createMapOverFinalBootstrapUids=function(r,s,t,u,v,w){"use strict";return function(x){var y=this.getEntry(x,v);if(y===undefined||w(x,y)===false)return;var z={};g(z,r);if(!z.iconClass)z.photo=y.photo;z.cost=r.cost+q.EPSILON+y.grammar_costs['{'+v+'}']-t.grammar_costs['{'+v+'}'];z.cache_id_length=Infinity;z.structure=r.structure.slice(0);z.structure[r.chunks[u]]={type:s.type,text:y.text,uid:x};z.blankFilled=true;var aa=new RegExp('\\['+s.uid+'\\]','g');z.semantic=r.unsubstituted_semantic.replace(aa,x);if(z.parse&&z.parse.disambiguation&&z.parse.disambiguation.length>0)z.parse.disambiguation=z.parse.unsubstituted_disambiguation.map(function(ba){return ba.replace(aa,x);});z.tuid=JSON.stringify({semantic:z.semantic,structure:z.structure});return z;}.bind(this);};q.prototype._tryMatchingFinalBootstrapResult=function(r,s,t){"use strict";if(!t.completed)return [];var u=t.parse,v=u.remTokens[u.remTokens.length-1],w=t.structure[t.chunks[v]],x=w.type.substr(4).replace(':blank',''),y=this.getEntry(w.uid,x),z=r[x];if(z===undefined||y===undefined||y.grammar_costs===undefined)return [];return z.map(this._createMapOverFinalBootstrapUids(t,w,y,v,x,function(aa,ba){return s.length==this._greedyMatchText(this.tokenize(ba.text),s,0);}.bind(this))).filter(function(aa){return !!aa;});};q.prototype._trySubstitutingBootstrapResult=function(r,s,t){"use strict";if(s.unsubstituted_semantic===undefined||s.completed||s.type===p)return [];var u=s.parse.pos,v=s.structure[s.chunks[s.parse.pos]],w=v.type.substr(4),x=r[w];if(x===undefined)return [];var y=this.getEntry(v.uid);if(!y||y.grammar_costs===undefined)return [];return x.map(this._createMapOverFinalBootstrapUids(s,v,y,u,w,function(z){return this._prefixMatchEntity(t,s.parse,z)===t.length;}.bind(this))).filter(function(z){return !!z;});};q.prototype._getBestQueryCache=function(r){"use strict";for(var s=r.length;s>=0;s--){var t=this.queryCache[r.slice(0,s)];if(t)return t;}};q.prototype._getFBObjectType=function(r){"use strict";if(this.typeaheadTypeMap[r]){return this.typeaheadTypeMap[r];}else return 'page';};q.EPSILON=1e-05;q.getUniqueSemantic=function(r){var s=[],t=[],u=[];r='('+r+')';var v=r,w=false;r.replace(/[\(\),]/g,function(x,y){var z;switch(x){case ',':var aa=u.length-1;z=v.substr(u[aa],y-u[aa]);s[aa].push(z);u[aa]=y+1;break;case '(':u.push(y+1);s.push([]);t.push(y+1);break;case ')':if(u.length===0)throw r+' is not a valid semantic string';var ba=u.pop();z=v.substr(ba,y-ba);z=decodeURI(z.replace(/%/g,'%25').trim());var ca=s.pop();ca.push(z);var da=ca.sort();for(var ea=1;ea<da.length;ea++)if(da[ea]==da[ea-1])w=true;var fa=da.join(',');v=v.substr(0,t.pop())+fa+v.substr(y);break;}return x;});if(w)return '';return v.replace(/\((.*)\)/,'$1');};e.exports=q;});
__d("FacebarTokenizer",["TokenizeUtil"],function(a,b,c,d,e,f){var g=b('TokenizeUtil'),h="[^\"]",i=["\\s's","'s","\""+h+"*\"?"],j=[[/\s+$/,''],[/\"\s+/,'"'],[/\s+\"/,'"'],[/\"\"/,''],[/^\"$/,''],[/\s+/,' ']],k={tokenize:function(l,m){var n=[],o=0;l=l.replace(/\s/g,' ').toLowerCase();l.replace(new RegExp(i.join('|'),'g'),function(q,r){if(r>o){var s=l.substr(o,r-o);Array.prototype.push.apply(n,g.parse(s).tokens.slice(0));}var t=q;for(var u=0;u<j.length;u++){var v=j[u];t=t.replace(v[0],v[1]);}if(n.length&&t=='\'s'){n[n.length-1]+=t;}else if(t!=='')n.push(t);if(m)Array.prototype.push.apply(n,g.parse(q).tokens);o=r+q.length;});if(o<l.length){var p=l.substr(o,l.length-o);Array.prototype.push.apply(n,g.parse(p).tokens.slice(0));}return n;}};e.exports=k;});
__d("FacebarTypeaheadTypeNamedX",[],function(a,b,c,d,e,f){var g={browse_type_user:'user',browse_type_page:'page',browse_type_place:'place',browse_type_group:'group',browse_type_application:'app'},h=1,i=2;function j(){"use strict";}j.addTypeNamedX=function(k,l,m,n,o){"use strict";var p=new j(),q=[],r=[];k.forEach(function(w){delete w.tags.hiddenSeeMore;if(w.isSeeMore){q.push(w);}else r.push(w);});if(m)r.length=Math.min(r.length,l);var s=p.buildTypeNamedXBuckets(r,q,n,o),t=s[0],u=s[1];t.forEach(function(w){w.tags.displayedSeeMore=true;});var v=p.replaceResults(r,l,t);Array.prototype.push.apply(v,u);v.forEach(function(w){if(m){w.tags.bottomSeeMore=true;}else w.tags.hiddenSeeMore=true;});if(m)Array.prototype.push.apply(r,v);return r;};j.prototype.buildTypeNamedXBuckets=function(k,l,m,n){"use strict";var o={};n=n||{};k.forEach(function(t,u){var v=t.render_type||t.type;if(o[v]===undefined)o[v]={index:u,matchCount:0};if(!n.alwaysDisplayTypeNamedX&&t.text.toLowerCase().indexOf(m.toLowerCase())<0)return;o[v].matchCount++;});var p=[],q=0,r=[];l.forEach(function(t){var u=g[t.results_set_type];if(o[u]!==undefined&&o[u].matchCount>=h&&q<i){p.push([t,o[u].index]);q++;}else r.push(t);});p.sort(function(t,u){return t[1]-u[1];});var s=p.map(function(t){return t[0];});return [s,r];};j.prototype.replaceResults=function(k,l,m){"use strict";var n=[],o=Math.min(0,k.length-l)+m.length;for(var p=0;p<o;++p){var q=-1;for(var r=0;r<Math.min(l-p,k.length);++r){var s=k[r];if(!s.exactMatchKeywords&&s.type!=='websuggestion')q=r;}if(q>=0){n.push(k[q]);k.splice(q,1);}}Array.prototype.unshift.apply(k,m);return n;};e.exports=j;});
__d("ResultsBucketizer",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i,j){"use strict";this.$ResultsBucketizer0=i;this.$ResultsBucketizer1=j;}h.trimResults=function(i,j,k){"use strict";var l=[];i.forEach(function(m,n){if(m.indexBeforeBuckets>j)l.push({index:n,originalIndex:m.indexBeforeBuckets});});l.sort(function(m,n){return m.originalIndex-n.originalIndex;}).slice(k).sort(function(m,n){return n.index-m.index;}).forEach(function(m){i.splice(m.index,1);});};h.mergeBuckets=function(i,j){"use strict";var k=[];for(var l in j)if(!j[l].rule.hidden&&(!j[l].rule.xor||!j[j[l].rule.xor]))k.push(j[l]);k.sort(function(m,n){var o=(m.rule.position||0)-(n.rule.position||0);if(o!==0)return o;return m.results[0].indexBeforeBuckets-n.results[0].indexBeforeBuckets;});i.length=0;k.forEach(function(m,n){if(m.rule.maxPromotions!=null&&n<k.length-1)h.trimResults(m.results,k[n+1].results[0].indexBeforeBuckets,m.rule.maxPromotions);Array.prototype.push.apply(i,m.results);}.bind(this));};h.prototype.$ResultsBucketizer2=function(i,j){"use strict";if(j.propertyName==null)return j.bucketName||'default';var k=this.$ResultsBucketizer1(i,j.propertyName);if(k==null||(j.propertyValue!=null&&(''+k)!==j.propertyValue))return false;return j.bucketName||(j.propertyName+'.'+k);};h.prototype.$ResultsBucketizer3=function(i,j){"use strict";var k={};i.forEach(function(l,m){j.some(function(n){var o=this.$ResultsBucketizer2(l,n);if(o===false)return false;if(k[o]==null)k[o]={results:[],rule:n};if(!!n.maxResults&&k[o].results.length>=n.maxResults)return true;l.bucketLineage.push({bucketName:o,bucketIndex:k[o].results.length});k[o].results.push(l);return true;}.bind(this));}.bind(this));return k;};h.prototype.$ResultsBucketizer4=function(i,j){"use strict";var k=this.$ResultsBucketizer0[j];if(!k)return {};var l=this.$ResultsBucketizer3(i,k);for(var m in l){var n=l[m].rule.subBucketRules;if(!!n)this.$ResultsBucketizer4(l[m].results,n);}h.mergeBuckets(i,l);return l;};h.prototype.$ResultsBucketizer5=function(i,j,k){"use strict";if(j.length<=k)return j.slice();var l=j.map(function(n){return n.indexBeforeBuckets;}),m=l.sort(function(n,o){return n-o;})[k];return j.filter(function(n){return n.indexBeforeBuckets<m;});};h.prototype.bucketize=function(i,j,k){"use strict";i.forEach(function(l,m){l.bucketLineage=[];l.indexBeforeBuckets=m;});k=k||{};g(k,this.$ResultsBucketizer4(i,'main'));return this.$ResultsBucketizer5(k,i,j);};e.exports=h;});
__d("FacebarDataSource",["Arbiter","AsyncRequest","BingScalingCommon","FacebarGlobalOptions","FacebarResultStore","FacebarStructuredText","FacebarTokenizer","FacebarTypeaheadTypeNamedX","FacebarTypeaheadL2Terms","FacebarTypeNamedXTokenOptions","FacebarURI","ResultsBucketizer","ResultsBucketizerConfig","FacebarJSConstants","SearchDataSource","Vector","ViewportBounds","copyProperties","throttle","invariant"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('BingScalingCommon'),j=b('FacebarGlobalOptions'),k=b('FacebarResultStore'),l=b('FacebarStructuredText'),m=b('FacebarTokenizer'),n=b('FacebarTypeaheadTypeNamedX'),o=b('FacebarTypeaheadL2Terms'),p=b('FacebarTypeNamedXTokenOptions'),q=b('FacebarURI'),r=b('ResultsBucketizer'),s=b('ResultsBucketizerConfig'),t=b('FacebarJSConstants'),u=b('SearchDataSource'),v=b('Vector'),w=b('ViewportBounds'),x=b('copyProperties'),y=b('throttle'),z=b('invariant'),aa=100,ba=250;for(var ca in u)if(u.hasOwnProperty(ca))ea[ca]=u[ca];var da=u===null?null:u.prototype;ea.prototype=Object.create(da);ea.prototype.constructor=ea;ea.__superConstructor__=u;function ea(fa){"use strict";u.call(this,fa);this.filterOutWebSuggestion=true;this.bootstrap_saved=[];this._fetched_null_state=null;this._initialQueryData=null;this._curQueryId=-1;this._seeMore=false;this._waitingQueries=0;this.mixGrammarAndEntity=fa.mixGrammarAndEntity!==undefined?fa.mixGrammarAndEntity:true;this.grammarVersion=fa.grammarVersion||'';if(!fa.grammarOptions)fa.grammarOptions={};this.recordingRoute=fa.grammarOptions.recordingRoute||'banzai_vital';this._maxGrammarResults=fa.grammarOptions.maxGrammarResults;this.nullStateEndpoint=fa.nullStateEndpoint||'/ajax/browse/null_state.php';this.setNullStateData(fa.nullStateData||{},true);this._minWebSugg=fa.minWebSugg||1;this._minQueryLength=fa.minQueryLength||-1;this.allowWebSuggOnTop=fa.allowWebSuggOnTop||false;this._maxWebSuggToCountFetchMore=fa.maxWebSuggToCountFetchMore||0;this._fixProcessLean=fa.grammarOptions.fixProcessLean||false;if(fa.throttled==='0'){this.executeQueryThrottled=this.executeQuery;this.sendRemoteQueryThrottled=this.sendRemoteQuery;}else{this.executeQueryThrottled=y(this.executeQuery,aa,this);this.sendRemoteQueryThrottled=y(this.sendRemoteQuery,ba,this);}this.resultStoreOptions=fa.grammarOptions||{};this.resultStoreOptions.useNewExactNameMatch=(fa.grammarOptions.useNewExactNameMatch==="true");this._bypassBucketizer=false;this._resultsBucketizer=new r(s.rules,function(ga,ha){switch(ha){case 'isSeeMore':return ga.isSeeMore;case 'objectType':return ga.type;case 'resultSetType':return ga.results_set_type;case 'renderType':return ga.render_type||ga.type;case 'cacheOnlyResult':return ga.cacheOnlyResult;case 'closeEntity':return ga.bootstrapped||(!!ga.tags?ga.tags[ha]:undefined);default:return !!ga.tags?ga.tags[ha]:undefined;}});this.fetchNullState();this.initWithConfig(j.grammarConfig);}ea.prototype.initWithConfig=function(fa){"use strict";this.facebarConfig=fa;this.createResultStore();if(this._fetched_null_state){this.setNullState(this._fetched_null_state);this._fetched_null_state=null;}};ea.prototype.createResultStore=function(){"use strict";this.facebarConfig.maxGrammarResults=this._maxGrammarResults;this.resultStore=new k(this.facebarConfig,m.tokenize,this.getEntry.bind(this),this.resultStoreOptions);this.addEntries(this.bootstrap_saved);if(this._fixProcessLean)this._processLean();this.bootstrap_saved=[];this.subscribe('enableCache',function(fa,ga){this.resultStore.cacheEnabled(ga);}.bind(this));this.subscribe('setSortFunction',function(fa,ga){this.resultStore.setSortFunction(ga);}.bind(this));};ea.prototype.dirty=function(){"use strict";this.bootstrap_saved=[];this._nullStateFetched=false;if(this.resultStore)this.resultStore.resetCaches();da.dirty.call(this);};ea.prototype.addEntries=function(fa){"use strict";if(this.resultStore){this.resultStore.addBootstrap(this.processEntries(fa));}else Array.prototype.push.apply(this.bootstrap_saved,fa);};ea.prototype._processLean=function(){"use strict";if(this._fixProcessLean){if(this._leanPayload&&this.resultStore){var fa,ga=this._leanPayload.entries;for(var ha in ga){fa=this.getEntry(ha);if(!fa)continue;for(var ia in ga[ha]){if(!fa.grammar_costs)fa.grammar_costs={};fa.grammar_costs['{'+ia+'}']=ga[ha][ia];}}this.setExclusions(this._leanPayload.blocked);this._leanPayload=null;}}else da._processLean.call(this);};ea.prototype.setNullStateData=function(fa,ga){"use strict";if(ga)this.nullStateData={grammar_version:this.grammarVersion};x(this.nullStateData,fa);return this;};ea.prototype.setNullState=function(fa){"use strict";this._null_state=fa;this.processEntries(this._null_state.entities);this.resultStore.setNullState(this._null_state.queries);this.resultStore.addNullStateToQueryCache(this.getRawStructure(l.fromString('')));};ea.prototype.overrideNullState=function(fa){"use strict";z(this._null_state!=null);this._original_null_state=this._original_null_state||this._null_state;this.setNullState(fa);};ea.prototype.restoreNullState=function(){"use strict";if(this._original_null_state)this.setNullState(this._original_null_state);};ea.prototype.fetchNullState=function(){"use strict";if(this._nullStateFetched||!j.allowGrammar)return;var fa=new h().setURI(this.nullStateEndpoint).setData(this.nullStateData).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setHandler(function(ga){if(this.resultStore){this.setNullState(ga.payload);this.inform('nullstateReady',true);}else this._fetched_null_state=ga.payload;this._nullStateFetched=true;}.bind(this)).setFinallyHandler(this.activityEnd.bind(this));this.activityStart();fa.send();};ea.prototype.fetchNUXResults=function(fa){"use strict";if(!j.allowGrammar)return;fa=fa||{};var ga=new h().setURI(fa.URI).setData(this.nullStateData).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setHandler(function(ha){if(this.resultStore){this.overrideNullState(ha.payload);fa.success&&fa.success();}}.bind(this)).setFinallyHandler(this.activityEnd.bind(this));this.activityStart();ga.send();};ea.prototype.toTypeaheadEntryUid=function(fa){"use strict";var ga,ha=l.fromStruct(fa.structure),ia=ha.getFragment(0);if(ha.getCount()==1&&ia.isType('ent')){var ja=ia.getType().split(':')[2];ga=this.getEntry(ia.getUID(),ja);ga.type=this.resultStore.stripBrackets(fa.type);}else{ga=this.getEntry(fa.tuid);if(!ga){ga={dynamic_cost:fa.dynamic_cost,extra_uri_params:fa.extra_uri_params,icon_class:fa.iconClass,memcache:fa.fromMemcache,photo:fa.photo,results_set_type:fa.resultsSetType,tuid:fa.tuid,type:fa.type,uid:fa.tuid,tags:fa.tags,websuggestion_source:fa.websuggestion_source,is_redirect:fa.isRedirect};this.processEntries([ga]);ga=this.getEntry(fa.tuid);}}if(ga.type==='websuggestion'||ga.is_redirect)ga.path=fa.path;ga.error_info=fa.errorInfo;ga.logInfo=fa.logInfo;ga.structure=ha;ga.text=ga.structure.toString();ga.queryTypeText=fa.queryTypeText;ga.semantic=fa.semantic;ga.tree=fa.tree;ga.cost=fa.cost;ga.isSeeMore=!!fa.isSeeMore;ga.isNullState=!!fa.isNullState;ga.isSingleState=!!fa.isSingleState;ga.isTrending=!!fa.isTrending;ga.entityInfo=fa.entityInfo;ga.cacheOnlyResult=fa.cacheOnlyResult||false;ga.isExtendedResult=fa.isExtendedResult||false;if(fa.isExtendedResult){ga.uri=q.getURI(this.facebarConfig,ga);}else ga.uri=ga.uri||q.getURI(this.facebarConfig,ga);ga.semanticForest=fa.semanticForest;ga.entityTypes=fa.entityTypes;ga.parse=fa.parse;ga.tags=fa.tags||{};ga.isKeywordL2=fa.keywordResultType==='entity_l2';ga.exactMatchKeywords=fa.exactMatchKeywords||false;ga.qid=fa.qid;ga.templateID=fa.templateID;ga.removable=true;if(fa.isJSBootstrapMatch){ga.isJSBootstrapMatch=fa.isJSBootstrapMatch;ga.backendCost=fa.backendCost;ga.bootstrapCost=fa.bootstrapCost;}this._replaceCategoryWithTermMatches(ga,fa);return ga.tuid;};ea.prototype._replaceCategoryWithTermMatches=function(fa,ga){"use strict";if(fa.type!=="user"||!fa.term_to_subtitle||!ga.termMatches)return;var ha=[];ga.termMatches.forEach(function(ja){if(fa.term_to_subtitle[ja])ha.push(fa.term_to_subtitle[ja]);}.bind(this));if(fa.category===undefined)fa.category="";var ia=fa.category.split(" \xB7 ");ia.unshift.apply(ia,ha);ia=ia.filter(function(ja,ka,la){return ka==la.indexOf(ja);});fa.category=ia.splice(0,2).join(" \xB7 ");};ea.prototype.getRawStructure=function(fa){"use strict";if(typeof fa=='string')fa=l.fromString(fa);if(this.resultStore)return this.resultStore.transformStructured(fa.toArray());};ea.prototype.isSeeMore=function(){"use strict";return this._seeMore;};ea.prototype.saveResult=function(fa){"use strict";this._initialQueryData=this.getUID(fa.uid,fa.fetchType);};ea.prototype.buildUids=function(fa){"use strict";if(!fa||!this.resultStore)return [];if(typeof fa=='string')fa=l.fromString(fa);var ga=this.getRawStructure(fa),ha=this.resultStore.getResults(ga,this.getMaxResults()),ia=ha.results;if(typeof ia==='undefined')return [];var ja=ha.webSuggOnTop;if(typeof ja==='undefined')ja=false;var ka=ha.webSuggLimit||0,la=ha.null_state===true,ma=this.filterOutWebSuggestion&&!la,na=0;ia=ia.filter(function(sa,ta){if(!j.allowGrammar&&sa.type=='grammar')return false;if(sa.type!='websuggestion'){return sa.semantic!='<blank>'&&(sa.type!='unimplemented'||na++===0);}else return !ma;}.bind(this));var oa=ia.slice(),pa=[],qa=[],ra=[];ia.forEach(function(sa){if(sa.forcedPosition>0){ra.push(sa);}else if(sa.isSeeMore){pa.push(sa);}else qa.push(sa);});if(la){ia=this.orderNullState(ia,this.getMaxResults());}else if(j.webSuggestionsEnabled){ia=i.integrateWebsuggestions(qa,Boolean(ja),this.getMaxResults(),ka,this._minWebSugg);}else ia=qa;this.inform('decorateSeeMoreSuggestions',{structured:fa,allResults:oa,selectedResults:ia,seeMoreResults:pa});if(ra.length>0){ra.sort(function(sa,ta){return sa.forcedPosition-ta.forcedPosition;});ra.forEach(function(sa){ia.splice(sa.forcedPosition,0,sa);});}if(pa.length>0)ia.push.apply(ia,pa);return ia.map(this.toTypeaheadEntryUid.bind(this));};ea.prototype.orderNullState=function(fa,ga){"use strict";var ha={top:[],bottom:[],middle:[]},ia=function(la){var ma=la.null_state_position;return ha.hasOwnProperty(ma)?ma:'middle';},ja=function(la,ma){return la.original_cost-ma.original_cost;};fa&&fa.forEach(function(la){ha[ia(la)].push(la);}.bind(this));for(var ka in ha){ha[ka]=ha[ka].sort(ja).slice(0,ga);ga-=ha[ka].length;}return [].concat(ha.top,ha.middle,ha.bottom);};ea.prototype.handleResponse=function(fa,ga){"use strict";if(!(fa.payload.errors)){this.processEntries(fa.payload.entities);this.filterOutWebSuggestion=true;for(var ha=0;ha<fa.payload.results.length;ha++)if(fa.payload.results[ha].type=='websuggestion'){this.filterOutWebSuggestion=false;break;}fa.payload.results.forEach(function(ja){ja.qid=this._curQueryId;}.bind(this));var ia={};['webSuggOnTop','webSuggLimit','webSuggLimitSeeMore'].forEach(function(ja){if(fa.payload.hasOwnProperty(ja))ia[ja]=fa.payload[ja];});this.resultStore.saveResults(fa.payload.results,ga,fa.payload.incomplete,ia);}};ea.prototype.processEntries=function(fa){"use strict";return fa.map(function(ga,ha){var ia=(ga.uid=ga.uid+'');ga.textToIndex=this.getTextToIndex(ga);ga.titleToIndex=this.getTitleTerms(ga);ia=this.getUID(ia,ga.fetchType);var ja=this.getEntry(ia);if(!ja){this.setEntry(ia,{});ja=this.getEntry(ia);}x(ja,ga);ja.tokenVersion=ga.tokenVersion;ja.tuid=ia;ja.index===undefined&&(ja.index=ha);return ia;}.bind(this));};ea.prototype.getUID=function(fa,ga){"use strict";fa=fa+'';if(ga!==undefined){ga=/([^:]+:)?([^:]+)(:.*)?/.exec(ga)[2];return JSON.stringify([fa,ga]);}return fa;};ea.prototype.getEntry=function(fa,ga){"use strict";var ha;fa=''+fa;ha=ga!=null?da.getEntry.call(this,this.getUID(fa,ga))||da.getEntry.call(this,fa):da.getEntry.call(this,fa);return ha;};ea.prototype.getEntryForFragment=function(fa){"use strict";return this.getEntry(fa.getUID(),fa.getTypePart(2));};ea.prototype.getMaxResults=function(){"use strict";return this._numResults.max;};ea.prototype.query=function(fa,ga,ha,ia){"use strict";this.executeQueryThrottled(fa,ia,this._initialQueryData);this._initialQueryData=null;};ea.prototype.executeQuery=function(fa,ga,ha){"use strict";this._seeMore=ga===true;this._curQueryId++;this.setQueryData({qid:this._curQueryId,see_more:this._seeMore,max_results:(this.getMaxResults()+p.additionalResultsToFetch)});this.inform('beforeQuery',{value:fa,queryId:this._curQueryId});var ia=this.buildUids(fa,[]);if(ha&&ia.length===0)ia.push(ha);this.value=fa;this.inform('query',{value:fa,results:ia,see_more:this._seeMore,queryId:this._curQueryId});if(this.resultStore)this.respond(fa,ia,false);};ea.prototype.shouldFetchMore=function(fa,ga){"use strict";if(fa.is_empty)return false;if(this._seeMore)return true;if(this.resultStore.alreadyKnown(fa.cache_id))return false;if(fa.raw_text&&this._isQueryTooShort(fa.raw_text))return false;if(ga.length<this.getMaxResults())return true;return this.countValidResults(ga)<this.getMaxResults();};ea.prototype.countValidResults=function(fa){"use strict";var ga=0,ha=0;fa.forEach(function(ia){var ja=this.getEntry(ia);if(ja&&!ja.isNullState)if(ja.type==='websuggestion'){ga++;}else ha++;}.bind(this));return ha+Math.min(this._maxWebSuggToCountFetchMore,ga);};ea.prototype.sendRemoteQuery=function(fa,ga){"use strict";var ha=new h().setURI(this.queryEndpoint).setData(this.getQueryData(fa.text_form)).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setHandler(function(ia,ja){ja.queryId=ia;this.inform('response_received',ja);this.handleResponse(ja,fa);this.respond(ga,this.buildUids(ga),true,ja.payload&&(!ja.payload.results||ja.payload.results.length===0));this.inform('backend_response',ja);}.bind(this,this._curQueryId)).setFinallyHandler(this.activityEnd.bind(this));this.inform('sending_request',ha);this.activityStart();ha.send();};ea.prototype.activityStart=function(){"use strict";if(!this._waitingQueries)this.inform('activity',{activity:true,seeMore:this._seeMore},g.BEHAVIOR_STATE);this._waitingQueries++;};ea.prototype.activityEnd=function(){"use strict";this._waitingQueries--;if(!this._waitingQueries)this.inform('activity',{activity:false,seeMore:this._seeMore},g.BEHAVIOR_STATE);};ea.prototype._bucketizeResults=function(fa,ga){"use strict";ga=this._tagKeywordsSuggestions(ga);ga=o.addL2Terms(ga,this.getMaxResults(),fa.toString(),j);ga=n.addTypeNamedX(ga,this.getMaxResults(),this.isSeeMore(),fa.toString(),j);var ha=this.isSeeMore()?ga.length:Math.min(ga.length,this.getMaxResults());return this._resultsBucketizer.bucketize(ga,ha);};ea.prototype._tagKeywordsSuggestions=function(fa){"use strict";if(!fa||fa.length===0)return fa;var ga=fa[0];if(ga.bootstrapped)return fa;if(ga.type==='grammar'||(ga.cost<j.closeEntityThreshold&&ga.type==='user'))return fa;return fa.map(function(ha){if(ha.type!==t.keywordType)return ha;ha=x(null,ha);ha.tags.topBucket=true;return ha;});};ea.prototype.setBypassBucketizer=function(fa){"use strict";this._bypassBucketizer=fa;};ea.prototype.respond=function(fa,ga,ha,ia){"use strict";this.inform('reorderResults',ga);this.inform('respondValidUids',ga);var ja=ga.map(this.getEntry.bind(this));if(!!fa&&(fa instanceof l&&!fa.isEmptyOrWhitespace())&&!this._bypassBucketizer)ja=this._bucketizeResults(fa,ja);if(!ha){var ka=this.getRawStructure(fa);if(this.shouldFetchMore(ka,ja))this.sendRemoteQueryThrottled(ka,fa);}if(!this.isSeeMore())ja.length=Math.min(ja.length,this.getMaxResults());this.inform('respond',{value:fa,results:ja,isAsync:!!ha,isEmptyResults:ia,isScrollable:this.isSeeMore()});return ja;};ea.prototype._updateMaxResults=function(){"use strict";var fa=v.getViewportDimensions().y,ga=w.getTop()||42,ha=56,ia=48;this.setMaxResults(Math.max(this._numResults.min,Math.min(this._numResults.max,Math.floor((fa-ga-ia-25)/ha)-1)));};ea.prototype.getCurQueryId=function(){"use strict";return this._curQueryId;};x(ea.prototype,{events:['query','respond','bootstrapped','activity','ready']});e.exports=ea;});
__d("FacebarTypeaheadDebugPane.react",["Banzai","LeftRight.react","ReactPropTypes","React","Image.react"],function(a,b,c,d,e,f){var g=b('Banzai'),h=b('LeftRight.react'),i=b('ReactPropTypes'),j=b('React'),k=b('Image.react'),l=j.createClass({displayName:'FacebarTypeaheadDebugPane',propTypes:{result:i.object.isRequired},getInitialState:function(){return {feedbackSent:false};},componentWillReceiveProps:function(m){if(m.result!==this.props.result)this.setState({feedbackSent:false});},sendFeedback:function(m){var n=this.props.result;if(n.decoration.entity===n)n.decoration.entity='';var o=JSON.stringify(n),p=JSON.stringify(n.debug.allResults),q={result:o,query:n.debug.query,position:n.debug.position,sid:n.debug.sid,allResults:p,isOK:m};g.post('facebar_feedback',q,{delay:0});this.setState({feedbackSent:true});this.setState({feedbackOK:m});return false;},renderDebugText:function(m){return j.DOM.div(null,m);},render:function(){var m=this.sendFeedback.bind(this,true),n=this.sendFeedback.bind(this,false),o=this.state.feedbackSent,p=o&&this.state.feedbackOK,q=o&&!this.state.feedbackOK;return (j.DOM.div({className:"fsm pam"},h(null,j.DOM.div(null,this.props.result.debug.map(this.renderDebugText)),j.DOM.div(null,j.DOM.div({className:p?'':'hidden_elem'},j.DOM.strong(null,"Feedback sent"),k({className:"mls",src:'/images/green_up.gif'})),j.DOM.div({className:q?'':'hidden_elem'},j.DOM.strong(null,"Feedback sent"),k({className:"mls",src:'/images/red_down.gif'})),j.DOM.div({className:o?'hidden_elem':''},j.DOM.a({href:"#",onClick:m},k({src:'/images/green_up.gif'})),j.DOM.a({href:"#",onClick:n},k({className:"mls",src:'/images/red_down.gif'})))))));}});e.exports=l;});
__d("FacebarTypeaheadDiffText.react",["React","ReactPropTypes","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('ReactPropTypes'),i=b('cx'),j=g.createClass({displayName:'FacebarTypeaheadDiffText',propTypes:{prefix:h.string,text:h.string},renderDiff:function(k){return (g.DOM.span({className:"_5td3"},k));},renderParts:function(){var k=this.props.prefix,l=this.props.text;if(k==null)return this.renderDiff(l);var m=l.toLowerCase().indexOf((k.toLowerCase()));k=k.trim();if(m===0)l=l.slice(k.length);var n=l.split(/\b/).map(this.renderDiff);if(m===0)n.unshift(k);return n;},render:function(){return this.transferPropsTo(g.DOM.span(null,this.renderParts()));}});j.generatePrefixes=function(k,l){var m=[],n,o;for(var p=0,q=l.length;p<q;p++){o=l[p].getText();n=k.slice(0,Math.min(k.length,o.length));if(n==='')return m;if(o.toLowerCase().indexOf(n.toLowerCase())===0){m.push(n);k=k.slice(n.length);}else return m;}return m;};e.exports=j;});
__d("FacebarTypeaheadItem.react",["Badge.react","ReactPropTypes","React","FacebarGlobalOptions","FacebarTypeaheadDebugPane.react","FacebarTypeaheadDiffText.react","FacebarTypeaheadHighlightedText.react","cx","joinClasses"],function(a,b,c,d,e,f){var g=b('Badge.react'),h=b('ReactPropTypes'),i=b('React'),j=b('FacebarGlobalOptions'),k=b('FacebarTypeaheadDebugPane.react'),l=b('FacebarTypeaheadDiffText.react'),m=b('FacebarTypeaheadHighlightedText.react'),n=b('cx'),o=b('joinClasses');function p(r){var s=r.getTypePart(0);return s?"fragment"+s.charAt(0).toUpperCase()+s.substr(1):"fragment";}var q=i.createClass({displayName:'FacebarTypeaheadItem',propTypes:{result:h.object.isRequired,className:h.string,icon:h.object,token:h.object,highlight:h.array,prefix:h.string,message:h.object,valign:h.bool},getDefaultProps:function(){return {valign:true};},renderHighlightedFragment:function(r){return (m({className:p(r),text:r.getText(),tokens:this.props.highlight}));},renderDiffedFragment:function(r,s){return (l({className:p(r),prefix:s,text:r.getText()}));},renderText:function(){var r=this.props.result.structure.toArray(),s=this.props.prefix;if(j.graphSearchTypeaheadV2&&s!=null&&s.trim()!==''){var t=l.generatePrefixes(s,r);return r.map(function(u,v){return this.renderDiffedFragment(u,t[v]);}.bind(this));}else return r.map(this.renderHighlightedFragment);},renderBadge:function(){if(this.props.result.is_verified)return (g({type:"verified",size:"medium"}));},renderIcon:function(){var r=this.props.result.icon_class;if(r){return (i.DOM.span({className:"_k83"},i.DOM.span({className:r})));}else if(this.props.result.photo)return (i.DOM.img({className:"_20h",alt:"",src:this.props.result.photo}));},renderLabel:function(){var r=(("_53ad")+(this.props.valign&&this.props.token&&this.props.token.props&&this.props.token.props.text.length>0?' '+"_55y-":'')),s=i.DOM.span({className:r},this.renderText(),this.renderBadge(),this.props.token),t=(("_7gk")+(this.props.message?' '+"_5byz":''));return (i.DOM.span({className:t},s,this.props.message));},renderMain:function(){var r=this.props.result.uri;return (i.DOM.a({className:"_205",href:r?r.toString():'#',rel:"ignore"},i.DOM.span({className:"_6i1"},this.props.icon||this.renderIcon(),this.renderLabel())));},renderDebug:function(){return this.props.result.debug?k({result:this.props.result}):null;},render:function(){var r="_202 _5bl2 _6_k";return (i.DOM.li({className:o(r,this.props.className),onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,'aria-label':this.props.result.structure.toString(),role:"option"},this.renderMain(),this.renderDebug()));}});e.exports=q;});
__d("FacebarTypeaheadToken.react",["FacebarTypeaheadHighlightedText.react","ReactPropTypes","React","cx"],function(a,b,c,d,e,f){var g=b('FacebarTypeaheadHighlightedText.react'),h=b('ReactPropTypes'),i=b('React'),j=b('cx'),k=' \u00B7 ',l=i.createClass({displayName:'FacebarTypeaheadToken',propTypes:{text:h.array.isRequired,highlight:h.array,limit:h.number,innerClass:h.string,leadingMiddot:h.bool},render:function(){var m=this.props.text;if(this.props.limit)m.splice(this.props.limit);m.forEach(function(q,r){if(r!==0||this.props.leadingMiddot)m[r]=k+q;}.bind(this));var n=g({tokens:this.props.highlight,text:m.shift()}),o=m.length?g({tokens:this.props.highlight,className:"_53ab",text:m.join('')}):null,p=this.props.innerClass||"_53aa";return (i.DOM.span({className:"_53a9"},i.DOM.span({className:p},n,o)));}});e.exports=l;});
__d("FacebarTypeaheadEntityItem.react",["React","FacebarTypeaheadItem.react","FacebarTypeaheadToken.react","FacebarTypeaheadTokenText","TypeaheadFacepileX.react","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('FacebarTypeaheadItem.react'),i=b('FacebarTypeaheadToken.react'),j=b('FacebarTypeaheadTokenText'),k=b('TypeaheadFacepileX.react'),l=b('cx'),m=g.createClass({displayName:'FacebarTypeaheadEntityItem',renderToken:function(){return (i({highlight:this.getHighlightTokens(),text:j.textForEntity(this.props.result,{})}));},renderIcon:function(){if(this.props.result.size>1&&this.props.result.photos){return (k({className:"_51l_",photos:this.props.result.photos,size:this.props.result.size}));}else if(this.props.result.photo)return (g.DOM.img({className:"_20h",alt:"",src:this.props.result.photo}));},getHighlightTokens:function(){if(this.props.result.original_query){var n=this.props.result.original_query.toString().trim(),o=n.split(' '),p=o.length>1?[n].concat(o):[n];return p.filter(function(q){return (q!=='');});}},render:function(){return this.transferPropsTo(h({icon:this.renderIcon(),token:this.renderToken(),highlight:this.getHighlightTokens(),valign:true}));}});e.exports=m;});
__d("FacebarDisambiguationDialog",["Event","BrowseLogger","CSS","cx","Dialog","DOM","FacebarStructuredText","FacebarTypeaheadEntityItem.react","React","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('BrowseLogger'),i=b('CSS'),j=b('cx'),k=b('Dialog'),l=b('DOM'),m=b('FacebarStructuredText'),n=b('FacebarTypeaheadEntityItem.react'),o=b('React'),p=b('tx'),q=650;function r(s,t,u,v,w){"use strict";this._sets=s;this._path=t;this._ondone=u;this._oncancel=v;this._selection=[];this._typeaheadSID=w;}r.prototype.show=function(){"use strict";new k().setTitle("Which of these did you mean?").setBody(this._createBody()).setContentWidth(q).setModal(true).setButtons([k.CONFIRM,k.CANCEL]).setHandler(this._handleDone.bind(this)).setCancelHandler(this._handleCancel.bind(this)).show();this._sets.forEach(function(s){var t=[];s.forEach(function(v){t.push(v.uid);});var u=s[0];h.logDisambiguationImpression(u.text,u.type,this._path,t.join(','),this._typeaheadSID);}.bind(this));};r.prototype._createBody=function(){"use strict";var s=[];this._sets.forEach(function(t,u){s.length&&s.push(l.create('li',{className:"_200"}));t.forEach(function(v){var w=this._createItem(v,u);this._selection[u]||this._selectItem(w);s.push(w.root);}.bind(this));}.bind(this));return l.create('ul',{className:'viewList disambiguationList'},s);};r.prototype._createItem=function(s,t){"use strict";var u={uri:null,subtext:s.subtext,category:s.category,photo:s.photo,type:s.type,structure:m.fromStruct([{text:s.text,type:'ent:'+s.type,uid:s.uid}])},v=l.create('div',{className:"_201"}),w=n({result:u}),x=l.create('div');o.renderComponent(w,x);var y=x.firstChild;i.addClass(y,"_6i3");l.appendContent(y,i.hide(v));var z={setId:t,result:s,root:y,check:v};g.listen(y,'mouseover',this._toggleHover.bind(this,z,true));g.listen(y,'mouseout',this._toggleHover.bind(this,z,false));g.listen(y,'click',function(event){this._selectItem(z);return event.kill();}.bind(this));return z;};r.prototype._toggleHover=function(s,t){"use strict";i.conditionClass(s.root,'selected',t);};r.prototype._toggleCheck=function(s,t){"use strict";i.conditionShow(s.check,t);};r.prototype._selectItem=function(s){"use strict";var t=this._selection[s.setId];this._selection[s.setId]=s;t&&this._toggleCheck(t,false);this._toggleCheck(s,true);};r.prototype._handleDone=function(s){"use strict";this._ondone(s==k.CONFIRM?this._selection.map(function(t){var u=t.result;h.logDisambiguationClick(u.text,u.type,this._path,u.index,u.uid,this._typeaheadSID);return u;}.bind(this)):null);};r.prototype._handleCancel=function(){"use strict";this._oncancel();};e.exports=r;});
__d("FacebarTypeahead",["Arbiter","Typeahead","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Typeahead'),i=b('copyProperties'),j=b('emptyFunction');for(var k in h)if(h.hasOwnProperty(k))m[k]=h[k];var l=h===null?null:h.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=h;function m(n,o,p,q,r,s){"use strict";h.call(this,n,o,p,q);this.getCore();this.proxyEvents();this.initBehaviors(r||[]);var t=this.core.subscribe('focus',function(){if(s)s.init(this);this.core.unsubscribe(t);this.data.bootstrap(false);this.core.input.focus();}.bind(this));this.data.bootstrap(true);this.inform('init',this,g.BEHAVIOR_PERSISTENT);g.inform('Facebar/init',this,g.BEHAVIOR_PERSISTENT);}m.prototype.proxyEvents=function(){"use strict";var n,o=[],p=null,q=(function(){while(n=o.shift())this.inform(n[0],n[1]);p=null;}).bind(this);[this.data,this.view,this.core].forEach(function(r){r.subscribe(r.events,function(s,t){o.push([s,t]);p=p||q.defer();}.bind(this));},this);};i(m.prototype,{init:j});e.exports=m;});
__d("StructuredInputUtil",["StructuredInputDOM"],function(a,b,c,d,e,f){var g=b('StructuredInputDOM');function h(n,o,p){var q=n.substr(0,o).lastIndexOf(p);return q!==-1?q+1:0;}function i(n,o,p){var q=n.indexOf(p,o);return q!==-1?q:n.length;}function j(n,o,p){return (o===0||o===n.length||n.substr(o,p.length)==p);}function k(n,o,p,q){switch(o){case 'none':return p;case 'all':return q?n.length:0;case 'word':if(j(n,p,'\u00a0')){return p;}else if(q){return i(n,p,'\u00a0');}else return h(n,p,'\u00a0');}}function l(n,o){return o&&g.isEntityNode(n)&&!g.isEntityNode(o);}var m={getMarkerAtOffset:function(n,o){var p=n.firstChild,q=0,r=0;while(p){q+=r;r=g.getLength(p);if(q+r>o){break;}else p=p.nextSibling;}return {node:p||n.lastChild,offset:o-q};},validateEntityText:function(n){var o=g.getText(n),p=n.getAttribute('data-fulltext'),q=n.getAttribute('data-group');if(q=='hashtag'){var r=o.match(/#[^\s]+/);p=r&&r[0];}var s=o.indexOf(p),t={prefix:null,entity:null,suffix:null};switch(q){case 'none':t.entity=o;break;case 'hashtag':case 'all':if(s!=-1){t.prefix=o.substr(0,s);t.entity=o.substr(s,p.length);t.suffix=o.substr(s+p.length);}else t.suffix=o;break;case 'word':if(s!=-1){t.prefix=o.substr(0,s);o=o.substr(s);}var u=0,v=0;while(u<p.length){v=i(p,u+1,'\u00a0');if(o.substr(0,v)!=p.substr(0,v)){break;}else u=v;}t.entity=o.substr(0,u)||null;t.suffix=o.substr(u)||null;}return t;},getGrouping:function(n,o){var p=n.getAttribute('data-group'),q=n.getAttribute('data-select');if(o=='select'){return q=='group'?p:'none';}else return p;},snapMarkerToText:function(n,o){var p=n.node;if(g.isEntityNode(p)){var q=n.offset,r=m.getGrouping(p,o);if(r!='none')if(q===0){var s=p.previousSibling;if(l(p,s))return {node:s,offset:g.getLength(s)};}else if(q==g.getLength(p)){var t=p.nextSibling;if(l(p,t))return {node:t,offset:0};}}return n;},nextMarkerBoundary:function(n,o,p){var q=n.node;if(g.isEntityNode(q)&&(!o||n.offset!==0)){var r=m.getGrouping(q,p);if(r!='none')return {node:n.node,offset:k(g.getText(q),r,n.offset,o)};}return n;}};e.exports=m;});
__d("StructuredInputCleaner",["DOM","createArrayFrom","copyProperties","StructuredInputUtil","StructuredInputDOM","UserAgent"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('createArrayFrom'),i=b('copyProperties'),j=b('StructuredInputUtil'),k=b('StructuredInputDOM'),l=b('UserAgent');function m(n,o,p){"use strict";this._node=n;this._selection=o;this._wrapText=p;}m.prototype._cleanEntityNode=function(n){"use strict";var o=n.getAttribute('data-text'),p=k.getText(n);n.style.cssText='';if(o==p&&k.containsOnlyText(n,{I:true}))return null;var q=[],r=j.validateEntityText(n),s=k.createIconNode(JSON.parse(n.getAttribute('data-icon')));if(!r.entity&&((r.suffix&&!r.prefix)||(r.prefix&&!r.suffix))){k.convertToTextNode(n);n.setAttribute('data-text',p);return null;}if(r.prefix)q.push(this._createTextNode(r.prefix));if(r.entity){if(this._selection&&g.getText(n)!==r.entity)this._selection.markDirty(n);g.setContent(n,s?[s,r.entity]:r.entity);n.setAttribute('data-text',r.entity);q.push(n);}if(r.suffix)q.push(this._createTextNode(r.suffix));return q;};m.prototype._removeSpecialNodes=function(){"use strict";var n=h(this._node.getElementsByTagName('script')),o=h(this._node.getElementsByTagName('style'));n.forEach(g.remove);o.forEach(g.remove);};m.prototype._collapseNodes=function(){"use strict";for(var n,o=this._node.firstChild;o;o=n){n=o.nextSibling;if(!g.isTextNode(o)&&!k.isEntityNode(o)&&!k.containsOnlyText(o))for(var p=o.lastChild;p;p=o.lastChild){this._node.insertBefore(p,n);n=p;}}};m.prototype._createTextNode=function(n){"use strict";if(this._wrapText){return k.createTextNode(n);}else return document.createTextNode(n);};m.prototype.replaceNodes=function(n,o){"use strict";if(o==null)return;var p=n.length?n[n.length-1].nextSibling:null;n.forEach(function(q){if(o.indexOf(q)===-1)g.remove(q);},this);o.reverse().forEach(function(q){if(n.indexOf(q)===-1)this._node.insertBefore(q,p);p=q;},this);};m.prototype.clean=function(){"use strict";this._removeSpecialNodes();this._collapseNodes();var n=[],o=function(){if(n.length){this.replaceNodes(n,this._cleanTextNodes(n));n.length=0;}}.bind(this);h(this._node.childNodes).forEach(function(p){if(k.isEntityNode(p)){this.replaceNodes([p],this._cleanEntityNode(p));o(n);}else n.push(p);}.bind(this));o();if(!this._node.firstChild&&l.firefox())this._node.appendChild(this._createTextNode());};m.prototype.endOnText=function(){"use strict";var n=function(o,p){if(k.isEntityNode(o))this._node.insertBefore(this._createTextNode(),p?o:null);}.bind(this);n(this._node.firstChild,true);n(this._node.lastChild,false);};i(m.prototype,{_cleanTextNodes:(function(){var n=function(p){return (p.nodeName==='BR'||p.nodeName==='SPAN'&&o(p));},o=function(p){return p.getAttribute('data-si')&&k.containsOnlyText(p)&&k.getLength(p)>0;};return function(p){if(p.length!=1||!n(p[0])){var q=p.map(k.getText).join('').replace(/\s+/g,' ');return q?[this._createTextNode(q)]:[];}else{p[0].style.cssText='';return;}};})()});e.exports=m;});
__d("DOMSelection",[],function(a,b,c,d,e,f){(function(){var g=this,h={isPreceding:function(n,o){return o.compareDocumentPosition(n)&2;},contains:function(n,o){if(n.compareDocumentPosition!=null){return n.compareDocumentPosition(o)&16;}else return n.contains(o);},isCursorPreceding:function(n,o,p,q){if(n===p)return o<=q;if(h.isText(n)&&h.isText(p))return h.isPreceding(n,p);if(h.isText(n)&&!h.isText(p))return !h.isCursorPreceding(p,q,n,o);if(!h.contains(n,p))return h.isPreceding(n,p);if(n.childNodes.length<=o)return false;if(n.childNodes[o]===p)return 0<=q;return h.isPreceding(n.childNodes[o],p);},isText:function(n){return (n!=null?n.nodeType==3:false);},getChildIndex:function(n){var o=0;while(n=n.previousSibling)o++;return o;}},i=g.Selection=(function(){function n(o){this.win=o;}n.prototype.hasSelection=function(){return n.hasSelection(this.win);};n.prototype.isBidirectional=function(){return n.isBidirectional(this.win);};n.prototype.getOrigin=function(){return n.getOrigin(this.win);};n.prototype.getFocus=function(){return n.getFocus(this.win);};n.prototype.getStart=function(){return n.getStart(this.win);};n.prototype.getEnd=function(){return n.getEnd(this.win);};n.prototype.trySelection=function(o,p,q,r){return n.trySelection(this.win,o,p,q,r);};n.prototype.setSelection=function(o,p,q,r){return n.setSelection(this.win,o,p,q,r);};n.prototype.clearSelection=function(){return n.clearSelection(this.win);};return n;})();function j(){if(g.document.selection&&/MSIE 9\./.test(navigator.userAgent)){return false;}else return !!g.getSelection;}if(j()){i.supported=true;i.hasSelection=function(n){var o;return (o=n.getSelection())&&(o.focusNode!=null)&&(o.anchorNode!=null);};i.isBidirectional=function(n){return true;};i.getOrigin=function(n){var o;if(!((o=n.getSelection())&&(o.anchorNode!=null)))return null;return [o.anchorNode,o.anchorOffset];};i.getFocus=function(n){var o;if(!((o=n.getSelection())&&(o.focusNode!=null)))return null;return [o.focusNode,o.focusOffset];};i.getStart=function(n){var o,p,q,r,s,t;if(!i.hasSelection(n))return null;s=i.getOrigin(n),o=s[0],q=s[1];t=i.getFocus(n),p=t[0],r=t[1];if(h.isCursorPreceding(o,q,p,r))return [o,q];return [p,r];};i.getEnd=function(n){var o,p,q,r,s,t;if(!i.hasSelection(n))return null;s=i.getOrigin(n),o=s[0],q=s[1];t=i.getFocus(n),p=t[0],r=t[1];if(h.isCursorPreceding(o,q,p,r))return [p,r];return [o,q];};var k=function(n,o,p,q,s,t){var u=o.getSelection();if(!u)return;if(s==null)s=p;if(t==null)t=q;if(u.collapse&&u.extend){u.collapse(p,q);u.extend(s,t);}else{r=o.document.createRange();r.setStart(p,q);r.setEnd(s,t);if(n||!i.hasSelection(o)||(r.endContainer===s&&r.endOffset===t&&r.startContainer===p&&r.startOffset===q)){try{u.removeAllRanges();}catch(v){}u.addRange(r);}}};i.setSelection=k.bind(i,true);i.trySelection=k.bind(i,false);i.clearSelection=function(n){try{var p=n.getSelection();if(!p)return;p.removeAllRanges();}catch(o){}};i.getText=function(n){var o=n.getSelection();if(!o)return;return o.toString();};}else if(g.document.selection){var l=function(n,o,p){var q,r,s,t,u;r=n.createElement('a');q=o.duplicate();q.collapse(p);u=q.parentElement();while(true){u.insertBefore(r,r.previousSibling);q.moveToElementText(r);if(!(q.compareEndPoints((p?'StartToStart':'StartToEnd'),o)>0&&(r.previousSibling!=null)))break;}if(q.compareEndPoints((p?'StartToStart':'StartToEnd'),o)===-1&&r.nextSibling){q.setEndPoint((p?'EndToStart':'EndToEnd'),o);s=r.nextSibling;t=q.text.length;}else{s=r.parentNode;t=h.getChildIndex(r);}r.parentNode.removeChild(r);return [s,t];},m=function(n,o,p,q,r){var s,t,u,v,w;w=0;s=h.isText(q)?q:q.childNodes[r];t=h.isText(q)?q.parentNode:q;if(h.isText(q))w=r;v=n.createElement('a');t.insertBefore(v,s||null);u=n.body.createTextRange();u.moveToElementText(v);v.parentNode.removeChild(v);o.setEndPoint((p?'StartToStart':'EndToEnd'),u);return o[p?'moveStart':'moveEnd']('character',w);};i.supported=true;i.hasSelection=function(n){var o;if(!n.document.selection)return false;o=n.document.selection.createRange();return o&&o.parentElement().document===n.document;};i.getStart=function(n){var o;if(!i.hasSelection(n))return null;o=n.document.selection.createRange();return l(n.document,o,true);};i.getEnd=function(n){var o;if(!i.hasSelection(n))return null;o=n.document.selection.createRange();return l(n.document,o,false);};i.isBidirectional=function(n){return false;};i.getOrigin=function(n){return i.getStart(n);};i.getFocus=function(n){return i.getEnd(n);};var k=function(n,o,p,q,r,s){if(r==null)r=p;if(s==null)s=q;var t=o.document.body.createTextRange();m(o.document,t,false,r,s);m(o.document,t,true,p,q);return t.select();};i.setSelection=k.bind(i,true);i.trySelection=k.bind(i,false);i.clearSelection=function(n){return n.document.selection.empty();};i.getText=function(n){if(!i.hasSelection(n))return null;var o=n.document.selection.createRange();return o&&o.text;};}else i.supported=false;}).call(this);e.exports=Selection;});
__d("StructuredInputSelection",["DOM","DOMSelection","Vector","StructuredInputUtil","StructuredInputDOM"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('DOMSelection'),i=b('Vector'),j=b('StructuredInputUtil'),k=b('StructuredInputDOM');function l(n){"use strict";var o=n.ownerDocument;this.window=o.defaultView||o.parentWindow;this.root=n;this.selection=false;this.start=new m(this,[]);this.end=new m(this,[]);this.update();}l.prototype.isSupported=function(){"use strict";return !!(h&&h.hasSelection);};l.prototype.update=function(){"use strict";this.selection=false;if(this.isSupported()&&this.root==document.activeElement)if(h.hasSelection(this.window)){var n=h.getStart(this.window),o=h.getEnd(this.window),p=h.getFocus(this.window);this.start=this.makeMarker(n);this.end=this.makeMarker(o);this.backward=n[0]==p[0]&&n[1]==p[1];this.selection=this.start.node&&this.end.node;}};l.prototype.makeMarker=function(n){"use strict";if(n[0]===this.root){return new m(this,[this.root.childNodes[n[1]],0]);}else return new m(this,n);};l.prototype.getFocus=function(){"use strict";return this.backward?this.start:this.end;};l.prototype.getOrigin=function(){"use strict";return this.backward?this.end:this.start;};l.prototype.move=function(n){"use strict";if(this.selection){this.start.move(n);this.start.snap();this.end.setPosition(this.start);return this.apply();}};l.prototype.expand=function(n){"use strict";if(this.selection){if(h.isBidirectional()){this.start.move(!n);this.start.snap();this.end.move(n);this.end.snap();}return this.apply();}};l.prototype.getText=function(){"use strict";if(this.selection&&this.isSupported()){var n=h.getText(this.window);return n;}};l.prototype.getOffset=function(){"use strict";if(this.selection)return this.start.rootOffset;};l.prototype.getLength=function(){"use strict";return (this.getText()||"").length;};l.prototype.setPosition=function(n,o){"use strict";this.backward=false;this.selection=true;this.start.setPosition(j.getMarkerAtOffset(this.root,n));this.start.snap();if(o>0){this.end.setPosition(j.getMarkerAtOffset(this.root,n+o));this.end.snap();}else this.end.setPosition(this.start);return this.apply();};l.prototype.hasRange=function(){"use strict";return this.selection&&(this.start.node!=this.end.node||this.start.offset!=this.end.offset);};l.prototype.scrollToFocus=function(){"use strict";var n=5,o=this.getFocus();if(o.node){var p=i.getElementDimensions(this.root).x,q=this.root.scrollLeft,r=o.node.offsetLeft+o.node.offsetWidth;if(r-q<n){this.root.scrollLeft=r-n;}else if(r-q>p-n)this.root.scrollLeft=r-p+n;}};l.prototype.apply=function(){"use strict";if(this.start.hasChanged()||this.end.hasChanged()){var n=this.getOrigin().getMarker(true),o=this.getFocus().getMarker(true);this.selection=this.selection&&n&&n.node&&o&&o.node;if(this.selection&&this.isSupported()){this.start.changed=false;this.end.changed=false;h.trySelection(this.window,n.node,n.offset,o.node,o.offset);return true;}}};l.prototype.markDirty=function(n){"use strict";if(g.contains(n,this.start.node,n))this.start.changed=true;if(g.contains(n,this.end.node,n))this.end.changed=true;};function m(n,o){"use strict";this.selection=n;this.node=o[0];this.offset=o[1];this.rootOffset=this.getRootOffset(o[0],o[1]);this.sibling=this.node&&this.node.previousSibling;this.changed=false;}m.prototype.hasChanged=function(){"use strict";return this.changed||!this.isNodeValid();};m.prototype.isNodeValid=function(){"use strict";if(k.getLength(this.node)>this.offset){var n=this.node;while(n=n.parentNode)if(n==this.selection.root)return true;}};m.prototype.getMarker=function(n){"use strict";if(this.isNodeValid()&&((n&&!this.node.firstChild)||(!n&&this.node.parentNode==this.selection.root))){return this;}else return k.getMarker(this.selection.root,this.rootOffset,n);};m.prototype.move=function(n){"use strict";this.node&&this.setPosition(j.nextMarkerBoundary(this.getMarker(false),n,'select'));};m.prototype.snap=function(){"use strict";this.node&&this.setPosition(j.snapMarkerToText(this.getMarker(false),'select'));};m.prototype.setPosition=function(n){"use strict";if(n.offset!=this.offset||n.node!=this.node){this.changed=true;this.node=n.node;this.offset=n.offset;this.rootOffset=this.getRootOffset(this.node,this.offset);}};m.prototype.getRootOffset=function(n,o){"use strict";var p=0,q=5;while(n&&p++<q)if(n===this.selection.root){return o;}else{var r=n;while(r=r.previousSibling)o+=k.getLength(r);n=n.parentNode;}};e.exports=l;});
__d("StructuredInput",["Arbiter","ArbiterMixin","CSS","DataStore","DOM","ErrorUtils","Event","Input","InputSelection","Keys","Parent","StructuredInputCleaner","StructuredInputDOM","StructuredInputSelection","StructuredInputUtil","Style","UserAgent","createArrayFrom","createObjectFrom","cx","csx","emptyFunction","getActiveElement","requestAnimationFrame","mixin"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('ErrorUtils'),m=b('Event'),n=b('Input'),o=b('InputSelection'),p=b('Keys'),q=b('Parent'),r=b('StructuredInputCleaner'),s=b('StructuredInputDOM'),t=b('StructuredInputSelection'),u=b('StructuredInputUtil'),v=b('Style'),w=b('UserAgent'),x=b('createArrayFrom'),y=b('createObjectFrom'),z=b('cx'),aa=b('csx'),ba=b('emptyFunction'),ca=b('getActiveElement'),da=b('requestAnimationFrame'),ea=229,fa=y([p.UP,p.DOWN,p.LEFT,p.RIGHT]),ga=y([p.BACKSPACE,p.DELETE]),ha=y([p.SPACE,p.RETURN]),ia=y('IUB'.split('').map(function(ra){return ra.charCodeAt(0);})),ja=w.firefox(),ka=w.ie(),la=w.webkit(),ma=b("mixin"),na=ma(h);for(var oa in na)if(na.hasOwnProperty(oa))qa[oa]=na[oa];var pa=na===null?null:na.prototype;qa.prototype=Object.create(pa);qa.prototype.constructor=qa;qa.__superConstructor__=na;function qa(ra){"use strict";j.set(ra,'StructuredInput',this);this._root=ra;this._richInput=k.find(ra,"._586i");this._textInput=k.find(ra,"._586f");this._placeholderText=k.scry(ra,"._586j")[0];this._hintText=k.find(ra,"._586k");this._contentWidth=null;this._richWidth=null;this._hintNodes=[];this.init();}qa.prototype.init=function(){"use strict";this.init=ba;this._initSelection();this._initCleaner();this._initInputs();this._initEvents();this._scheduledCleanInput=false;this._richChanged=false;this._textChanged=false;this._selectionChanged=false;this._selectionIgnore=false;this._imeMode=false;this.cleanInput();this.inform('init',null,g.BEHAVIOR_PERSISTENT);};qa.prototype._initInputs=function(){"use strict";this._richInput.contentEditable=true;this._richInput.spellcheck=false;this._richInput.tabIndex=0;this._textInput.tabIndex=-1;this._multiline=this._textInput.nodeName=='TEXTAREA';if(!i.shown(this._richInput)){var ra=o.get(this._textInput),sa=ca()===this._textInput;k.setContent(this._richInput,s.encodeText(n.getValue(this._textInput)));i.hide(this._textInput);i.show(this._richInput);this.cleanInput();if(sa){this._richInput.focus();this.setSelection({offset:ra.start,length:ra.end-ra.start});}}this.togglePlaceholder();this._toggleHint();};qa.prototype._initEvents=function(){"use strict";var ra=null,sa=ja>=14||la>=536,ta=function(){this._richChanged=true;sa||this.scheduleCleanInput(true);}.bind(this),ua=function(){this._textChanged=true;sa||this.scheduleCleanInput(false);}.bind(this),va=function(){this._selectionChanged=true;this.scheduleCleanInput(false);}.bind(this),wa=function(){this._imeMode=true;this._placeholderText&&i.hide(this._placeholderText);i.hide(this._hintText);}.bind(this),xa=function(){this._imeMode=false;this._richChanged=true;this.cleanInput();}.bind(this);m.listen(this._richInput,'keydown',function(ya){ra=ya.keyCode;if(ya.ctrlKey&&ya.keyCode in ia){return ya.kill();}else if(ya.keyCode in fa){va();}else if(ya.keyCode===p.BACKSPACE&&this._deleteTrailingChunk()){this._richChanged=true;this.cleanInput();return ya.kill();}else if(ya.keyCode in ga){ta();}else if(ya.keyCode==ea)wa();}.bind(this));m.listen(this._richInput,'keypress',function(ya){if(ya.keyCode==p.RETURN){this._multiline&&this._insertText("\n");return ya.kill();}else if(!this._selectionChanged&&this._selectionIsText()){ua();}else ta();}.bind(this));if(!sa){m.listen(this._richInput,'keyup',function(ya){if((this._imeMode||ya.keyCode!=ra)&&ya.keyCode in ha){xa();return ya.kill();}else if(this._imeMode){this._textChanged=true;this.cleanInput();}}.bind(this));}else{m.listen(this._richInput,'compositionstart',wa);m.listen(this._richInput,'compositionend',function(){xa.defer();});m.listen(this._richInput,'input',function(){this._textChanged=true;if(!this._imeMode)if(!this._richChanged){this.cleanInput();}else this.scheduleCleanInput();}.bind(this));}m.listen(document,'selectionchange',l.guard(function(){if(this._selectionIgnore){this._selectionIgnore=false;}else this._selectionChanged=true;}.bind(this),'StructuredInput.handleSelectionChange'));m.listen(this._richInput,'mousedown',function(){this._selectionChanged=true;this._selectionLength=0;this._selectionOffset=0;}.bind(this));m.listen(this._richInput,'mouseup',function(){this._selectionChanged=true;this.scheduleCleanInput();}.bind(this));m.listen(this._richInput,'cut',function(){this._richChanged=true;this.scheduleCleanInput(false);}.bind(this));m.listen(this._richInput,'paste',function(ya){this._richChanged=true;this.scheduleCleanInput(true);}.bind(this));m.listen(this._richInput,'drop',function(ya){this.focus();this.selectAll();this._insertClipboard(ya&&ya.dataTransfer);return ya.kill();}.bind(this));m.listen(this._richInput,'dragover',function(ya){ya.dataTransfer.dropEffect='move';ya.dataTransfer.effectAllowed='move';return ya.kill();});m.listen(this._richInput,'focus',function(ya){this._toggleHint();this.inform('focus');}.bind(this));m.listen(this._richInput,'blur',function(ya){i.hide(this._hintText);this._imeMode=false;this._richChanged=true;this.scheduleCleanInput(false);this.inform('blur');}.bind(this));};qa.prototype._initCleaner=function(){"use strict";this._cleaner=new r(this._richInput,this._selection,true);};qa.prototype._initSelection=function(){"use strict";this._selection=new t(this._richInput);this._selectionLength=0;this._selectionOffset=0;};qa.prototype._insertClipboard=function(ra){"use strict";if(ra&&typeof ra.getData==='function'){var sa=ra.getData('Text');this._insertText(sa);}};qa.prototype._deleteTrailingChunk=function(ra){"use strict";var sa=this.getSelection();if(sa.length>0||sa.offset===0)return false;var ta=this.getSelection().offset-1,ua=u.getMarkerAtOffset(this._richInput,ta);if(ua&&s.isEntityNode(ua.node)&&u.getGrouping(ua.node,'select')!=='none'){k.remove(ua.node);return true;}return false;};qa.prototype._selectionIsText=function(){"use strict";var ra=this._selection.start.node,sa=this._selection.end.node;return ra&&ra===sa&&!s.isEntityNode(ra)&&!s.isEntityNode(ra.parentNode);};qa.prototype._insertText=function(ra){"use strict";if(ra){var sa=k.create('div',{},ra);return this._insertNodes(sa);}};qa.prototype._insertHTML=function(ra){"use strict";if(ra){var sa=k.create('div'),ta=new r(sa,null,false);sa.innerHTML=ra;ta.clean();return this._insertNodes(sa);}};qa.prototype._insertNodes=function(ra){"use strict";if(document.selection){document.selection.createRange().pasteHTML(ra.innerHTML);}else document.execCommand('insertHTML',false,ra.innerHTML);this._richChanged=true;this.cleanInput();};qa.prototype.togglePlaceholder=function(ra){"use strict";if(!this._placeholderText)return;var sa=s.getLength(this._richInput)===0;if(ra&&sa){i.show(this._placeholderText);}else i.conditionShow(this._placeholderText,sa&&!this._imeMode);};qa.prototype._toggleHint=function(){"use strict";var ra=x(this._hintNodes),sa=null,ta='',ua=s.getText(this._richInput).toLowerCase();if(!this.hasFocus())return;if(this._contentOverflows()){i.hide(this._hintText);return;}while(ra.length&&ta.length<ua.length){sa=ra.shift();ta+=s.getText(sa);}if(ua.length&&ta.substr(0,ua.length).toLowerCase()==ua.toLowerCase()){k.setContent(this._hintText,x(this._richInput.cloneNode(true).childNodes));var va=s.createTextNode(ta.substr(ua.length));ra.unshift(va);k.appendContent(this._hintText,k.create('span',{className:"_586h"},ra));i.show(this._hintText);i.hide(this._placeholderText);}else i.hide(this._hintText);};qa.prototype._contentOverflows=function(){"use strict";if(this._richWidth===null)this._richWidth=this._richInput.clientWidth;if(this._contentWidth===null){var ra=this._richInput.lastChild;this._contentWidth=k.isElementNode(ra)?ra.offsetLeft+ra.offsetWidth:0;}return this._contentWidth>this._richWidth;};qa.prototype._forceTop=function(){"use strict";if(!this._multiline)this._richInput.scrollTop=0;this._root.scrollTop=0;};qa.prototype._createStructureNodes=function(ra){"use strict";return ra.map(function(sa){return sa.uid||(sa.type&&sa.type!='text')?s.createEntityNode(sa,sa.display||{}):s.createTextNode(sa.text);}.bind(this));};qa.prototype._suppressInput=function(){"use strict";if(ja||ka){if(this._richClean)return;this._richClean=this._richInput.cloneNode(true);this._richClean.contentEditable=false;this._root.insertBefore(this._richClean,this._richInput.nextSibling);this._richClean.scrollLeft=this._richInput.scrollLeft;v.set(this._richInput,'padding',0);v.set(this._richInput,'height',0);}};qa.prototype._revealInput=function(){"use strict";if(!this._richClean)return;v.set(this._richInput,'height','');v.set(this._richInput,'padding','');this._root.removeChild(this._richClean);this.focus();this._richClean=null;};qa.prototype._cleanInput=function(){"use strict";var ra;if(this._textChanged&&!this._richChanged){this._selection.update();ra='change';}else if(this._richChanged||this._selectionChanged){this._selection.update();if(this._richChanged){this._contentWidth=null;this._cleaner.clean();this._cleaner.endOnText();this._selection.apply();ra='change';}if(this._selectionChanged){this._cleanSelection();if(this._selectionLength||!this._richChanged)ra='select';}}this._revealInput();this._forceTop();if(this._richChanged||this._textChanged){this.togglePlaceholder();this._toggleHint();}this._selectionIgnore=true;this._selectionChanged=false;this._richChanged=false;this._textChanged=false;ra&&this.inform(ra);};qa.prototype._cleanSelection=function(){"use strict";var ra=this._selection.getLength(),sa=this._selection.getOffset();if(ra){this._selection.expand(ra>=this._selectionLength);ra=this._selection.getLength();sa=this._selection.getOffset();}this._selectionLength=ra;this._selectionOffset=sa;};qa.prototype.cleanInput=function(){"use strict";this._scheduledCleanInput||this._cleanInput();};qa.prototype.scheduleCleanInput=function(ra){"use strict";ra&&this._suppressInput();if(!this._scheduledCleanInput){this._scheduledCleanInput=true;da(function(){this._cleanInput();this._scheduledCleanInput=false;}.bind(this));}};qa.prototype.setEnabled=function(ra){"use strict";this._textInput.disabled=!ra;this._richInput.contentEditable=ra;};qa.prototype.getRoot=function(){"use strict";return this._root;};qa.prototype.getRichInput=function(){"use strict";return this._richInput;};qa.prototype.getEnabled=function(){"use strict";return !this._textInput.disabled;};qa.prototype.getText=function(){"use strict";return s.getDecodedText(this._richInput);};qa.prototype.setText=function(ra){"use strict";k.setContent(this._richInput,s.createTextNode(ra));this._richChanged=false;this._selectionChanged=false;this.inform('change');};qa.prototype.setHint=function(ra){"use strict";this._hintNodes=this._createStructureNodes(ra);this._toggleHint();};qa.prototype.getStructure=function(){"use strict";var ra=[];x(this._richInput.childNodes).forEach(function(sa){var ta=!k.isTextNode(sa),ua=s.getDecodedText(sa);ua.length&&ra.push({text:ua,uid:ta?sa.getAttribute('data-uid'):null,type:(ta&&sa.getAttribute('data-type'))||'text'});}.bind(this));return ra;};qa.prototype.setStructure=function(ra){"use strict";k.setContent(this._richInput,this._createStructureNodes(ra));this._cleaner.endOnText();this._cleaner.clean();this.togglePlaceholder();this._toggleHint();this._richChanged=false;this._selectionChanged=false;this.inform('change');};qa.prototype.getContentDimensions=function(){"use strict";var ra=this._richInput.lastChild;return {width:ra?ra.offsetLeft+ra.offsetWidth:0,height:ra?ra.offsetTop+ra.offsetHeight:0};};qa.prototype.getSelection=function(){"use strict";if(this._selection)return {offset:this._selection.getOffset(),length:this._selection.getLength()};};qa.prototype.setSelection=function(ra){"use strict";if(this.hasFocus()&&this._selection){this._selection.update();this._selection.setPosition(ra.offset,ra.length);this._selection.scrollToFocus();this._selectionChanged=false;this.inform('select');}};qa.prototype.moveSelectionToEnd=function(){"use strict";this.setSelection({length:0,offset:s.getLength(this._richInput)});};qa.prototype.isSelectionAtEnd=function(){"use strict";var ra=this.getSelection().offset,sa=s.getLength(this._richInput);return ra>=sa;};qa.prototype.selectAll=function(){"use strict";this.setSelection({offset:0,length:s.getLength(this._richInput)});};qa.prototype.hasFocus=function(){"use strict";return k.contains(this._root,document.activeElement);};qa.prototype.focus=function(){"use strict";this._richInput.focus();};qa.prototype.blur=function(){"use strict";var ra=k.create('input',{type:'text',tabIndex:-1,style:{position:'absolute',top:0,left:'-100px',width:'1px',height:'1px'}});k.appendContent(this._root,ra);var sa=function(){if(this.hasFocus()||(la&&document.activeElement===document.body)){ra.focus();ra.blur();}};this.blur=sa;this.blur();};qa.getInstance=function(ra){var sa=q.byClass(ra,"_586g");if(!sa)throw new Error('No DOMElement structured input found using '+ra);var ta=j.get(sa,'StructuredInput');if(!ta){var ua=q.byClass(sa,"_585-");throw new Error('Failed to fetch instance from storage. fbFacebar/root was'+(ua!=null?ua.innerHTML:'not there'));}return ta;};e.exports=qa;});
__d("FacebarTypeaheadInput",["ArbiterMixin","csx","DOM","FacebarStructuredText","StructuredInput","Vector","copyProperties","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('csx'),i=b('DOM'),j=b('FacebarStructuredText'),k=b('StructuredInput'),l=b('Vector'),m=b('copyProperties'),n={text:{className:"text",group:"all",select:"none"},ent:{className:"entity",group:"all",select:"group"},'ent:hashtag_exact':{className:"entity",group:"hashtag",select:"none"}},o=b("mixin");function p(u){return m(u.toStruct(),{display:n[u.getType()]||n[u.getTypePart(0)]});}var q=o(g);for(var r in q)if(q.hasOwnProperty(r))t[r]=q[r];var s=q===null?null:q.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=q;function t(u){"use strict";this.root=u;this.input=k.getInstance(u);this.value=null;this.selection={offset:0,length:0};this.resetOnChange=true;this.initEvents();}t.prototype.initEvents=function(){"use strict";var u=function(v,w){this.inform(v,w);}.bind(this);this.input.subscribe('blur',u);this.input.subscribe('focus',u);this.input.subscribe('change',function(v,w){if(this.resetOnChange)this.value=null;this.inform('change',w);}.bind(this));};t.prototype.togglePlaceholder=function(u){"use strict";return this.input.togglePlaceholder(u);};t.prototype.focus=function(){"use strict";this.input.focus();};t.prototype.blur=function(){"use strict";this.input.blur();};t.prototype.getElement=function(){"use strict";return this.root;};t.prototype.getRawPlaceholderElement=function(){"use strict";return i.find(this.root,"._586j");};t.prototype.getRawInputElement=function(){"use strict";return i.scry(this.root,"._586i")[0];};t.prototype.getValue=function(){"use strict";if(this.value===null)this.value=j.fromStruct(this.input.getStructure());return this.value;};t.prototype.getLength=function(){"use strict";return this.getValue().getLength();};t.prototype.resetPlaceholder=function(){"use strict";this.input.resetPlaceholder();};t.prototype.setValue=function(u){"use strict";this.value=u;this.resetOnChange=false;var v=u.toArray().map(p);this.input.setStructure(v);this.input.setSelection({offset:u.getLength(),length:0});this.resetOnChange=true;};t.prototype.storeSelection=function(){"use strict";this.selection=this.input.getSelection();};t.prototype.restoreSelection=function(){"use strict";if(this.selection)this.input.setSelection(this.selection);};t.prototype.setHint=function(u){"use strict";var v=u&&!u.hasRTL()?u.toArray().map(p):[];this.input.setHint(v);};t.prototype.isSelectionAtEnd=function(){"use strict";return this.input.isSelectionAtEnd();};t.prototype.selectInput=function(u){"use strict";this.input.setSelection({offset:u||0,length:this.getLength()});};t.prototype.getEndOffset=function(){"use strict";var u=l.getElementDimensions(this.root),v=this.input.getContentDimensions();return Math.min(u.x,v.width);};m(t.prototype,{events:['change','focus','blur']});e.exports=t;});
__d("FacebarTypeaheadWebSearch",["startsWith","FacebarStructuredFragment","FacebarStructuredText"],function(a,b,c,d,e,f){var g=b('startsWith'),h=b('FacebarStructuredFragment'),i=b('FacebarStructuredText'),j=new h({type:'ent:websuggestion',text:'Web Search: ',uid:null}),k=j.getText().toLowerCase().trim();function l(o,p){if(!o||o.type!=='websuggestion')return;var q=p.getValue().toArray();q.forEach(function(r){if(r.isType('ent')&&!r.isType('ent','user')&&r.getUID())if(o.extra_uri_params){o.extra_uri_params.qh=r.getUID();return;}});}function m(o){return o.getType()===j.getType();}function n(o){"use strict";this._core=o.getCore();this._view=o.getView();this._input=this._core.input;this._isEnabled=false;}n.prototype.enable=function(){"use strict";this._isEnabled=true;this.changeListener=this._input.subscribe('change',this._changeWebSearch.bind(this));this.lockListener=this._input.subscribe('shortcut',this._lockWebSearch.bind(this));this.beforeSelectListener=this._view.subscribe('beforeSelect',this._beforeSelect.bind(this));this.beforeRenderListener=this._view.subscribe('beforeRender',this._beforeRender.bind(this));};n.prototype._changeWebSearch=function(){"use strict";var o=this._input.getValue(),p=o.toArray(),q=p[0];if(q&&q.getType()==='text')if(g(q.getText().toLowerCase(),k)){p.splice(0,1,j,new h({text:q.getText().substr(k.length).replace(/^ /,'')}));this._replaceFragments(p);}else if(p.length>1&&p.some(m)){var r='';p.forEach(function(s){if(m(s))return;r+=s.getText();});this._input.storeSelection();this._input.setValue(i.fromString(r));this._input.restoreSelection();}};n.prototype._replaceFragments=function(o){"use strict";this._input.storeSelection();this._input.setValue(new i(o));this._input.restoreSelection();};n.prototype._beforeSelect=function(o,p){"use strict";l(p.selected,this._input);return true;};n.prototype._beforeRender=function(o,p){"use strict";var q=this._input.getValue().toArray()[0],r=q&&m(q);p.results.forEach(function(s){if(s.type==='websuggestion')s.isLockedWebSearchMode=r;});return true;};n.prototype._lockWebSearch=function(o,p){"use strict";if(p.shift){var q=this._input.getValue().toArray()[0];if(!q||!m(q))this._input.setValue(new i([j]));}};n.prototype.disable=function(){"use strict";this.beforeSelectListener.unsubscribe();this.changeListener.unsubscribe();this.lockListener.unsubscribe();this.beforeRenderListener.unsubscribe();this._isEnabled=false;};n.addPrefix=function(o){"use strict";var p=m(o.getFragment(0))||g(o.getFragment(0).getText().toLowerCase(),k);if(!p){var q=[j].concat(o.toArray());return new i(q);}else return o;};e.exports=n;});
__d("FacebarTypeaheadCore",["Animation","Arbiter","ArbiterMixin","Base64","CSS","DOM","Event","FacebarGlobalOptions","FacebarJSConstants","FacebarStructuredText","FacebarTypeaheadInput","FacebarTypeaheadWebSearch","Keys","KeywordsSearchResultConfig","Parent","Style","URI","arrayContains","copyProperties","cx","csx","getActiveElement","invariant","mixin","startsWith"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('Base64'),k=b('CSS'),l=b('DOM'),m=b('Event'),n=b('FacebarGlobalOptions'),o=b('FacebarJSConstants'),p=b('FacebarStructuredText'),q=b('FacebarTypeaheadInput'),r=b('FacebarTypeaheadWebSearch'),s=b('Keys'),t=b('KeywordsSearchResultConfig'),u=b('Parent'),v=b('Style'),w=b('URI'),x=b('arrayContains'),y=b('copyProperties'),z=b('cx'),aa=b('csx'),ba=b('getActiveElement'),ca=b('invariant'),da=b('mixin'),ea=b('startsWith'),fa=da(i);for(var ga in fa)if(fa.hasOwnProperty(ga))ia[ga]=fa[ga];var ha=fa===null?null:fa.prototype;ia.prototype=Object.create(ha);ia.prototype.constructor=ia;ia.__superConstructor__=fa;function ia(ja){"use strict";y(this,ja);}ia.prototype.init=function(ja,ka,la){"use strict";if(window.getSelection===null)throw new Error('Facebar: window.getSelection is null!');this.init=function(){};this.data=ja;this.view=ka;this.root=la;this.windowFocused=true;this.isFocused=false;this.hoverAnimation=null;this.stickyQuery=null;this.settedQuery=null;this.selectedQuery=null;this.currentQuery=null;this.initSubcomponents();this.initEvents();this.checkValue();};ia.prototype.initSubcomponents=function(){"use strict";var ja=l.find(this.root,"._5861");this.input=new q(ja);this.view.setInputElement(this.input.getRawInputElement());};ia.prototype.initEvents=function(){"use strict";m.listen(this.root,'keydown',this.keydown.bind(this));m.listen(this.root.parentNode,'mousedown',this.mousedown.bind(this));m.listen(this.view.getElement(),'mousedown',this.mousedown.bind(this));m.listen(window,'focus',this.focusWindow.bind(this));m.listen(window,'blur',this.blurWindow.bind(this));this.view.subscribe('select',this.selectView.bind(this));this.view.subscribe('highlight',this.highlightView.bind(this));this.view.subscribe('render',this.highlightView.bind(this));this.view.subscribe('hideHelp',this.performQuery.bind(this));this.input.subscribe('focus',this.focusInput.bind(this));this.input.subscribe('blur',this.blurInput.bind(this));this.input.subscribe('change',this.changeInput.bind(this));this.data.subscribe('activity',this.typeaheadActivity.bind(this));this.data.subscribe('respond',this.completeData.bind(this));this.data.subscribe('nullstateReady',this.performQueryIfVisible.bind(this));this.initFocus.bind(this).defer();};ia.prototype.initFocus=function(){"use strict";if(!this.lazyFocused&&l.contains(this.input.root,ba())){this.lazyFocused=true;this.isFocused=true;this._newSession();this.inform('focus',{catchup:true});this.open();}};ia.prototype.cleanQuery=function(ja){"use strict";ja=y({},ja)||{};if(!ja.structure)ja.structure=new p();if(!n.allowGrammar||o.nonGrammarTypes[ja.type])ja.structure=p.fromString(ja.structure.toString());ca(ja.structure instanceof p);if(ja.type=='websuggestion'&&n.allowGrammar&&n.webSearchLockedInMode)ja.structure=r.addPrefix(ja.structure);return ja;};ia.prototype._unlockQuery=function(){"use strict";var ja=this.input.getValue();if(ja.hasType('ent')&&ja.trim().getCount()===1){this.input.storeSelection();this.input.setValue(p.fromString(ja.toString()));this.input.restoreSelection();}};ia.prototype.setPageQuery=function(ja){"use strict";ja=this.cleanQuery(ja);var ka=this.input.getValue(),la=ja.structure,ma=!la.isEmptyOrWhitespace()&&(ka.isEmptyOrWhitespace()||ka.toString().trim()==la.toString().trim());return this.selectQuery(ja,ma);};ia.prototype.selectQuery=function(ja,ka){"use strict";ka=ka!==false;ja=this.cleanQuery(ja);if(ka||!this.selectedQuery){if(ka||this.getValue().isEmptyOrWhitespace())this.setQuery(ja);this.selectedQuery=ja;}return ja;};ia.prototype.completeSelection=function(){"use strict";var ja=this.view.getSelection();if(ja&&!ja.search){this.data.saveResult(ja);ja.structure=ja.structure.pad();this.setQuery(ja);return true;}};ia.prototype.setQuery=function(ja,ka){"use strict";ja=this.cleanQuery(ja);if(ja.structure.hasType('blank'))ja.structure=new p(ja.structure.toArray().filter(function(la){return la.getType()!='blank';}));this.input.setValue(ja.structure);this.settedQuery=ja;this.stickyQuery=ka===false?this.stickyQuery:ja;this.checkValue();};ia.prototype.checkValue=function(){"use strict";if(this.value&&this.value.getHash()==this.input.getValue().getHash())return;this.performQueryIfVisible();};ia.prototype.performQueryIfVisible=function(){"use strict";if(!this.view.visible)return;this.value=this.nextQuery=this.getValue();this.performQuery();};ia.prototype.performQuery=function(){"use strict";this.data.query(this.nextQuery);this.currentQuery=this.nextQuery;};ia.prototype.expandView=function(){"use strict";this.data.query(this.currentQuery,false,[],true);this.input.restoreSelection();};ia.prototype.collapseView=function(){"use strict";this.requery();};ia.prototype.requery=function(){"use strict";if(this.currentQuery)this.data.query(this.currentQuery);};ia.prototype.executeQuery=function(ja){"use strict";ja=this.cleanQuery(ja);var ka=this.inform('execute',ja),la=this.getSessionID(),ma=ja.structure.hasType('blank');if(!ma)this.close();if(n.allowGrammar){this.selectQuery(ja);}else this.selectQuery();if(!ka&&!ma)this._navigateToQuery(ja,la);};ia.prototype.getSearchType=function(){"use strict";return 'facebar';};ia.prototype._newSession=function(){"use strict";this._sessionID=Math.random().toString();this.inform('session',this._sessionID,h.BEHAVIOR_STATE);};ia.prototype._closeSession=function(){"use strict";this.inform('session',null,h.BEHAVIOR_STATE);};ia.prototype.getSessionID=function(){"use strict";return this._sessionID;};ia.prototype._navigateToQuery=function(ja,ka){"use strict";var la=this.data.facebarConfig;if(ja.uri){ja.uri.addQueryData(ja.extra_uri_params);ja.uri.addQueryData({ref:'br_tf'});if(ja.structure&&(ja.type=='websuggestion'||ja.type==t.result_type||(ja.type=='grammar'&&(!la||ea(ja.uri.getPath(),la.search_path))))){var ma=this.data.getRawStructure(ja.structure).text_form,na=j.encode(encodeURIComponent(ma)).replace(/\=+$/,''),oa={sid:ka,qs:na,gv:this.data.getQueryData().grammar_version},pa=j.encode(JSON.stringify(oa)).replace(/\=+$/,'');ja.uri.addQueryData({ref:pa});}ja.uri.go();return;}};ia.prototype.reset=function(){"use strict";this.selectQuery();this.inform('reset');};ia.prototype.animateInputValue=function(ja,ka,la){"use strict";this.hoverAnimation&&this.hoverAnimation.stop();var ma=new g(ka).from('opacity',1).to('opacity',0).duration(150).ondone(function(){this.input.setValue(la);this.hoverAnimation=na.go();}.bind(this)),na=new g(ja).from('opacity',0).to('opacity',1).duration(150).ondone(function(){this.hoverAnimation=null;v.set(ka,'opacity','');v.set(ja,'opacity','');}.bind(this));v.set(ja,'opacity',0);this.hoverAnimation=ma.go();};ia.prototype.open=function(){"use strict";this.inform('open');this.view.show();this.input.focus();this.checkValue();if(!this.isFocused){this.isFocused=true;this._newSession();this.inform('focus');}};ia.prototype.close=function(){"use strict";this._closeSession();if(this.inform('close')===false)return;if((!this.value||this.value.isEmptyOrWhitespace())&&this.selectedQuery){this.input.setValue(this.selectedQuery.structure);}else if(this.stickyQuery)this.input.setValue(this.stickyQuery.structure);this.input.blur();this.view.hide();this.view.setAutoSelect(false);this.inform('session',null,h.BEHAVIOR_STATE);if(this.isFocused){this.isFocused=false;this.inform.bind(this,'blur').defer();}};ia.prototype.getElement=function(){"use strict";return this.root;};ia.prototype.getValue=function(){"use strict";return this.input.getValue();};ia.prototype.getText=function(){"use strict";return this.getValue().toString();};ia.prototype.keydown=function(event){"use strict";var ja=true,ka=m.getKeyCode(event);switch(ka){case s.ESC:this.close();break;case s.RIGHT:if(!n.disableLockingEntitiesOnRightArrow){ja=this.input.isSelectionAtEnd()&&this.completeSelection();}else ja=false;break;case s.TAB:var la=this.cleanQuery(this.view.getSelection()),ma=la.structure.hasType('blank');if(event.getModifiers().shift||(!this.completeSelection()&&!this.loading)){this.view.setAutoSelect(false);this.view.hide();ja=false;}else if(!ma)this.tabQueued=true;break;case s.UP:this.view.prev();break;case s.DOWN:this.view.next();break;case s.RETURN:this.view.select();break;case s.PAGE_UP:this.view.first();break;default:var na=(ka<=46),oa=(ka>=112&&ka<=126),pa=(ka===144||ka===145);if(!na&&!oa&&!pa){if(n.unlockTextOnKeypress)this._unlockQuery();this.view.setAutoSelect(true);}this.stickyQuery=null;ja=false;break;}this.input.storeSelection();if(ja)return event.kill();};ia.prototype.mousedown=function(event){"use strict";this.view.setAutoSelect(true);this.input.storeSelection();if(u.byClass(event.target,"_50c9"))event.preventDefault();};ia.prototype.focusWindow=function(){"use strict";this.windowFocused=true;};ia.prototype.blurWindow=function(){"use strict";this.windowFocused=false;};ia.prototype.selectView=function(ja,ka){"use strict";if(!ka||!ka.selected)return;ka.selected.see_more=this.data.isSeeMore();this.inform('select',ka);var la=this.cleanQuery(ka.selected);this.executeQuery(la);};ia.prototype.highlightView=function(){"use strict";var ja=this.view.getSelection();ja&&this.input.setHint(ja.structure);};ia.prototype.blurInput=function(){"use strict";setTimeout((function(){if(this.windowFocused||w.getRequestURI().getSubdomain()==='apps'){this.input.togglePlaceholder();this.close();}}).bind(this),0);};ia.prototype.changeInput=function(){"use strict";this.inform('change');this.checkValue();this.inform('change_end');};ia.prototype.focusInput=function(){"use strict";this.open();this.input.togglePlaceholder(false);};ia.prototype.updateData=function(){"use strict";this.view.setLoading(this.loading);};ia.prototype.completeData=function(ja,ka){"use strict";if(ka.forceDisplay||(this.value&&this.value.matches(ka.value))){this.view.render(ka.value,ka.results,ka.isAsync,(ka.results.length===0)&&ka.isEmptyResults,ka.isScrollable);if(this.tabQueued&&this.completeSelection())delete this.tabQueued;}};ia.prototype.typeaheadActivity=function(ja,ka){"use strict";this.fetching=ka.activity;if(this.loading!==this.fetching){this.loading=this.fetching;this.updateData();}};ia.prototype.getNameTextFromSelected=function(){"use strict";var ja=this.settedQuery&&this.settedQuery.semantic,ka=this.data.facebarConfig&&this.data.facebarConfig.name_functions,la=ja&&ka&&ja.match(/[a-z-]+\([^()]+\)/g);if(la)for(var ma=0;ma<la.length;ma++){var na=la[ma].match(/([a-z-]+)\(([^()]+)\)/);if(na&&x(ka,na[1]))return na[2];}return this.value.toString();};y(ia.prototype,{events:['session','focus','select','change','execute','blur']});e.exports=ia;});
__d("FacebarTypeaheadRecorder",["clickRefAction","copyProperties","Event","Keys","SearchTypeaheadRecorder","URI","userAction","Arbiter"],function(a,b,c,d,e,f){var g=b('clickRefAction'),h=b('copyProperties'),i=b('Event'),j=b('Keys'),k=b('SearchTypeaheadRecorder'),l=b('URI'),m=b('userAction'),n=b('Arbiter');for(var o in k)if(k.hasOwnProperty(o))q[o]=k[o];var p=k===null?null:k.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=k;function q(r){"use strict";this.typeahead=r;k.call(this,r);this.userText="";this.queryTimes={};this._sessionDisabled=false;this.type="facebar";}q.prototype.initEvents=function(){"use strict";this.typeahead.getCore().subscribe('session',function(r,s){if(s===null){this.sessionEnd();}else this.sessionStart(s);}.bind(this));this.typeahead.getCore().subscribe('select',function(r,s){this.recordSelectInfo(s);}.bind(this));this.typeahead.getCore().input.subscribe('shortcut',function(r,s){this.recordShortcut(s);}.bind(this));this.typeahead.getCore().subscribe('quickSelectRedirect',function(r,s){this.recordQuickSelectInfo(s);}.bind(this));this.typeahead.getView().subscribe('render',function(r,s){this.recordRender(s);}.bind(this));this.typeahead.data.subscribe('query',function(r,s){if(!s.value.isEmpty())this.recordCountStat('num_queries');if(s.see_more)this.recordStat('clicked_see_more',1);this.recordAvgStat('num_results_from_cache',s.results.length);this.queryTimes[s.queryId]={send:Date.now()};}.bind(this));this.typeahead.data.subscribe('sending_request',function(r,s){var t=s.data.value;if(!t)return;this.backendQueries.push(t);}.bind(this));this.typeahead.subscribe('navigation',function(r,s){if(s&&s.structure){this.recordStat('navigation_input',JSON.stringify(s.structure.toStruct()));this.recordStat('navigation_text',s.structure.toString());}}.bind(this));this.typeahead.data.subscribe('response_received',function(r,s,t){if(this.queryTimes[s.queryId]){var u=this.queryTimes[s.queryId];u.recv=Date.now()-u.send;u.payload_size=JSON.stringify(s).length;}}.bind(this));this.typeahead.data.subscribe('backend_response',function(r,s){if(this.queryTimes[s.queryId]){var t=this.queryTimes[s.queryId];t.render=Date.now()-t.send;if(s.payload.incomplete)t.incomplete=true;t.backendInfo=s.payload.info;if(this.core.scubaInfo)this.logToScuba(s,t,this.core.scubaInfo,this.userText,this.type);}}.bind(this));n.subscribe('BrowseNUX/typing',this.disableThisSession.bind(this));n.subscribe('TestConsole/typing',this.disableThisSession.bind(this));this.typeahead.getCore().subscribe('change',function(r,s){this.userInput(this.core.getText());}.bind(this));this.typeahead.subscribe('clear',function(){this.recordAppendStat('before_clear_queries',this.userText);}.bind(this));i.listen(this.element,'keydown',function(event){this.recordStat('keypressed',1);if(i.getKeyCode(event)==j.BACKSPACE){if(!this._backspacing){this._backspacing=true;this.recordAppendStat('before_backspace_queries',this.core.getText());}}else this._backspacing=false;}.bind(this));this.typeahead.subscribe('filter',function(r,s){this._unsupportedGrammarInfo=this.buildUnsupportedGrammarInfo(s);}.bind(this));this.typeahead.getCore().subscribe('recordFunction',function(r,s){this._extraRecorder.push(s);}.bind(this));};q.prototype._reset=function(r){"use strict";this.stats={};this.avgStats={};this.appendStats={};this._backspacing=false;this.backendQueries=[];this._topreplace=false;this._inflightRequests={};};q.prototype.sessionStart=function(r){"use strict";this._sessionEnded=false;this.data.setQueryData({sid:r});this.recordStat('sid',r);if(!this.stats.session_start_time){this.recordStat('session_start_time',Date.now());var s=new Date(),t=s.getTimezoneOffset(),u=Date.now()-t*60*1000;this.recordStat('session_start_time_user_timezone',u);}this.recordStat('keypressed',0);this.queryTimes={};};q.prototype.sessionEnd=function(){"use strict";if(this._sessionEnded||this._sessionDisabled){if(this._sessionDisabled){this.reset();this._sessionDisabled=false;this._sessionEnded=true;}return;}this._sessionEnded=true;this.recordStat('session_end_time',Date.now());this.recordStat('grammar_version',this.data.getQueryData().grammar_version);this.submit();};q.prototype.disableThisSession=function(){"use strict";this._sessionDisabled=true;};q.prototype.userInput=function(r){"use strict";this.userText=r;};q.prototype.buildUnsupportedGrammarInfo=function(r){"use strict";var s=r.results?r.results[0]:null;if(!s||s.results_set_type!=='unimplemented')return null;return {unsupported_grammar:{category:s.error_info.category||'unknown',edge:s.error_info.blamed_edge}};};q.prototype.buildTypeaheadRecord=function(r,s){"use strict";var t=r.rankType||r.render_type||r.type,u=0,v=s;if(typeof r.groupIndex=='number'){u=r.groupIndex;v=r.indexInGroup;}var w={group_index:u,index_in_group:v,cost:r.cost,s_value:r.s_value||0,semantic:r.semantic,text:r.structure.toString(),cache_only:(r.cacheOnlyResult?1:0),parse:r.parse,semantic_forest:r.semanticForest,normalized_input:r.entityTypes,category:r.category,type:t,source:r.bootstrapped,grammar_results_type:(r.results_set_type||'').replace(/[\[\{](.*)[\]\}]/,'$1'),result_from_memcache:r.memcache,websuggestion_source:r.websuggestion_source,dynamic_cost:r.dynamic_cost,is_js_bootstrap_match:r.isJSBootstrapMatch,backend_cost:r.backendCost,bootstrap_cost:r.bootstrapCost,match_type:r.match_type,l_type:r.l_type,vertical_type:r.vertical_type,prefix_match:r.prefix_match,prefix_length:r.prefix_length,index_before_buckets:r.indexBeforeBuckets,bucket_lineage:r.bucketLineage,nullstate:r.isNullState,singlestate:r.isSingleState,query_id:r.qid,template_id:r.templateID,coeff_cost:(typeof r.grammar_costs=='undefined')?-1:r.grammar_costs["{"+r.type+"}"]};if(r.logInfo)w.backend_log_info=r.logInfo;if(r.s_token)w.s_token=r.s_token;if(r.s_categories)w.s_categories=r.s_categories;return w;};q.prototype.buildListTypeaheadRecords=function(){"use strict";var r=[];this.results&&this.results.forEach(function(s,t){if(s.uid!=='search')r.push(this.buildTypeaheadRecord(s,t));}.bind(this));return r;};q.prototype.recordShortcut=function(r){"use strict";this.recordStat('shortcut',1);this.recordStat('shortcut_with_shift',r.shift);};q.prototype.recordStats=function(r,s){"use strict";for(var t in s)this.recordStat(r+'_'+t,s[t]);};q.prototype.getTypeaheadIndex=function(r,s){"use strict";var t=typeof r.groupIndex=='number'?r.groupIndex+1:0;return s-t;};q.prototype.recordQuickSelectInfo=function(r){"use strict";var s={input_query:r.input_query,semantic:r.semantic,type:r.type,position:r.position,with_mouse:r.with_mouse,text:r.text,quick_select:1};this.recordStats('selected',s);this.recordStat('quick_select',1);};q.prototype.recordSelectInfo=function(r){"use strict";var s=r.selected,t=this.getTypeaheadIndex(s,r.index),u={};if(s.uid=='search'){u.selected_search=1;}else{u=this.buildTypeaheadRecord(s);var v=(u.type=='friend'?'user':u.type);u.position=t;u[v]=1;}u.with_mouse=r.clicked?1:0;u.quick_select=0;u.see_more=s.see_more?1:0;u.input_query=this.userText;u.input_fragments=JSON.stringify(this.core.currentQuery.toStruct());var w=s.dataGT?{gt:JSON.parse(s.dataGT)}:{},x={href:s.path};g('click',x,null,null,w);m('search').uai('click');this.recordStats('selected',u);this.recordAppendStat('selection_history',{selected:u,candidate_results:this.buildListTypeaheadRecords(),timestamp:Date.now()});var y={};this._extraRecorder.forEach(function(z){z(r,this.results,y);}.bind(this));this.recordStat('extra_select_info',JSON.stringify(y));this.recordStat('selected_with_mouse',r.clicked?1:0);};q.prototype._dataToSubmit=function(){"use strict";this.recordStat('max_results',this.data._maxResults);if(this.stats&&this.stats.selected_input_query){this.recordStat('input_query',this.stats.selected_input_query);}else this.recordStat('input_query',this.userText);this.recordStat('uri',l().toString());if(!this.stats.shortcut){this.recordStat('shortcut',0);this.recordStat('shortcut_with_shift',false);}var r=this.stats;for(var s in this.avgStats){var t=this.avgStats[s];r[s]=t[0]/t[1];}var u={candidate_results:this.buildListTypeaheadRecords(),timestamp:Date.now(),input_query:this.userText};if(this._unsupportedGrammarInfo)h(u,this._unsupportedGrammarInfo);this.recordAppendStat('suggestions_at_end_of_session',u);this.recordAppendStat('query_times',this.queryTimes);if(this.backendQueries.length>0){if(this.backendQueries.length>this.data.logBackendQueriesWindow)this.backendQueries=this.backendQueries.slice(this.backendQueries.length-this.data.logBackendQueriesWindow);this.recordStat('backend_queries',this.backendQueries);}for(var v in this.appendStats)r[v]=JSON.stringify(this.appendStats[v]);return r;};q.prototype.getDataToSubmit=function(){"use strict";return this._dataToSubmit();};q.prototype.reset=function(){"use strict";return this._reset();};q.prototype.submit=function(){"use strict";if(!this._sessionDisabled)p.submit.call(this);this.view.inform('feedback');this._reset();};h(q.prototype,{_endPoint:'/ajax/typeahead/search/record_metrics.php',_sessionEnded:true,_extraRecorder:[],_banzaiRoute:'facebar'});e.exports=q;});
__d("FacebarTypeaheadGrammarItem.react",["React","FacebarTypeaheadItem.react","FacebarTypeaheadToken.react","FacebarTypeaheadTokenText","cx","fbt"],function(a,b,c,d,e,f){var g=b('React'),h=b('FacebarTypeaheadItem.react'),i=b('FacebarTypeaheadToken.react'),j=b('FacebarTypeaheadTokenText'),k=b('cx'),l=b('fbt'),m={user:"Person"},n=g.createClass({displayName:'FacebarTypeaheadGrammarItem',renderToken:function(){var o=this.props.result.decoration,p=this.props.result.ambiguity,q=p&&p.text,r=(o&&o.entity)||(p&&p.entity);if(q){return (i({text:j.text(q)}));}else if(r)return (i({text:j.textForEntity(r,m),limit:2,leadingMiddot:true}));},render:function(){var o=this.renderToken(),p=o&&!o.props.leadingMiddot;return this.transferPropsTo(h({className:"_207",valign:p,token:o}));}});e.exports=n;});
__d("FacebarTypeaheadKeywordItem.react",["FacebarTypeaheadItem.react","FacebarTypeaheadToken.react","React","cx"],function(a,b,c,d,e,f){var g=b('FacebarTypeaheadItem.react'),h=b('FacebarTypeaheadToken.react'),i=b('React'),j=b('cx'),k=i.createClass({displayName:'FacebarTypeaheadKeywordItem',render:function(){var l=['Search'];if(this.props.result.isTrending)l.push('Trending');var m=h({text:l,innerClass:"_53ab"});return this.transferPropsTo(g({className:"_207",token:m,prefix:this.props.result.query_string}));}});e.exports=k;});
__d("FacebarTypeaheadNodeItem.react",["React","DOM"],function(a,b,c,d,e,f){var g=b('React'),h=b('DOM'),i=g.createClass({displayName:'FacebarTypeaheadNodeItem',render:function(){var j=this.props.result.node;return this.transferPropsTo(g.DOM.li(null,!h.isElementNode(j)?j:null));},attachNode:function(j){var k=this.props.result.node;if(h.isElementNode(k))h.setContent(j,k);},componentDidMount:function(j){this.attachNode(j);},componentDidUpdate:function(j,k,l,m){this.attachNode(m);}});e.exports=i;});
__d("FacebarTypeaheadWebSuggestionItem.react",["FacebarTypeaheadItem.react","FacebarTypeaheadToken.react","React","cx"],function(a,b,c,d,e,f){var g=b('FacebarTypeaheadItem.react'),h=b('FacebarTypeaheadToken.react'),i=b('React'),j=b('cx'),k={EXACT_MATCH:1,BING:2,BING_POPULAR:3,WEBSUGGESTIONS_AS_KEYWORDS:4},l=i.createClass({displayName:'FacebarTypeaheadWebSuggestionItem',renderToken:function(){if(this.props.result.isLockedWebSearchMode)return;var m=this.props.result.websuggestion_source,n;if(m===k.WEBSUGGESTIONS_AS_KEYWORDS){n='Search';}else if(m===k.BING_POPULAR){n='Popular Web Search';}else n='Web Search';return (h({innerClass:"_57q5",text:[n]}));},render:function(){this.props.result.icon_class="_6-a";return this.transferPropsTo(g({className:"_207",token:this.renderToken()}));}});e.exports=l;});
__d("FacebarTypeaheadList.react",["FacebarTypeaheadEntityItem.react","FacebarTypeaheadGrammarItem.react","FacebarTypeaheadKeywordItem.react","FacebarTypeaheadNodeItem.react","FacebarTypeaheadWebSuggestionItem.react","LoadingIndicator.react","React","ReactPropTypes","FacebarJSConstants","cx","fbt"],function(a,b,c,d,e,f){var g=b('FacebarTypeaheadEntityItem.react'),h=b('FacebarTypeaheadGrammarItem.react'),i=b('FacebarTypeaheadKeywordItem.react'),j=b('FacebarTypeaheadNodeItem.react'),k=b('FacebarTypeaheadWebSuggestionItem.react'),l=b('LoadingIndicator.react'),m=b('React'),n=b('ReactPropTypes'),o=b('FacebarJSConstants'),p=b('cx'),q=b('fbt'),r=m.createClass({displayName:'FacebarTypeaheadList',propTypes:{results:n.array,onRender:n.func,onSelect:n.func.isRequired,onHighlight:n.func.isRequired},getItemComponent:function(s){if(s.type==='websuggestion'){return k;}else if(s.results_set_type===o.browseTypes.keyword){return i;}else if(s.type==='grammar'){return h;}else if(s.node){return j;}else return g;},renderItem:function(s,t){var u=this.getItemComponent(s);return u({result:s,onClick:this.handleClick.curry(s),onMouseEnter:this.handleMouseEnter.curry(s)});},renderFooter:function(){var s=(("_3su")+(!this.props.loading?' '+"hidden_elem":''));return (m.DOM.li({className:s},this.props.loading,m.DOM.div({className:"_21f"},"Retrieving suggestions",l({size:"medium",color:"white"}))));},render:function(){var s=this.props.results;return (m.DOM.ul({className:"_21c",role:"listbox"},s&&s.map(this.renderItem),this.renderFooter()));},handleClick:function(s,t){if(!t.nativeEvent.isMiddleClick()&&!t.nativeEvent.getModifiers().any){this.props.onSelect(s);t.preventDefault();}},handleMouseEnter:function(s){this.props.onHighlight(s);},componentDidUpdate:function(s,t,u,v){this.props.onRender();}});e.exports=r;});
__d("FacebarTypeaheadView",["Arbiter","CSS","ContextualLayer","DOM","FacebarTypeaheadList.react","Parent","React","Style","TypeaheadView","Vector","copyProperties","csx","cx","fbt"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('ContextualLayer'),j=b('DOM'),k=b('FacebarTypeaheadList.react'),l=b('Parent'),m=b('React'),n=b('Style'),o=b('TypeaheadView'),p=b('Vector'),q=b('copyProperties'),r=b('csx'),s=b('cx'),t=b('fbt'),u='unimplemented';for(var v in o)if(o.hasOwnProperty(v))x[v]=o[v];var w=o===null?null:o.prototype;x.prototype=Object.create(w);x.prototype.constructor=x;x.__superConstructor__=o;function x(y,z){"use strict";o.call(this,y,z);this.sid='';this.index=-1;this.warningShown=false;this.autoSelect=false;this.loading=false;}x.prototype.init=function(){"use strict";this.initializeElements();};x.prototype.initializeElements=function(){"use strict";var y=this.element;this.content=j.find(y,"._21r");this.warningNode=j.find(y,"._553e");this.resultsContainer=j.create('div');this.resultsComponent=k({onRender:this.handleRender.bind(this),onHighlight:this.handleHighlight.bind(this),onSelect:this.handleSelect.bind(this)});m.renderComponent(this.resultsComponent,this.resultsContainer);this.content.appendChild(this.resultsContainer);};x.prototype.initializeLayer=function(){"use strict";this.layer=new i({context:l.byClass(this.causalElement,"_585-"),position:'below',causalElement:this.causalElement},this.element);var y=this.layer.getContentRoot();this.root=j.find(y,"._50c9");h.addClass(y,"_5tlx");};x.prototype.setInputElement=function(y){"use strict";this.setAccessibilityControlElement(y);this.causalElement=y;this.initializeLayer();};x.prototype.setAutoSelect=function(y){"use strict";this.autoSelect=y;if(this.index===-1&&y)this.first();};x.prototype.setAnimationDuration=function(y){"use strict";this.$FacebarTypeaheadView0=y;};x.prototype.handleHighlight=function(y){"use strict";this.highlight(this.results.indexOf(y),false);};x.prototype.handleSelect=function(y){"use strict";this.handleHighlight(y);this.select(true);};x.prototype.show=function(){"use strict";if(!this.visible){this.inform('beforeShow',this.layer);var y=w.show.call(this);this.first();this.layer.show();this.layer.updatePosition();this.calculateAndSetHeight();this.inform('show');g.inform('layer_shown',{type:'FacebarTypeahead'});return y;}};x.prototype.hide=function(){"use strict";if(this.visible){this.layer.hide();w.hide.call(this);n.set(this.root,'height','0px');this.inform('hide');g.inform('layer_hidden',{type:'FacebarTypeahead'});}return this;};x.prototype.select=function(y){"use strict";var z=this.results&&this.results[this.index];if(!z){this.inform('quickSelect');return;}var aa=this.inform('beforeSelect',{index:this.index,selected:z});if(aa!==false)w.select.call(this,y);};x.prototype.buildResults=function(y){"use strict";y.forEach(function(z){if(!this.showBadges)z.is_verified=null;z.query_string=this.value.toString();}.bind(this));this.resultsComponent.setProps({results:y,loading:this.loading});return this.resultsContainer;};x.prototype.getItems=function(){"use strict";return w.getItems.call(this).slice(0,-1);};x.prototype.handleRender=function(){"use strict";this.items=this.getItems();this.calculateAndSetHeight();};x.prototype.calculateAndSetHeight=function(){"use strict";if(this.resultsContainer&&h.shown(this.resultsContainer)){var y=p.getElementDimensions(this.resultsContainer).y;n.set(this.root,'height',y+'px');}};x.prototype.render=function(y,z,aa,ba,ca){"use strict";this.inform('filter',{results:z,value:y,isScrollable:ca});this.seeMoreResult=null;if(z.length&&!ca&&y.getLength()){this.seeMoreResult=this.inform('seeMore',{value:y,results:z});if(!this.loading&&this.seeMoreResult)z.push(this.seeMoreResult);}var da=z[0];if(ba){this.showWarning(t._("There are no results for '{query}'",[t.param("query",y.toString())]));}else if(da&&da.results_set_type===u){if(!da.error_info.suppress)this.showWarning(da.error_info.errorMessage||"This search isn't currently supported.");}else this.hideWarning();if(this.inform('removeUnimplementedGrammar')!==false)z=z.filter(function(ea){return ea.results_set_type!==u;}.bind(this));w.render.call(this,y,z,aa);};x.prototype.reset=function(){"use strict";this.index=-1;this.items=[];this.results=[];this.value='';this.buildResults([]);this.inform('reset');return this;};x.prototype.showWarning=function(y){"use strict";h.show(this.warningNode);j.setContent(this.warningNode,y);this.warningShown=true;this.highlight(-1,false);};x.prototype.hideWarning=function(){"use strict";h.hide(this.warningNode);this.warningShown=false;this.highlight(this.index,false);};x.prototype.setLoading=function(y){"use strict";if(this.loading!=y){this.loading=y;if(this.seeMoreResult){if(this.loading){this.results.splice(this.results.indexOf(this.seeMoreResult),1);}else this.results.push(this.seeMoreResult);this.buildResults(this.results);}else this.resultsComponent.setProps({loading:y});}};x.prototype.first=function(){"use strict";this.index=this.autoSelect?0:-1;this.highlight(this.index);};x.prototype.prev=function(){"use strict";if(this.index<=0)this.index=this.items.length;this.ignoreMouseover=true;w.prev.call(this);};x.prototype.next=function(){"use strict";if(this.index+1>=this.items.length)this.index=-1;this.ignoreMouseover=true;w.next.call(this);};x.prototype.highlight=function(y,z){"use strict";z=z!==false&&(this.index!=y);if(!z||this.inform('beforeHighlight')!==false){var aa=this.warningShown||!this.autoSelect?-1:0;w.highlight.call(this,Math.max(aa,y),z);}};q(x.prototype,{events:['highlight','render','filter']});e.exports=x;});
__d("FacebarTypeaheadViewMegaphone",["Arbiter","ArbiterMixin","AsyncRequest","Button","CSS","Event","mixin"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('Button'),k=b('CSS'),l=b('Event'),m=b('mixin'),n=m(h);for(var o in n)if(n.hasOwnProperty(o))q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(r,s,t){"use strict";this.root=r;this.tourButton=s;this.closeButton=t;this.core=null;this.hidden=false;l.listen(this.tourButton,'click',this.$FacebarTypeaheadViewMegaphone0.bind(this));l.listen(this.closeButton,'click',this.$FacebarTypeaheadViewMegaphone1.bind(this));g.subscribe('Facebar/init',this.$FacebarTypeaheadViewMegaphone2.bind(this));}q.prototype.$FacebarTypeaheadViewMegaphone2=function(r,s){"use strict";s.view.subscribe('render',this.$FacebarTypeaheadViewMegaphone4.bind(this));s.view.subscribe('show',this.$FacebarTypeaheadViewMegaphone4.bind(this));this.core=s.core;};q.prototype.$FacebarTypeaheadViewMegaphone4=function(){"use strict";k.conditionShow(this.root,!this.hidden&&this.core.getValue().isEmpty());};q.prototype.$FacebarTypeaheadViewMegaphone0=function(){"use strict";j.setEnabled(this.tourButton,false);this.inform('start');};q.prototype.$FacebarTypeaheadViewMegaphone1=function(){"use strict";new i().setURI('/ajax/browse/nux_hide.php').setMethod('POST').send();this.hide();this.inform('hide');};q.prototype.hide=function(){"use strict";this.hidden=true;k.hide(this.root);};e.exports=q;});
__d("FacebarTypeaheadDecorateEntities",["arrayContains","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('arrayContains'),h=b('copyProperties'),i=b('emptyFunction');function j(n){var o=[];n.forEach(function(p){if(p.isType('ent'))o.push(p.getUID());});return o;}function k(n,o){var p=null;n.structure.forEach(function(q){if(q.isType('ent')&&!g(o,q.getUID()))p=q;});return p;}function l(n,o,p){n.forEach(function(q){var r=k(q,o);q.decoration={entity:r&&p.getEntryForFragment(r)};});}function m(n){"use strict";this._typeahead=n;}m.prototype.enable=function(){"use strict";this._typeahead.view.subscribe('filter',function(n,o){l(o.results,j(this._typeahead.core.getValue()),this._typeahead.data);}.bind(this));};h(m.prototype,{disable:i});e.exports=m;});
__d("FacebarTypeaheadDisambiguateResults",["FacebarDisambiguationDialog","FacebarStructuredFragment","FacebarStructuredText","URI","copyProperties","emptyFunction","getObjectValues"],function(a,b,c,d,e,f){var g=b('FacebarDisambiguationDialog'),h=b('FacebarStructuredFragment'),i=b('FacebarStructuredText'),j=b('URI'),k=b('copyProperties'),l=b('emptyFunction'),m=b('getObjectValues');function n(w,x){var y={};w.forEach(function(ba){if(ba.type=='grammar'){var ca=x(ba.structure).toLowerCase();y[ca]=y[ca]||[];y[ca].push(ba);}});var z=[];for(var aa in y)if(y[aa].length>1)z.push(y[aa]);return z;}function o(w){var x=[];w.toArray().forEach(function(y,z){if(y.isType('ent'))x.push(z);});return x;}function p(w,x,y){var z={},aa={},ba={};x.forEach(function(da){var ea=w[0].structure.getFragment(da),fa=ea.getHash();aa[fa]=aa[fa]||[];ba[da]=aa[fa];w.forEach(function(ga){var ha=ga.structure.getFragment(da),ia=ha&&ha.getUID();if(ia&&!z.hasOwnProperty(ia)){aa[fa].push(y.getEntryForFragment(ha));z[ia]=true;}});});for(var ca in ba)if(ba[ca].length<=1)delete ba[ca];return ba;}function q(w,x){var y={},z=[];w.forEach(function(aa){var ba=aa.structure.getFragment(x).getUID();if(!y.hasOwnProperty(ba)){y[ba]=z.length;z.push([]);}z[y[ba]].push(aa);});return z;}function r(w,x,y){var z=w.shift();z.ambiguity.entities=x;y.push.apply(y,w);return z;}function s(w,x){var y=[],z=[],aa=false;w.forEach(function(ca){ca.ambiguity={fragment:null,entities:null,text:null};});n(w,function(ca){return ca.getHash();}).forEach(function(ca){var da=ca[0].structure,ea=o(da),fa=p(ca,ea,x);if(aa){r(ca,fa,y);return;}var ga=ea.pop();if(typeof ga=='number'){var ha=q(ca,ga);aa=ha.length>1;if(aa)delete fa[ga];ha.forEach(function(ia){var ja=r(ia,fa,y);if(aa){var ka=ja.structure.getFragment(ga).getUID();ja.ambiguity.entity=x.getEntry(ka);z.push(ja);}});}});y.forEach(function(ca){var da=w.indexOf(ca);da!=-1&&w.splice(da,1);});n(w,function(ca){return ca.toString();}).forEach(function(ca){ca.forEach(function(da){if(!da.ambiguity.entities)da.ambiguity.text=da.queryTypeText;});});var ba=w.indexOf(z[0]);z.slice(1).forEach(function(ca){var da=w.indexOf(ca);if(da!=-1&&da!=++ba){w.splice(da,1);w.splice(ba,0,ca);}});}function t(w,x){var y=w&&w.ambiguity&&w.ambiguity.entities,z=y&&Object.keys(y).map(Number),aa=x.core.input;if(!z||z.length===0)return false;var ba=function(ea){x.core.executeQuery(u(w,z,ea));},ca=function(){aa.focus();aa.input.moveSelectionToEnd();};y=y?m(y):[];var da=new g(y,w.uri.getPath(),ba,ca,x.getCore().getSessionID());aa.blur();da.show();return true;}function u(w,x,y){var z=w.structure.toArray(),aa=j(w.uri),ba=aa.getPath().split('/');x.forEach(function(ca){var da=z[ca],ea=y.shift(),fa=ba.indexOf(String(da.getUID()));if(fa!=-1)ba[fa]=ea.uid;z[ca]=new h({uid:ea.uid,text:ea.text,type:'ent:'+ea.type});});return {uri:aa.setPath(ba.join('/')),structure:new i(z)};}function v(w){"use strict";this._typeahead=w;}v.prototype.enable=function(){"use strict";this._typeahead.view.subscribe('filter',function(w,x){s(x.results,this._typeahead.data);}.bind(this));this._typeahead.view.subscribe('beforeSelect',function(w,x){return !t(x.selected,this._typeahead);}.bind(this));};k(v.prototype,{disable:l});e.exports=v;});
__d("FacebarTypeaheadHashtagResult",["HashtagSearchResultUtils"],function(a,b,c,d,e,f){var g=b('HashtagSearchResultUtils');function h(i){"use strict";this.$FacebarTypeaheadHashtagResult0=i.getData();}h.prototype.enable=function(){"use strict";this.$FacebarTypeaheadHashtagResult1=this.$FacebarTypeaheadHashtagResult0.subscribe('beforeQuery',this.$FacebarTypeaheadHashtagResult2.bind(this));};h.prototype.$FacebarTypeaheadHashtagResult2=function(i,j){"use strict";if(!j||!j.value)return;var k=this.$FacebarTypeaheadHashtagResult0.getRawStructure(j.value);if(!k||k.is_empty||!k.raw_text)return;var l=g.getHashtagFromQuery(k.raw_text);if(!l)return;var m='hashtag:'+l,n=this.$FacebarTypeaheadHashtagResult0.getEntry(m);if(!n){this.$FacebarTypeaheadHashtagResult0.processEntries([g.makeFacebarEntry(l)]);this.$FacebarTypeaheadHashtagResult0.resultStore.saveResults([g.makeFacebarResult(l)],k,true);}return;};h.prototype.disable=function(){"use strict";this.$FacebarTypeaheadHashtagResult1&&this.$FacebarTypeaheadHashtagResult0.unsubscribe(this.$FacebarTypeaheadHashtagResult1);};e.exports=h;});
__d("FacebarTypeaheadMagGo",["csx","DOM","Event","$","SubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('csx'),h=b('DOM'),i=b('Event'),j=b('$'),k=b('SubscriptionsHandler');function l(m){"use strict";this._core=m.getCore();this._view=this._core.view;this._handler=new k();this._selected=null;}l.prototype.enable=function(){"use strict";var m=h.find(j('blueBar'),"._585_");this._handler.addSubscriptions(i.listen(m,'click',this._runQuery.bind(this)),this._view.subscribe('highlight',this._highlight.bind(this)),this._view.subscribe('render',this._render.bind(this)),this._core.subscribe('close',this._close.bind(this)));};l.prototype.disable=function(){"use strict";this._handler.release();};l.prototype._highlight=function(m,n){"use strict";this._selected=n.selected;};l.prototype._render=function(m,n){"use strict";this._selected=this._view.results[this._view.index];};l.prototype._runQuery=function(){"use strict";if(this._selected)return this._core.selectView(null,{selected:this._selected});};l.prototype._close=function(){"use strict";this._selected=null;};e.exports=l;});
__d("FacebarTypeaheadNavigation",["Arbiter","FacebarNavigation","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('FacebarNavigation'),i=b('copyProperties'),j=b('emptyFunction');function k(l){"use strict";this._core=l.core;this._preserveQuery=false;this._typeahead=l;}k.prototype.enable=function(){"use strict";h.registerBehavior(this);this._core.subscribe('execute',this.executedUserQuery.bind(this));this._core.subscribe('change',this.changeUserQuery.bind(this));};k.prototype.executedUserQuery=function(l,m){"use strict";this._preserveQuery=true;};k.prototype.changeUserQuery=function(){"use strict";this._navigatedQuery=false;};k.prototype.pageTransition=function(){"use strict";if(!this._preserveQuery){this._core.close();this._core.reset();}else this._preserveQuery=false;};k.prototype.setPageQuery=function(l){"use strict";l=this._core.setPageQuery(l);this._typeahead.inform('navigation',l,g.BEHAVIOR_PERSISTENT);};i(k.prototype,{disable:j});e.exports=k;});
__d("FacebarTypeaheadPrefixLengthOrderedCache",["copyProperties","emptyFunction","Arbiter"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('emptyFunction'),i=b('Arbiter');function j(k){"use strict";this._typeahead=k;}j.prototype.enable=function(){"use strict";this._typeahead.data.inform('setSortFunction',function(k,l){return (k.cache_id_length!=l.cache_id_length)?k.cache_id_length-l.cache_id_length:(k.cost||0)-(l.cost||0);},i.BEHAVIOR_STATE);};g(j.prototype,{disable:h});e.exports=j;});
__d("FacebarTypeaheadQuickSelect",["FacebarStructuredText","URI"],function(a,b,c,d,e,f){var g=b('FacebarStructuredText'),h=b('URI'),i='/search/web/direct_search.php';function j(k){"use strict";this._core=k.getCore();this._view=k.getView();this._input=this._core.input;this._beforeSelectListener=null;this._quickSelectListener=null;}j.prototype.enable=function(){"use strict";this._beforeSelectListener=this._view.subscribe('beforeSelect',this._quickSelect.bind(this));this._quickSelectListener=this._view.subscribe('quickSelect',this._quickSelect.bind(this));};j.prototype._quickSelect=function(k,l){"use strict";if(l&&l.selected&&l.selected.uid!=='search')return true;var m=this._input.getValue().toArray(),n=new g(m),o=n.toString();if(!o)return true;var p=h(i).addQueryData('q',o),q={input_query:o,type:'quickselect',text:o,position:0,with_mouse:0,semantic:'quickselect('+p.toString()+')',extra_uri_params:{source:'quickselect',sid:this._core.getSessionID()},uri:p};this._core.inform('quickSelectRedirect',q);this._core.executeQuery(q);return false;};j.prototype.disable=function(){"use strict";this._beforeSelectListener&&this._view.unsubscribe(this._beforeSelectListener);this._quickSelectListener&&this._view.unsubscribe(this._quickSelectListener);};e.exports=j;});
__d("FacebarTypeaheadRecorderBasic",["Arbiter","FacebarTypeaheadRecorder","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('FacebarTypeaheadRecorder'),i=b('copyProperties');function j(k){"use strict";this._typeahead=k;}j.prototype.enable=function(){"use strict";var k=this._typeahead;this._subscription=k.subscribe('init',function(l,m){var n=new h(k);k.inform('recorder',n,g.BEHAVIOR_PERSISTENT);});};j.prototype.disable=function(){"use strict";this._typeahead.unsubscribe(this._subscription);this._subscription=null;};i(j.prototype,{_subscription:null});e.exports=j;});
__d("FacebarTypeaheadSearchMap",["URI"],function(a,b,c,d,e,f){var g=b('URI');function h(i){"use strict";this._typeahead=i;this._subscription=null;}h.prototype.enable=function(){"use strict";this._subscription=this._typeahead.core.subscribe('execute',function(i,j){if(this._moveMapToQuery(j))return true;}.bind(this));};h.prototype._moveMapToQuery=function(i){"use strict";var j=i.results_set_type==='browse_type_place'||i.results_set_type==='page',k=window.searchmap&&window.location.pathname==='/nearby';if(!j||i.is_redirect){return false;}else if(k){window.searchmap.doFacebarSearch(i);return true;}else{var l=g('/nearby').addQueryData({query:i.structure._textHash,query_path:i.uri.getPath()});l.go();return true;}};h.prototype.disable=function(){"use strict";this._subscription&&this._subscription.unsubscribe();};e.exports=h;});
__d("FacebarTypeaheadSeeMoreSerp",["cx","FacebarStructuredText","FacebarURI","fbt","URI","React"],function(a,b,c,d,e,f){var g=b('cx'),h=b('FacebarStructuredText'),i=b('FacebarURI'),j=b('fbt'),k=b('URI'),l=b('React');function m(n){"use strict";this.$FacebarTypeaheadSeeMoreSerp0=n.getCore();this.$FacebarTypeaheadSeeMoreSerp1=this.$FacebarTypeaheadSeeMoreSerp0.view;}m.prototype.enable=function(){"use strict";this.$FacebarTypeaheadSeeMoreSerp2=this.$FacebarTypeaheadSeeMoreSerp1.subscribe('seeMore',this.$FacebarTypeaheadSeeMoreSerp3.bind(this));};m.prototype.disable=function(){"use strict";this.$FacebarTypeaheadSeeMoreSerp2.unsubscribe();};m.prototype.$FacebarTypeaheadSeeMoreSerp3=function(n,o){"use strict";var p=o.value.toString().trim();p=p.replace(/web\ssearch[\:]*\s*/i,'');var q=j._("See more results for \"{query}\"",[j.param("query",p)]),r=l.DOM.div({className:"_57zy calltoaction",'aria-label':q},l.DOM.span({className:"text"},l.DOM.span({className:"seeMore"},q))),s=k(this.$FacebarTypeaheadSeeMoreSerp1.seeMoreSerpEndpoint).addQueryData('q',p).addQueryData('sid',this.$FacebarTypeaheadSeeMoreSerp0.getSessionID());s=i.getQualifiedURI(s);return {uid:'see_more_serp',node:r,structure:new h(),search:true,uri:s,semantic:'seemore('+p+')',type:'see_more_serp',text:p};};e.exports=m;});
__d("FacebarTypeaheadSelectAll",["requestAnimationFrame"],function(a,b,c,d,e,f){var g=b('requestAnimationFrame');function h(i){"use strict";this._core=i.getCore();this._listener=null;}h.prototype.enable=function(){"use strict";var i=this._core.input;this._listener=this._core.subscribe('focus',function(j,k){var l=k&&k.catchup;l||g(function(){i.selectInput();});});};h.prototype.disable=function(){"use strict";this._listener&&this._core.unsubscribe(this._listener);};e.exports=h;});
__d("FacebarTypeaheadSizeAdjuster",["copyProperties","createArrayFrom","clip","emptyFunction","foldl","Style","Vector"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('createArrayFrom'),i=b('clip'),j=b('emptyFunction'),k=b('foldl'),l=b('Style'),m=b('Vector'),n=12,o=20,p=50,q=200,r=5;function s(u){return m.getElementDimensions(u).x;}function t(u){"use strict";this._core=u.getCore();this._view=this._core.view;this._input=this._core.input;this._cachedSizes={};this._appliedSize=null;this._defaultSize=this.getDefaultFontSize();this._calculatedSize=this._defaultSize;this._containerWidth=this.getContainerWidth();}t.prototype.enable=function(){"use strict";this._input.subscribe('change',this.adjustFontSize.bind(this));this.adjustFontSize();};t.prototype.getContainerWidth=function(){"use strict";return m.getElementDimensions(this._input.getElement()).x;};t.prototype.getDefaultFontSize=function(){"use strict";var u=l.get(this._input.getElement(),'font-size'),v=/^([\d\.]+)px$/.exec(u),w=v&&Number(v[1]);return Math.max(n,Math.min(o,w));};t.prototype.calculateFontSize=function(){"use strict";var u=this.getTextWidth(),v=this._calculatedSize;if(u>this._containerWidth-p){v--;}else if(u<this._containerWidth-q)v++;this._calculatedSize=i(v,n,this._defaultSize);return this._calculatedSize;};t.prototype.getTextWidth=function(){"use strict";var u=this._calculatedSize+this.getValueKey();if(!this._cachedSizes.hasOwnProperty(u))this._cachedSizes[u]=this.measureTextWidth();return this._cachedSizes[u];};t.prototype.getValueKey=function(){"use strict";var u=this._core.getValue().getHash(),v=r*Math.floor(u.length/r);return u.substr(0,v);};t.prototype.measureTextWidth=function(){"use strict";var u=this._input.getRawInputElement().childNodes;return k(function(v,w){return v+s(w);},h(u),0);};t.prototype.adjustFontSize=function(){"use strict";for(var u=0;u<10;u++){var v=this.calculateFontSize();if(v!=this._appliedSize){this._appliedSize=v;l.set(this._input.getElement(),'font-size',v+'px');l.set(this._view.content,'font-size',v+'px');}else break;}};g(t.prototype,{disable:j});e.exports=t;});
__d("FacebarTypeaheadTour",["Arbiter","AsyncRequest","BrowseNUXController","FacebarStructuredText","cx","fbt"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('BrowseNUXController'),j=b('FacebarStructuredText'),k=b('cx'),l=b('fbt');function m(n){"use strict";this._core=n.getCore();this._view=this._core.view;this._events=[];this._subscriptions=[];this._item={uid:'tour',uri:'#',type:'grammar',icon_class:"_4c7a",structure:j.fromString("Take the tour")};}m.prototype.enable=function(){"use strict";this._initEvents();this._subscriptions=[g.subscribe('BrowseNUX/megaphone',this._removeEvents.bind(this)),g.subscribe('BrowseNUX/starting',this._removeEvents.bind(this)),g.subscribe('BrowseNUX/finished',this._initEvents.bind(this))];};m.prototype.disable=function(){"use strict";while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();};m.prototype._initEvents=function(){"use strict";this._events=[this._view.subscribe('filter',this._addTour.bind(this)),this._view.subscribe('beforeSelect',this._beforeSelect.bind(this))];this._core.requery();};m.prototype._removeEvents=function(){"use strict";while(this._events.length)this._events.pop().unsubscribe();this._core.requery();};m.prototype._isNullState=function(){"use strict";return this._core.input.getValue().isEmpty();};m.prototype._addTour=function(n,event){"use strict";var o=event.results;if(o.length===0||!this._isNullState())return;var p=o.length;while(--p>=0)if(o[p].removable===true)break;o.splice(p+1,0,this._item);};m.prototype._beforeSelect=function(n,event){"use strict";if(event.selected===this._item){i.restartTour();return false;}new h('/ajax/browse/nux_addquery.php').setAllowCrossPageTransition(true).send();return true;};e.exports=m;});
__d("FacebarTypeaheadTrigger",["copyProperties","Arbiter"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('Arbiter');function i(j){"use strict";this._typeahead=j;this._core=j.getCore();this._subscription=null;}i.prototype.enable=function(){"use strict";this._subscription=h.subscribe('FacebarTrigger/select',this._activateTrigger.bind(this));};i.prototype.disable=function(){"use strict";h.unsubscribe(this._subscription);};i.prototype._activateTrigger=function(j,k){"use strict";var l=g({type:'grammar',uri:null,structure:null},k);if(!l.uri){setTimeout(function(){this._core.open();this._core.setQuery(l,false);}.bind(this),0);}else this._core.executeQuery(l);};e.exports=i;});