/*!CK:1439799947!*//*1384554852,178201931*/

if (self.CavalryLogger) { CavalryLogger.start_js(["pIRgb"]); }

__d("MercuryRecipientsDataSource",["DataSource","WebMessengerConstants"],function(a,b,c,d,e,f){var g=b('DataSource'),h=b('WebMessengerConstants');for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(l){"use strict";l=l||{};l.kanaNormalization=true;g.call(this,l);}k.prototype.buildData=function(l){"use strict";var m=[],n=[];l.forEach(function(o){var p=j.getEntry.call(this,o);if(p.render_type==h.NON_FRIEND_TYPE){var q=h.COMPOSER_NON_FRIENDS_MAX;if(n.length<q)n.push(o);}else if(m.length<h.COMPOSER_FRIENDS_MAX){p.render_type=h.FRIEND_TYPE;m.push(o);}}.bind(this));return j.buildData.call(this,m.concat(n));};e.exports=k;});
__d("SubscribableSet",["ArbiterMixin","isScalar","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('isScalar'),i=b('mixin'),j=i(g);for(var k in j)if(j.hasOwnProperty(k))m[k]=j[k];var l=j===null?null:j.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=j;function m(n){"use strict";this._map={};this._items=[];if(n)n.forEach(this.add.bind(this));}m.prototype.contains=function(n){"use strict";return n in this._map;};m.prototype.add=function(n){"use strict";if(!this.contains(n)){this._items.push(n);this._map[n]=n;this.inform('add',{item:n});this.inform('change');}};m.prototype.addAll=function(n){"use strict";n.forEach(this.add.bind(this));};m.prototype.remove=function(n){"use strict";if(this.contains(n)){delete this._map[n];this._items.splice(this._items.indexOf(n),1);this.inform('remove',{item:n});this.inform('change');}};m.prototype.clear=function(){"use strict";this.getItems().forEach(this.remove.bind(this));};m.prototype.getLength=function(){"use strict";return this._items.length;};m.prototype.getItems=function(){"use strict";return this._items.slice(0);};e.exports=m;});
__d("PhotoEditorFilters",[],function(a,b,c,d,e,f){function g(k){"use strict";this.$BaseFilter0=k;}g.prototype.filter=function(){"use strict";};g.prototype.run=function(k){"use strict";var l=this.$BaseFilter0.getImageData();this.filter.call(this,l,k);return l;};for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(){"use strict";if(g!==null)g.apply(this,arguments);}j.prototype.filter=function(k){"use strict";for(var l=0;l<k.getWidth();l++)for(var m=0;m<k.getHeight();m++){var n=k.getPixel(l,m),o=Math.floor((n.r+n.g+n.b)/3);n.r=n.g=n.b=o;k.setPixel(l,m,n);}};e.exports={BaseFilter:g,BlackAndWhiteFilter:j};});
__d("PhotoEditorCanvas",["BlobFactory","DOM","PhotoResizeModeConst","Vector","sprintf"],function(a,b,c,d,e,f){var g=b('BlobFactory'),h=b('DOM'),i=b('PhotoResizeModeConst'),j=b('Vector'),k=b('sprintf');function l(n){"use strict";this._editor=n;this._canvas=h.create('canvas');this._ctx=this._canvas.getContext('2d');this._drawHandler=null;}l.prototype.setImageContent=function(n){"use strict";this._canvas.width=n.width;this._canvas.height=n.height;this._ctx.drawImage(n,0,0);return this;};l.prototype.drawGraphic=function(){"use strict";this._ctx.drawImage.apply(this._ctx,arguments);return this;};l.prototype.isBlobSupported=function(){"use strict";return !!this._canvas.toBlob;};l.prototype.getElement=function(){"use strict";return this._canvas;};l.prototype.getDimensions=function(){"use strict";return new j(this._canvas.width,this._canvas.height,'document');};l.prototype.getWidth=function(){"use strict";return this._canvas.width;};l.prototype.getHeight=function(){"use strict";return this._canvas.height;};l.prototype.getContext=function(){"use strict";return this._ctx;};l.prototype.setWidth=function(n){"use strict";this._canvas.width=n;return this;};l.prototype.setHeight=function(n){"use strict";this._canvas.height=n;return this;};l.prototype.toBlob=function(n){"use strict";if(this.isBlobSupported()){this._canvas.toBlob(n);return;}this.getBlobFromDataURL(n);};l.prototype.getBlobFromDataURL=function(n){"use strict";var o=this.toDataURL('image/png'),p=o.match(/^data:(.*?);base64,/),q=p[1],r=o.substr(p[0].length),s=a.atob(r),t=new ArrayBuffer(s.length),u=new Uint8Array(t);for(var v=0;v<s.length;v++)u[v]=s.charCodeAt(v);var w=g.getBlob([t],{type:q});n(w);};l.prototype.toBlobURL=function(n){"use strict";this.toBlob(function(o){n(a.URL.createObjectURL(o));});};l.prototype.toURL=function(n){"use strict";if(this.isBlobSupported()){this.toBlobURL(n);return;}n(this.toDataURL());};l.prototype.toDataURL=function(n){"use strict";return this._canvas.toDataURL(n);};l.prototype.resizedCopy=function(n,o){"use strict";var p=n.x/this.getWidth(),q=n.y/this.getHeight();if(o==i.CONTAIN){if(p>q){return this.scaledCopy(q);}else return this.scaledCopy(p);}else if(o==i.COVER){if(p<q){return this.scaledCopy(q);}else return this.scaledCopy(p);}else throw new Error('mode must be one of PhotoResizeModeConst');};l.prototype.scaledCopy=function(n){"use strict";var o=this._canvas.width*n,p=this._canvas.height*n;return new l().setWidth(o).setHeight(p).drawGraphic(this._canvas,0,0,o,p);};l.prototype.copy=function(){"use strict";return this.scaledCopy(1);};l.prototype.getPixelColor=function(n,o){"use strict";var p=this.getImageData(n,o,1,1).getPixel(0,0);return k('rgba(%s,%s,%s,%s)',p.r,p.g,p.b,p.a);};l.prototype.getImageData=function(n,o,p,q){"use strict";return new m(this._ctx.getImageData(n||0,o||0,p||this.getWidth(),q||this.getHeight()));};l.prototype.putImageData=function(n,o,p){"use strict";this._ctx.putImageData(n.getData(),o||0,p||0);return this;};l.prototype.toDataURI=function(){"use strict";return this._canvas.toDataURL('image/png');};l.prototype.toBase64=function(){"use strict";var n='data:image/png;base64,',o=this.toDataURI();return o.slice(n.length);};l.prototype.applyFilter=function(n,o){"use strict";this.putImageData(new n(this).run(o));};l.prototype.enableDrawing=function(n,o){"use strict";if(!this._editor)return;this.disableDrawing();this._drawHandler=new n(this._editor,o).start();return this._drawHandler;};l.prototype.setDrawingFillStyle=function(n){"use strict";if(!this._drawHandler)return;this._drawHandler.setFillStyle(n);};l.prototype.setFillStyle=function(n){"use strict";this._ctx.fillStyle=n;};l.prototype.disableDrawing=function(){"use strict";if(!this._drawHandler)return;this._drawHandler.stop();this._drawHandler=null;};l.prototype.clear=function(){"use strict";this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height);return this;};l.prototype.crop=function(n,o,p,q){"use strict";var r=new l().setWidth(p).setHeight(q);r.drawGraphic(this._canvas,Math.max(0,n),Math.max(0,o),p,q,0,0,p,q);this.setImageContent(r.getElement());return this;};l.prototype.fillText=function(n,o,p,q,r,s){"use strict";this._ctx.font=o;if(s){this._canvas.width=this._ctx.measureText(n).width;this._ctx.font=o;}this._ctx.textBaseline='top';this._ctx.fillStyle=p;this._ctx.fillText(n,q,r);return this;};l.prototype.fillCircle=function(n,o,p,q){"use strict";this._ctx.fillStyle=q||'black';this._ctx.beginPath();this._ctx.arc(n,o,p,0,Math.PI*2);this._ctx.closePath();this._ctx.fill();};l.prototype.fillRect=function(n,o,p,q,r){"use strict";this._ctx.fillStyle=r||'black';this._ctx.fillRect(n||0,o||0,p||this._canvas.width,q||this._canvas.height);return this;};function m(n){"use strict";this.image_data=n;this.width=n.width;this.height=n.height;this.array=n.data;}m.prototype.getData=function(){"use strict";return this.image_data;};m.prototype.getWidth=function(){"use strict";return this.width;};m.prototype.getHeight=function(){"use strict";return this.height;};m.prototype.getPixel=function(n,o){"use strict";var p=this.getIndex(n,o);return {r:this.array[p],g:this.array[p+1],b:this.array[p+2],a:this.array[p+3]};};m.prototype.setPixel=function(n,o,p){"use strict";var q=this.getIndex(n,o);this.array[q]=p.r;this.array[q+1]=p.g;this.array[q+2]=p.b;this.array[q+3]=p.a;};m.prototype.getIndex=function(n,o){"use strict";return 4*(n+o*this.width);};m.prototype.forEach=function(n){"use strict";for(var o=0;o<this.getWidth();o++)for(var p=0;p<this.getHeight();p++)this.setPixel(n(this.getPixel(o,p),o,p));};e.exports=l;});
__d("PhotoEditorDrawingCursor",["PhotoEditorCanvas","CSS","Vector","cx"],function(a,b,c,d,e,f){var g=b('PhotoEditorCanvas'),h=b('CSS'),i=b('Vector'),j=b('cx');function k(l,m){"use strict";this.$PhotoEditorDrawingCursor0=l;this.$PhotoEditorDrawingCursor1=m;this.$PhotoEditorDrawingCursor2=new g();this.$PhotoEditorDrawingCursor3=new i(0,0);h.addClass(this.$PhotoEditorDrawingCursor2.getElement(),"_5ewz");}k.prototype.getElement=function(){"use strict";return this.$PhotoEditorDrawingCursor2.getElement();};k.prototype.update=function(){"use strict";var l=this.$PhotoEditorDrawingCursor0.getCurrentBrushSize();this.$PhotoEditorDrawingCursor2.clear();this.$PhotoEditorDrawingCursor2.setWidth(l).setHeight(l);this.$PhotoEditorDrawingCursor1.drawStroke(this.$PhotoEditorDrawingCursor2,l/2,l/2);this.$PhotoEditorDrawingCursor3=new i(l,l);return this;};k.prototype.getDimensions=function(){"use strict";return this.$PhotoEditorDrawingCursor3;};e.exports=k;});
__d("PhotoEditorInterpolation",[],function(a,b,c,d,e,f){function g(h){"use strict";this.$Linear0=null;this.$Linear1=null;this.$Linear2=h;}g.prototype.setPoints=function(h,i){"use strict";this.$Linear0=h;this.$Linear1=i;this.$Linear3=(this.$Linear1.y-this.$Linear0.y)/(this.$Linear1.x-this.$Linear0.x);this.$Linear4=this.$Linear0.y-this.$Linear3*this.$Linear0.x;if((this.isHorizontal()&&this.$Linear0.x>this.$Linear1.x)||(!this.isHorizontal()&&this.$Linear0.y>this.$Linear1.y)){var j=this.$Linear0;this.$Linear0=this.$Linear1;this.$Linear1=j;}return this;};g.prototype.invert=function(h){"use strict";var i=h.x;h.x=h.y;h.y=i;};g.prototype.isHorizontal=function(){"use strict";return this.$Linear3<=1&&this.$Linear3>-1;};g.prototype.draw=function(){"use strict";if(this.isHorizontal()){this.$Linear5();}else this.$Linear6();};g.prototype.$Linear6=function(){"use strict";var h,i;if(!isFinite(this.$Linear3)){for(i=this.$Linear0.y;i<=this.$Linear1.y;i++)this.$Linear2.draw(this.$Linear0.x,i);}else for(i=this.$Linear0.y;i<=this.$Linear1.y;i++){h=Math.floor((i-this.$Linear4)/this.$Linear3);this.$Linear2.draw(h,i);}};g.prototype.$Linear5=function(){"use strict";var h,i;for(h=this.$Linear0.x;h<=this.$Linear1.x;h++){i=Math.floor(this.$Linear3*h+this.$Linear4);this.$Linear2.draw(h,i);}};e.exports={Linear:g};});
__d("PhotoEditorDrawingHandlers",["PhotoEditorDrawingCursor","Event","PhotoEditorInterpolation","SubscriptionsHandler","Vector"],function(a,b,c,d,e,f){var g=b('PhotoEditorDrawingCursor'),h=b('Event'),i=b('PhotoEditorInterpolation'),j=b('SubscriptionsHandler'),k=b('Vector');function l(q,r,s){"use strict";this._editor=q;this._canvas=q.getWorkingCanvas();this.setFillStyle(r);this.setBrushSize(s);this.image_data=this._canvas.getImageData();this.isMouseDown=false;this.subscriptionsHandler=new j();this._lastPosition=null;this._func=null;}l.prototype.onMouseDown=function(q){"use strict";this.isMouseDown=true;q.preventDefault();this._func=new i.Linear(this);};l.prototype.onMouseUp=function(){"use strict";this._lastPosition=null;this.isMouseDown=false;};l.prototype.onMouseMove=function(q){"use strict";if(!this.isMouseDown)return;var r=k.getEventPosition(q).sub(k.getElementPosition(this._editor.getCanvasWrapper())).div(this._editor.getResizeFactor());if(this._lastPosition)this._func.setPoints(this._lastPosition,r).draw();this._lastPosition=r;};l.prototype.onMouseLeave=function(){"use strict";this._lastPosition=null;};l.prototype.setBrushSize=function(q){"use strict";this._brushSize=q;this.getDrawingCursor().update();};l.prototype.setFillStyle=function(q){"use strict";if(q instanceof Image){this._fillStyle=this._canvas.getContext().createPattern(q,'no-repeat');}else if(Array.isArray(q)){this._fillStyle=this._canvas.getContext().createLinearGradient(0,0,this._canvas.getwidth(),this._canvas.getHeight());for(var r=0;r<q.length;r++)this._fillStyle.addColorStop(q[r].index,q[r].color);}else this._fillStyle=q;this.getDrawingCursor().update();};l.prototype.drawStroke=function(q,r,s){"use strict";};l.prototype.draw=function(q,r){"use strict";this.drawStroke(this._canvas,q,r);};l.prototype.getDrawingCursor=function(){"use strict";if(!this._cursor)this._cursor=new g(this._editor,this);return this._cursor;};l.prototype.getCursorElement=function(){"use strict";return this.getDrawingCursor().getElement();};l.prototype.start=function(){"use strict";var q=this.getDrawingCursor();q.update();this.subscriptionsHandler.engage();this.subscriptionsHandler.addSubscriptions(h.listen(this._canvas.getElement(),'mouseleave',this.onMouseLeave.bind(this)),h.listen(this._canvas.getElement(),'mousemove',this.onMouseMove.bind(this)),h.listen(this._canvas.getElement(),'mousedown',this.onMouseDown.bind(this)),h.listen(this._canvas.getElement(),'mouseup',this.onMouseUp.bind(this)),h.listen(q.getElement(),'mousemove',this.onMouseMove.bind(this)),h.listen(q.getElement(),'mousedown',this.onMouseDown.bind(this)),h.listen(q.getElement(),'mouseup',this.onMouseUp.bind(this)));return this;};l.prototype.getCurrentBrushRect=function(q,r){"use strict";var s=this._editor.getCurrentBrushSize();q-=Math.floor(s/2);r-=Math.floor(s/2);return {x:q,y:r,width:s,height:s};};l.prototype.stop=function(){"use strict";this.subscriptionsHandler.release();return this;};for(var m in l)if(l.hasOwnProperty(m))o[m]=l[m];var n=l===null?null:l.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=l;function o(){"use strict";if(l!==null)l.apply(this,arguments);}o.prototype.drawStroke=function(q,r,s){"use strict";var t=this.getCurrentBrushRect(r,s);q.fillRect(t.x,t.y,t.width,t.height,this._fillStyle);};for(m in l)if(l.hasOwnProperty(m))p[m]=l[m];p.prototype=Object.create(n);p.prototype.constructor=p;p.__superConstructor__=l;function p(){"use strict";if(l!==null)l.apply(this,arguments);}p.prototype.drawStroke=function(q,r,s){"use strict";var t=this._editor.getCurrentBrushSize();q.fillCircle(r,s,t/2,this._fillStyle);};e.exports={SquareBrush:o,CircularBrush:p};});
__d("PhotoEditorFont",["PhotoEditorConfig","sprintf"],function(a,b,c,d,e,f){var g=b('PhotoEditorConfig').Constants,h=b('sprintf');function i(j,k,l){"use strict";this.$PhotoEditorFont0=j||g.DEFAULT_FONT_FAMILY;this.$PhotoEditorFont1=k||g.DEFAULT_FONT_SIZE;this.$PhotoEditorFont2=l||g.DEFAULT_FONT_METRIC;}i.prototype.setFamily=function(j){"use strict";this.$PhotoEditorFont0=j;};i.prototype.getFamily=function(){"use strict";return this.$PhotoEditorFont0;};i.prototype.setSize=function(j){"use strict";this.$PhotoEditorFont1=j;};i.prototype.getSize=function(){"use strict";return this.$PhotoEditorFont1;};i.prototype.setMetric=function(j){"use strict";this.$PhotoEditorFont2=j;};i.prototype.getMetric=function(){"use strict";return this.$PhotoEditorFont2;};i.prototype.toString=function(){"use strict";return h('%s%s %s',this.$PhotoEditorFont1,this.$PhotoEditorFont2,this.$PhotoEditorFont0);};i.prototype.copy=function(){"use strict";return new i(this.$PhotoEditorFont0,this.$PhotoEditorFont1,this.$PhotoEditorFont2);};i.getDefault=function(){return new i();};e.exports=i;});
__d("PhotoEditorDialogs",["Dialog","PhotoEditorFont","Form","DOM","React","ReactDOMInput","tx"],function(a,b,c,d,e,f){var g=b('Dialog'),h=b('PhotoEditorFont'),i=b('Form'),j=b('DOM'),k=b('React'),l=b('ReactDOMInput'),m=b('tx');function n(r,s,t){if(!t){t=s;s={};}var u=j.create('div'),v=k.DOM.form({action:"#"},"Font size",k.DOM.br(null),l({name:"size",defaultValue:s.size})," px ",k.DOM.br(null),"Font family",k.DOM.br(null),k.DOM.select({name:"family"},k.DOM.option({value:"arial"},"Arial"),k.DOM.option({value:"verdana"},"Verdana"),k.DOM.option({value:"tahoma"},"Tahoma")),k.DOM.br(null),"Text",k.DOM.br(null),l({name:"text",defaultValue:s.text}));k.renderComponent(v,u);v=u.firstChild;new g().setTitle("Configure text").setBody(u).setButtons(g.OK_AND_CANCEL).setHandler(function(){t(i.serialize(v));}).setCausalElement(r).show();}function o(r){n(r.getRoot(),function(s){r.addTextGraphic(s.text,new h(s.family,s.size,'px'));});}function p(r){var s=r.getFont().getSize(),t={text:r.getText(),size:s[1],family:s[2]};n(r.getElement(),t,function(u){r.updateText(u.text,new h(u.family,u.size,'px'));});}function q(r,s,t){new g().setBody("Are you sure you want to do that?").setTitle(s).setButtons(g.OK_AND_CANCEL).setHandler(t).setCausalElement(r.getRoot()).show();}e.exports={addText:o,editText:p,confirmation:q};});
__d("PhotoEditorShareDialog",["DOM"],function(a,b,c,d,e,f){var g=b('DOM');function h(i,j){"use strict";this._editor=i;this._dialog=j;this._insertCanvasInput();this._insertImagePreview();}h.prototype._insertCanvasInput=function(){"use strict";var i=g.find(this._dialog.getRoot(),'form');i.appendChild(g.create('input',{type:'hidden',name:'stage',value:this._editor.toBase64()}));};h.prototype._insertImagePreview=function(){"use strict";var i=g.find(this._dialog.getRoot(),'.UIShareStage_Image');i.appendChild(this._editor.getPreviewCanvas(200/this._editor.getWorkingCanvas().getWidth()).getElement());};e.exports=h;});
__d("PhotoEditorButtonHandler",["PhotoEditorConfig","PhotoEditorFilters","PhotoEditorDrawingHandlers","cx","CSS","PhotoEditorDialogs","Arbiter","AsyncDialog","AsyncRequest","PhotoEditorShareDialog","copyProperties"],function(a,b,c,d,e,f){var g=b('PhotoEditorConfig').Constants,h=b('PhotoEditorConfig').Actions,i=b('PhotoEditorFilters'),j=b('PhotoEditorDrawingHandlers'),k=b('cx'),l=b('CSS'),m=b('PhotoEditorDialogs'),n=b('Arbiter'),o=b('AsyncDialog'),p=b('AsyncRequest'),q=b('PhotoEditorShareDialog'),r=b('copyProperties');function s(v){"use strict";this.$ButtonHandler0=v;this.$ButtonHandler1=new n();}s.prototype.subscribe=function(v,w){"use strict";if(!Array.isArray(v))v=[v];v=v.map(function(x){return x.toString();});return this.$ButtonHandler1.subscribe(v,this.$ButtonHandler2.curry(w));};s.prototype.$ButtonHandler2=function(v,w,x){"use strict";v.apply(this,x);};s.prototype.handleAction=function(v,w){"use strict";return this.$ButtonHandler1.inform(v.toString(),[this.$ButtonHandler0,w]);};s.prototype.subscribeToStandardActions=function(){"use strict";this.subscribeToStandardActionsExcept();};s.prototype.subscribeToStandardActionsExcept=function(v){"use strict";var w=u;w=r({},w);if(v)for(var x=0;x<v.length;x++)delete w[v[x]];for(var y in w)this.subscribe(y,w[y]);};function t(v){return function(w,x){m.confirmation(w,x.getAttribute('aria-label'),v.bind(this,w));};}var u={};u[h.BW_FILTER]=function(v){v.getWorkingCanvas().applyFilter(i.BlackAndWhiteFilter);};u[h.REVERT]=function(v){v.revert();};u[h.PAINT_BRUSH]=function(v){v.enableDrawing(j.CircularBrush,v.getCurrentFillStyle());v.updateBrushConfigVisibility({color:true,size:true});l.addClass(v.getWorkingCanvas().getElement(),"_55g1");};u[h.PENCIL]=function(v){v.enableDrawing(j.SquareBrush,v.getCurrentFillStyle());v.updateBrushConfigVisiblity({color:true,size:true});l.addClass(v.getWorkingCanvas().getElement(),"_55g1");};u[h.REVERT_BRUSH]=function(v){v.enableDrawing(j.CircularBrush,v.getOriginalImage());v.updateBrushConfigVisiblity({color:false,size:true});l.addClass(v.getWorkingCanvas().getElement(),"_55g1");};u[h.SAVE_AS_PROFILE]=t(function(v){v.saveAsProfPic();});u[h.SAVE_IN_ALBUM]=function(v){o.send(new p().setURI(g.BROWSE_ALBUMS_PATH).setData({save_on_click:1}));};u[h.ADD_TEXT]=function(v){m.addText(v);};u[h.IMPORT_IMAGE]=function(v){o.send(new p().setURI(g.BROWSE_ALBUMS_PATH));};u[h.SHARE]=function(v){new o.send(new p().setURI(g.SHARE_DIALOG_PATH),function(w){new q(v,w);});};u[h.ROTATE_CW]=function(v){v.rotate(true);};u[h.ROTATE_CCW]=function(v){v.rotate(false);};e.exports=s;});
__d("PhotoEditorGraphic",["ArbiterMixin","PhotoEditorCanvas","CSS","DOM","Event","Style","SubscriptionsHandler","TextMetrics","UserAgent","Vector","cx","mixin","throttle"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('PhotoEditorCanvas'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('Style'),m=b('SubscriptionsHandler'),n=b('TextMetrics'),o=b('UserAgent'),p=b('Vector'),q=b('cx'),r=b('mixin'),s=b('throttle'),t=0,u=[],v=r(g);for(var w in v)if(v.hasOwnProperty(w))y[w]=v[w];var x=v===null?null:v.prototype;y.prototype=Object.create(x);y.prototype.constructor=y;y.__superConstructor__=v;function y(ia,ja){"use strict";this.id=t++;u.push(this);this.root=j.create('div');this.root.setAttribute('draggable',true);l.apply(this.root,{maxWidth:ia+'px',maxHeight:ja+'px'});this.$Graphic0=ia;this.$Graphic1=ja;i.addClass(this.root,"_55gm");var ka=this.root.appendChild(j.create('div'));ka.className="_55gn";this.$Graphic2=new p(0,0,'document');this.subscriptionsHandler=new m();this.subscriptionsHandler.addSubscriptions(k.listen(this.root,'dragstart',this.onDragStart.bind(this)),k.listen(this.root,'drop',this.onDropOnSelf.bind(this)),k.listen(ka,'click',this.remove.bind(this)));}y.prototype.getElement=function(){"use strict";return this.root;};y.prototype.getInitialDimensions=function(){"use strict";return new p(this.$Graphic0,this.$Graphic1,'document').mul(.25);};y.prototype.getPos=function(ia){"use strict";return this.$Graphic2;};y.prototype.setPos=function(ia){"use strict";this.$Graphic2=ia;l.apply(this.root,{left:this.$Graphic2.x+'px',top:this.$Graphic2.y+'px'});};y.prototype.setDimensions=function(ia){"use strict";l.apply(this.root,{width:ia.x+'px',height:ia.y+'px'});};y.prototype.remove=function(){"use strict";this.subscriptionsHandler.release();j.remove(this.root);this.inform('removed');};y.prototype.getDrawableObj=function(){"use strict";};y.prototype.getDimensions=function(){"use strict";return p.getElementDimensions(this.root);};y.prototype.onDragStart=function(ia){"use strict";if(o.firefox()){this.$Graphic3=ia.layerX;this.$Graphic4=ia.layerY;}else{this.$Graphic3=ia.offsetX;this.$Graphic4=ia.offsetY;}ia.dataTransfer.setData('graphic_id',this.id);};y.prototype.onDrop=function(ia,ja){"use strict";if(this.id!==parseInt(ia.dataTransfer.getData('graphic_id'),10))return;if(!ja)ja=new p(0,0,'document');this.$Graphic2=new p(ja.x+ia.layerX-this.$Graphic3,ja.y+ia.layerY-this.$Graphic4,'document');this.setPos(this.$Graphic2);ia.kill();};y.prototype.onDropOnSelf=function(ia){"use strict";ia.stopPropagation();this.onDrop(ia,this.$Graphic2);};y.prototype.setCanvasAsBackground=function(ia){"use strict";l.set(this.root,'backgroundImage','url('+ia.toDataURL()+')');};for(var z in y)if(y.hasOwnProperty(z))ba[z]=y[z];var aa=y===null?null:y.prototype;ba.prototype=Object.create(aa);ba.prototype.constructor=ba;ba.__superConstructor__=y;function ba(ia,ja,ka){"use strict";aa.constructor.call(this,ja,ka);this.root.setAttribute('draggable',true);this.setDimensions(this.getInitialDimensions());this.$ImageGraphic0=new Image();this.$ImageGraphic0.crossOrigin='anonymous';l.apply(this.$ImageGraphic0,{maxWidth:ja+'px',maxHeight:ka+'px'});i.addClass(this.root,"_55jn");i.addClass(this.root,'loading');this.subscriptionsHandler.addSubscriptions(k.listen(this.$ImageGraphic0,'load',this.$ImageGraphic1.bind(this)),k.listen(this.root,'dragenter',k.prevent),k.listen(this.root,'dragover',k.prevent));this.$ImageGraphic0.src=ia;this.imageURL=ia;}ba.prototype.getDrawableObj=function(){"use strict";return this.$ImageGraphic0;};ba.prototype.onDragStart=function(ia){"use strict";aa.onDragStart.call(this,ia);ia.dataTransfer.setData('text/plain',this.$ImageGraphic0.src);};ba.prototype.$ImageGraphic1=function(){"use strict";i.removeClass(this.root,'loading');var ia=this.$ImageGraphic0.width/this.$ImageGraphic0.height;l.set(this.root,'height',this.getInitialDimensions().x/ia+'px');var ja=new h();ja.setImageContent(this.$ImageGraphic0);this.setCanvasAsBackground(ja);};for(var ca in ba)if(ba.hasOwnProperty(ca))ea[ca]=ba[ca];var da=ba===null?null:ba.prototype;ea.prototype=Object.create(da);ea.prototype.constructor=ea;ea.__superConstructor__=ba;function ea(){"use strict";if(ba!==null)ba.apply(this,arguments);}for(z in y)if(y.hasOwnProperty(z))fa[z]=y[z];fa.prototype=Object.create(aa);fa.prototype.constructor=fa;fa.__superConstructor__=y;function fa(ia,ja,ka,la,ma,na){"use strict";aa.constructor.call(this,ma,na);this.$TextGraphic0=new h();this.$TextGraphic1=ka;this.$TextGraphic2=ja;this.$TextGraphic3=ia;this.$TextGraphic4=ia;this.$TextGraphic5=false;this.$TextGraphic6=j.create('input',{className:"_5g78",type:'text'});i.addClass(this.root,"_5g79");this.root.appendChild(this.$TextGraphic6);this.$TextGraphic7=la.appendChild(j.create('div'));i.addClass(this.$TextGraphic7,"_55jo");this.subscriptionsHandler.addSubscriptions(k.listen(this.root,'click',function(){this.$TextGraphic6.focus();}.bind(this)),k.listen(this.$TextGraphic6,'blur',function(){i.removeClass(this.root,"_5g7a");if(!this.$TextGraphic5||!this.$TextGraphic3.length){this.updateText(this.$TextGraphic4);this.$TextGraphic5=false;}}.bind(this)),k.listen(this.$TextGraphic6,'focus',function(){i.addClass(this.root,"_5g7a");this.inform('focus');if(!this.$TextGraphic5)this.updateText('');}.bind(this)),k.listen(this.$TextGraphic6,'keyup',s(this.$TextGraphic8,50,this)));this.updateText(ia,ja);}fa.prototype.$TextGraphic8=function(){"use strict";this.updateText(this.$TextGraphic6.value);this.$TextGraphic5=true;};fa.prototype.getDrawableObj=function(){"use strict";var ia=new h().setWidth(this.root.offsetWidth).setHeight(this.root.offsetHeight);ia.fillText(this.$TextGraphic3,this.$TextGraphic2,this.$TextGraphic1,0,0);return ia.getElement();};fa.prototype.getFont=function(){"use strict";return this.$TextGraphic2;};fa.prototype.getText=function(){"use strict";return this.$TextGraphic3;};fa.prototype.getFillStyle=function(){"use strict";return this.$TextGraphic1;};fa.prototype.updateText=function(ia,ja,ka){"use strict";if(ka)this.$TextGraphic1=ka;if(ja)this.$TextGraphic2=ja;if(typeof ia=='string')this.$TextGraphic3=ia;this.$TextGraphic6.value=this.$TextGraphic3;l.set(this.$TextGraphic7,'font',this.$TextGraphic2);var la=new n(this.$TextGraphic7,true).measure(this.$TextGraphic3);this.$TextGraphic0.clear().setWidth(la.width).setHeight(la.height).fillText(this.$TextGraphic3,this.$TextGraphic2,this.$TextGraphic1,0,0,true);l.apply(this.root,{width:la.width+'px',height:la.height+'px'});this.setCanvasAsBackground(this.$TextGraphic0);};fa.prototype.setText=function(ia){"use strict";this.$TextGraphic3=ia;this.updateText();};fa.prototype.setFont=function(ia){"use strict";this.$TextGraphic2=ia;this.updateText();};fa.prototype.setFontFamily=function(ia){"use strict";this.$TextGraphic2.setFamily(ia);this.updateText();};fa.prototype.setFontSize=function(ia){"use strict";this.$TextGraphic2.setSize(ia);this.updateText();};fa.prototype.setFillStyle=function(ia){"use strict";this.$TextGraphic1=ia;this.updateText();};for(ca in ba)if(ba.hasOwnProperty(ca))ga[ca]=ba[ca];ga.prototype=Object.create(da);ga.prototype.constructor=ga;ga.__superConstructor__=ba;function ga(){"use strict";if(ba!==null)ba.apply(this,arguments);}ga.prototype.remove=function(){"use strict";da.remove.call(this);a.URL.revokeObjectURL(this.imageURL);};function ha(ia,ja){if(u[ia])u[ia].onDrop(ja);}e.exports={Image:ba,Sticker:ea,Text:fa,Blob:ga,onDrop:ha};});
__d("PhotoEditorDOM",["DOM","Parent","sprintf"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Parent'),i=b('sprintf'),j='data-photoeditoraction',k='['+j+'="%s"]',l={getElementForAction:function(m,n){return g.find(m,i(k,n));},getActionFromElement:function(m){m=h.byAttribute(m,j);if(m)return parseInt(m.getAttribute(j),10);}};e.exports=l;});
__d("PhotoEditor",["ArbiterMixin","AsyncDialog","AsyncRequest","PhotoEditorButtonHandler","PhotoEditorCanvas","PhotoEditorConfig","CSS","DOM","DragDropTarget","Event","PhotoEditorFont","PhotoEditorGraphic","PhotoEditorDOM","Style","SubscriptionsHandler","URI","Vector","cx","mixin","removeFromArray"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncDialog'),i=b('AsyncRequest'),j=b('PhotoEditorButtonHandler'),k=b('PhotoEditorCanvas'),l=b('PhotoEditorConfig').Constants,m=b('CSS'),n=b('DOM'),o=b('DragDropTarget'),p=b('Event'),q=b('PhotoEditorFont'),r=b('PhotoEditorGraphic'),s=b('PhotoEditorDOM'),t=b('Style'),u=b('SubscriptionsHandler'),v=b('URI'),w=b('Vector'),x=b('cx'),y=b('mixin'),z=b('removeFromArray'),aa=null,ba=90,ca=Math.PI/2,da=y(g);for(var ea in da)if(da.hasOwnProperty(ea))ga[ea]=da[ea];var fa=da===null?null:da.prototype;ga.prototype=Object.create(fa);ga.prototype.constructor=ga;ga.__superConstructor__=da;function ga(ha){"use strict";this.root=ha;this.workingCanvas=new k(this);this.layers=[];this.buttonHandler=new j(this);this.originalImage=null;this.canvasWrapperEl=null;this.drawingSubscriptionsHandler=new u();this.setCurrentFillStyle('black');this.setCurrentBrushSize(5);this.initDOM();this.reset();aa=this;m.addClass(this.canvasWrapperEl,"_5981");m.addClass(this.workingCanvas.getElement(),this.getCanvasClass());}ga.prototype.getCanvasClass=function(){"use strict";return "_5982";};ga.prototype.initDOM=function(){"use strict";};ga.prototype.updateBrushConfigVisibility=function(ha){"use strict";};ga.prototype.getRoot=function(){"use strict";return this.root;};ga.prototype.getCanvasWrapper=function(){"use strict";return this.canvasWrapperEl;};ga.prototype.setImage=function(ha){"use strict";this.workingCanvas.setImageContent(ha);t.apply(this.canvasWrapperEl,{width:ha.width+'px',height:ha.height+'px'});n.setContent(this.canvasWrapperEl,this.workingCanvas.getElement());if(this.$PhotoEditor0)this.canvasWrapperEl.appendChild(this.$PhotoEditor0.getCursorElement());this.originalImage=ha;};ga.prototype.registerEventDelegate=function(ha){"use strict";return p.listen(ha,'click',this.handleDelegateClick.bind(this),p.Priority.URGENT);};ga.prototype.handleDelegateClick=function(ha){"use strict";var ia=ha.getTarget(),ja=s.getActionFromElement(ia);if(!ja)return;var ka=this.buttonHandler.handleAction(ja,ia);if(!ka)ha.prevent();};ga.prototype.getButtonHandler=function(ha,ia){"use strict";return this.buttonHandler;};ga.prototype.loadPhoto=function(ha){"use strict";var ia=new Image();ia.crossOrigin='anonymous';if(this.imageLoadRef)this.imageLoadRef.remove();this.imageLoadRef=p.listen(ia,'load',this.onImageLoaded.bind(this,ia));ia.src=ha;};ga.prototype.onImageLoaded=function(ha){"use strict";this.setImage(ha);this.inform('resize',ha);};ga.prototype.getPhotoPosition=function(){"use strict";return this.photoPosition||new w(0,0);};ga.prototype.getImageDimensions=function(){"use strict";if(this.isInverted){return new w(this.workingCanvas.getHeight(),this.workingCanvas.getWidth());}else return new w(this.workingCanvas.getWidth(),this.workingCanvas.getHeight());};ga.prototype.getCanvasDimensions=function(){"use strict";if(this.isInverted){return new w(this.canvasWrapperEl.offsetWidth,this.canvasWrapperEl.offsetHeight);}else return new w(this.canvasWrapperEl.offsetHeight,this.canvasWrapperEl.offsetWidth);};ga.prototype.reset=function(){"use strict";m.removeClass(this.canvasWrapperEl,this.getRotateClass());this.workingCanvas.clear();this.rotations=0;this.isInverted=false;};ga.prototype.rotate=function(ha){"use strict";m.removeClass(this.canvasWrapperEl,this.getRotateClass());this.rotations+=ha?1:3;this.rotations%=4;if(this.rotations)m.addClass(this.canvasWrapperEl,this.getRotateClass());this.isInverted=!this.isInverted;};ga.prototype.getIsInverted=function(){"use strict";return this.isInverted;};ga.prototype.getNumRotations=function(){"use strict";return this.rotations;};ga.prototype.getRotationAngle=function(){"use strict";return this.rotations*ca;};ga.prototype.getRotateClass=function(){"use strict";return 'rot'+(this.rotations*ba);};ga.prototype.removeGraphic=function(ha){"use strict";z(this.layers,ha);};ga.prototype.$PhotoEditor1=function(ha){"use strict";return w.getElementDimensions(this.canvasWrapperEl).sub(ha.getInitialDimensions()).mul(Math.random(),Math.random());};ga.prototype.addGraphic=function(ha,ia){"use strict";this.layers.push(ha);ha.subscribeOnce('removed',this.removeGraphic.bind(this,ha));if(!ia)ia=this.$PhotoEditor1(ha);this.canvasWrapperEl.appendChild(ha.getElement());ia=ia.sub(ha.getDimensions().div(2));ha.setPos(ia);this.$PhotoEditor2();return ha;};ga.prototype.addBlobGraphic=function(ha,ia){"use strict";var ja=this.getCanvasDimensions();return this.addGraphic(new r.Blob(ha,ja.x,ja.y),ia);};ga.prototype.addImageGraphic=function(ha,ia){"use strict";var ja=this.getCanvasDimensions();return this.addGraphic(new r.Image(ha,ja.x,ja.y),ia);};ga.prototype.addStickerGraphicViaProxy=function(ha,ia){"use strict";var ja=this.getCanvasDimensions(),ka=v(l.STICKER_PROXY_PATH).addQueryData('sticker_id',ha);return this.addGraphic(new r.Sticker(ka,ja.x,ja.y),ia);};ga.prototype.addStickerGraphic=function(ha,ia){"use strict";var ja=this.getCanvasDimensions();return this.addGraphic(new r.Sticker(ha,ja.x,ja.y),ia);};ga.prototype.addTextGraphic=function(ha,ia,ja){"use strict";var ka=this.getCanvasDimensions();return this.addGraphic(new r.Text(ha,ia,this.getCurrentFillStyle(),this.canvasWrapperEl,ka.x,ka.y),ja);};ga.prototype.crop=function(ha,ia,ja,ka){"use strict";this.workingCanvas.crop(ha,ia,ja,ka);this.inform('resize');};ga.prototype.getWorkingCanvas=function(){"use strict";return this.workingCanvas;};ga.prototype.getOriginalImage=function(){"use strict";return this.originalImage;};ga.prototype.setCurrentFillStyle=function(ha){"use strict";this.fillStyle=ha;if(this.$PhotoEditor0)this.$PhotoEditor0.setFillStyle(ha);};ga.prototype.getCurrentFillStyle=function(){"use strict";return this.fillStyle;};ga.prototype.setCurrentBrushSize=function(ha){"use strict";this.brushSize=ha;if(this.$PhotoEditor0)this.$PhotoEditor0.setBrushSize(ha);};ga.prototype.getCurrentBrushSize=function(){"use strict";return this.brushSize;};ga.prototype.getPreviewCanvas=function(ha){"use strict";return this.getFlattenedCanvas().scaledCopy(ha);};ga.prototype.getResizeFactor=function(){"use strict";return this.canvasWrapperEl.offsetWidth/this.workingCanvas.getWidth();};ga.prototype.revert=function(){"use strict";this.workingCanvas.setImageContent(this.originalImage);for(var ha=0;ha<this.layers.length;ha++)this.layers[ha].remove();this.layers=[];};ga.prototype.toDataURL=function(){"use strict";return this.getFlattenedCanvas().toDataURL();};ga.prototype.toBase64=function(){"use strict";return this.getFlattenedCanvas().toBase64();};ga.prototype.toBlob=function(ha){"use strict";this.getFlattenedCanvas().toBlob(ha);};ga.prototype.toBlobURI=function(ha){"use strict";this.getFlattenedCanvas().toBlobURI(ha);};ga.prototype.toURL=function(ha){"use strict";this.getFlattenedCanvas().toURL(ha);};ga.prototype.getFlattenedCanvas=function(){"use strict";var ha=this.workingCanvas.getWidth(),ia=this.workingCanvas.getHeight(),ja=new k(),ka=ja.getContext(),la,ma;if(this.rotations){if(this.rotations%2){la=ia/2;ma=ha/2;ja.setWidth(ia).setHeight(ha);}else{la=ha/2;ma=ia/2;ja.setWidth(ha).setHeight(ia);}ka.translate(la,ma);ka.rotate(this.rotations*ca);if(this.rotations%2){ka.translate(-ma,-la);}else ka.translate(-la,-ma);ja.drawGraphic(this.workingCanvas.getElement(),0,0);}else ja.setImageContent(this.workingCanvas.getElement());var na,oa,pa,qa;for(var ra=0;ra<this.layers.length;ra++){na=this.layers[ra];pa=na.getPos().div(this.getResizeFactor());qa=na.getDimensions().div(this.getResizeFactor());oa=na.getDrawableObj();ja.drawGraphic(oa,pa.x,pa.y,qa.x,qa.y);}return ja;};ga.prototype.save=function(ha){"use strict";ha.stage=this.getFlattenedCanvas().toBase64();var ia=new i().setURI(l.SAVE_PATH).setData(ha).setMethod('POST').setRelativeTo(this.root);h.send(ia);};ga.prototype.saveInAlbum=function(ha){"use strict";this.save({album_id:ha});};ga.prototype.saveAsProfPic=function(){"use strict";this.save({profile_pic:1});};ga.prototype.enableDrawing=function(ha,ia,ja){"use strict";this.drawingSubscriptionsHandler.engage();this.drawingSubscriptionsHandler.addSubscriptions(p.listen(this.canvasWrapperEl,'mousemove',this.$PhotoEditor3.bind(this)),p.listen(this.canvasWrapperEl,'mouseleave',this.$PhotoEditor4.bind(this)));this.$PhotoEditor0=this.workingCanvas.enableDrawing(ha,ia);m.hide(this.$PhotoEditor0.getCursorElement());m.addClass(this.canvasWrapperEl,"_5ewy");this.canvasWrapperEl.appendChild(this.$PhotoEditor0.getCursorElement());};ga.prototype.disableDrawing=function(){"use strict";this.drawingSubscriptionsHandler.release();this.workingCanvas.disableDrawing();m.removeClass(this.canvasWrapperEl,"_5ewy");n.remove(this.$PhotoEditor0.getCursorElement());this.$PhotoEditor0=null;};ga.prototype.$PhotoEditor4=function(){"use strict";m.hide(this.$PhotoEditor0.getCursorElement());};ga.prototype.$PhotoEditor3=function(ha){"use strict";w.getEventPosition(ha).sub(w.getElementPosition(this.canvasWrapperEl)).sub(this.$PhotoEditor0.getDrawingCursor().getDimensions().div(2)).setElementPosition(this.$PhotoEditor0.getCursorElement());m.show(this.$PhotoEditor0.getCursorElement());};ga.prototype.$PhotoEditor2=function(){"use strict";if(this.$PhotoEditor5)return;p.listen(this.canvasWrapperEl,'dragenter',p.prevent);p.listen(this.canvasWrapperEl,'dragover',p.prevent);p.listen(this.canvasWrapperEl,'drop',this.$PhotoEditor6.bind(this));};ga.prototype.$PhotoEditor6=function(ha){"use strict";var ia=ha.dataTransfer.getData('graphic_id');if(ia)r.onDrop(ia,ha);};ga.prototype.enableTextAndImageFileDragDrop=function(){"use strict";if(!this.$PhotoEditor7)this.$PhotoEditor7=new o(this.canvasWrapperEl).setOnDropCallback(function(ha,ia){var ja=ha.files||[],ka=ha.plainText,la=ia.dataTransfer.getData('graphic_id');if(la)return;var ma=w.getEventPosition(ia).sub(w.getElementPosition(this.canvasWrapperEl));if(ja.length==1){this.addBlobGraphic(a.URL.createObjectURL(ja[0]),ma);}else if(ja.length){for(var na=0;na<ja.length;na++)this.addBlobGraphic(a.URL.createObjectURL(ja[na]));}else if(ka)this.addTextGraphic(ka,new q('Arial',30,'px'),ma);}.bind(this)).setFileFilter(function(ha){var ia=[];for(var ja=0;ja<ha.length;ja++)if(ha[ja].type.match('image/*'))ia.push(ha[ja]);return ia;});this.$PhotoEditor7.enable();};ga.prototype.disableTextAndImageFileDragDrop=function(){"use strict";if(this.$PhotoEditor7)this.$PhotoEditor7.disable();};ga.addImageGraphic=function(ha){ga.getInstance().addImageGraphic(ha);};ga.addStickerGraphic=function(ha){ga.getInstance().addStickerGraphic(ha);};ga.addGraphicFromBrowser=function(ha){ga.getInstance().addImageGraphic(ha.getAttribute('data-imageurl'));m.addClass(ha,'added');};ga.saveInAlbum=function(ha){ga.getInstance().saveInAlbum(ha.getAttribute('data-albumid'));};ga.getInstance=function(){return aa;};e.exports=ga;});
__d("PhotoEditorCrop",["Photocrop2","Rect","Vector"],function(a,b,c,d,e,f){var g=b('Photocrop2'),h=b('Rect'),i=b('Vector');for(var j in g)if(g.hasOwnProperty(j))l[j]=g[j];var k=g===null?null:g.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=g;function l(m,n,o){"use strict";this.$PhotoEditorCrop0=m;k.constructor.call(this,m.getWorkingCanvas().getElement(),n,o);}l.prototype.done=function(m){"use strict";var n=k.done.call(this,m),o=this.$PhotoEditorCrop0.getRotationAngle();if(!o)return n;var p=h.newFromVectors(new i(n.x,n.y),new i(n.width,n.height)),q=this.$PhotoEditorCrop0.getImageDimensions().mul(.5);p=p.sub(q).rotateAroundOrigin(-this.$PhotoEditorCrop0.getNumRotations());if(this.$PhotoEditorCrop0.getIsInverted()){p=p.add(q.y,q.x);}else p=p.add(q.x,q.y);var r=p.getPositionVector(),s=p.getDimensionVector();return {x:r.x,y:r.y,width:s.x,height:s.y};};l.prototype.setHighlightSource=function(){"use strict";this.$PhotoEditorCrop0.toURL(function(m){this.highlight.src=m;}.bind(this));};l.prototype.getPhotoPosition=function(){"use strict";return this.$PhotoEditorCrop0.getPhotoPosition();};l.prototype.getPhotoDimensions=function(){"use strict";var m=k.getPhotoDimensions.call(this);if(this.$PhotoEditorCrop0.getIsInverted()){var n=m.x;m.x=m.y;m.y=n;}return m;};e.exports=l;});
__d("PhotoEditorPaletteBase",["ArbiterMixin","CSS","DOM","Event","SubscriptionsHandler","cx","csx","mixin","shield"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('SubscriptionsHandler'),l=b('cx'),m=b('csx'),n=b('mixin'),o=b('shield'),p="_5c-o",q=n(g);for(var r in q)if(q.hasOwnProperty(r))t[r]=q[r];var s=q===null?null:q.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=q;function t(u,v){"use strict";this.palette=v;this.photoEditor=u;this.$PhotoEditorPaletteBase0=false;this.$PhotoEditorPaletteBase1=null;this.subscriptionsHandler=new k('PhotoEditorPalette');this.initDOM();}t.prototype.initDOM=function(){"use strict";this.closeButton=i.scry(this.palette,"._5c-p").pop();this.confirmButton=i.find(this.palette,"._5c-q");};t.prototype.getRoot=function(){"use strict";return this.palette;};t.prototype.enable=function(u){"use strict";if(this.$PhotoEditorPaletteBase0)return;this.subscriptionsHandler.engage();if(this.closeButton)this.subscriptionsHandler.addSubscriptions(j.listen(this.closeButton,'click',o(this.disable,this)));if(this.$PhotoEditorPaletteBase1)h.addClass(this.$PhotoEditorPaletteBase1,p);this.onEnable(u);this.$PhotoEditorPaletteBase0=true;h.show(this.palette);this.inform('enabled',u);};t.prototype.onEnable=function(u){"use strict";};t.prototype.disable=function(u){"use strict";if(!this.$PhotoEditorPaletteBase0)return;this.subscriptionsHandler.release();this.onDisable(u);this.$PhotoEditorPaletteBase0=false;h.hide(this.palette);this.inform('disabled',u);};t.prototype.onDisable=function(u){"use strict";};t.prototype.isEnabled=function(){"use strict";return this.$PhotoEditorPaletteBase0;};t.prototype.setButtonActive=function(u){"use strict";if(this.$PhotoEditorPaletteBase1)h.removeClass(this.$PhotoEditorPaletteBase1,p);h.addClass(u,p);this.$PhotoEditorPaletteBase1=u;};e.exports=t;});
__d("PhotoEditorCropPalette",["PhotoEditorConfig","Event","PhotocropConstraintConstants","PhotoEditorCrop","PhotoEditorDOM","PhotoEditorPaletteBase"],function(a,b,c,d,e,f){var g=b('PhotoEditorConfig').Actions,h=b('Event'),i=b('PhotocropConstraintConstants'),j=b('PhotoEditorCrop'),k=b('PhotoEditorDOM'),l=b('PhotoEditorPaletteBase');for(var m in l)if(l.hasOwnProperty(m))o[m]=l[m];var n=l===null?null:l.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=l;function o(p,q,r){"use strict";n.constructor.call(this,p,q);this.targetParent=r;}o.prototype.onEnable=function(){"use strict";this.subscriptionsHandler.addSubscriptions(this.photoEditor.getButtonHandler().subscribe([g.CROP_BOUNDARY,g.CROP_SQUARE,g.CROP_WIDE],this.$PhotoEditorCropPalette0.bind(this)),h.listen(this.confirmButton,'click',function(){this.disable(this.$PhotoEditorCropPalette1.done(true));return false;}.bind(this)));this.$PhotoEditorCropPalette1=new j(this.photoEditor,{create_target:true,target_parent:this.targetParent},this.photoEditor.getImageDimensions());this.$PhotoEditorCropPalette2(g.CROP_BOUNDARY);};o.prototype.onDisable=function(p){"use strict";this.$PhotoEditorCropPalette1.done();this.$PhotoEditorCropPalette1=null;};o.prototype.$PhotoEditorCropPalette2=function(p){"use strict";if(p===g.CROP_BOUNDARY){this.$PhotoEditorCropPalette1.setConstraintType(i.BOUNDARY);}else if(p===g.CROP_WIDE){this.$PhotoEditorCropPalette1.setConstraintType(i.WIDE);}else if(p===g.CROP_SQUARE){this.$PhotoEditorCropPalette1.setConstraintType(i.SQUARE);}else return;var q=k.getElementForAction(this.palette,p);this.setButtonActive(q);};o.prototype.$PhotoEditorCropPalette0=function(p,q){"use strict";this.$PhotoEditorCropPalette2(k.getActionFromElement(q));};e.exports=o;});
__d("PhotoEditorFilterPalette",["PhotoEditorConfig","PhotoEditorCanvas","CSS","DOM","Event","PhotoEditorFilters","PhotoEditorDOM","PhotoEditorPaletteBase","PhotoResizeModeConst"],function(a,b,c,d,e,f){var g=b('PhotoEditorConfig').Actions,h=b('PhotoEditorCanvas'),i=b('PhotoEditorConfig').Constants,j=b('CSS'),k=b('DOM'),l=b('Event'),m=b('PhotoEditorFilters'),n=b('PhotoEditorDOM'),o=b('PhotoEditorPaletteBase'),p=b('PhotoResizeModeConst');for(var q in o)if(o.hasOwnProperty(q))s[q]=o[q];var r=o===null?null:o.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=o;function s(){"use strict";if(o!==null)o.apply(this,arguments);}s.prototype.initDOM=function(){"use strict";r.initDOM.call(this);this.$PhotoEditorFilterPalette0=n.getElementForAction(this.palette,g.REVERT);this.$PhotoEditorFilterPalette1=n.getElementForAction(this.palette,g.BW_FILTER);this.$PhotoEditorFilterPalette2=null;};s.prototype.onEnable=function(){"use strict";this.subscriptionsHandler.addSubscriptions(l.listen(this.confirmButton,'click',function(){this.disable(this.$PhotoEditorFilterPalette2);return false;}.bind(this)),l.listen(this.$PhotoEditorFilterPalette1,'click',this.$PhotoEditorFilterPalette3.bind(this)),l.listen(this.$PhotoEditorFilterPalette0,'click',this.$PhotoEditorFilterPalette4.bind(this)));if(!this.$PhotoEditorFilterPalette5){this.$PhotoEditorFilterPalette5=new h();j.addClass(this.$PhotoEditorFilterPalette5.getElement(),this.photoEditor.getCanvasClass());if(!this.$PhotoEditorFilterPalette2){this.$PhotoEditorFilterPalette4();}else this.$PhotoEditorFilterPalette6(this.$PhotoEditorFilterPalette2);}k.insertAfter(this.photoEditor.getWorkingCanvas().getElement(),this.$PhotoEditorFilterPalette5.getElement());this.$PhotoEditorFilterPalette7(this.$PhotoEditorFilterPalette1,m.BlackAndWhiteFilter);this.$PhotoEditorFilterPalette7(this.$PhotoEditorFilterPalette0);};s.prototype.clearCachedCanvas=function(){"use strict";this.$PhotoEditorFilterPalette5=null;};s.prototype.$PhotoEditorFilterPalette7=function(t,u){"use strict";var v=new h().setImageContent(this.photoEditor.getUnfilteredImage()).resizedCopy(i.FILTER_PREVIEW_DIMS,p.COVER);if(u)v.applyFilter(u);var w=k.create('img');v.toURL(function(x){w.src=x;k.setContent(t,w);});};s.prototype.$PhotoEditorFilterPalette3=function(){"use strict";this.setButtonActive(this.$PhotoEditorFilterPalette1);this.$PhotoEditorFilterPalette2={filter:m.BlackAndWhiteFilter,args:null};this.$PhotoEditorFilterPalette6(this.$PhotoEditorFilterPalette2);};s.prototype.$PhotoEditorFilterPalette4=function(){"use strict";this.$PhotoEditorFilterPalette2=null;this.setButtonActive(this.$PhotoEditorFilterPalette0);this.$PhotoEditorFilterPalette5.setImageContent(this.photoEditor.getUnfilteredImage());};s.prototype.$PhotoEditorFilterPalette6=function(t){"use strict";this.$PhotoEditorFilterPalette2=t;this.$PhotoEditorFilterPalette5.setImageContent(this.photoEditor.getUnfilteredImage());this.$PhotoEditorFilterPalette5.applyFilter(t.filter,t.args);};s.prototype.onDisable=function(t){"use strict";k.remove(this.$PhotoEditorFilterPalette5.getElement());k.empty(this.$PhotoEditorFilterPalette0);k.empty(this.$PhotoEditorFilterPalette1);if(!t){this.$PhotoEditorFilterPalette5=null;this.$PhotoEditorFilterPalette2=null;}};e.exports=s;});
__d("PhotoViewerResize",["SubscriptionsHandler","UserAgent","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('SubscriptionsHandler'),h=b('UserAgent'),i=b('Vector'),j=b('copyProperties');function k(l){"use strict";this._viewer=l;}k.prototype.enable=function(){"use strict";this._subscriptionsHandler=new g();this._subscriptionsHandler.addSubscriptions(this._viewer.subscribe('windowresize',this._windowResize.bind(this)),this._viewer.subscribe('imageset',this._resize.bind(this)),this._viewer.subscribe('close',this._resetStageSize.bind(this)));this._dimensions=this._viewer.getPhotoViewerDimensions();};k.prototype.disable=function(){"use strict";this._subscriptionsHandler.release();};k.prototype._resetStageSize=function(){"use strict";this._minStageDimensions=new i(0,0);};k.prototype._windowResize=function(){"use strict";this._resetStageSize();this._resize();};k.prototype._resize=function(){"use strict";var l=this._dimensions.getDimensionsFromImage(this._viewer.getCurrentImage()),m=this._dimensions.getStageDimensions(l);if(!this._minStageDimensions)this._resetStageSize();this._minStageDimensions=new i(Math.max(m.x,this._minWidth,this._minStageDimensions.x),Math.max(m.y,this._minHeight,this._minStageDimensions.y));var n=this._dimensions.getImageDimensionsForStage(l,this._minStageDimensions),o=this._minStageDimensions.y-n.y;if(o>0&&o<this._padding)this._minStageDimensions.y=n.y;var p=this._minStageDimensions.x-n.x;if(p>0&&p<this._padding)this._minStageDimensions.x-=p;if(h.ie()<8)n.x-=1;this._viewer.setStageDimensions(this._minStageDimensions);this._viewer.setImageDimensions(n);};j(k.prototype,{_padding:40,_minHeight:520,_minWidth:520,_subscriptions:null,_minStageDimensions:null,_dimensions:null});e.exports=k;});
__d("VaultImageCache",[],function(a,b,c,d,e,f){var g=[],h={},i={addImageProvider:function(j){g.push(j);},invokeCallbackWithURL:function(j,k){if(h[j]){k(h[j]);return;}for(var l=0;l<g.length;l++){var m=g[l](j,function(n){h[j]=n;k(n);});if(m)return;}}};e.exports=i;});
__d("VaultNUX",["AsyncRequest","CSS","DOM","csx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('csx'),k='/ajax/vault/nux_state.php';function l(n){new g().setURI(k).setData({action:'complete',step:n}).send();}var m={setVaultBoxNUXCompleted:function(){new g().setURI(k).setData({action:'complete_vault_box'}).send();},init:function(n,o){var p=i.find(n.getRoot(),"._3qj"),q=i.find(n.getRoot(),"._3qk");l(1);n.subscribe('confirm',function(r){var s=o.getNumItems(),t=o.getIndex()+1;if(t<s){o.page();if(t+1===s){h.hide(p);h.show(q);}}else{l(o.getIndex()+2);n.hide();}});o.subscribe('page_end',function(event,r){var s=r===o.getNumItems()-1;h.conditionShow(p,!s);h.conditionShow(q,s);l(r+1);});}};e.exports=m;});
__d("VaultBoxCropper",["ArbiterMixin","copyProperties","CSS","DOM","Parent","Photocrop2","PhotosConst","ProfilePicRequestCreator","URI","csx","cx","Event"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('Parent'),l=b('Photocrop2'),m=b('PhotosConst'),n=b('ProfilePicRequestCreator'),o=b('URI'),p=b('csx'),q=b('cx'),r=b('Event');function s(t){this._vaultBox=t;}h(s,{_instance:null,getInstance:function(t){if(!s._instance)s._instance=new s(t);return s._instance;}});h(s.prototype,g,{_initialized:false,init:function(){if(this._initialized)return;this._initialized=true;this._croppingEnabled=false;this._saveMode=false;this._croppingOptions=j.find(this._getRoot(),"._68_");this._saveProfilePicMessage=j.find(this._getRoot(),"._690");this._setupHandlers();},_setupHandlers:function(){r.listen(this._croppingOptions,'click',this.clickHandler.bind(this));this._vaultBox.subscribe('page',this._done.bind(this));this._vaultBox.subscribe('close',this._done.bind(this));},submitCroppedPhoto:function(){var t=this._vaultBox.getCurrentImageData();if(!t)return;i.addClass(this._getRoot(),'profilePicSavingMode');i.removeClass(this._getRoot(),'profilePicCroppingMode');i.hide(this._croppingOptions);i.show(this._saveProfilePicMessage);this._saveMode=true;var u=this._photocrop.done();new n(t.fbid,t.owner,t.owner,u).setSuccessURI(new o('profile.php').setQueryData({id:t.owner}).toString()).setErrorURI(o.getRequestURI().setQueryData({view_image:t.fbid}).toString()).setIsUnscaled(true).send();},clickHandler:function(event){var t=event.getTarget();if(this._croppingEnabled&&k.byClass(t,"_691")){this.inform('cancel');this._done();}else if(this._croppingEnabled&&k.byClass(t,"_692"))this.submitCroppedPhoto();event.prevent();},enableCropping:function(t){if(this._croppingEnabled)return;this._croppingEnabled=true;var u={create_target:true,target_parent:j.find(this._getRoot(),"._el"),min_width:m.PIC_NORMAL_FBX_SIZE,min_height:m.PIC_NORMAL_FBX_SIZE};this.photo=j.find(this._getRoot(),"._1_y");this._photocrop=new l(this.photo,u,t);this._photocrop.subscribe('done',this._disableCropping.bind(this));i.addClass(this._getRoot(),'profilePicCroppingMode');i.show(this._croppingOptions);this._saveMode=false;this.inform('enabled');},_done:function(){this._photocrop&&this._photocrop.done(false);delete this._photocrop;},_disableCropping:function(){if(!this._croppingEnabled)return;this._croppingEnabled=false;i.removeClass(this._getRoot(),'profilePicCroppingMode');i.hide(this._croppingOptions);if(!this._saveMode){i.removeClass(this._getRoot(),'profilePicSavingMode');i.hide(this._saveProfilePicMessage);}delete this.photo;this.inform('disabled',!this._saveMode);this._saveMode=false;},_getRoot:function(){return this._vaultBox.getRoot();}});e.exports=s;});
__d("VaultBoxEditor",["PhotoEditorConfig","PhotoEditorCanvas","PhotoEditorCropPalette","CSS","DOM","Event","PhotoEditorFilterPalette","PhotoEditor","Style","SubscriptionsHandler","Vector","$","csx"],function(a,b,c,d,e,f){var g=b('PhotoEditorConfig').Actions,h=b('PhotoEditorCanvas'),i=b('PhotoEditorCropPalette'),j=b('CSS'),k=b('DOM'),l=b('Event'),m=b('PhotoEditorFilterPalette'),n=b('PhotoEditor'),o=b('Style'),p=b('SubscriptionsHandler'),q=b('Vector'),r=b('$'),s=b('csx');for(var t in n)if(n.hasOwnProperty(t))v[t]=n[t];var u=n===null?null:n.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=n;function v(w){"use strict";u.constructor.call(this,w.getRoot());this.buttonHandler.subscribeToStandardActions();this.$VaultBoxEditor0=w;this.$VaultBoxEditor1=this.$VaultBoxEditor0.getCurrentImage().copy();this.$VaultBoxEditor2=null;this.$VaultBoxEditor3=new p('VaultBoxEditor');this.$VaultBoxEditor4=null;this.$VaultBoxEditor3.addSubscriptions(this.registerEventDelegate(this.$VaultBoxEditor5));}v.prototype.initDOM=function(){"use strict";this.$VaultBoxEditor5=r('fbVaultBoxEditPalette').parentNode;this.canvasWrapperEl=k.find(this.root,"._589s");};v.prototype.crop=function(w,x,y,z){"use strict";var aa=this.$VaultBoxEditor6?this.$VaultBoxEditor1.setHiResDimensions.bind(this.$VaultBoxEditor1):this.$VaultBoxEditor1.setNormalDimensions.bind(this.$VaultBoxEditor1);if(this.isInverted){aa(z,y);}else aa(y,z);if(this.$VaultBoxEditor7)this.$VaultBoxEditor7.clearCachedCanvas();u.crop.call(this,w,x,y,z);this.unfilteredImage=new h().setImageContent(this.unfilteredImage).crop(w,x,y,z).getElement();};v.prototype.setImage=function(w){"use strict";u.setImage.call(this,w);this.unfilteredImage=w;};v.prototype.getUnfilteredImage=function(){"use strict";return this.unfilteredImage;};v.prototype.enable=function(w,x){"use strict";this.$VaultBoxEditor3.engage();this.$VaultBoxEditor3.addSubscriptions(this.$VaultBoxEditor0.subscribe('stageresized',this.$VaultBoxEditor8.bind(this)),this.$VaultBoxEditor0.subscribe('imageresized',this.$VaultBoxEditor9.bind(this)),this.$VaultBoxEditor0.subscribe('close',this.disable.bind(this)),this.buttonHandler.subscribe([g.ROTATE_CW,g.ROTATE_CCW],this.$VaultBoxEditora.bind(this)),this.buttonHandler.subscribe(g.FILTER_DROPDOWN,this.$VaultBoxEditorb.bind(this)),this.buttonHandler.subscribe(g.CROP,this.$VaultBoxEditorc.bind(this)),l.listen(k.find(this.root,"._5ab5"),'click',function(z){this.disable();return false;}.bind(this)));j.show(this.canvasWrapperEl);j.addClass(this.getRoot(),'profilePicEditingMode');this.$VaultBoxEditor6=this.$VaultBoxEditor1.hasHiResDimensions();var y=this.$VaultBoxEditor1.getHiResSrc()||this.$VaultBoxEditor1.getNormalSrc();this.loadPhoto(y);this.$VaultBoxEditor9(null,{x:w,y:x});this.inform('enabled');};v.prototype.onImageLoaded=function(w){"use strict";u.onImageLoaded.call(this,w);j.show(this.$VaultBoxEditor5);};v.prototype.disable=function(){"use strict";this.$VaultBoxEditor3.release();if(this.$VaultBoxEditor4)this.$VaultBoxEditor4.disable();this.imageLoadRef.remove();j.hide(this.canvasWrapperEl);j.hide(this.$VaultBoxEditor5);j.removeClass(this.getRoot(),'profilePicEditingMode');this.reset();this.inform('disabled');};v.prototype.$VaultBoxEditor9=function(w,x){"use strict";var y,z,aa=0,ba=0;if(this.isInverted){o.apply(this.canvasWrapperEl,{width:x.y+'px',height:x.x+'px'});}else o.apply(this.canvasWrapperEl,{width:x.x+'px',height:x.y+'px'});if(this.$VaultBoxEditor2){if(this.isInverted){y=(this.$VaultBoxEditor2.x-x.y)/2;z=(this.$VaultBoxEditor2.y-x.x)/2;}else{y=(this.$VaultBoxEditor2.x-x.x)/2;z=(this.$VaultBoxEditor2.y-x.y)/2;}if(x.x<this.$VaultBoxEditor2.x)aa=y;if(x.y<this.$VaultBoxEditor2.y)ba=z;}else y=z=0;this.photoPosition=new q(aa,ba);o.apply(this.canvasWrapperEl,{top:z+'px',left:y+'px'});};v.prototype.$VaultBoxEditor8=function(w,x){"use strict";this.$VaultBoxEditor2=x;};v.prototype.$VaultBoxEditora=function(w){"use strict";this.$VaultBoxEditor1.invertDimensions();this.inform('resize');};v.prototype.$VaultBoxEditorc=function(){"use strict";if(!this.$VaultBoxEditore){var w=new i(this,r('fbVaultBoxCropPalette').parentNode,k.find(this.$VaultBoxEditor0.getRoot(),"._el"));this.registerEventDelegate(w.getRoot());this.$VaultBoxEditor3.addSubscriptions(w.subscribe('enabled',j.hide.curry(this.$VaultBoxEditor5)),w.subscribe('disabled',function(x,y){j.show(this.$VaultBoxEditor5);if(y)this.crop(y.x,y.y,y.width,y.height);}.bind(this)));this.$VaultBoxEditore=w;}this.$VaultBoxEditore.enable();this.$VaultBoxEditor4=this.$VaultBoxEditore;};v.prototype.$VaultBoxEditorb=function(){"use strict";if(!this.$VaultBoxEditor7){var w=new m(this,r('fbVaultBoxFilterPalette').parentNode);this.$VaultBoxEditor3.addSubscriptions(w.subscribe('enabled',j.hide.curry(this.$VaultBoxEditor5)),w.subscribe('disabled',function(x,y){j.show(this.$VaultBoxEditor5);this.workingCanvas.setImageContent(this.unfilteredImage);if(y)this.workingCanvas.applyFilter(y.filter,y.args);}.bind(this)));this.$VaultBoxEditor7=w;}this.$VaultBoxEditor7.enable();this.$VaultBoxEditor4=this.$VaultBoxEditor7;};v.prototype.getPhotoViewerImage=function(){"use strict";return this.$VaultBoxEditor1;};e.exports=v;});
__d("VaultBoxUpdateUrlOnNav",["LinkController","PageTransitions","URI","VaultBoxURI","computeRelativeURI","copyProperties","goURI"],function(a,b,c,d,e,f){var g=b('LinkController'),h=b('PageTransitions'),i=b('URI'),j=b('VaultBoxURI'),k=b('computeRelativeURI'),l=b('copyProperties'),m=b('goURI');function n(o){this._vaultbox=o;}l(n.prototype,{enable:function(){this._subscriptions=[this._vaultbox.subscribe('open',this._handleOpen.bind(this)),this._vaultbox.subscribe('close',this._handleClose.bind(this)),this._vaultbox.subscribe('go',this._handleGo.bind(this)),this._vaultbox.subscribe('image',this._handleImage.bind(this)),this._vaultbox.subscribe('cycle',this._handleCycle.bind(this)),this._vaultbox.subscribe('store',this._handleStore.bind(this))];},disable:function(){this.unregisterTransition();for(var o=0;o<this._subscriptions.length;o++)this._subscriptions[o].unsubscribe();this._subscriptions=[];},registerTransition:function(){if(!this._ptHandler)this._ptHandler=h.registerHandler(this._handleTransition.bind(this));},unregisterTransition:function(){if(this._ptHandler){this._ptHandler.unsubscribe();this._ptHandler=null;}},goCurrent:function(){m(this._vaultbox.stream.getCurrentImageData().getPermalink());},_handleTransition:function(o){if(this._replaceUrl){this._replaceUrl=false;h.transitionComplete();return true;}var p=this._vaultbox.stream.getCursorForURI(o.getUnqualifiedURI().toString());if(p){var q=this._vaultbox.stream.getRelativeMovement(p);this._keepUrl=true;this._vaultbox.page(q);h.transitionComplete();return true;}if(this._vaultbox._isOpen){this._vaultbox._spotlight.hide();h.transitionComplete();return true;}this._ptHandler=null;return false;},_handleOpen:function(o){this._startingURI=i.getMostRecentURI().getUnqualifiedURI();this.registerTransition();g.registerHandler(this._handleNavigateAway.bind(this));},_handleClose:function(o){this._openExplicitly=false;if(this._startingURI){this._replaceUrl=true;var p=this._startingURI;if(j.isVaultBoxURI(p)){p=new i(p).removeQueryData('view_image');if(p.getQueryData().hasOwnProperty('makeprofile'))p=p.removeQueryData('makeprofile');}m(p);}},_handleGo:function(o,p){this.registerTransition();this._openExplicitly=true;},_handleImage:function(o,p){if(this._keepUrl){this._keepUrl=false;}else{this._replaceUrl=true;m(p.getPermalink());}},_handleCycle:function(o){this._keepUrl=true;},_handleStore:function(o,p){if('init' in p&&this._openExplicitly){this._replaceUrl=true;this.goCurrent();}},_handleNavigateAway:function(o){var p=k(h._most_recent_uri.getQualifiedURI(),o.getAttribute('href'));if(this._vaultbox._isOpen&&p instanceof i){this._vaultbox.recacheData();this._vaultbox._spotlight.hide();this._openExplicitly=false;m(p);return false;}return true;}});e.exports=n;});
__d("VaultBox",["Arbiter","ArbiterMixin","AsyncRequest","BehaviorsMixin","Bootloader","CSS","CSSAnimations","DOM","Event","Form","KeyEventController","Locale","Parent","PhotosConst","PhotoStreamCache","PhotosUploadWaterfall","PhotoViewer","PhotoViewerDimensions","PhotoViewerImage","PhotoViewerResize","Style","SubscribableSet","UIPagelet","VaultBoxCropper","VaultBoxEditor","VaultBoxUpdateUrlOnNav","VaultImageCache","VaultNUX","Vector","$","copyProperties","createArrayFrom","csx","cx","emptyFunction","ge","shield","mixin","classWithMixins"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('BehaviorsMixin'),k=b('Bootloader'),l=b('CSS'),m=b('CSSAnimations'),n=b('DOM'),o=b('Event'),p=b('Form'),q=b('KeyEventController'),r=b('Locale'),s=b('Parent'),t=b('PhotosConst'),u=b('PhotoStreamCache'),v=b('PhotosUploadWaterfall'),w=b('PhotoViewer'),x=b('PhotoViewerDimensions'),y=b('PhotoViewerImage'),z=b('PhotoViewerResize'),aa=b('Style'),ba=b('SubscribableSet'),ca=b('UIPagelet'),da=b('VaultBoxCropper'),ea=b('VaultBoxEditor'),fa=b('VaultBoxUpdateUrlOnNav'),ga=b('VaultImageCache'),ha=b('VaultNUX'),ia=b('Vector'),ja=b('$'),ka=b('copyProperties'),la=b('createArrayFrom'),ma=b('csx'),na=b('cx'),oa=b('emptyFunction'),pa=b('ge'),qa=b('shield'),ra=-1,sa=1,ta=40,ua=120,va='left',wa='right',xa=b("mixin"),ya=b("classWithMixins"),za=ya(w,xa(h,j));for(var ab in za)if(za.hasOwnProperty(ab))cb[ab]=za[ab];var bb=za===null?null:za.prototype;cb.prototype=Object.create(bb);cb.prototype.constructor=cb;cb.__superConstructor__=za;function cb(){"use strict";za.call(this);this._dimensions=new x();this.enableBehavior(fa);this.enableBehavior(z);}cb.prototype.bootstrap=function(db,eb,fb,gb,hb,ib){"use strict";ib=ib||{};var jb=['thumbSrc','waterfallID','makeProfile'];for(var kb in ib)if(jb.indexOf(kb)<0)throw new Error("Unsupported extraData value '"+kb+"' should not be used");ib.waterfallID&&this.setWaterfallID(ib.waterfallID);this._makeProfile=ib.makeProfile;if(this._makeProfile){var lb=this.subscribeOnce('imageloaded',this.enableCropping.bind(this));this.subscribeOnce('page',lb.unsubscribe.bind(lb));}this._firstImage=new y({hiResDimensions:gb,normalDimensions:hb,hiResSrc:fb,normalSrc:eb,thumbSrc:ib.thumbSrc});this._loadQuery={fbid:db,image:this._firstImage};if(eb)new Image().src=this._getSrcFromImage(this._firstImage);this.inform('go');if(this._spotlight){this.open(this._loadQuery);}else new i('/ajax/photos/vaultbox/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};cb.prototype.init=function(db,eb){"use strict";if(this._isInitialized())return;this._spotlight=db;this._spotlight.subscribe('hide',this._onHide.bind(this));this.root=db.getRoot();this._stageWrapper=n.find(this.root,"div._5_");this._errorBox=n.find(this._stageWrapper,"div._ep");this.image=n.find(this._stageWrapper,"img._1_y");this._checkmark=n.find(this._stageWrapper,"a._b4");this._checkNUX=n.find(this._stageWrapper,"div._3n7");this._bottomBar=n.find(this.root,"div._3n1");this._deleteLink=n.find(this._bottomBar,"._3n0");this._deleteForm=s.byTag(this._deleteLink,'form');this._deleteHiddenInput=n.find(this._deleteForm,'input[name="vault_image_ids"]');this._badgedButton=eb;this._selectionSet&&this.setSelectionSet(this._selectionSet);this._prevPager=n.find(this._stageWrapper,"._62");this._nextPager=n.find(this._stageWrapper,"._61");var fb=function(gb,hb){if(this.stream){var ib=this.stream.getImageData(gb);if(ib){hb(ib.url);return true;}}return false;}.bind(this);ga.addImageProvider(fb);this._sharePhotosButton=n.find(this._stageWrapper,"._4kgo");if(this._loadQuery)this.open(this._loadQuery);};cb.prototype.getEventPrefix=function(){"use strict";return 'VaultBox';};cb.prototype.getSourceString=function(){"use strict";return 'vaultbox';};cb.prototype.showVaultBoxNUX=function(){"use strict";this._checkNUX&&l.show(this._checkNUX);};cb.prototype.getCurrentPhotoFBID=function(){"use strict";var db=this.stream.getCursor();if((db===null||db===u.INIT_PLACEHOLDER)&&this._loadQuery)db=this._loadQuery.fbid;return db;};cb.prototype.open=function(db){"use strict";var eb=this._getSrcFromImage(db.image);delete db.image;if(!this.firstLoad){this.firstLoad=true;db.firstLoad=true;}db.qn=this._waterfallID;db.application=this._getWaterfallApp();this._isOpen=true;this.loadingStates={image:false,html:false};this.stream=new u();this.stream.init(t.VIEWER_VAULTBOX,'VaultBoxPagelet','pagelet_photo_viewer');this.stream.waitForInitData();ca.loadFromEndpoint('VaultBoxInitPagelet',pa('pagelet_vault_box_init',this.root),db,{usePipe:true,jsNonblock:true,crossPage:true});this.setLoadingState(cb.STATE_HTML,true);l.hide(this._stageWrapper);this.setLoadingState(cb.STATE_IMAGE_PIXELS,true);this._spotlight.show();eb&&this._loadFirstImage(eb);this.inform('open');this.stageHandlers=[o.listen(window,'resize',this._onResize.bind(this)),o.listen(this.root,'click',this._onClick.bind(this)),o.listen(this._stageWrapper,'mousemove',this._onMouseMove.bind(this)),o.listen(this._stageWrapper,'mouseleave',this._hideActions.bind(this)),q.registerKey('LEFT',function(fb,gb){this.page(ra);return false;}.bind(this)),q.registerKey('RIGHT',function(fb,gb){this.page(sa);return false;}.bind(this))];if(!eb)this.setLoadingState(cb.STATE_IMAGE_DATA,true);};cb.prototype.attachWarningDialog=function(db){"use strict";db.setContext(this._checkmark);};cb.prototype._onClick=function(event){"use strict";var db=event.getTarget();if(this.canPage){var eb=s.byTag(db,'a');if(eb)if(l.hasClass(eb,"_61")){this.page(sa);return;}else if(l.hasClass(eb,"_62")){this.page(ra);return;}else if(l.hasClass(eb,"_b4")){this.toggleSelected();return;}else if(s.byClass(eb,"_59p4")){this.rotate(va);return;}else if(s.byClass(eb,"_59p5")){this.rotate(wa);return;}else if(s.byClass(eb,"_3n2")){return;}else if(l.hasClass(eb,"_3n0")){p.createHiddenInputs({qn:this._waterfallID,source:v.VAULTBOX},this._deleteForm);p.bootstrap(this._deleteForm,eb);return;}else if(l.hasClass(eb,"_5xu")){this.close();return;}else if(s.byClass(eb,"_by1")){this.enableCropping();return;}else if(s.byClass(eb,"_5aop")){this.enableEditor();return;}if(n.contains(this._sharePhotosButton,db)){var fb=this.getSelectionSet();if(fb.getLength()===0)fb.add(this.getCurrentPhotoFBID());this.inform('create-post',this._sharePhotosButton);return;}if(s.byClass(db,"_5_")&&!s.byClass(db,"_3n1")&&!s.byClass(db,"_68_")&&!s.byClass(db,"_bx5"))if(this._pageToPrev){this.page(ra);return;}else{this.page(sa);return;}}if(this._isOpen){var gb=s.byClass(db.parentNode,"_5_")===null&&!s.byClass(db,"_bx5");if(gb){this.recacheData();this._spotlight.hide();}}};cb.prototype._onHide=function(){"use strict";while(this.stageHandlers.length)this.stageHandlers.pop().remove();this.canPage=false;l.hide(this._errorBox);l.hide(this._stageWrapper);this.stream.destroy();this.inform('close');this._isOpen=false;};cb.prototype._onMouseMove=function(event){"use strict";var db=ia.getEventPosition(event),eb=ia.getElementPosition(this._stageWrapper),fb=event.getTarget(),gb=fb&&l.hasClass(fb,"_5xu"),hb=db.x-eb.x,ib=ia.getElementDimensions(this._stageWrapper),jb=hb/ib.x;if(r.isRTL()){this._pageToPrev=jb>(1-cb.PAGE_TO_PREV_PERCENTAGE);}else this._pageToPrev=jb<cb.PAGE_TO_PREV_PERCENTAGE;l.conditionClass(this._prevPager,"_8rd",this._pageToPrev&&!gb);l.conditionClass(this._nextPager,"_8rd",!this._pageToPrev&&!gb);this._showActions();};cb.prototype._showActions=function(){"use strict";l.addClass(this._stageWrapper,"_8re");};cb.prototype._hideActions=function(){"use strict";var db=n.scry(this.root,"._bx5");if(db.length>0)return;clearTimeout(this.fadeTimer);l.removeClass(this._stageWrapper,"_8re");};cb.prototype.setLoadingState=function(db,eb){"use strict";switch(db){case cb.STATE_IMAGE_PIXELS:l.conditionClass(this.root,'imagePixelsLoading',eb);break;case cb.STATE_IMAGE_DATA:this.loadingStates[db]=eb;l.conditionClass(this.root,'imageLoading',eb);this.image.setAttribute('aria-busy',eb);break;case cb.STATE_HTML:this.loadingStates[db]=eb;l.conditionClass(this.root,'dataLoading',eb);break;}};cb.prototype.checkState=function(db){"use strict";if(db!=cb.STATE_ERROR&&!this.loadingStates[db])return;switch(db){case cb.STATE_IMAGE_DATA:this.page(0);break;case cb.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(db,false);}break;default:if(this.stream.errorInCurrent()){l.hide(this._stageWrapper);l.show(this._errorBox);}break;}};cb.prototype.updateCheckmarkState=function(){"use strict";var db=this.getSelectionSet().contains(this.getCurrentPhotoFBID());l.conditionClass(this._checkmark,"_b5",db);};cb.prototype.toggleSelected=function(event){"use strict";var db=this.getSelectionSet(),eb=this.getCurrentPhotoFBID(),fb;if(db.contains(eb)){db.remove(eb);fb=-1;}else{fb=1;db.add(eb);}if(this._waterfallID)v.sendSignal({qn:this._waterfallID,step:v.VAULT_IMAGES_SELECTED,count:fb,uploader:this._getWaterfallApp(),source:v.VAULTBOX});if(l.shown(this._checkNUX)){ha.setVaultBoxNUXCompleted();l.hide(this._checkNUX);}m.bounce(this._checkmark);};cb.prototype.getSelectionSet=function(){"use strict";if(!this._selectionSet)this._selectionSet=new ba();return this._selectionSet;};cb.prototype.setSelectionSet=function(db){"use strict";if(db==this._selectionSet)return;this._selectionSet=db;if(this._selectionSetSubscription)this._selectionSetSubscription.unsubscribe();this._selectionSetSubscription=this._selectionSet.subscribe('change',function(){this._isOpen&&this.updateCheckmarkState();}.bind(this));this._badgedButton&&this._badgedButton.setSelectionSet(db);};cb.prototype.page=function(db){"use strict";if(!this.stream.isValidMovement(db)||!this._canPage())return;this.inform('page');this.recacheData();this.stream.moveCursor(db);l.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(cb.STATE_HTML,true);l.show(this._errorBox);return;}var eb=this.stream.getCurrentImageData();if(eb){var fb=this._getSrcFromImage(eb);if(fb)this.switchImage(fb,true);this.inform('image',eb);this.setLoadingState(cb.STATE_IMAGE_DATA,false);}else{this.setLoadingState(cb.STATE_IMAGE_PIXELS,true);this.setLoadingState(cb.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(cb.STATE_HTML,true);};cb.prototype.recacheData=function(){"use strict";if(!this.loadingStates.html){var db=this.stream.getCurrentHtml();for(var eb in db){db[eb]=la(ja(eb).childNodes);n.empty(ja(eb));}}};cb.prototype._onResize=function(){"use strict";this.inform('windowresize');};cb.prototype.makeNewImage=function(db){"use strict";var eb=n.create('img',{className:"_1_y",alt:''});eb.setAttribute('aria-busy','true');o.listen(eb,'load',function(){this.image.setAttribute('aria-busy','false');this.setLoadingState(cb.STATE_IMAGE_PIXELS,false);this.updateCheckmarkState();if(this._isOpen){this.inform('imageset');this.inform('imageloaded');l.show(this._stageWrapper);}}.bind(this));eb.src=db;return eb;};cb.prototype.switchImage=function(db,eb){"use strict";l.hide(this.image);l.hide(this._errorBox);this.setLoadingState(cb.STATE_IMAGE_PIXELS,true);this.useImage(this.makeNewImage(db));if(eb)this.stream.preloadImages(this._dimensions.shouldUseHiRes.bind(this._dimensions));};cb.prototype.useImage=function(db){"use strict";n.replace(this.image,db);this.image=db;this.inform('imageset');l.show(this._stageWrapper);};cb.prototype._loadFirstImage=function(db){"use strict";if(this._firstImage.getThumbSrc()){var eb=n.create('img',{className:"_1_y",alt:'',src:this._firstImage.getThumbSrc()});this.useImage(eb);this._loadFirstImageFullSize(db);}else this.switchImage(db,false);};cb.prototype._loadFirstImageFullSize=function(db){"use strict";var eb=n.create('img',{className:"_1_y",alt:''});o.listen(eb,'load',function(){this.setLoadingState(cb.STATE_IMAGE_PIXELS,false);this.updateCheckmarkState();if(this._isOpen){this.useImage(eb);this.inform('imageloaded');}}.bind(this));eb.src=db;};cb.prototype.setErrorBoxContent=function(db){"use strict";n.setContent(this._errorBox,db);};cb.prototype.swapData=function(){"use strict";var db,eb=this.stream.getCurrentHtml();if(eb){this.setLoadingState(cb.STATE_HTML,false);for(var fb in eb){db=pa(fb);if(db)n.setContent(db,eb[fb]);}var gb=this.stream.getCurrentExtraData();this._deleteHiddenInput.setAttribute('value',this.getCurrentPhotoFBID());this.inform('data',this.getCurrentImageData(),g.BEHAVIOR_STATE);if(gb)this.inform('extra_data',gb,g.BEHAVIOR_STATE);this._showActions();}};cb.prototype.addPhotoFbids=function(db,eb,fb){"use strict";var gb=this.stream.getCursor()===null;this.stream.attachToFbidsList(db,eb,fb);if(fb&&gb){this.inform('cycle');this.page(0);}};cb.prototype.storeFromData=function(db){"use strict";if(!this._isOpen)return;var eb=this.stream.storeToCache(db);this.inform('store',eb);if('error' in eb){this.checkState(cb.STATE_ERROR);return;}if('init' in eb)this.canPage=true;if('image' in eb)this.checkState(cb.STATE_IMAGE_DATA);if('data' in eb)this.checkState(cb.STATE_HTML);};cb.prototype.getVersionConst=function(){"use strict";return t.VIEWER_VAULTBOX;};cb.prototype._isInitialized=function(){"use strict";return !!this._spotlight;};cb.prototype.close=function(){"use strict";this.inform('close');this._spotlight.hide();};cb.prototype.setWaterfallID=function(db){"use strict";this._waterfallID=db;};cb.prototype.enableCropping=function(){"use strict";if(!this._vaultCropper){this._vaultCropper=da.getInstance(this);this._vaultCropper.init();this._vaultCropper.subscribe('enabled',function(){this._isCroppingEnabled=true;l.hide(this._bottomBar);}.bind(this));this._vaultCropper.subscribe('disabled',function(db,eb){this._isCroppingEnabled=false;if(eb)l.show(this._bottomBar);}.bind(this));}this._vaultCropper.enableCropping(this._getCurrentImageMaxDimensions());};cb.prototype.enableEditor=function(){"use strict";this._vaultEditor=new ea(this);this._vaultEditor.subscribe('enabled',function(){l.hide(this._bottomBar);l.hide(this.image);this._isEditingEnabled=true;}.bind(this));this._vaultEditor.subscribe('disabled',function(){l.show(this._bottomBar);l.show(this.image);this._isEditingEnabled=false;this.inform('windowresize');}.bind(this));this._vaultEditor.subscribe('imageloaded',qa(this.inform,this,'imageset'));this._vaultEditor.subscribe('resize',qa(this.inform,this,'windowresize'));this._vaultEditor.enable(parseInt(this.image.width,10),parseInt(this.image.height,10));};cb.prototype.getCurrentImageData=function(){"use strict";return this.stream.getCurrentImageData().getInfo();};cb.prototype.getCurrentImage=function(){"use strict";if(this._isEditingEnabled)return this._vaultEditor.getPhotoViewerImage();var db=this.stream&&this.stream.getCurrentImageData();return db||this._firstImage;};cb.prototype._getCurrentImageDimensions=function(){"use strict";return this._getDimensionsFromImage(this.getCurrentImage());};cb.prototype._getCurrentImageMaxDimensions=function(){"use strict";return this._getMaxDimensionsFromImage(this.getCurrentImage());};cb.prototype._getWaterfallApp=function(){"use strict";return v.APP_ARCHIVE;};cb.prototype._getVerticalPadding=function(){"use strict";return this._checkNUX&&l.shown(this._checkNUX)?ua:ta;};cb.prototype._getSrcFromImage=function(db){"use strict";return this._dimensions.getSrcFromImage(db);};cb.prototype._getDimensionsFromImage=function(db){"use strict";return this._dimensions.getDimensionsFromImage(db);};cb.prototype._getMaxDimensionsFromImage=function(db){"use strict";if(!this._dimensions.getMaxDimensionsFromImage)return this._getDimensionsFromImage(db);return this._dimensions.getMaxDimensionsFromImage(db);};cb.prototype.setImageDimensions=function(db){"use strict";aa.set(this.image,'width',db.x+'px');aa.set(this.image,'height',db.y+'px');this.inform('imageresized',db);};cb.prototype.setStageDimensions=function(db){"use strict";aa.set(this._stageWrapper,'width',db.x+'px');aa.set(this._stageWrapper,'height',db.y+'px');this.inform('stageresized',db);};cb.prototype.getPhotoViewerDimensions=function(){"use strict";return this._dimensions;};cb.prototype._canPage=function(){"use strict";return this._isOpen&&!this._isCroppingEnabled&&!this._isEditingEnabled;};cb.prototype.rotate=function(db){"use strict";var eb=this.getCurrentPhotoFBID(),fb={fbid:eb,cs_ver:t.VIEWER_VAULTBOX};fb[db]=1;this.setLoadingState(cb.STATE_IMAGE_DATA,true);this.setLoadingState(cb.STATE_IMAGE_PIXELS,true);l.hide(this.image);new i('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(fb).setErrorHandler(this.rotationError.bind(this,eb)).setFinallyHandler(this.rotationComplete.bind(this,eb)).setMethod('POST').setReadOnly(false).send();};cb.prototype.rotationComplete=function(db,eb){"use strict";if(db===this.getCurrentPhotoFBID()){this.setLoadingState(cb.STATE_IMAGE_DATA,false);var fb=this._getSrcFromImage(this.getCurrentImage());this.switchImage(fb);}};cb.prototype.rotationError=function(db,eb){"use strict";if(db===this.getCurrentPhotoFBID()){this.setLoadingState(cb.STATE_IMAGE_DATA,false);var fb=this._getSrcFromImage(this.getCurrentImage());this.switchImage(fb);k.loadModules(['AsyncResponse'],function(gb){gb.defaultErrorHandler(eb);});}};cb.getInstance=function(){"use strict";if(!cb._instance)cb._instance=new cb();return cb._instance;};cb.init=function(db,eb){"use strict";cb.getInstance().init(db,eb);};cb.addPhotoFbids=function(db,eb,fb){"use strict";cb.getInstance().addPhotoFbids(db,eb,fb);};cb.bootstrap=function(db,eb,fb,gb,hb,ib){"use strict";cb.getInstance().bootstrap(db,eb,fb,gb,hb,ib);};cb.bootstrapWithElem=function(db){"use strict";var eb=n.find(db,'img').src;cb.getInstance().bootstrap(db.getAttribute('data-fbid'),db.getAttribute('data-normal-src'),db.getAttribute('data-hi-res-src'),db.getAttribute('data-hi-res-dimensions'),db.getAttribute('data-normal-dimensions'),{thumbSrc:eb});};cb.setErrorBoxContent=function(db){"use strict";cb.getInstance().setErrorBoxContent(db);};cb.storeFromData=function(db){"use strict";cb.getInstance().storeFromData(db);};cb.subscribe=function(db,eb,fb){"use strict";return cb.getInstance().subscribe(db,eb,fb);};cb.setSelectionSet=function(db){"use strict";cb.getInstance().setSelectionSet(db);};cb.attachWarningDialog=function(db){"use strict";cb.getInstance().attachWarningDialog(db);};cb.showVaultBoxNUX=function(){"use strict";cb.getInstance().showVaultBoxNUX();};cb.close=function(){"use strict";cb.getInstance().close();};cb.setWaterfallID=function(db){"use strict";cb.getInstance().setWaterfallID(db);};cb.enableCropping=function(){"use strict";cb.getInstance().enableCropping();};ka(cb,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',PAGE_TO_PREV_PERCENTAGE:.2,FADE_TIME:3000,_instance:null,touchMarkup:oa});ka(cb.prototype,{imageLoadingTimer:null,canPage:false,lastPage:0,firstLoad:false});e.exports=cb;});
__d("VideoUploadLogger",["Banzai","copyProperties"],function(a,b,c,d,e,f){var g=b('Banzai'),h=b('copyProperties');function i(j){this._source=j.source;this._waterfallID=j.waterfall_id;this._targetID=j.target_id;this._targetType=j.target_type;this._delay=j.delay;this._times=[];}h(i,{BANZAI_GK:'videos',BANZAI_ROUTE:'video_waterfall',SOURCE_SIMPLE:'simple',SOURCE_COMPOSER:'composer',EVENT_REQUESTED_UPLOADING:'upload.client.requested_uploading',EVENT_STARTED_UPLOADING:'upload.client.started_uploading',EVENT_FINISHED_UPLOADING:'upload.client.finished_uploading',EVENT_CANCELED_UPLOADING:'upload.client.canceled_uploading',EVENT_ABANDONED_UPLOADING:'upload.client.abandoned_uploading',EVENT_FAILED_UPLOADING:'upload.client.failed_uploading',EVENT_STARTED_SENDING_BYTES:'upload.client.started_sending_bytes',EVENT_FINISHED_SENDING_BYTES:'upload.client.finished_sending_bytes',EVENT_CANCELED_SENDING_BYTES:'upload.client.canceled_sending_bytes',EVENT_FAILED_SENDING_BYTES:'upload.client.failed_sending_bytes',EVENT_STARTED_SENDING_CHUNK_BYTES:'upload.client.started_sending_chunk_bytes',EVENT_FINISHED_SENDING_CHUNK_BYTES:'upload.client.finished_sending_chunk_bytes',EVENT_CANCELED_SENDING_CHUNK_BYTES:'upload.client.canceled_sending_chunk_bytes',EVENT_FAILED_SENDING_CHUNK_BYTES:'upload.client.failed_sending_chunk_bytes',EVENT_RECEIVED_RESPONSE:'upload.client.received_response'});h(i.prototype,{logEvent:function(event,j){var k=h({},j);if(k.elapsed_time==null)if(event.indexOf('started')!==-1){this._times[event]=Date.now();}else if(event.indexOf('finished')!==-1){k.elapsed_time=this._computeElapsedTime(event,'finished');}else if(event.indexOf('canceled')!==-1){k.elapsed_time=this._computeElapsedTime(event,'canceled');}else if(event.indexOf('failed')!==-1)k.elapsed_time=this._computeElapsedTime(event,'failed');k.event=event;k.source=this._source;k.waterfall_id=this._waterfallID;k.target_id=this._targetID;k.target_type=this._targetType;g.post(i.BANZAI_ROUTE,k,{delay:this._delay});},_computeElapsedTime:function(event,j){var k=event.replace(j,'started'),l=this._times[k];return l?Date.now()-l:null;}});e.exports=i;});
__d("VideoUploader_DEPRECATED",["ArbiterMixin","AsyncRequest","copyProperties","Dialog","ErrorDialog","UserAgent","VideoUploadLogger","WaterfallIDGenerator","DOM","Run","submitForm","tx"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('Dialog'),k=b('ErrorDialog'),l=b('UserAgent'),m=b('VideoUploadLogger'),n=b('WaterfallIDGenerator'),o=b('DOM'),p=b('Run'),q=b('submitForm'),r=b('tx');function s(t){this._extensions=t.extensions;this._isUploadInProgress=false;this._loggingDelay=t.logging_delay;this._maxSize=t.max_size;this._minSize=t.min_size;this._source=t.source;this._targetID=t.target_id;this._targetType=t.target_type;}i(s.prototype,g,{isVideoFile:function(t){return !!this._extensions[this._getFileExtension(t)];},upload:function(t,u){this._fileForm=t;this._fileInput=u;this._fileSize=this._getFileSize(this._fileInput);this._fileExtension=this._getFileExtension(this._fileInput);this._videoID=null;this._sentBytes=0;this._totalBytes=0;var v=n.generate();o.find(t.getRoot(),"input[name='qn']").value=v;var w=o.scry(t.getRoot(),"input[name='source']");if(w.length===0)o.appendContent(t.getRoot(),o.create('input',{name:'source',value:this._source,type:'hidden'}));this._logger=new m({delay:this._loggingDelay,source:this._source,target_id:this._targetID,target_type:this._targetType,waterfall_id:v});var x={file_size:this._fileSize,file_extension:this._fileExtension};this._logger.logEvent(m.EVENT_REQUESTED_UPLOADING,x);if(!this._validateFormat()||!this._validateSize()){this.inform('file-invalidated');return;}this._subscriptions=[t.subscribe('submit',this._handleUploadSubmitted.bind(this)),t.subscribe('progress',this._handleUploadProgress.bind(this)),t.subscribe('initial',this._handleUploadResponded.bind(this)),t.subscribe('success',this._handleUploadSucceeded.bind(this)),t.subscribe('failure',this._handleUploadFailed.bind(this))];p.onLeave(this._cancelUpload.bind(this));this._isUploadInProgress=true;this._logger.logEvent(m.EVENT_STARTED_UPLOADING,x);q(this._fileForm.getRoot());},showCancelDialog:function(){new j().setTitle("Cancel Upload").setBody("Are you sure you want to cancel?").setButtons(j.CONFIRM,j.CANCEL).setHandler(this._handleUploadCanceled.bind(this)).setModal(true).show();},getIsUploadInProgress:function(){return this._isUploadInProgress;},_cancelUpload:function(){if(this._isUploadInProgress)this._handleUploadCanceled();},_validateFormat:function(){if(!this._extensions[this._fileExtension]){k.show("Unsupported File Format","Sorry, the file you selected is in a format that we don't support. Please use one of our \u003Ca href=\"http:\/\/www.facebook.com\/help\/?faq=218673814818907#What-formats-of-video-files-can-I-upload?\">recommended formats\u003C\/a> for video files.");this._logger.logEvent(m.EVENT_FAILED_UPLOADING,{error_code:1363024,error_description:'Unsupported Video Format',file_extension:this._fileExtension,file_size:this._fileSize});return false;}return true;},_validateSize:function(){if(this._fileSize!==null&&this._fileSize<this._minSize){k.show("Video File Too Small",r._("The video file you tried to upload is too small. The minimum size for a video file is \u003Cb>{min-size} KB\u003C\/b>. Please try again with a larger file.",{'min-size':Math.round(this._minSize/1024)}));this._logger.logEvent(m.EVENT_FAILED_UPLOADING,{error_code:1363022,error_description:'Video File Too Small',file_size:this._fileSize});return false;}if(this._fileSize!==null&&this._fileSize>this._maxSize){k.show("Video File Too Large",r._("The video file you tried to upload is too large. The maximum size for a video file is \u003Cb>{max-size} MB\u003C\/b>. Please try again with a smaller file.",{'max-size':Math.round(this._maxSize/1024/1024)}));this._logger.logEvent(m.EVENT_FAILED_UPLOADING,{error_code:1363023,error_description:'Video File Too Large',file_size:this._fileSize});return false;}return true;},_handleUploadSubmitted:function(t,u){if(this._shouldLogSendingBytesEvents())this._logger.logEvent(m.EVENT_STARTED_SENDING_BYTES,{file_size:this._fileSize});this.inform('upload-submitted',u);},_handleUploadProgress:function(t,u){if(u.event.lengthComputable&&this._shouldLogSendingBytesEvents()){this._sentBytes=u.event.loaded;this._totalBytes=u.event.total;if(this._sentBytes===this._totalBytes)this._logger.logEvent(m.EVENT_FINISHED_SENDING_BYTES,{sent_bytes:this._sentBytes,file_size:this._fileSize});}this.inform('upload-progressed',u);},_handleUploadResponded:function(t,u){this._logger.logEvent(m.EVENT_RECEIVED_RESPONSE,{file_size:this._fileSize});this.inform('upload-responded',u);},_handleUploadSucceeded:function(t,u){this._isUploadInProgress=false;this._videoID=u.response.getPayload().video_id;this._logger.logEvent(m.EVENT_FINISHED_UPLOADING,{video_id:this._videoID,file_size:this._fileSize});this.inform('upload-succeeded',u);this._cleanup();},_handleUploadFailed:function(t,u){this._isUploadInProgress=false;this._logger.logEvent(m.EVENT_FAILED_UPLOADING,{error_code:u.response.error,error_description:u.response.errorSummary,file_size:this._fileSize});if(this._shouldLogSendingBytesEvents()&&(this._sentBytes<this._totalBytes))this._logger.logEvent(m.EVENT_FAILED_SENDING_BYTES,{sent_bytes:this._sentBytes,total_bytes:this._totalBytes,file_size:this._fileSize});k.show(u.response.errorSummary,u.response.errorDescription);this.inform('upload-failed',u);this._cleanup();},_handleUploadCanceled:function(t,u){this._fileForm.abort();this._isUploadInProgress=false;if(this._videoID)new h('/ajax/video/actions/delete').setData({fbid:this._videoID,redirect:false}).send();this._logger.logEvent(m.EVENT_CANCELED_UPLOADING,{video_id:this._videoID,file_size:this._fileSize});if(this._shouldLogSendingBytesEvents()&&(this._sentBytes<this._totalBytes))this._logger.logEvent(m.EVENT_CANCELED_SENDING_BYTES,{sent_bytes:this._sentBytes,total_bytes:this._totalBytes,file_size:this._fileSize});this.inform('upload-canceled',u);},_cleanup:function(){this._subscriptions.forEach(function(t){t.unsubscribe();});},_getFileSize:function(t){if(!t.files||!t.files[0])return null;return t.files[0].size;},_getFileExtension:function(t){return t.value.split('.').pop().toLowerCase();},_shouldLogSendingBytesEvents:function(){return l.chrome()>=25;}});e.exports=s;});