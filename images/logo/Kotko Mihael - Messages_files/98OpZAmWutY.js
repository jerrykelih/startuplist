/*!CK:1148600859!*//*1384774338,178146371*/

if (self.CavalryLogger) { CavalryLogger.start_js(["auw9g"]); }

__d("TimelineMapScrollableArea",["Animation","ArbiterMixin","CSS","DOM","Event","Run","SimpleDrag","Style","Vector","$","copyProperties","shield"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('Run'),m=b('SimpleDrag'),n=b('Style'),o=b('Vector'),p=b('$'),q=b('copyProperties'),r=b('shield');function s(t,u){t&&this.init(p(t),u);}q(s.prototype,h,{init:function(t,u){u=u||{};this._elem=t;this._wrap=j.find(t,'div.fbScrollableAreaWrap');this._body=j.find(this._wrap,'div.fbScrollableAreaBody');this._track=j.find(t,'div.fbScrollableAreaTrack');this._gripper=j.find(this._track,'div.fbScrollableAreaGripper');this._options=u;this.adjustGripper();this._listeners=[k.listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(u.fade!==false)this._listeners.push(k.listen(t,'mouseenter',r(this.adjustGripper,this)),k.listen(t,'mouseenter',r(this.showScrollbar,this)),k.listen(t,'mousemove',this._handleMousemove.bind(this)),k.listen(t,'mouseout',r(this.hideScrollbar,this)));if(u.fade!==undefined)this._listeners.push(k.listen(this._track,'click',this.clickToScroll.bind(this)));if(u.verticalscroll)this._listeners.push(k.listen(this._wrap,'mousewheel',this.mouseWheel.bind(this)),k.listen(this._wrap,'DOMMouseScroll',this.mouseWheel.bind(this)));this.initDrag();if(!u.persistent)l.onLeave(this.destroy.bind(this));},initDrag:function(){var t=new m(this._gripper);t.subscribe('start',function(u,event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;this.inform('dragstart');var v=o.getEventPosition(event).x,w=this._gripper.offsetLeft,x=t.subscribe('update',function(z,aa){var ba=o.getEventPosition(aa).x-v,ca=this._elem.clientWidth,da=this._body.offsetWidth,ea=this._track.offsetWidth,fa=ca/da*ea,ga=da-this._wrap.offsetWidth,ha=w+ba,ia=ea-fa;ha=Math.max(Math.min(ha,ia),0);var ja=ha/ia*ga;this._wrap.scrollLeft=ja;}.bind(this)),y=t.subscribe('end',function(){t.unsubscribe(x);t.unsubscribe(y);this.inform('dragend');}.bind(this));}.bind(this));},adjustGripper:function(){var t=this._elem.clientWidth,u=this._body.offsetWidth,v=this._track.offsetWidth,w=t/u*v;if(w<v){n.set(this._gripper,'width',w+'px');var x=this._wrap.scrollLeft/u*v;n.set(this._gripper,'left',x+'px');i.show(this._gripper);}else i.hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function(){var t=this._wrap.scrollLeft,u=this._wrap.scrollWidth-this._wrap.clientWidth;i.conditionClass(this._elem,'contentBefore',t>0);i.conditionClass(this._elem,'contentAfter',t<u);},destroy:function(){this._listeners.forEach(function(t){t.remove();});this._listeners.length=0;},_handleMousemove:function(event){var t=o.getElementPosition(this._track).y,u=o.getElementDimensions(this._track).y;if(Math.abs(t+u/2-o.getEventPosition(event).y)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();},hideScrollbar:function(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=new g(this._track).from('opacity',1).to('opacity',0).duration(250).ondone(i.addClass.curry(this._track,'invisible_elem')).go();}.bind(this).defer(750);return this;},showScrollbar:function(t){if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this.adjustGripper();n.set(this._track,'opacity',1);i.removeClass(this._track,'invisible_elem');if(t!==false)this.hideScrollbar();return this;},clickToScroll:function(event){var t=o.getEventPosition(event).x,u=this._elem.clientWidth,v=this._body.offsetWidth,w=this._track.offsetWidth,x=u/v*w,y=o.getElementPosition(this._gripper);if(t>=y.x&&t<=y.x+x)return;var z=t<y.x?-1:1,aa=this._wrap.offsetWidth*.8*z;this.scrollBy(aa);},scrollBy:function(t){this.setScroll(this._wrap.scrollLeft+t);},setScroll:function(t){var u=this._body.offsetWidth-this._wrap.offsetWidth,v=t;v=Math.max(Math.min(v,u),0);this._wrap.scrollLeft=v;},scrollIntoView:function(t){var u=this._wrap.clientWidth,v=t.offsetWidth,w=this._wrap.scrollLeft,x=w+u,y=t.offsetLeft,z=y+v;if(y<w||u<v){this.setScroll(y);}else if(z>x)this.setScroll(w+(z-x));},mouseWheel:function(event){var t=0;if(event.wheelDelta){var u=event.wheelDelta;if(event.wheelDeltaX&&event.wheelDeltaY)u=Math.abs(event.wheelDeltaX)>Math.abs(event.wheelDeltaY)?event.wheelDeltaX:event.wheelDeltaY;t=-u*10/40;}else if(event.detail)t=event.detail*10;this.scrollBy(t);event.prevent();}});e.exports=a.TimelineMapScrollableArea||s;});
__d("VaultEditableGrid",["Event","Arbiter","AsyncRequest","CSS","DOM","$","copyProperties","csx","ge","removeFromArray"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('DOM'),l=b('$'),m=b('copyProperties'),n=b('csx'),o=b('ge'),p=b('removeFromArray'),q={};function r(s,t){q[s.id]=this;this._grid=s;this._gridID=s.id;this._dialogEndpoint=t;this._selectedVaultImageIDs=[];h.subscribe('multi-upload/image-removed/'+this._gridID,function(u,v){p(this._selectedVaultImageIDs,v);}.bind(this));h.subscribe('multi-upload/composer-reset/'+this._gridID,this.removeImages.bind(this));h.inform('fbVaultEditableGrid/created/'+s.id,this,h.BEHAVIOR_PERSISTENT);h.subscribe('multi-upload/images-upload-start/'+this._gridID,this._scrollToRight.bind(this));}m(r,{VAULT_IMAGE:'vault_image',getInstance:function(s){return q[s];},registerDialogWithGrid:function(s,t,u){h.subscribe(['multi-upload/images-upload-start/'+s,'multi-upload/video-added/'+s],u.hide.bind(u));h.subscribe('fbVaultEditableGrid/created/'+s,function(v,w){w._registerDialogWithGrid(t,u);});},onImagesSelected:function(s,t,u){q[s]._onImagesSelected(t,u);}});m(r.prototype,{getRoot:function(){var s=o(this._gridID);if(s){return s;}else return this._grid;},_registerDialogWithGrid:function(s,t){this._dialog=t;var u=this.getMoreLink();u&&g.listen(u,'click',function(){t.show();return false;});t.subscribe('aftershow',function(){var v=[];k.scry(l(this._gridID),'input[type="hidden"]').forEach(function(x){if(x.name.match('composer_vault_images')||x.name.match('composer_unpublished_photo'))v.push(x.value);});var w=s.getGrid();w.bulkChange(function(){var x=w.getSelectionSet();x.clear();x.addAll(v);});}.bind(this));},getID:function(){return this._gridID;},_onImagesSelected:function(s,t){var u=k.find(this.getRoot(),"._577");this.removeImages();this._selectedVaultImageIDs=t;s.forEach(function(v){k.insertBefore(u,v);});h.inform('multi-upload/images-added/'+this._gridID,{fbids:t});this._scrollToRight();},removeImages:function(){k.scry(this.getRoot(),'.fbVaultGridItem').forEach(function(s){if(!j.hasClass(s,'fbVaultEditableGridMoreLink'))k.remove(s);});this._selectedVaultImageIDs=[];h.inform('multi-upload/all-images-removed/'+this._gridID);},_scrollToRight:function(){var s=this.getRoot(),t=k.find(s,'.fbScrollableAreaWrap');t.scrollLeft=Math.max(0,k.find(s,'.fbScrollableAreaBody').offsetWidth-t.offsetWidth);},showDialog:function(s,t){if(this._dialog){this._dialog.show();}else i.bootstrap(this._dialogEndpoint,s);},getMoreLink:function(){return k.scry(this.getRoot(),'.fbVaultEditableGridMoreLink')[0];}});e.exports=r;});
__d("BasePhotoUploader",["Arbiter","ArbiterMixin","CSS","DOM","PhotosMultiUploadInput","VaultEditableGrid","TimelineMapScrollableArea","removeFromArray","mixin"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DOM'),k=b('PhotosMultiUploadInput'),l=b('VaultEditableGrid'),m=b('TimelineMapScrollableArea'),n=b('removeFromArray'),o=b("mixin"),p=o(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t,u){"use strict";new m(t,{verticalscroll:true});this.$BasePhotoUploader0=t;this.$BasePhotoUploader1=this.$BasePhotoUploader2();this.$BasePhotoUploader3=false;this.$BasePhotoUploader4=null;u.addSubscriptions(g.subscribe('multi-upload/images-added/'+this.$BasePhotoUploader0.id,function(v,w){this.$BasePhotoUploader1=this.$BasePhotoUploader1.concat(w.fbids);this.$BasePhotoUploader5();this.inform('upload-completed',{fbids:w.fbids});}.bind(this)),g.subscribe('multi-upload/image-removed/'+this.$BasePhotoUploader0.id,function(v,w){n(this.$BasePhotoUploader1,w);this.$BasePhotoUploader5();}.bind(this)),g.subscribe('multi-upload/images-upload-start/'+this.$BasePhotoUploader0.id,function(v,w){i.show(this.$BasePhotoUploader0);this.$BasePhotoUploader3=true;this.inform('dom-updated');this.inform('upload-started',w);}.bind(this)),g.subscribe('multi-upload/composer-reset/'+this.$BasePhotoUploader0.id,this.clear.bind(this)),g.subscribe('multi-upload/all-images-removed/'+this.$BasePhotoUploader0.id,this.$BasePhotoUploader6.bind(this)),g.subscribe('multi-upload/images-upload-completed/'+this.$BasePhotoUploader0.id,function(v){this.$BasePhotoUploader3=false;this.inform('all-uploads-completed');}.bind(this)));i.conditionShow(this.$BasePhotoUploader0,this.$BasePhotoUploader1.length);}s.prototype.getSelectedFBIDs=function(){"use strict";return this.$BasePhotoUploader1;};s.prototype.isUploading=function(){"use strict";return this.$BasePhotoUploader3;};s.prototype.clear=function(){"use strict";var t=l.getInstance(this.$BasePhotoUploader0.id);t&&t.removeImages();};s.prototype.getWaterfallID=function(){"use strict";return k.getWaterfallID(this.$BasePhotoUploader0.id);};s.prototype.$BasePhotoUploader6=function(){"use strict";this.$BasePhotoUploader1=[];this.$BasePhotoUploader3=false;i.hide(this.$BasePhotoUploader0);this.inform('all-uploads-completed');this.inform('dom-updated');};s.prototype.$BasePhotoUploader2=function(){"use strict";var t=[];j.scry(this.$BasePhotoUploader0,'input[type="hidden"]').forEach(function(u){if(u.name.match('composer_vault_images'))t.push(u.value);});return t;};s.prototype.$BasePhotoUploader5=function(){"use strict";i.conditionShow(this.$BasePhotoUploader0,this.$BasePhotoUploader1.length>0);this.inform('dom-updated');};s.prototype.setCurrentMethod=function(t){"use strict";this.$BasePhotoUploader4=t;};s.prototype.getCurrentMethod=function(){"use strict";return this.$BasePhotoUploader4;};e.exports=s;});
__d("MercuryPhotoUploader",["Arbiter","AsyncRequest","copyProperties","DOM","FileInput","Parent","PhotosMultiUploadInput","PUWMethods","VaultEditableGrid","Focus","csx","cx","Event","BasePhotoUploader"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('DOM'),k=b('FileInput'),l=b('Parent'),m=b('PhotosMultiUploadInput'),n=b('PUWMethods'),o=b('VaultEditableGrid'),p=b('Focus'),q=b('csx'),r=b('cx'),s=b('Event'),t=b('BasePhotoUploader');for(var u in t)if(t.hasOwnProperty(u))w[u]=t[u];var v=t===null?null:t.prototype;w.prototype=Object.create(v);w.prototype.constructor=w;w.__superConstructor__=t;function w(x,y,z,aa){"use strict";t.call(this,x,z);this.$MercuryPhotoUploader0=x.id;this.$MercuryPhotoUploader1=false;g.subscribe('PhotosMultiUploadInput/loaded/'+x.id,function(){this.$MercuryPhotoUploader1=true;}.bind(this));g.subscribe('MercuryPhotoUploader/initUploadButton/'+x.id,function(){var ba=j.scry(y,'input[type="file"]')[0];if(!ba)ba=j.create('input',{accept:'image/*',type:'file',className:"_n",name:'composer_unpublished_photo[]',multiple:1});var ca=l.byClass(y,"_9_h"),da=new k(ca,j.find(ca,"._214"),ba);da.subscribe('change',m.doFileUpload.curry(x.id,da));});g.subscribe('MercuryPhotoUploader/registerPhotoMenu/'+x.id,function(ba,ca){var da=ca.menu.getRoot();ca.menu.setContext(y);var ea=j.scry(da,"._d2p"),fa=ea&&ea[0];fa&&s.listen(fa,'click',function(){o.getInstance(x.id).showDialog(fa,o.VAULT_IMAGE);this.setCurrentMethod(n.VAULT);this.inform('selection-start',{method:n.VAULT});}.bind(this));s.listen(y,'click',function(){if(!this.$MercuryPhotoUploader1)return;if(!ca.menu.isShown()){var ha=j.scry(ca.menu.getContentRoot(),'li');this.inform('menu-show');ca.menu.show();if(ha)p.setWithoutOutline(ha[0]);}else{this.inform('menu-hide');ca.menu.hide();}}.bind(this));s.listen(document.documentElement,'click',function(event){if(!j.contains(y,event.getTarget())&&!j.contains(fa,event.getTarget())){if(ca.menu.isShown())this.inform('menu-hide');ca.menu.hide();}}.bind(this));var ga=j.find(da,"._9_h");s.listen(ga,'click',function(){this.setCurrentMethod(n.FILE_SELECTOR);this.inform('selection-start',{method:n.FILE_SELECTOR});}.bind(this));}.bind(this));aa&&m.initDragDrop(x.id,aa);}w.prototype.addCachedPhotos=function(x){"use strict";h.post('/ajax/vault/selected.php',{max_select:10,grid_id:this.$MercuryPhotoUploader0,source:'messenger',image_ids:x});};i(w,{initUploadButton:function(x){g.inform('MercuryPhotoUploader/initUploadButton/'+x,{},g.BEHAVIOR_PERSISTENT);},registerPhotoMenu:function(x,y){g.inform('MercuryPhotoUploader/registerPhotoMenu/'+x,{menu:y},g.BEHAVIOR_PERSISTENT);}});e.exports=w;});
__d("MercuryDrafts",["CacheStorage","MercurySingletonMixin","copyProperties","isEmpty"],function(a,b,c,d,e,f){var g=b('CacheStorage'),h=b('MercurySingletonMixin'),i=b('copyProperties'),j=b('isEmpty');function k(l){"use strict";this.$MercuryDrafts0=l;this.$MercuryDrafts1=new g('localstorage','mercury-drafts:'+this.$MercuryDrafts0);}k.prototype.saveDraft=function(l,m){"use strict";if(this.isMessageEmpty(m)){this.removeDraft(l);}else this.$MercuryDrafts1.set(l,this.$MercuryDrafts2(l,m));};k.prototype.removeDraft=function(l){"use strict";this.$MercuryDrafts1.remove(l);};k.prototype.getDraft=function(l){"use strict";var m=this.$MercuryDrafts1.get(l,{});return m.message;};k.prototype.isMessageEmpty=function(l){"use strict";return j(l)||(j(l.body)&&j(l.content_attachment)&&j(l.raw_attachments)&&j(l.photo_fbids)&&j(l.image_ids));};k.prototype.$MercuryDrafts2=function(l,m){"use strict";return {thread_id:l,message:m};};i(k,h);e.exports=k;});
__d("MercuryDraftsController",["MercuryDrafts","Input","MercuryConfig","MercurySingletonMixin","copyProperties","isEmpty"],function(a,b,c,d,e,f){var g=b('MercuryDrafts').get(),h=b('Input'),i=b('MercuryConfig'),j=b('MercurySingletonMixin'),k=b('copyProperties'),l=b('isEmpty');function m(n){"use strict";this.$MercuryDraftsController0;}m.prototype.clearDraft=function(n){"use strict";if(this.canSaveDrafts(n))g.removeDraft(n);};m.prototype.saveDraft=function(n,o,p,q,r){"use strict";if(!this.canSaveDrafts(n))return;var s={body:h.getValue(o)};if(!l(p.getAttachments())){s.has_attachment=true;s.raw_attachments=p.getAttachments();}if(!l(p.getImageFiles())){s.has_attachment=true;s.image_ids=p.getImageFiles();}if(r&&!l(r.getSelectedFBIDs())){s.has_attachment=true;s.photo_fbids=r.getSelectedFBIDs();}if(q.getAttachData()){s.has_attachment=true;s.content_attachment=q.getAttachData();}g.saveDraft(n,s);};m.prototype.loadDraft=function(n,o,p,q,r){"use strict";if(!this.canSaveDrafts(n)||this.$MercuryDraftsController1(o,p,q,r))return;var s=g.getDraft(n);if(!l(s)){if(s.body){o.focus();h.setValue(o,s.body);}if(!l(s.raw_attachments))p.addCachedAttachments(s.raw_attachments);if(!l(s.image_ids))p.addCachedImageFiles(s.image_ids);if(!l(s.content_attachment))q.loadShare(s.content_attachment.attachment.params.url);if(r&&!l(s.photo_fbids))r.addCachedPhotos(s.photo_fbids);}};m.prototype.canSaveDrafts=function(n){"use strict";return !!(i.ChatSaveDraftsGK&&n);};m.prototype.$MercuryDraftsController1=function(n,o,p,q){"use strict";return !h.isEmpty(n)||!l(o.getAttachments())||!l(o.getImageFiles())||(q&&!l(q.getSelectedFBIDs()))||p.getAttachData();};m.prototype.toString=function(){"use strict";return '[object MercuryDraftsController:'+this.$MercuryDraftsController0+']';};k(m,j);e.exports=m;});
__d("WebMessengerStateConstants",[],function(a,b,c,d,e,f){var g={STATE_CHANGE_EVENT:'state-changed',DETAIL:{COMPOSE_MAIN:'compose-main',COMPOSE_TYPEAHEAD_RESULTS:'compose-typeahead-results',COMPOSE_ALL_PEOPLE_RESULTS:'compose-all-people-results',RECENT_MESSAGES:'recent-messages',SEARCH_CONTEXT:'search-context',SEARCH_SNIPPET:'search-snippet',SEARCH_THREAD_SNIPPET:'search-thread-snippet',SHARED_PHOTOS:'shared-photos'},MASTER:{RECENT_THREADS:'recent-threads',SEARCH:'search'},MESSAGE_ACTION:{DELETE:'delete',FORWARD:'forward',REPORT_SPAM:'report_spam'}};e.exports=g;});
__d("WebMessengerStateStore",["MercuryAssert","PresenceState"],function(a,b,c,d,e,f){var g=b('MercuryAssert'),h=b('PresenceState'),i=null;function j(){var l=h.get();if(l&&l.wml)return l.wml;return {};}h.registerStateStorer(function(l){if(i)l.wml=i;i=null;});var k={getLastSeenThreadID:function(){var l=j();return l.thread_id||null;},getLastSeenFolder:function(){var l=j();return l.folder||null;},setLastSeen:function(l,m){m&&g.isThreadID(m);i={folder:l,thread_id:m||null};h.doSync();}};e.exports=k;});
__d("WebMessengerPermalinks",["MercuryAPIArgsSource","MercuryFilters","MercuryIDs","MercuryParticipants","MercuryParticipantTypes","MessagingTag","WebMessengerOldToNewPermalink","WebMessengerPermalinkConstants","MercuryServerRequests","WebMessengerStateConstants","WebMessengerStateStore","MercuryThreads","Token","URI","WebMessengerConstants","WebMessengerPreferences","MercuryUnreadState","isWebMessengerURI","goURI"],function(a,b,c,d,e,f){var g=b('MercuryAPIArgsSource'),h=b('MercuryFilters'),i=b('MercuryIDs'),j=b('MercuryParticipants'),k=b('MercuryParticipantTypes'),l=b('MessagingTag'),m=b('WebMessengerOldToNewPermalink'),n=b('WebMessengerPermalinkConstants'),o=b('MercuryServerRequests').get(),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateStore'),r=b('MercuryThreads').get(),s=b('Token'),t=b('URI'),u=b('WebMessengerConstants'),v=b('WebMessengerPreferences'),w=b('MercuryUnreadState'),x=b('isWebMessengerURI'),y=b('goURI'),z='(/|\\?|$)',aa={getDefaultURI:function(){var na=new t().setSubdomain('www');na.setPath(n.BASE_PATH);return na;},goNextURI:function(na,oa,pa,qa){if(ja(na,oa,pa)){var ra=aa.getURI(na,oa,pa);y(ra,false,qa);return true;}return false;},getURI:function(na,oa,pa){var qa=aa.getDefaultURI();if(!na||!oa||!pa)return qa;switch(pa.folder){case l.OTHER:qa.setPath(n.OTHER_PATH);break;case l.ACTION_ARCHIVED:qa.setPath(n.ARCHIVED_PATH);break;case l.SPAM:qa.setPath(n.SPAM_PATH);break;}if(pa.filter&&(pa.filter!=h.ALL))qa.addQueryData({filter:pa.filter});var ra;switch(na){case p.MASTER.SEARCH:ra=false;qa.setPath(qa.getPath()+n.SEARCH_POSTFIX_PATH);break;}switch(oa){case p.DETAIL.COMPOSE_MAIN:case p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case p.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:qa.setPath(qa.getPath()+n.COMPOSE_POSTFIX_PATH);ra=false;break;case p.DETAIL.RECENT_MESSAGES:ra=!pa.thread_id;break;case p.DETAIL.SEARCH_CONTEXT:case p.DETAIL.SHARED_PHOTOS:ra=false;break;default:ra=true;break;}if(ra)qa.addQueryData({action:oa});if(pa.thread_id){var sa=r.getCanonicalUserInThread(pa.thread_id),ta=sa&&j.getNow(j.getIDForUser(sa));if(ta&&ta.type!==k.EVENT){var ua=(ta&&ta.vanity)||sa;qa.setPath(n.getURIPathForIDOrVanity(ua,qa.getPath()));}else{var va=o.getServerThreadIDNow(pa.thread_id),wa=va?va:pa.thread_id;qa.setPath(n.getURIPathForThreadID(wa,qa.getPath()));}}if(pa.query)qa.addQueryData({query:pa.query});if(pa.message_query)qa.addQueryData({mquery:pa.message_query});if(pa.message_id)qa.addQueryData({mid:pa.message_id});if(pa.reuse_composer)qa.addQueryData({rc:true});return qa;},processURI:function(na){na=m(na);if(!x(na))return false;var oa=ka(na);if(!oa.master_state||!oa.detail_state)return la(na);var pa={data:{folder:ha(na),filter:ia(na)},redirect:false,master_state:oa.master_state,detail_state:oa.detail_state};if(na.getQueryData().rc)pa.data.reuse_composer=true;pa=ea(na,pa);switch(oa.detail_state){case p.DETAIL.RECENT_MESSAGES:return ga(na,pa);case p.DETAIL.COMPOSE_MAIN:return ba(na,pa);case p.DETAIL.SEARCH_SNIPPET:pa=fa(na,pa);return pa;case p.DETAIL.SEARCH_CONTEXT:pa=ga(na,pa);pa=fa(na,pa);return da(na,pa);}pa.redirect=true;return pa;}};function ba(na,oa){var pa=null;if(na.getQueryData().to)pa=[].concat(na.getQueryData().to);return ca(pa,oa);}function ca(na,oa){if(na){oa.data.new_tokens=[];na.forEach(function(pa){var qa=j.getNow(j.getIDForUser(pa));if(qa){var ra={uid:pa,text:qa.name,type:u.USER_TYPE};oa.data.new_tokens.push(new s(ra));}});}oa.data.start=true;return oa;}function da(na,oa){var pa=na.getQueryData().mid;if(pa){oa.data.message_id=pa;}else oa.redirect=true;return oa;}function ea(na,oa){var pa=na.getQueryData().query;oa.data.query=pa;return oa;}function fa(na,oa){var pa=na.getQueryData().mquery;oa.data.message_query=pa;return oa;}function ga(na,oa){var pa=n.getThreadIDFromURI(na);if(pa){var qa=i.isValidThreadID(pa)?pa:o.getClientThreadIDNow(pa);if(qa){oa.data.thread_id=qa;}else oa.redirect=true;}else{var ra=n.getUserIDOrVanity(na.getPath());if(ra){var sa=j.getIDFromVanityOrFBID(ra),ta=sa&&r.getCanonicalThreadToParticipant(sa,null,g.WEBMESSENGER);if(ta){if(ta.timestamp){oa.data.thread_id=ta.thread_id;}else{oa.detail_state=p.DETAIL.COMPOSE_MAIN;oa=ca([j.getUserID(sa)],oa);}}else oa.redirect=true;}}return oa;}function ha(na,oa){var pa=na.getPath();if(pa.match('^'+n.ARCHIVED_PATH+z))return l.ACTION_ARCHIVED;if(pa.match('^'+n.OTHER_PATH+z))return l.OTHER;if(pa.match('^'+n.SPAM_PATH+z))return l.SPAM;if(oa!==undefined)return oa;return l.INBOX;}function ia(na){return na.getQueryData().filter||h.ALL;}function ja(na,oa,pa){if(oa===p.DETAIL.SEARCH_CONTEXT||oa===p.DETAIL.SEARCH_THREAD_SNIPPET||oa===p.DETAIL.SHARED_PHOTOS)return false;if(pa&&pa.no_uri===true){delete pa.no_uri;return false;}var qa=oa==p.DETAIL.COMPOSE_MAIN||oa==p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||oa==p.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(qa&&(!pa.start||pa.new_tokens))return false;if(!na||!oa||!pa)return true;if(pa.bug_reporting_enabled)return false;return !pa.message_action;}function ka(na){var oa={},pa=na.getPath(),qa=na.getQueryData(),ra=pa.match(n.BASE_PATH+'(/[^/]+)?'+n.SEARCH_POSTFIX_PATH+z);oa.master_state=ra&&qa.query?p.MASTER.SEARCH:p.MASTER.RECENT_THREADS;if(qa.action){oa.detail_state=qa.action;return oa;}if(pa.match(n.BASE_PATH+'(/[^/]+)?'+n.COMPOSE_POSTFIX_PATH+z)){oa.detail_state=p.DETAIL.COMPOSE_MAIN;return oa;}if(pa.match(n.TID_POSTFIX_PARTIAL_PATH)||n.getUserIDOrVanity(pa)){if(qa.mid&&qa.mquery){oa.detail_state=p.DETAIL.SEARCH_CONTEXT;}else oa.detail_state=p.DETAIL.RECENT_MESSAGES;}else if(qa.mquery)oa.detail_state=p.DETAIL.SEARCH_SNIPPET;return oa;}function la(na){var oa=ha(na,null)||q.getLastSeenFolder(),pa=q.getLastSeenThreadID()||ma(oa||l.INBOX),qa=w.get();if(oa===l.OTHER&&qa.getUnreadCount(oa)===0){var ra=l.INBOX;if(qa.exceedsMaxCount(ra)||qa.getUnreadCount(ra)>0)oa=ra;}var sa={redirect:!!pa||!!oa,replace:true,master_state:p.MASTER.RECENT_THREADS,detail_state:p.DETAIL.RECENT_MESSAGES,data:{folder:oa||l.INBOX,filter:h.ALL,thread_id:pa}};return sa;}function ma(na){var oa=v.lastReadThreadForFolder[na];if(oa){return o.getClientThreadIDNow(oa.thread_id)||null;}else return null;}e.exports=aa;});
__d("WebMessengerStateManager",["Arbiter","Dialog","Env","Focus","JSLogger","MercuryFilters","WebMessengerPermalinks","WebMessengerStateConstants","MessagingTag","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Dialog'),i=b('Env'),j=b('Focus'),k=b('JSLogger'),l=b('MercuryFilters'),m=b('WebMessengerPermalinks'),n=b('WebMessengerStateConstants'),o=b('MessagingTag'),p=b('copyProperties'),q=k.create('wm_state_manager'),r=i.user,s=p(new g(),{getCurrentUserID:function(){return r;},getCurrentMasterState:function(){return v;},getCurrentDetailState:function(){return w;},getCurrentStateData:function(){return x;},setUserID:function(z){r=z||i.user;},updateMasterState:function(z,aa){s.updateAllStates(z,w,aa);},updateDetailState:function(z,aa){s.updateAllStates(v,z,aa);},updateAllStates:function(z,aa,ba){for(var ca=0;ca<y.length;ca++)if(y[ca]){var da=y[ca](z,aa,ba);if(da){q.log('confirmation_dialog',{master_state:v,detail_state:w,data:x,new_master_state:z,new_detail_state:aa,new_data:ba});da.setHandler(t.curry(z,aa,ba)).show();var ea=da.getButtonElement(h.OK.label);ea&&j.set(ea);return;}}t(z,aa,ba);},updateStateOnURI:function(z,aa,ba){u(z,aa,ba);},registerConfirmationBeforeStateUpdate:function(z){var aa=y.length;y.push(z);return aa;},unregisterConfirmationBeforeStateUpdate:function(z){delete y[z];}});function t(z,aa,ba){if(!ba.folder)ba.folder=x.folder;if(!ba.filter)ba.filter=x.filter;if(!m.goNextURI(z,aa,ba))u(z,aa,ba);}function u(z,aa,ba){v=z;w=aa;x=ba;var ca=p({},x);ca.new_tokens=[];(x.new_tokens||[]).forEach(function(da){ca.new_tokens.push(da.getInfo());});ca.new_tokens=[];q.log('state_updated',{master_state:v,detail_state:w,data:ca});s.inform(n.STATE_CHANGE_EVENT);}var v=n.MASTER.RECENT_THREADS,w=n.DETAIL.RECENT_MESSAGES,x={thread_id:null,folder:o.INBOX,filter:l.ALL},y=[undefined];e.exports=s;});
__d("WebMessengerMercury",["MercuryMessages","MercuryOrderedThreadlist","MercuryServerRequests","WebMessengerStateManager","MercuryThreadInformer","MercuryThreads","MercuryUnreadState","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('MercuryMessages'),h=b('MercuryOrderedThreadlist'),i=b('MercuryServerRequests'),j=b('WebMessengerStateManager'),k=b('MercuryThreadInformer'),l=b('MercuryThreads'),m=b('MercuryUnreadState'),n=b('MercuryUnseenState'),o={getMessages:function(){return g.getForFBID(p());},getOrderedThreadlist:function(){return h.getForFBID(p());},getServerRequests:function(){return i.getForFBID(p());},getThreadInformer:function(){return k.getForFBID(p());},getThreads:function(){return l.getForFBID(p());},getUnreadState:function(){return m.getForFBID(p());},getUnseenState:function(){return n.getForFBID(p());}};function p(){return j.getCurrentUserID();}e.exports=o;});
__d("WebMessengerThreadMessagesAgent",["MercuryAPIArgsSource","MercuryMessages","MessagingTag","MercuryOrderedThreadlist","MercuryThreadInformer","MercuryThreads","WebMessengerConstants"],function(a,b,c,d,e,f){var g=b('MercuryAPIArgsSource'),h=b('MercuryMessages').get(),i=b('MessagingTag'),j=b('MercuryOrderedThreadlist').get(),k=b('MercuryThreadInformer').get(),l=b('MercuryThreads').get(),m=b('WebMessengerConstants'),n=21,o=false,p='n_inbox_n_unreads',q=m.THREADLIST_MAX_READ_PRELOAD_NUM,r=m.THREADLIST_MAX_UNREAD_PRELOAD_NUM;function s(){"use strict";this._active=true;this._iterative=o;this._strategy=p;this._requestInFlight=false;this._requestIsQueued=false;this._pendingThreadIds={};this._processedThreadIds={};this._threadInformerSubscriptions=[];this._threadInformerSubscriptions.push(k.subscribe('threadlist-updated',t.curry(this)));}s.prototype.turnOn=function(){"use strict";this._active=true;};s.prototype.turnOff=function(){"use strict";this._active=false;};s.prototype.destroy=function(){"use strict";this._threadInformerSubscriptions.forEach(k.unsubscribe);this._threadInformerSubscriptions=[];};function t(w){if(w._active&&!w._requestIsQueued){if(w._requestInFlight){w._requestIsQueued=true;return;}var x=u(w);if(x.length){w._requestInFlight=true;if(x.length>n){x=x.slice(0,n);w._requestIsQueued=true;}}x.forEach(function(y){w._processedThreadIds[y]=true;w._pendingThreadIds[y]=true;h.getThreadMessagesRange(y,0,m.INITIAL_MESSAGES_LIMIT+1,function(){v(w,y);},null,g.WEBMESSENGER);});}}function u(w){var x=j.getThreadlistUntilTimestamp(0,i.INBOX),y=x.filter(function(da){return !w._processedThreadIds[da]&&!h.hasLoadedNMessages(da,m.INITIAL_MESSAGES_LIMIT+1);});if(w._strategy===p){var z=[],aa=[];for(var ba=0;ba<y.length;ba++){var ca=l.getThreadMetaNow(y[ba]);if(ca){if(ca.unread_count&&aa.length<r)aa.push(y[ba]);if(!ca.unread_count&&z.length<q)z.push(y[ba]);if(aa.length>=r&&z.length>=q)break;}}y=z.concat(aa);}return y;}function v(w,x){if(w._pendingThreadIds[x])delete w._pendingThreadIds[x];if(Object.keys(w._pendingThreadIds).length===0){if(!w._iterative)w._active=false;w._requestInFlight=false;if(w._requestIsQueued){w._requestIsQueued=false;t(w);}}}e.exports=s;});
__d("WebMessengerAdsControl",["Arbiter","CSS","DOM","EgoAdsObjectSet","Env","Event","KeyedCallbackManager","MercuryParticipants","UIPagelet","URI","UserActivity","Vector","WebMessengerStateManager","cx","shield","MercuryThreads","WebMessengerSubscriptionsHandler","copyProperties","csx","throttle","WebMessengerConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('EgoAdsObjectSet'),k=b('Env'),l=b('Event'),m=b('KeyedCallbackManager'),n=b('MercuryParticipants'),o=b('UIPagelet'),p=b('URI'),q=b('UserActivity'),r=b('Vector'),s=b('WebMessengerStateManager'),t=b('cx'),u=b('shield'),v=b('MercuryThreads').get(),w=b('WebMessengerSubscriptionsHandler'),x=b('copyProperties'),t=b('cx'),y=b('csx'),z=b('throttle'),aa=b('WebMessengerConstants'),ba=aa.ADS_ROTATION_INTERVAL_PASSIVE,ca=aa.ADS_ROTATION_THRESHOLD_ACTIVE,da=aa.MAX_ADS,ea=2,fa=165,ga='data-height',ha=new m(),ia='webMessengerAdsStage',ja=0;function ka(){}x(ka,{init:function(){this._ads=new j();this._initializedAds=false;this._loadingCount=null;this._stage=null;this._drawCount=0;this._lastRefresh=0;this._pageletInProgress=null;this._lastMousedOnAds=false;this._waitOn(['codes','container','sidebar','footer'],this.start.bind(this));w.addSubscriptions(q.subscribe(u(this._refreshIfReady,this)),g.subscribe('footerLoaded',function(){ha.setResource('footer',1);}),g.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide'],this._sideBarChanged.bind(this)),ha);return this;},setContainer:function(ra){ha.setResource('container',ra);this._container=ra;},setTrackingCodes:function(ra){ha.setResource('codes',ra);},getTrackingCodes:function(){return ha.getResource('codes');},start:function(){this._stage=i.create('div',{id:ia,className:"_2rn"});this._ego=i.find(this._container,"._81");i.insertAfter(this._ego,this._stage);this._updateFooterHeight();this.waitForAdsLoad(this._container,this._processOnPageUnits.bind(this));w.addSubscriptions(l.listen(window,'resize',z(this.draw,100,this)),l.listen(this._ego,'mouseenter',u(this._mouseEvent,this,true)),l.listen(this._ego,'mouseleave',u(this._mouseEvent,this,false)));},stateChanged:function(ra,sa){ra=ra||{};sa=sa||{};if(ra.thread_id&&sa.thread_id&&sa.thread_id!==ra.thread_id)this._refreshIfReady(true);},draw:function(){var ra=this._loadingCount<=0;if(!this._initializedAds||!this._drawCount&&!ra)return;this._adjustAdsToFit();},_processOnPageUnits:function(){this._ads.init(pa(this._ego));this._initializedAds=true;this._adjustAdsToFit();},_processStagedUnits:function(){this._pageletInProgress=false;var ra=pa(this._stage);if(!this._lastMousedOnAds&&ra.length&&!this._focusedOnAds()){i.empty(this._ego);while(this._stage.childNodes.length)i.appendContent(this._ego,this._stage.firstChild);this._ads.init(ra);this._lastRefresh=Date.now();this._adjustAdsToFit();}},waitForAdsLoad:function(ra,sa){var ta=pa(ra);this._loadingCount=ta.length;if(!this._loadingCount){this._lastRefresh=Date.now()-ba/2;this._pageletInProgress=false;return;}var ua=function(va){oa(va);if(--this._loadingCount<=0)sa();}.bind(this);ta.forEach(function(va){function wa(){ua.curry(va).defer();}var xa=i.scry(va,'img.img')[0];if(!xa||xa.complete){wa();}else l.listen(xa,{load:wa,error:wa,abort:wa});}.bind(this));},_adjustAdsToFit:function(){this._drawCount++;var ra=r.getViewportDimensions().y,sa=ra-this._footerHeight-fa,ta=sa,ua=0;while(ta>0&&ua<this._ads.getCount()){ta-=na(this._ads.getUnit(ua));if(ta>=0)ua++;}ua=Math.max(ua,ea);for(var va=0;va<this._ads.getCount();va++)ma(this._ads.getUnit(va),va>=ua);h.conditionShow(this._ego,ua);h.addClass(this._ads.getUnit(0),'ego_unit_no_top_border');var wa=i.scry(this._container,'.ego_section');wa.forEach(function(xa){la(xa,i.scry(xa,'[data-onscreen]').length);});la(this._container,true);this._registerImpressions(ua);this._registerHoldoutImpressions(sa);},_waitOn:function(ra,sa){ha.executeOrEnqueue(ra,sa);},_mouseEvent:function(ra){this._lastMousedOnAds=ra;},_focusedOnAds:function(){return i.contains(this._container,document.activeElement);},_refreshIfReady:function(ra){var sa=ra?ca:ba;if(this._lastRefresh===0){this._lastRefresh=Date.now();return;}else if(this._pageletInProgress||!this._drawCount||this._lastMousedOnAds||this._focusedOnAds()||this._lastRefresh+sa>Date.now())return;ha.reset();this._waitOn(['codes'],this.waitForAdsLoad.bind(this,this._stage,this._processStagedUnits.bind(this)));this._pageletInProgress=o.loadFromEndpoint('WebEgoPane',ia,{pid:43,data:[k.user,da,++ja,qa()]},{crossPage:true,bundle:false});},_updateFooterHeight:function(){h.hide(this._ego);this._footerHeight=r.getElementDimensions(this._container).y;h.show(this._ego);},_registerImpression:function(ra){var sa=this.getTrackingCodes();if(!sa||!sa[ra])return;var ta=i.create('iframe',{src:p('/ai.php').addQueryData({aed:sa[ra]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});ta.setAttribute('aria-hidden','true');i.appendContent(this._container,ta);delete sa[ra];},_registerImpressions:function(ra){for(var sa=ra-1;sa>=0;--sa){if(!this._ads.getUnit(sa))continue;var ta=i.scry(this._ads.getUnit(sa),"div._4u8");if(!ta.length)continue;var ua=ta[0].getAttribute('data-ad'),va=JSON.parse(ua).adid,wa=this.getTrackingCodes();if(!wa||!wa[va])return;this._registerImpression(va);}},_registerHoldoutImpressions:function(ra){var sa=this._ads.getHoldoutAdIDsForSpace(ra,na);if(sa)sa.forEach(this._registerImpression.bind(this));},_sideBarChanged:function(ra,sa){if(ra=='sidebar/initialized')ha.setResource('sidebar',1);this._initializedAds&&this.draw();}});function la(ra,sa){h.conditionClass(ra,"_2rn",!sa);}function ma(ra,sa){h.conditionClass(ra,"_22r",sa);ra.setAttribute('aria-hidden',sa?'true':'false');if(sa){ra.removeAttribute('data-onscreen');}else ra.setAttribute('data-onscreen','1');}function na(ra){if(!ra)return 0;var sa=ra.getAttribute(ga)||oa(ra);return parseInt(sa,10);}function oa(ra){var sa=r.getElementDimensions(ra).y;ra.setAttribute(ga,sa);return sa;}function pa(ra){return i.scry(ra,'div.ego_unit');}function qa(){var ra=s.getCurrentStateData();if(ra.thread_id){var sa=v.getThreadMetaNow(ra.thread_id);if(sa)return sa.participants.map(n.getUserID).filter(function(ta){return ta&&ta!=k.user;});}return [];}e.exports=ka;});
__d("MercuryDataSources",[],function(a,b,c,d,e,f){var g={},h={add:function(i,j){g[i]=j;},get:function(i){!g[i];return g[i];}};e.exports=h;});
__d("MercuryTypeaheadRenderer",["Event","CSS","MercuryConstants","DOM","Image.react","MercuryParticipantsConstants","React","MercuryTypeaheadTemplates","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('MercuryConstants'),j=b('DOM'),k=b('Image.react'),l=b('MercuryParticipantsConstants'),m=b('React'),n=b('MercuryTypeaheadTemplates'),o=b('copyProperties'),p=b('cx');function q(s,t){var u=i.MercuryTypeaheadConstants,v;switch(s.type){case u.HEADER_TYPE:v=n[':fb:mercury:typeahead:header'].build();q.renderHeader(v,s);break;case u.USER_TYPE:v=n[':fb:mercury:typeahead:result'].build();q.renderPerson(v,s);break;default:throw new Error('Unsupported result type: '+s.type);}return v.getRoot();}o(q,{renderHeader:function(s,t){if(t.disabled){h.hide(s.getRoot());return;}var u=t.getLinkHandler&&t.getLinkHandler();if(u){var v=s.getNode('link');j.setContent(v,t.linkText);g.listen(v,'click',u);}else h.hide(s.getNode('link'));s.setNodeContent('text',t.text);},renderPersonWithBigPhoto:function(s,t){r(s,t,l.BIG_IMAGE_SIZE);},renderPerson:function(s,t){r(s,t,l.IMAGE_SIZE);}});function r(s,t,u){if(t.photo){var v=k({width:u,height:u,src:t.photo});m.renderComponent(v,s.getNode('image'));}if(t.text){j.setContent(s.getNode('name'),t.text);s.getRoot().setAttribute('aria-label',t.text);}var w=[];if(t.subtext||t.category){if(t.subtext)w.push(t.subtext);if(t.category)w.push(t.category);j.appendContent(s.getNode('snippet'),w.join(" \u00b7 "));}if(t.non_employee){if(w.length)j.prependContent(s.getNode('snippet')," \u00b7 ");var x=j.create('span',{className:"_52l8 highlight"},'(Non-Employee)');j.prependContent(s.getNode('snippet'),x);}}e.exports=q;});
__d("WebMessengerAddPeopleToConversationDialog",["ContextualTypeaheadView","Dialog","DOM","MercuryAPIArgsSource","MercuryDataSources","MercuryLogMessageType","MercurySourceType","MercuryTypeahead","MercuryTypeaheadRenderer","MercuryMessages","WebMessengerTemplates","MercuryThreads","WebMessengerConstants","tx"],function(a,b,c,d,e,f){var g=b('ContextualTypeaheadView'),h=b('Dialog'),i=b('DOM'),j=b('MercuryAPIArgsSource'),k=b('MercuryDataSources'),l=b('MercuryLogMessageType'),m=b('MercurySourceType'),n=b('MercuryTypeahead'),o=b('MercuryTypeaheadRenderer'),p=b('MercuryMessages').get(),q=b('WebMessengerTemplates'),r=b('MercuryThreads').get(),s=b('WebMessengerConstants'),t=b('tx'),u={show:function(w){var x="Add People",y={};y[s.FRIEND_TYPE]={uid:s.FRIEND_TYPE,type:s.HEADER_TYPE,disabled:true};y[s.NON_FRIEND_TYPE]={uid:s.NON_FRIEND_TYPE,text:"Other People",type:s.HEADER_TYPE};var z=new n(k.get('MercuryRecipientsDataSource'),g);z.setViewOption('renderer',o);z.setViewOption('typeObjects',y);z.setPlaceholder("Add friends to this chat");var aa=[];aa.push({name:'subscribe',label:x,handler:v.bind(null,w,z)});aa.push(h.CANCEL);var ba=q[':fb:web-messenger:add-people-dialog'].build(),ca=new h().setTitle(x).setBody(ba.getRoot()).setButtons(aa).showLoading();r.getThreadMeta(w,function(da){z.setFullWidthView(ba.getNode('participantsTypeahead'));z.setExcludedParticipantsFromThreadMeta(da);z.build();i.appendContent(ba.getNode('participantsTypeahead'),z.getElement());ca.show();z.focus();},j.WEBMESSENGER);}};function v(w,x){var y=x.getTokens(),z=y.map(function(aa){if(aa.getInfo().type==s.USER_TYPE){return 'fbid:'+aa.getValue();}else return 'email:'+aa.getValue();});if(!z.length)return false;p.sendMessage(p.constructLogMessageObject(m.TITAN_WEB,w,l.SUBSCRIBE,{added_participants:z}),null,j.WEBMESSENGER);return true;}e.exports=u;});
__d("WebMessengerEditThreadDialog",["Event","Button","ContextualDialog","CSS","DOM","FileInput","FileInputUploader","Input","InputSelection","LayerFadeOnHide","LayerFadeOnShow","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryMessages","WebMessengerTemplates","MercuryThreads","URI","WebMessengerSubscriptionsHandler","csx","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Button'),i=b('ContextualDialog'),j=b('CSS'),k=b('DOM'),l=b('FileInput'),m=b('FileInputUploader'),n=b('Input'),o=b('InputSelection'),p=b('LayerFadeOnHide'),q=b('LayerFadeOnShow'),r=b('MercuryAPIArgsSource'),s=b('MercuryLogMessageType'),t=b('MercurySourceType'),u=b('MercuryMessages').get(),v=b('WebMessengerTemplates'),w=b('MercuryThreads').get(),x=b('URI'),y=b('WebMessengerSubscriptionsHandler'),z=b('csx'),aa=b('cx'),ba=':fb:web-messenger:read-view:header:edit-multichat';function ca(){"use strict";var da=v[ba].build();this._dialog=new i({position:'below',addedBehaviors:[p,q]},da.getRoot());this._saveButton=da.getNode('saveButton');this._cancelButton=da.getNode('cancelButton');this._pictureInput=da.getNode('newPicture');this._uploadButton=da.getNode('uploadButton');this._uploadingThrobber=da.getNode('uploadingThrobber');this._uploadedFileDetails=da.getNode('uploadedFileDetails');this._fileNameNode=da.getNode('fileName');this._cancelImageButton=da.getNode('cancelImage');this._threadID=null;var ea=da.getNode('newName');this._uploadedImage=null;if(!this._pictureInput){var fa=k.scry(da.getRoot(),"._8-9")[0];this._pictureInput=k.create('input',{accept:'image/*',type:'file',className:"_n",name:'attachment[]',tabindex:2});new l(fa,this._uploadButton,this._pictureInput);}this._uploader=new m(this._pictureInput);this._uploader.setURI(x('/ajax/mercury/upload.php').setSubdomain('upload').toString());y.addSubscriptions(this._uploader.subscribe('success',this._onFileUploadSuccess.bind(this)),g.listen(this._pictureInput,'change',this._onFileUploadChange.bind(this)),g.listen(this._cancelImageButton,'click',this._resetImageUpload.bind(this)));g.listen(this._saveButton,'click',function(){this.save(n.getValue(ea));this._dialog.hide();}.bind(this));g.listen(this._cancelButton,'click',function(){this._dialog.hide();}.bind(this));this._dialog.subscribe('show',function(){var ga=w.getThreadMetaNow(this._threadID);n.setValue(ea,ga.name);this._resetImageUpload();}.bind(this));this._dialog.subscribe('aftershow',function(){o.set(ea,0,n.getValue(ea).length);}.bind(this));}ca.prototype.toggleShown=function(da,ea){"use strict";if(!this._dialog.isShown()){this._dialog.setContext(da);this._threadID=ea;this._uploadedImage=null;this._dialog.show();}else this._dialog.hide();};ca.prototype.save=function(da){"use strict";var ea=null,fa=w.getThreadMetaNow(this._threadID);if(fa)ea=fa.name;if((da||ea)&&(da!=ea))u.sendMessage(u.constructLogMessageObject(t.CHAT_WEB,this._threadID,s.THREAD_NAME,{name:da}),null,r.WEBMESSENGER);if(this._uploadedImage)u.sendMessage(u.constructLogMessageObject(t.CHAT_WEB,this._threadID,s.THREAD_IMAGE,{image:this._uploadedImage}));};ca.prototype._onFileUploadChange=function(event){"use strict";var da=n.getValue(event.getTarget());if(da){h.setEnabled(this._saveButton,false);j.hide(this._uploadButton);j.hide(this._uploadedFileDetails);j.show(this._uploadingThrobber);this._uploader.send();}};ca.prototype._onFileUploadSuccess=function(da,ea){"use strict";var fa=ea.response.getPayload();this._uploadedImage=fa.metadata[0];k.setContent(this._fileNameNode,this._uploadedImage.filename);j.hide(this._uploadingThrobber);j.hide(this._uploadButton);j.show(this._uploadedFileDetails);h.setEnabled(this._saveButton,true);};ca.prototype._resetImageUpload=function(){"use strict";this._uploadedImage=null;j.hide(this._uploadingThrobber);j.hide(this._uploadedFileDetails);j.show(this._uploadButton);};e.exports=ca;});
__d("WebMessengerDetailViewHeaderControl",["WebMessengerAddPeopleToConversationDialog","Autosize","AvailableListConstants","Bootloader","ContextualDialog","CSS","DOM","WebMessengerEditThreadDialog","Event","HovercardLink","HoverFlyout","JSXDOM","LastMobileActiveTimes","LayerFadeOnHide","LayerFadeOnShow","LayerHideOnTransition","MercuryAPIArgsSource","MercuryConfig","MercuryParticipantTypes","MercuryParticipants","MercuryPresence","ScrollableArea","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads","Tooltip","WebMessengerConstants","WebMessengerEvents","WebMessengerSubscriptionsHandler","copyProperties","csx","cx","curry","fbt","tx"],function(a,b,c,d,e,f){var g=b('WebMessengerAddPeopleToConversationDialog'),h=b('Autosize'),i=b('AvailableListConstants'),j=b('Bootloader'),k=b('ContextualDialog'),l=b('CSS'),m=b('DOM'),n=b('WebMessengerEditThreadDialog'),o=b('Event'),p=b('HovercardLink'),q=b('HoverFlyout'),r=b('JSXDOM'),s=b('LastMobileActiveTimes'),t=b('LayerFadeOnHide'),u=b('LayerFadeOnShow'),v=b('LayerHideOnTransition'),w=b('MercuryAPIArgsSource'),x=b('MercuryConfig'),y=b('MercuryParticipantTypes'),z=b('MercuryParticipants'),aa=b('MercuryPresence'),ba=b('ScrollableArea'),ca=b('WebMessengerStateConstants'),da=b('WebMessengerStateManager'),ea=b('Style'),fa=b('WebMessengerTemplates'),ga=b('MercuryThreadInformer').get(),ha=b('MercuryThreadMetadataRenderer').get(),ia=b('MercuryThreads').get(),ja=b('Tooltip'),ka=b('WebMessengerConstants'),la=b('WebMessengerEvents'),ma=b('WebMessengerSubscriptionsHandler'),na=b('copyProperties'),oa=b('csx'),pa=b('cx'),qa=b('curry'),ra=b('fbt'),sa=b('tx'),ta=null;function ua(bb){"use strict";this._rootElement=bb;m.empty(this._rootElement);this._renderHeaderBar();}ua.prototype.hideView=function(){"use strict";l.hide(this._rootElement);};ua.prototype.updateView=function(){"use strict";l.removeClass(this._rootElement,'isMultichat');l.show(this._rootElement);if(this._listener){ga.unsubscribe(this._listener);this._listener=null;}var bb=ca;switch(da.getCurrentDetailState()){case bb.DETAIL.RECENT_MESSAGES:case bb.DETAIL.SEARCH_CONTEXT:case bb.DETAIL.SEARCH_THREAD_SNIPPET:case bb.DETAIL.SHARED_PHOTOS:this.setThreadID(da.getCurrentStateData().thread_id);break;default:this.setThreadID(null);break;}la.detailDOMChanged();};ua.prototype.setThreadID=function(bb){"use strict";this._threadID=bb;if(this._threadID){this._listener=ga.listen(this._threadID,this.updateView.bind(this));ma.addSubscriptions(this._listener);}bb&&ia.getThreadMeta(bb,function(cb){if(this._threadID==bb)l.conditionClass(this._rootElement,'isMultichat',!cb.is_canonical&&ia.canReply(bb));}.bind(this));};ua.prototype._renderHeaderBar=function(){"use strict";this._headerBar=fa[':fb:web-messenger:read-view:header'].build();m.appendContent(this._rootElement,this._headerBar.getRoot());var bb=this._headerBar.getNode('editThreadName'),cb=this._headerBar.getNode('addPeopleToThread'),db=new n();this._title_node_wrapper=this._headerBar.getNode('headerName');this._relationship_status=this._headerBar.getNode('relationshipStatus');ma.addSubscriptions(o.listen(this._headerBar.getNode('closeButton'),'click',function(){var eb=na(da.getCurrentStateData(),{all_people_query:undefined});da.updateDetailState(ca.DETAIL.COMPOSE_MAIN,eb);}),o.listen(bb,'click',function(event){this._threadID&&db.toggleShown(this._headerBar.getNode('headerName'),this._threadID);return true;}.bind(this)),o.listen(cb,'click',function(event){this._threadID&&g.show(this._threadID);return true;}.bind(this)),la.subscribe(la.DETAIL_DOM_CHANGED,this.updateHeaderBar.bind(this)));};ua.prototype.updateHeaderBar=function(){"use strict";var bb=this._headerBar.getNode('headerButtons');this._title_node_wrapper.style.fontSize='';var cb=r.span(null);m.setContent(this._title_node_wrapper,cb);var db=this._headerBar.getNode('webMessengerRecIndicator');db&&l.hide(db);var eb=da.getCurrentDetailState(),fb=eb==ca.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;l.conditionShow(this._headerBar.getNode('closeButton'),fb);l.conditionClass(this._title_node_wrapper,'allPeopleResults',fb);l.hide(this._relationship_status);l.removeClass(this._title_node_wrapper,"_50jz");var gb,hb;switch(eb){case ca.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:hb=da.getCurrentStateData().all_people_query;gb=m.tx._("People matching {query}",{query:m.create('strong',{},hb)});break;case ca.DETAIL.COMPOSE_MAIN:case ca.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:gb="New Message";break;case ca.DETAIL.SEARCH_SNIPPET:hb=da.getCurrentStateData().message_query;if(hb)gb=sa._("Messages with word: {query}",{query:hb});break;}var ib=!gb&&!this._threadID;if(ib)gb="No Selection";l.conditionClass(this._title_node_wrapper,"_3jd",ib);if(gb){m.setContent(cb,gb);ab(this._title_node_wrapper,this._threadID,bb,db);return;}ha.renderAndSeparatedParticipantList(this._threadID,cb,{check_length:false,names_renderer:function(jb){var kb=jb.map(function(mb){var nb=jb.length===1?mb.name:mb.short_name,ob=z.getUserID(mb.id);if(ob&&mb.href){var pb=r.a({href:mb.href},nb);if(jb.length===1)pb.setAttribute('data-hovercard',p.constructEndpoint({id:ob}));return pb;}else return nb;});if(jb.length===1&&jb[0].fbid!==null){var lb=r.span(null);m.setContent(lb,kb[0]);wa(jb[0],lb);kb[0]=lb;}return kb;}.bind(this)});if(db)ia.getThreadMeta(this._threadID,function(jb){xa(jb,db);});if(x.SocialContextGK)this.renderRelationshipStatusIndicator();this.renderParticipantListFlyout(cb);this.renderNamedThreadParticipantCount(cb);ab(this._title_node_wrapper,this._threadID,bb,db);new h(this._title_node_wrapper,{min:11,max:16,height:100,width:this._title_node_wrapper.offsetWidth,wrap:false});};ua.prototype.renderNamedThreadParticipantCount=function(bb){"use strict";ia.getThreadMeta(this._threadID,function(cb){if(cb.name){var db=ha.renderParticipantCount(cb.thread_id,{count:cb.participants.length-1}),eb=m.create('span',{className:"_1us"},sa._("({participants})",{participants:db}));m.appendContent(bb,eb);}},w.WEBMESSENGER);};ua.prototype.renderRelationshipStatusIndicator=function(){"use strict";var bb=this._relationship_status,cb=this._title_node_wrapper,db=this._threadID;ia.getThreadMeta(this._threadID,function(eb){var fb=eb.participants.filter(function(gb){return gb!==z.user;});if(fb.length>1)return;z.getMulti(fb,function(gb){if(this._threadID!=db)return;var hb=fb.map(function(jb){return gb[jb];}),ib=hb[0];if(ib&&!ib.is_friend&&(ib.type===y.USER||ib.type===y.FRIEND)){m.setContent(bb,za(ib));l.show(bb);l.addClass(cb,"_50jz");}}.bind(this));}.bind(this),w.WEBMESSENGER);};ua.prototype.renderParticipantListFlyout=function(bb){"use strict";this._dialog&&this._dialog.destroy();delete this._dialog;this._flyout&&this._flyout.destroy();delete this._flyout;var cb=this._threadID;ia.getThreadMeta(this._threadID,function(db){var eb=db.participants.filter(function(fb){return fb!==z.user;});if(eb.length<=1)return;z.getMulti(eb,function(fb){if(this._threadID!=cb)return;var gb=0,hb=fa[':fb:web-messenger:flyoutlist'].build();for(var ib in fb){var jb=fb[ib],kb=fa[':fb:web-messenger:flyoutlist-profile-item'].build();kb.getNode('profilePhoto').setAttribute('src',jb.image_src);var lb=kb.getNode('title');if(jb.href){var mb=r.a({href:jb.href});m.setContent(lb,mb);lb=mb;var nb=kb.getNode('profilePhoto'),ob=r.a({href:jb.href});m.replace(nb,ob);m.setContent(ob,nb);}m.setContent(lb,jb.name);wa(jb,kb.getNode('title'));m.setContent(kb.getNode('infoLine'),za(jb));gb++;m.appendContent(hb.getNode('list'),kb.getRoot());}var pb=hb.getRoot();this._dialog=new k({context:bb,position:'below',addedBehaviors:[t,u,v]},pb);this._flyout=new q();this._flyout.init(this._dialog);this._flyout.initNode(bb);ya(this._flyout,pb,gb);}.bind(this));}.bind(this),w.WEBMESSENGER);};ua.prototype.destroy=function(){"use strict";};function va(bb,cb,db){var eb=s.getShortDisplay(db);if(!eb||bb.get(db)!==i.MOBILE){ja.remove(cb);return;}ja.set(cb,ra._("Last active {time} ago",[ra.param("time",eb)]),'right');}function wa(bb,cb){var db=z.getUserID(bb.id);if(!db)return;var eb=r.span(null);aa.updateOnPresenceChanges(db,eb);if(m.isNode(cb)){j.loadModules(['PresenceStatus','ChatOpenTab'],function(fb,gb){o.listen(eb,'mouseenter',qa(va,fb,eb,db));o.listen(eb,'click',gb.openUserTab.curry(db,'web messenger header'));});m.appendContent(cb,eb);}}function xa(bb,cb){if(cb)z.getMulti(bb.participants,function(db){var eb=true;for(var fb in db)eb=eb&&db[fb].employee;l.conditionShow(cb,eb);});}function ya(bb,cb,db){if(db<=ka.MAX_VISIBLE_IN_FLYOUT)return;var eb=ba.fromNative(cb,{fade:true});cb.style.height=ka.PARTICIPANTS_FLYOUT_HEIGHT+'px';bb.subscribe('show',function(){eb.showScrollbar(false);});}function za(bb){var cb=bb.social_snippets||{},db=Object.keys(cb);if(db.length>0){var eb=db.slice(0,1).map(function(jb){return cb[jb];});return eb;}var fb=bb.networks||{},gb=Object.keys(fb),hb=gb.length>0,ib=2;if(hb){var eb=gb.slice(0,ib).map(function(jb){return fb[jb];});return eb.join(' \u00b7 ');}return '';}function ab(bb,cb,db,eb){var fb=db.offsetWidth;if(eb){ta=ta||eb.offsetWidth;fb+=ta;}var gb=m.scry(document.body,"div._2nd");if(gb.length)fb+=gb[0].offsetWidth;var hb=bb.parentNode.offsetWidth;if(hb>fb)ea.set(bb,'max-width',(hb-fb)+'px');}e.exports=ua;});
__d("WebMessengerFlexibleArea",["Event","ArbiterMixin","CSS","cx","DOM","Style","throttle","Vector","createArrayFrom","mixin"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('CSS'),j=b('cx'),k=b('DOM'),l=b('Style'),m=b('throttle'),n=b('Vector'),o=b('createArrayFrom'),p=[],q=b("mixin");function r(){p.forEach(function(w){w.draw();});}g.listen(window,'resize',m(r,50));var s=q(h);for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w){"use strict";this.minFlexAreaHeight=0;this.flexArea=w;this.container=null;this.padding=0;this.sizeToFit=false;p.push(this);}v.prototype.setContainer=function(w){"use strict";this.container=w;return this;};v.prototype.setPadding=function(w){"use strict";this.padding=w;return this;};v.prototype.setMinFlexAreaHeight=function(w){"use strict";this.minFlexAreaHeight=w;return this;};v.prototype.setSizeToFit=function(w){"use strict";this.sizeToFit=w;return this;};v.prototype.draw=function(){"use strict";if(this.flexArea){var w=this._flexHeight;this.inform('predraw',{old_height:w});var x=n.getViewportDimensions().y-this.padding;x-=n.getElementPosition(this.container||this.flexArea).y;if(this.container){o(this.container.childNodes).forEach(function(y){x-=n.getElementDimensions(y).y;});x+=n.getElementDimensions(this.flexArea).y;}if(this.sizeToFit)x=Math.min(x,this._getNaturalHeight());if(x<this.minFlexAreaHeight)x=this.minFlexAreaHeight;if(isNaN(x)||x<0)x=0;if(x!==w){l.set(this.flexArea,'height',x+'px');this._flexHeight=x;this.inform('height_changed',{height:x,old_height:w});}}return this;};v.prototype.destroy=function(){"use strict";var w=p.indexOf(this);w>=0&&p.splice(w,1);r();};v.prototype._getNaturalHeight=function(){"use strict";var w=this.flexArea.cloneNode(true);i.addClass(w,"_2ys");l.set(w,'height','auto');k.insertAfter(this.flexArea,w);var x=n.getElementDimensions(w).y;k.remove(w);return x;};v.prototype._getFlexHeight=function(){"use strict";if(isNaN(this._flexHeight))this._flexHeight=n.getElementDimensions(this.flexArea).y;return this._flexHeight;};e.exports=v;});
__d("WebMessengerFlexibleScrollArea",["CSS","DOMQuery","ScrollableArea","Style","WebMessengerFlexibleArea","emptyFunction","throttle"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOMQuery'),i=b('ScrollableArea'),j=b('Style'),k=b('WebMessengerFlexibleArea'),l=b('emptyFunction'),m=b('throttle');for(var n in k)if(k.hasOwnProperty(n))p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(q,r){"use strict";this._scroll=i.fromNative(q,r);k.call(this,q);this._scrollBody=h.find(this.flexArea,'.uiScrollableAreaBody');var s=h.scry(this.flexArea,'.uiScrollableAreaShadow');this._shadow=s.length?s[0]:null;this._scrollContent=h.find(this.flexArea,'.uiScrollableAreaContent');this._scrollCallback=l;this._drawSubscription=this.subscribe('height_changed',this.poke.bind(this));this._scrollSub=this._scroll.subscribe('scroll',m(this._onScroll,50,this));}p.prototype.setBottomAligned=function(q){"use strict";var r=q!==false;if(this._bottomEdgeBias===r)return;g.conditionClass(this.flexArea,'uiScrollableAreaBottomAligned',r);this._bottomEdgeBias=r;if(this._bottomEdgeBias){this.scrollToBottom(false);}else this.scrollToTop(false);this.poke.bind(this).defer();return this;};p.prototype.setInfiniteScrollHandler=function(q,r){"use strict";if(r){this._infiniteUpwardScrollHandler=q;}else this._infiniteDownScrollHandler=q;return this;};p.prototype.setScrollCallback=function(q){"use strict";this._scrollCallback=q;return this;};p.prototype.setTabbable=function(q){"use strict";this._scroll._wrap.setAttribute('tabindex',q?'0':'-1');};p.prototype.poke=function(q,r){"use strict";var s=this._scrollHeight,t=this._scroll.getScrollTop();this._scrollHeight=this._getScrollHeight();if(typeof s=='undefined'||(r&&!r.old_height)){this._bottomEdgeBias&&this._setShadowHeight();return;}var u=this._scrollHeight-s;if(this._bottomEdgeBias){var v=r?r.height-r.old_height:0;clearTimeout(this._pollTimer);this._pollTimer=this.poke.bind(this).defer(200);var w,x=u-v;if(this._scrollHeight>this._getFlexHeight()){w=t+x;w=w<0?0:w;}else w=0;x>0&&this._setShadowHeight();if(w!==t)this._scroll.setScrollTop(w,false);x<0&&this._setShadowHeight();}else if(u)this._scroll.setScrollTop(t,false);};p.prototype.setScrollTop=function(q,r){"use strict";this._scroll.setScrollTop(q,r);};p.prototype.getScrollableArea=function(){"use strict";return this._scroll;};p.prototype.isScrolledToBottom=function(){"use strict";return this._scroll.isScrolledToBottom();};p.prototype.scrollToBottom=function(q){"use strict";this._scroll.scrollToBottom(q);if(this._bottomEdgeBias)this._scrollBottom=0;};p.prototype.isScrolledToTop=function(){"use strict";return this._scroll.getScrollTop()===0;};p.prototype.scrollToTop=function(q){"use strict";this._scroll.scrollToTop(q);};p.prototype.scrollIntoView=function(q,r){"use strict";this._scroll.scrollIntoView(q,r);};p.prototype.destroy=function(){"use strict";this._scrollSub&&this._scrollSub.unsubscribe();this.unsubscribe(this._drawSubscription);clearTimeout(this._pollTimer);o.destroy.call(this);this._scroll.destroy();};p.prototype._getScrollHeight=function(){"use strict";if(this._bottomEdgeBias){return this._scrollContent.offsetHeight;}else return this._scroll.getScrollHeight();};p.prototype._setShadowHeight=function(){"use strict";var q=this._shadowHeight;this._shadowHeight=this._scrollHeight-this._getFlexHeight();if(this._shadowHeight<0)this._shadowHeight=0;if(this._shadowHeight!==q)j.set(this._shadow,'height',this._shadowHeight+'px');};p.prototype._onScroll=function(){"use strict";var q=this._scroll.getScrollTop(),r=this._getScrollHeight();if(q<this._getFlexHeight())this._infiniteUpwardScrollHandler&&this._infiniteUpwardScrollHandler();if(q+2*this._getFlexHeight()>r)this._infiniteDownScrollHandler&&this._infiniteDownScrollHandler();this._scrollCallback(this._scroll);};e.exports=p;});
__d("ListInputTargetTracker",[],function(a,b,c,d,e,f){function g(){"use strict";this._index=undefined;this._items=[];}g.prototype.getIndex=function(){"use strict";return this._index;};g.prototype.setIndex=function(h){"use strict";this._index=Math.max(0,Math.min(h,this._items.length-1));};g.prototype.getNumItems=function(){"use strict";return this._items.length;};g.prototype.getItem=function(){"use strict";if(this._index!==undefined)return this._items[this._index];};g.prototype.setTargetItem=function(h){"use strict";this.updateIndex(this._items,h);};g.prototype.removeItemAtIndex=function(h){"use strict";this._items.splice(h,1);};g.prototype.removeItemByValue=function(h){"use strict";var i=this._items.indexOf(h);this.removeItemAtIndex(i);};g.prototype.moveUp=function(){"use strict";if(this._index===undefined||this._index===0){if(this._items.length){this._index=this._items.length-1;return true;}}else if(this._index>0){this._index--;return true;}return false;};g.prototype.moveDown=function(){"use strict";if(this._index===undefined||this._index===this._items.length-1){if(this._items.length){this._index=0;return true;}}else if(this._index<this._items.length-1){this._index++;return true;}return false;};g.prototype.updateIndex=function(h,i){"use strict";this._items=h||[];if(i){var j=this._items.indexOf(i);if(j>=0){this._index=j;}else if(this._index!==undefined)if(this._items.length>0){this._index=Math.min(this._index,this._items.length-1);}else this._index=undefined;}else this._index=undefined;return this._index;};e.exports=g;});
__d("WebMessengerShortcuts",["DialogX","DOM","KeyEventController","LayerHideOnEscape","ListInputTargetTracker","MercuryAPIArgsSource","MessagingTag","Parent","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreads","UserAgent","WebMessengerEvents","arrayContains","csx","cx","ge","shield","tx"],function(a,b,c,d,e,f){var g=b('DialogX'),h=b('DOM'),i=b('KeyEventController'),j=b('LayerHideOnEscape'),k=b('ListInputTargetTracker'),l=b('MercuryAPIArgsSource'),m=b('MessagingTag'),n=b('Parent'),o=b('WebMessengerStateConstants'),p=b('WebMessengerStateManager'),q=b('WebMessengerTemplates'),r=b('MercuryThreads').get(),s=b('UserAgent'),t=b('WebMessengerEvents'),u=b('arrayContains'),v=b('csx'),w=b('cx'),x=b('ge'),y=b('shield'),z=b('tx'),aa=null,ba=null,ca=null,da={c:{callback:ia,description:"Start a new message",section:'navigation',uses_meta:true},g:{callback:ja,description:"Search conversations",section:'searchAndHelp',uses_meta:true},i:{callback:ra.curry(m.INBOX),description:"Go to Inbox",section:'navigation',uses_meta:true},u:{callback:ra.curry(m.OTHER),description:"Go to Other",section:'navigation',uses_meta:true},z:{callback:la,description:"Archive\/unarchive conversation",otherKeys:['DELETE','BACKSPACE'],section:'conversation',uses_meta:true},r:{callback:ma,description:"Mark message as read\/unread",section:'conversation',uses_meta:true},UP:{callback:na,description:"Select next conversation",section:'navigation',uses_meta:false},DOWN:{callback:oa,description:"Select previous conversation",section:'navigation',uses_meta:false},q:{callback:y(ta),description:"Show\/hide keyboard shortcuts",section:'searchAndHelp',uses_meta:true},j:{callback:ua,description:"Mark as spam",section:'conversation',uses_meta:true}},ea={registerGeneralShortcuts:function(){ba=new k();for(var va in da){var wa=da[va],xa=wa.otherKeys||[];xa.push(va);for(var ya=0;ya<xa.length;ya++)i.registerKey(xa[ya],wa.callback,ha.curry(wa.uses_meta));}},updateThreadlistIndex:function(va,wa,xa){aa=va;if(ba){if(!u(wa,xa))xa=null;ba.updateIndex(wa,xa);}},openSearchThread:function(){var va=qa(),wa=p.getCurrentMasterState();if(va&&wa==o.MASTER.SEARCH)aa.openSearchThread(va);},showOrHideShortcuts:ta};function fa(){return s.osx()?'CTRL':'ALT';}function ga(va){function wa(){if(!ca){var xa=h.find(document.body,"._ksg");ca=[];do{xa=xa.parentNode;ca.push(xa);}while(xa&&xa!==document.body);}return ca;}if(!n.byClass(va,"_ksg"))if(!u(wa(),va))if(!h.scry(va,"._5hu2").length)return false;return true;}function ha(va,event,wa){if(!i.filterEventTypes(event,wa))return false;if(!ga(event.getTarget()))return false;var xa;if(va)switch(fa()){case 'CTRL':xa='ctrlKey';break;case 'ALT':xa='altKey';break;}var ya=['ctrlKey','metaKey','altKey','shiftKey'];for(var za=0;za<ya.length;za++)if(ya[za]!==xa&&event[ya[za]])return false;return !va||event[xa];}function ia(){p.updateDetailState(o.DETAIL.COMPOSE_MAIN,{start:true});return false;}function ja(){t.focusAndSelectSearch();return false;}function ka(va){var wa;if(ba.getNumItems()>1){var xa=ba.getIndex();ba.setIndex(xa===0?1:xa-1);wa=qa();}va();p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{folder:p.getCurrentStateData().folder,thread_id:wa});if(wa)aa._manager.scrollIntoView(x(ba.getItem()),false);}function la(){var va=qa();if(va){r.getThreadMeta(va,function(wa){if(wa.folder==m.SPAM)return;ka(function(){r.changeThreadArchivedStatus(wa.thread_id,!wa.is_archived);});},l.WEBMESSENGER);return false;}}function ma(){var va=qa();if(va){r.getThreadMeta(va,function(wa){var xa=!wa.unread_count;r.changeThreadReadStatus(va,!xa);},l.WEBMESSENGER);return false;}}function na(){if(ba)if(ba.getIndex()===0){switch(p.getCurrentMasterState()){case o.MASTER.SEARCH:ba.moveUp();pa();aa._manager.scrollToBottom(false);break;default:aa._manager.scrollToTop(false);t.focusSearch();}}else{if(ba.getItem()){ba.moveUp();}else ba.moveDown();pa();}return false;}function oa(){var va=p.getCurrentMasterState();if(ba&&(va!==o.MASTER.RECENT_THREADS||ba.getIndex()<ba.getNumItems()-1)){ba.moveDown();pa();}return false;}function pa(){var va=qa();if(va){var wa=p.getCurrentMasterState();if(wa==o.MASTER.SEARCH){aa.updateKeyboardSelection(va);t.focusSearch();}else p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{thread_id:va});if(ba)if(ba.getIndex()===0){aa._manager.scrollToTop(false);}else aa._manager.scrollIntoView(x(ba.getItem()),false);}}function qa(){var va=ba&&ba.getItem();if(typeof va==='string'&&va.indexOf(':')!==-1)return va.substr(va.indexOf(':')+1);return null;}function ra(va){var wa=p.getCurrentMasterState(),xa=wa==o.MASTER.SEARCH?null:p.getCurrentStateData().thread_id;p.updateMasterState(o.MASTER.RECENT_THREADS,{thread_id:xa,folder:va});}var sa;function ta(va){if(!sa){var wa={};for(var xa in da){var ya=da[xa];if(!ya.uses_meta)continue;var za=q[':fb:web-messenger:shortcuts-dialog:row'].build();za.setNodeContent('meta',fa());if(ya.keyName){za.setNodeContent('key',ya.keyName);}else za.setNodeContent('key',xa);za.setNodeContent('description',ya.description);if(!wa[ya.section])wa[ya.section]=[];wa[ya.section].push(za.getRoot());}var ab=q[':fb:web-messenger:shortcuts-dialog'].build();for(var bb in wa)ab.setNodeContent(bb,wa[bb]);var cb=h.scry(ab.getRoot(),"._1yw")[0],db=null;if(cb)db=h.getID(cb);sa=new g({modal:true,titleID:db,width:565},ab.getRoot());sa.enableBehavior(j);}if(sa.isShown()){sa.hide();}else{sa.show();if(typeof va==='function')sa.subscribeOnce('hide',va);}return false;}function ua(){var va=qa();if(va){r.getThreadMeta(va,function(wa){if(wa.folder==m.SPAM)return;ka(r.markThreadSpam.bind(r,va));},l.WEBMESSENGER);return false;}}e.exports=ea;});
__d("WebMessengerDetailViewActionsMenuControl",["Event","WebMessengerAddPeopleToConversationDialog","WebMessengerDeleteThreadDialog","Arbiter","AsyncDialog","AsyncRequest","MercuryChatUtils","MercuryConfig","CSS","Dialog","DOM","fbt","Focus","Input","Keys","WebMessengerActionsMenuItem","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryThreadMuter","MercuryMessages","MessagingTag","MercuryParticipants","MercuryServerRequests","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadInformer","MercuryThreads","Toggler","URI","WebMessengerSubscriptionsHandler","copyProperties","emptyFunction","goURI","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('WebMessengerAddPeopleToConversationDialog'),i=b('WebMessengerDeleteThreadDialog'),j=b('Arbiter'),k=b('AsyncDialog'),l=b('AsyncRequest'),m=b('MercuryChatUtils'),n=b('MercuryConfig'),o=b('CSS'),p=b('Dialog'),q=b('DOM'),r=b('fbt'),s=b('Focus'),t=b('Input'),u=b('Keys'),v=b('WebMessengerActionsMenuItem'),w=b('MercuryAPIArgsSource'),x=b('MercuryLogMessageType'),y=b('MercurySourceType'),z=b('MercuryThreadMuter'),aa=b('MercuryMessages').get(),ba=b('MessagingTag'),ca=b('MercuryParticipants'),da=b('MercuryServerRequests').get(),ea=b('WebMessengerShortcuts'),fa=b('WebMessengerStateConstants'),ga=b('WebMessengerStateManager'),ha=b('WebMessengerTemplates'),ia=b('MercuryThreadInformer').get(),ja=b('MercuryThreads').get(),ka=b('Toggler'),la=b('URI'),ma=b('WebMessengerSubscriptionsHandler'),na=b('copyProperties'),oa=b('emptyFunction'),pa=b('goURI'),qa=b('tx');function ra(){"use strict";this.node=ha[':ui:menu-DEPRECATED:separator'].render();}ra.prototype.getNode=function(){"use strict";return this.node;};function sa(bc){"use strict";this._rootElement=bc;this._menuTemplate=ha[':fb:web-messenger:actions-menu'].build();this._newMessageButton=this._menuTemplate.getNode('newMessageButton').parentNode;this._actionsMenu=this._menuTemplate.getNode('menu');this._searchThreadInput=this._menuTemplate.getNode('searchThreadInput');this._searchThreadButton=this._menuTemplate.getNode('searchThreadButton').parentNode;this._searchCloseButton=this._menuTemplate.getNode('searchCloseButton').parentNode;var cc=this._menuTemplate.getNode('actionsButton'),dc=this._menuTemplate.getNode('newMessageButton');s.relocate(dc,dc.parentNode);var ec=function(event){if(!this._searchMode){ua(this,true);}else{var fc=t.getValue(this._searchThreadInput);if(fc){var gc=na({},ga.getCurrentStateData());na(gc,{message_query:fc});ga.updateDetailState(fa.DETAIL.SEARCH_THREAD_SNIPPET,gc);this._searchThreadInput.focus();}else ua(this,false);}event.kill();}.bind(this);ma.addSubscriptions(ia.subscribe('threads-updated',function(fc,gc){gc[this._threadID]&&this.updateView();}.bind(this)),g.listen(this._menuTemplate.getNode('newMessageButton'),'click',function(){ga.updateDetailState(fa.DETAIL.COMPOSE_MAIN,na(ga.getCurrentStateData(),{start:true,thread_id:undefined}));}),g.listen(this._actionsMenu,'keydown',function(event){if(event.keyCode===u.ESC){cc.focus();event.preventDefault();}}),g.listen(this._searchThreadButton,'mousedown',ec),g.listen(this._searchThreadButton,'keydown',function(event){if(event.keyCode===u.RETURN||event.keyCode===u.SPACE)ec(event);}),g.listen(this._searchThreadButton,'click',oa.thatReturnsFalse),g.listen(this._searchCloseButton,'keydown',function(event){if(event.keyCode===u.RETURN||event.keyCode===u.SPACE){wa(this);this._menuTemplate.getNode('searchThreadButton').focus();}}.bind(this)),g.listen(this._searchCloseButton,'mousedown',function(event){wa(this);}.bind(this)),g.listen(this._searchThreadInput,'blur',function(event){var fc=t.getValue(this._searchThreadInput);if(!fc)ua(this,false);}.bind(this)),g.listen(this._searchThreadInput,'keyup',function(event){var fc=t.getValue(this._searchThreadInput),gc=na({},ga.getCurrentStateData());na(gc,{message_query:fc});if(event.keyCode==u.RETURN&&fc)ga.updateDetailState(fa.DETAIL.SEARCH_THREAD_SNIPPET,gc);if(event.keyCode==u.ESC)t.reset(this._searchThreadInput);}.bind(this)));this.initItems();q.setContent(this._rootElement,this._menuTemplate.getRoot());}sa.prototype.initItems=function(){"use strict";var bc=this._menuTemplate.getNode('actionsButton'),cc=this._menuTemplate.getNode('newMessageButton').parentNode,dc=function(){bc.focus();},ec=function(){cc.focus();};this.menuItems=[new v("Mark as Read",vb.curry(dc),hb),new v("Mark as Unread",ub.curry(dc),eb(hb)),new v("Open in Chat",za,m.canOpenChatTab),new v("Create Group...",tb,cb)];if(n.WebMessengerSharedPhotosGK){var fc=("View Photos in Thread");this.menuItems.push(new v(fc,lb));}this.menuItems.push(new ra());if(!n.MessagesDisableForwardingGK)this.menuItems.push(new v("Forward Messages...",xb));this.menuItems=this.menuItems.concat([new v("Delete Messages...",wb),new ra(),new v("Add People...",nb,ya),new v("Leave Conversation...",ob,ya),new v("Delete Conversation...",db),new v("Mute Conversation...",z.showMuteChangeDialog,eb(z.isThreadMuted)),new v("Unmute Conversation",va.curry(dc),z.isThreadMuted),new v("Move to Inbox",bb.curry(ec,ba.INBOX),ab.curry(ba.OTHER)),new v("Move to Other",bb.curry(ec,ba.OTHER),ab.curry(ba.INBOX)),new v("Archive",qb.curry(ec),eb(gb)),new v("Unarchive",rb.curry(ec),gb),new v("Report Spam or Abuse...",jb.curry(dc),eb(fb)),new v("Not Spam",mb.curry(ec),fb)]);if(xa())this.menuItems=this.menuItems.concat([new ra(),new v('Enable bug reporting',yb.curry(dc),eb(ib)),new v('Disable bug reporting',zb.curry(dc),ib)]);this.menuItems=this.menuItems.concat([new ra(),new v("Keyboard Shortcuts",ea.showOrHideShortcuts.bind(ea,dc)),new v("Feedback",pa.curry('/help/?page=134259426717336'))]);var gc=this.menuItems.map(function(ic){return ic.getNode();}),hc=q.find(this._menuTemplate.getRoot(),'.uiMenuInner');q.setContent(hc,gc);};sa.prototype.hideView=function(){"use strict";o.hide(this._rootElement);};sa.prototype.updateView=function(){"use strict";this.hideView();var bc=ga.getCurrentDetailState(),cc=false,dc=false,ec=false,fc=false,gc=false,hc=false;switch(bc){case fa.DETAIL.COMPOSE_MAIN:case fa.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case fa.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:ta(this);this._threadID=null;break;case fa.DETAIL.RECENT_MESSAGES:case fa.DETAIL.SEARCH_CONTEXT:if(this._state!==bc)ta(this);var ic=ga.getCurrentStateData().thread_id;cc=true;if(this._searchMode&&this._threadID===ic){fc=true;}else{ta(this);dc=true;ec=true;}this._threadID=ic;if(n.WebMessengerThreadSearchGK&&this._threadID)gc=true;break;case fa.DETAIL.SEARCH_THREAD_SNIPPET:var jc=ga.getCurrentStateData();t.setValue(this._searchThreadInput,jc.message_query);this._threadID=jc.thread_id;cc=true;fc=true;hc=true;break;case fa.DETAIL.SHARED_PHOTOS:var kc=ga.getCurrentStateData();this._threadID=kc.thread_id;cc=true;dc=true;ec=true;gc=true;break;default:ta(this);cc=true;dc=true;this._threadID=null;break;}this._state=bc;o.conditionShow(this._searchThreadInput,fc);o.conditionShow(this._searchThreadButton,gc);o.conditionShow(this._searchCloseButton,hc);o.conditionShow(this._newMessageButton,dc);o.conditionShow(this._rootElement,cc);this._threadSubscription&&ja.unsubscribe(this._threadSubscription);if(ec&&this._threadID){this._threadSubscription=ja.getThreadMeta(this._threadID,function(lc){var mc=null,nc=false;this.menuItems.forEach(function(oc){if(oc instanceof v){nc|=oc.updateShown(lc);}else if(oc instanceof ra){o.conditionShow(oc.getNode(),nc);if(nc){mc=oc;nc=false;}}});if(!nc&&mc)o.hide(mc.getNode());o.show(this._menuTemplate.getNode('menu'));o.show(this._rootElement);}.bind(this),w.WEBMESSENGER);}else o.hide(this._menuTemplate.getNode('menu'));};sa.prototype.destroy=function(){"use strict";};function ta(bc){bc._searchMode=false;t.reset(bc._searchThreadInput);}function ua(bc,cc){if(cc){bc._searchMode=true;}else ta(bc);o.conditionShow(bc._newMessageButton,!cc);o.conditionShow(bc._actionsMenu,!cc);o.conditionShow(bc._searchThreadInput,cc);if(cc)bc._searchThreadInput.focus();}function va(bc,cc){ja.updateThreadMuteSetting(cc,0);ka.hide();bc();}function wa(bc){ua(bc,false);o.conditionShow(bc._searchThreadButton,true);o.conditionShow(bc._searchCloseButton,false);var cc=ga.getCurrentDetailState();if(cc!==fa.DETAIL.RECENT_MESSAGES)ga.updateDetailState(fa.DETAIL.RECENT_MESSAGES,{thread_id:ga.getCurrentStateData().thread_id});}function xa(){var bc=ca.getNow(ca.user);return bc&&bc.employee;}function ya(bc){return !bc.is_canonical&&bc.is_subscribed;}function za(bc){j.inform('chat/open-tab',{thread_id:bc});}function ab(bc,cc){return !cc.is_archived&&cc.folder==bc;}function bb(bc,cc,dc){ja.changeFolder(dc,cc);ac();bc();}function cb(bc){var cc=sb(bc.participants);return cc.length>2;}function db(bc){i.show(bc);}function eb(bc){return function(){return !bc.apply(this,arguments);};}function fb(bc){return bc.folder===ba.SPAM;}function gb(bc){return bc.is_archived;}function hb(bc){return bc.unread_count>0;}function ib(){return ga.getCurrentStateData().bug_reporting_enabled;}function jb(bc,cc){var dc=ja.getThreadMetaNow(cc),ec;if(dc&&dc.message_count==1){ec=ha[':fb:web-messenger:report-dialog-single-message'].build();}else ec=ha[':fb:web-messenger:report-dialog'].build();var fc=ec.getRoot(),gc=[p.OK,p.CANCEL];new p().setTitle("Report Spam or Abuse").setBody(fc).setButtons(gc).setHandler(kb.curry(cc,fc)).setCancelHandler(bc).show();}function kb(bc,cc){var dc=q.find(cc,'.markSpam'),ec=q.scry(cc,'.markSpamMessages')[0];if(dc.checked){ja.markThreadSpam(bc);ac();}else if(ec&&ec.checked){var fc=na({},ga.getCurrentStateData());na(fc,{message_action:fa.MESSAGE_ACTION.REPORT_SPAM});ga.updateDetailState(ga.getCurrentDetailState(),fc);}else{var gc=q.find(cc,'.reportUsers');if(gc.checked){da.getServerThreadID(bc,function(hc){p.bootstrap('/ajax/messaging/report/',{tid:hc});});}else return false;}}function lb(bc){var cc=na({},ga.getCurrentStateData());ga.updateDetailState(fa.DETAIL.SHARED_PHOTOS,cc);}function mb(bc,cc){ja.unmarkThreadSpam(cc);ac();bc();}function nb(bc){h.show(bc);}function ob(bc){var cc=[];cc.push({name:'unsubscribe',label:"Leave Conversation",handler:pb.bind(null,bc)});cc.push(p.CANCEL);new p().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(cc).show();}function pb(bc){aa.sendMessage(aa.constructLogMessageObject(y.TITAN_WEB,bc,x.UNSUBSCRIBE,{}),null,w.WEBMESSENGER);return true;}function qb(bc,cc){ja.changeThreadArchivedStatus(cc,true);ac();bc();}function rb(bc,cc){ja.changeThreadArchivedStatus(cc,false);ac();bc();}function sb(bc){var cc=[];for(var dc=0;dc<bc.length;dc++){var ec=bc[dc];if(/^fbid:\d+$/.test(ec))cc.push(ec.substr(5));}return cc;}function tb(bc){ja.getThreadMeta(bc,function(cc){var dc=sb(cc.participants),ec=la('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger',members:dc,parent_id:'0'});k.send(new l(ec));},w.WEBMESSENGER);}function ub(bc,cc){ja.changeThreadReadStatus(cc,false);ka.hide();bc();}function vb(bc,cc){ja.changeThreadReadStatus(cc,true);ka.hide();bc();}function wb(){var bc=na({},ga.getCurrentStateData());na(bc,{message_action:fa.MESSAGE_ACTION.DELETE});ga.updateDetailState(ga.getCurrentDetailState(),bc);}function xb(){var bc=na({},ga.getCurrentStateData());na(bc,{message_action:fa.MESSAGE_ACTION.FORWARD});ga.updateDetailState(ga.getCurrentDetailState(),bc);}function yb(bc){var cc=na({},ga.getCurrentStateData());cc.bug_reporting_enabled=true;ka.hide();ga.updateDetailState(ga.getCurrentDetailState(),cc);bc();}function zb(bc){var cc=na({},ga.getCurrentStateData());cc.bug_reporting_enabled=false;ka.hide();ga.updateDetailState(ga.getCurrentDetailState(),cc);bc();}function ac(){ga.updateDetailState(fa.DETAIL.RECENT_MESSAGES,{folder:ga.getCurrentStateData().folder});}e.exports=sa;});
__d("ExpandableDataSource",["DataSource"],function(a,b,c,d,e,f){var g=b('DataSource');for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";this._initialLimit=l;this._moreResultsLimit=m;this._states={};k=k||{};k.maxResults=this._initialLimit;g.call(this,k);}j.prototype.query=function(k,l,m){"use strict";this.setQueryData({offset:0,limit:this._initialLimit});i.query.call(this,k,l,m);};j.prototype.fetchHandler=function(k,l){"use strict";var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[n]=false;this.getState('total_results_count_per_query')[n]=m.total_count;i.fetchHandler.call(this,k,l);};j.prototype.loadMore=function(){"use strict";if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this._initialLimit;this.setQueryData({offset:k[this.value],limit:this._moreResultsLimit});k[this.value]+=this._moreResultsLimit;if(k[this.value]>this._maxResults)this._maxResults=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};j.prototype.isLoadingMore=function(){"use strict";return this.getState('is_loading_more_per_query')[this.value];};j.prototype.hasLoadedAllResults=function(){"use strict";var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;};j.prototype.getStates=function(){"use strict";return this._states;};j.prototype.getState=function(k){"use strict";var l=this.getStates();if(!l[k])l[k]={};return l[k];};j.prototype.getQueryCache=function(){"use strict";return this.getState('query_cache');};e.exports=j;});
__d("WebMessengerDetailViewAllPeopleResultsControl",["Event","CSS","DataStore","DOM","ExpandableDataSource","MercuryIDs","Parent","WebMessengerStateConstants","WebMessengerStateManager","Token","WebMessengerEvents","cx","WebMessengerSubscriptionsHandler","copyProperties","WebMessengerTemplates"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DataStore'),j=b('DOM'),k=b('ExpandableDataSource'),l=b('MercuryIDs'),m=b('Parent'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('Token'),q=b('WebMessengerEvents'),r=b('cx'),s=b('WebMessengerSubscriptionsHandler'),t=b('copyProperties'),u=b('WebMessengerTemplates'),v=5,w=5;function x(ca){"use strict";this._rootElement=ca;j.empty(this._rootElement);var da=u[':fb:web-messenger:all-people-results'].build();j.setContent(this._rootElement,da.getRoot());this._loadingSpinner=da.getNode('loadingSpinner');this._peopleResults=da.getNode('results');this._loadMoreButton=da.getNode('loadMoreButton');this._loadMoreLink=da.getNode('loadMoreLink');s.addSubscriptions(g.listen(this._loadMoreLink,'click',function(){h.addClass(this._loadMoreButton,'async_saving');this._peopleDataSource&&this._peopleDataSource.loadMore();}.bind(this)));}x.prototype.hideView=function(){"use strict";h.hide(this._rootElement);};x.prototype.updateView=function(){"use strict";var ca=o.getCurrentDetailState();if(ca==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){h.show(this._rootElement);y(this);q.detailDOMChanged();}};x.prototype.destroy=function(){"use strict";};function y(ca){h.show(ca._loadingSpinner);h.hide(ca._peopleResults);h.hide(ca._loadMoreButton);var da=o.getCurrentStateData(),ea=da.all_people_query||'';z(ca);var fa=(da.participants||[]).map(function(ga){return l.tokenize(ga).value;});ca._peopleDataSource.setExclusions(fa);ca._peopleDataSource.query(ea);}function z(ca){if(!ca._peopleDataSource){ca._peopleDataSource=new k({queryEndpoint:'/ajax/mercury/search_people.php'},v,w);ca._peopleDataSource.init();s.addSubscriptions(ca._peopleDataSource.subscribe('respond',aa.curry(ca)),g.listen(ca._rootElement,'click',function(event){var da=event.getTarget().parentNode;if(h.hasClass(da,"_4wt"))ba(event.getTarget(),ca._peopleDataSource);}));}}function aa(ca,da,ea){var fa=o.getCurrentDetailState(),ga=o.getCurrentStateData();if(fa==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS&&ga.all_people_query==ea.value){j.empty(ca._peopleResults);h.show(ca._peopleResults);ea.results.forEach(function(ha){var ia=j.create('div',{className:'personResult'},ha.detail_markup);i.set(ia,'uid',ha.uid);j.appendContent(ca._peopleResults,ia);});if(ea.results.length){h.hide(ca._loadingSpinner);h.conditionShow(ca._loadMoreButton,!ca._peopleDataSource.hasLoadedAllResults());h.conditionClass(ca._loadMoreButton,'async_saving',ca._peopleDataSource.isLoadingMore());}}}function ba(ca,da){var ea=m.byClass(ca,'personResult'),fa=da.getEntry(i.get(ea,'uid')),ga=t(o.getCurrentStateData(),{new_tokens:[new p(fa)],start:false});o.updateDetailState(n.DETAIL.COMPOSE_MAIN,ga);}e.exports=x;});
__d("WebMessengerComposerTypeaheadView",["BucketedTypeaheadView","MercuryConstants","CSS","DataStore","WebMessengerStateConstants","WebMessengerStateManager","copyProperties","cx","fbt","tx"],function(a,b,c,d,e,f){var g=b('BucketedTypeaheadView'),h=b('MercuryConstants'),i=b('CSS'),j=b('DataStore'),k=b('WebMessengerStateConstants'),l=b('WebMessengerStateManager'),m=b('copyProperties'),n=b('cx'),o=b('fbt'),p=b('tx');for(var q in g)if(g.hasOwnProperty(q))s[q]=g[q];var r=g===null?null:g.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=g;function s(w,x){"use strict";g.call(this,w,x);var y=h.MercuryTypeaheadConstants;this.typeObjects={};this.typeObjects[y.FRIEND_TYPE]={disabled:true,uid:y.FRIEND_TYPE,type:y.HEADER_TYPE};this.typeObjects[y.THREAD_TYPE]={uid:y.THREAD_TYPE,text:"Group Conversations",type:y.HEADER_TYPE,linkText:"Show More",getLinkHandler:v.curry(this)};this.typeObjects[y.FB4C_TYPE]={uid:y.THREAD_TYPE,text:"Co-workers",type:y.HEADER_TYPE,linkText:"Show More",getLinkHandler:v.curry(this)};this.typeObjects[y.NON_FRIEND_TYPE]={uid:y.NON_FRIEND_TYPE,text:"Other People",type:y.HEADER_TYPE,linkText:"Show All",getLinkHandler:function(){return function(){u(this.value);}.bind(this);}.bind(this)};}s.prototype.setTypeahead=function(w){"use strict";r.setTypeahead.call(this,w);var x=j.get(w,'Typeahead');x.subscribe('loading',function(y,z){var aa=x.getData();if(this._threadHeader)i.conditionClass(this._threadHeader,"_355",aa.isLoadingMore(this.value));}.bind(this));};s.prototype.setNewHeader=function(w,x){"use strict";if(x.uid===h.MercuryTypeaheadConstants.THREAD_TYPE)this._threadHeader=w;};s.prototype.mouseover=function(event){"use strict";if(!t(this,event))r.mouseover.call(this,event);};s.prototype.mouseup=function(event){"use strict";if(!t(this,event))r.mouseup.call(this,event);};s.prototype.clearSelected=function(){"use strict";this.index=-1;this.highlight(-1);};function t(w,event){var x=w.getIndex(event);return x>=0&&x<w.results.length&&w.results[x].type==h.MercuryTypeaheadConstants.HEADER_TYPE;}function u(w){var x=m(l.getCurrentStateData(),{all_people_query:w,start:false});l.updateDetailState(k.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,x);}function v(w){var x=j.get(w.typeahead,'Typeahead'),y=x.getData();if(y.hasLoadedInitialResults(w.value)&&!y.hasLoadedAllResults(w.value))return y.loadMore.bind(y);}e.exports=s;});
__d("WebMessengerDetailViewComposeTypeaheadControl",["Event","WebMessengerComposerTypeaheadView","MercuryConstants","CSS","WebMessengerDataSources","DOM","MercuryFolders","FreeformTokenizerBehavior","Keys","MercuryDataSourceHelper","MercuryParticipantTypes","MercuryTypeahead","MercuryParticipants","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreads","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTypeaheadRenderer","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('WebMessengerComposerTypeaheadView'),i=b('MercuryConstants'),j=b('CSS'),k=b('WebMessengerDataSources'),l=b('DOM'),m=b('MercuryFolders'),n=b('FreeformTokenizerBehavior'),o=b('Keys'),p=b('MercuryDataSourceHelper'),q=b('MercuryParticipantTypes'),r=b('MercuryTypeahead'),s=b('MercuryParticipants'),t=b('WebMessengerStateConstants'),u=b('WebMessengerStateManager'),v=b('WebMessengerTemplates'),w=b('MercuryThreads').get(),x=b('WebMessengerEvents'),y=b('WebMessengerSubscriptionsHandler'),z=b('WebMessengerTypeaheadRenderer'),aa=b('copyProperties'),ba=b('tx');function ca(ga,ha){"use strict";this._typeaheadRoot=ga;this._resultsRoot=ha;l.empty(this._typeaheadRoot);l.empty(this._resultsRoot);}ca.prototype.hideView=function(){"use strict";j.hide(this._typeaheadRoot);j.hide(this._resultsRoot);};ca.prototype.updateView=function(){"use strict";var ga=t;switch(u.getCurrentDetailState()){case ga.DETAIL.COMPOSE_MAIN:this.renderComposeTypeahead();j.hide(this._resultsRoot);break;case ga.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this.renderComposeTypeahead();j.show(this._resultsRoot);break;}x.detailDOMChanged();};ca.prototype.renderComposeTypeahead=function(){"use strict";var ga=u.getCurrentStateData();j.show(this._typeaheadRoot);j.show(this._resultsRoot);if(!this._initiated){var ha=v[':fb:web-messenger:read-view:compose:typeahead'].build();l.setContent(this._typeaheadRoot,ha.getRoot());var ia=v[':fb:web-messenger:read-view:compose:typeahead:results'].build();l.setContent(this._resultsRoot,ia.getRoot());this._initialResultsLoadingSpinner=ia.getNode('initialResultsLoadingSpinner');this._typeaheadFooter=ia.getNode('typeaheadFooter');this._moreResultsLink=ia.getNode('moreResultsLink');this._typeaheadCaption=ia.getNode('caption');this.buildTypeahead(ia.getNode('results'));l.appendContent(ha.getNode('typeahead'),this._typeahead.getElement());this._initiated=true;}if(ga.start){if(!ga.participants)this._typeahead.reset();this._typeahead.focus();var ja=this._typeahead.getTypeahead().getCore();ja.getElement().removeAttribute('disabled');}ea(this);};ca.prototype.buildTypeahead=function(ga){"use strict";if(this._typeahead)return;var ha=k.WebMessengerComposerDataSource;p.updateMercuryOnFetchComplete(ha);var ia=new r(ha,h);ia.setPlaceholder("Name");ia.setViewNodeID(ga);ia.setViewOption('renderer',z);y.addSubscriptions(ia.subscribe('tokens-changed',this.onTokensChanged.bind(this)));ia.build();y.addSubscriptions(ia.getTypeahead().subscribe(['respond','focus'],function(){da(!!ia.getTypeahead().getCore().getValue());}),ia.getTypeahead().subscribe(['reset','blur'],function(){da(false);}),ia.getTypeahead().subscribe('render',function(ja,ka){fa(this,ka.length);}.bind(this)),ia.getTypeahead().subscribe('reset',function(){fa(this,false);}.bind(this)),ia.getTypeahead().subscribe('query',function(ja,ka){l.setContent(this._moreResultsLink,ba._("See more results for {query}",{query:ka.value}));}.bind(this)),g.listen(ia.getElement(),'keydown',function(ja){if(ja.keyCode===o.TAB&&!ja.getModifiers().any){x.focusComposer();return false;}}),g.listen(this._typeaheadFooter,'mousedown',function(){return false;}),g.listen(this._moreResultsLink,'click',function(){var ja=this._typeahead.getTypeahead().getCore().getValue(),ka=aa(u.getCurrentStateData(),{all_people_query:ja,start:false});u.updateDetailState(t.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,ka);}.bind(this)),g.listen(this._typeaheadFooter,'mouseover',function(){this._typeahead.getTypeahead().getView().clearSelected();}.bind(this)));this._typeahead=ia;};ca.prototype.onTokensChanged=function(){"use strict";var ga=u.getCurrentDetailState();if(ga==t.DETAIL.COMPOSE_MAIN||ga==t.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||ga==t.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){var ha=this._typeahead,ia=ha.getTokens(),ja=ia[ia.length-1];if(ja&&ja.getInfo().mercury_thread){var ka=ja.getInfo().mercury_thread.thread_id,la=m.getFromMeta(w.getThreadMetaNow(ka));u.updateDetailState(t.DETAIL.RECENT_MESSAGES,{thread_id:ka,folder:la,reuse_composer:true});}else{var ma=ia.map(function(oa){if(oa.getInfo().type==i.MercuryTypeaheadConstants.USER_TYPE){return 'fbid:'+oa.getValue();}else return 'email:'+oa.getValue();}),na=u.getCurrentStateData();if(!na.start||(ma||[]).length)u.updateDetailState(t.DETAIL.COMPOSE_MAIN,aa({},na,{participants:ma}));}}};ca.prototype.destroy=function(){"use strict";};function da(ga){var ha=u.getCurrentDetailState(),ia=t;if(ha!=ia.DETAIL.COMPOSE_MAIN&&ha!=ia.DETAIL.COMPOSE_TYPEAHEAD_RESULTS)return;var ja;if(ga){ja=ia.DETAIL.COMPOSE_TYPEAHEAD_RESULTS;}else if(ha==ia.DETAIL.COMPOSE_TYPEAHEAD_RESULTS){ja=ia.DETAIL.COMPOSE_MAIN;}else ja=ha;if(ja!=ha){var ka=aa(u.getCurrentStateData(),{start:false,new_tokens:undefined});u.updateDetailState(ja,ka);}}function ea(ga){var ha=u.getCurrentStateData();if(ha.new_tokens){var ia=ga._typeahead.getTypeahead().getCore();ia.reset();ha.new_tokens.forEach(function(la){ga._typeahead.getTokenizer().addToken(la);});if(ha.new_tokens.length==1){var ja=ha.new_tokens[0],ka=s.getNow('fbid:'+ja.getValue());if(ka&&ka.type==q.PAGE)ia.getElement().setAttribute('disabled','disabled');}}}function fa(ga,ha){var ia=ga._typeahead.getTypeahead(),ja=ia.getCore().getValue(),ka=ia.getData().hasLoadedInitialResults(ja);j.conditionShow(ga._initialResultsLoadingSpinner,!ka);j.conditionShow(ga._moreResultsLink,ka&&ha);if(!ha&&ka){l.setContent(ga._typeaheadCaption,"No results found");}else l.setContent(ga._typeaheadCaption,"Displaying top results");}e.exports=ca;});
__d("WebMessengerUnseenMessageNoticeRenderer",["JSXDOM","ContextualLayer","LayerFadeOnHide","cx","tx","Event"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('ContextualLayer'),i=b('LayerFadeOnHide'),j=b('cx'),k=b('tx'),l=b('Event'),m={renderNoticeTooltip:function(o,p){var q=g.div({className:"_40p"},n(o),g.i({className:"_40q"})),r=new h(p||{},q).enableBehavior(i);return r;}};function n(o){var p=g.div({className:"_40r"},"You have new messages");l.listen(p,'click',o);return p;}e.exports=m;});
__d("WebMessengerMessagesNotice",["LayerDestroyOnHide","WebMessengerUnseenMessageNoticeRenderer","MercuryParticipants"],function(a,b,c,d,e,f){var g=b('LayerDestroyOnHide'),h=b('WebMessengerUnseenMessageNoticeRenderer'),i=b('MercuryParticipants');function j(){"use strict";this._notice=null;this._noticeContextNode=null;this._active=false;}j.prototype.getActive=function(){"use strict";return this._active;};j.prototype.showMessageNotice=function(k,l){"use strict";if(!this._active)return;if(!this._notice)this._notice=h.renderNoticeTooltip(k,{context:this._noticeContextNode,offsetY:2,position:l,alignment:'center'});this._notice.show();};j.prototype.hideMessageNotice=function(){"use strict";this._notice&&this._notice.hide();};j.prototype.removeMessageNotice=function(){"use strict";if(this._notice){this._notice.enableBehavior(g).hide();this._notice=null;}};j.prototype.setNoticeContextNode=function(k){"use strict";this._noticeContextNode=k;};j.prototype.hideView=function(){"use strict";this._active=false;this.hideMessageNotice();};j.prototype.updateView=function(){"use strict";this._active=true;};j.prototype.destroy=function(){"use strict";this._active=false;this.removeMessageNotice();};j.prototype.onlyReceivedFromSelf=function(k){"use strict";for(var l in k){if(!k.hasOwnProperty(l))continue;for(var m=0,n=k[l].length;m<n;m++)if(k[l][m].author!==i.user)return false;}return true;};e.exports=j;});
__d("WebMessengerDetailViewUnreadMessagesNotice",["WebMessengerStateManager","throttle","MercuryThreadInformer","MercuryThreads","UserActivity","WebMessengerMessagesNotice","WebMessengerConstants","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('WebMessengerStateManager'),h=b('throttle'),i=b('MercuryThreadInformer').get(),j=b('MercuryThreads').get(),k=b('UserActivity'),l=b('WebMessengerMessagesNotice'),m=b('WebMessengerConstants'),n=b('WebMessengerSubscriptionsHandler'),o=m.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;for(var p in l)if(l.hasOwnProperty(p))r[p]=l[p];var q=l===null?null:l.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=l;function r(s){"use strict";l.call(this);this._manager=s;n.addSubscriptions(i.subscribe('thread-read-changed',this._updateReadStatus.bind(this)));this._manager.setScrollCallback(h.withBlocking(function(t){if(this._shouldMarkAsRead(t)){this.removeMessageNotice();if(k.isActive(5000)){var u=g.getCurrentStateData().thread_id;j.changeThreadReadStatus(u,true);}else k.subscribeOnce(function(){if(this._shouldMarkAsRead(t)){var v=g.getCurrentStateData().thread_id;j.changeThreadReadStatus(v,true);}}.bind(this));}}.bind(this),100,null));}r.prototype.updateOnMessagesReceived=function(s,t,u,v){"use strict";var w=!k.isActive(o);if(!q.getActive.call(this))return;if(w||q.onlyReceivedFromSelf.call(this,v)){this.removeMessageNotice();this._manager.scrollToBottom(true);}else if(!this._manager.isScrolledToBottom()){var x=u-(t-s);this._manager.setScrollTop(x,false);this.showMessageNotice();}};r.prototype.showMessageNotice=function(){"use strict";var s=function(){this._manager.scrollToBottom();}.bind(this);q.showMessageNotice.call(this,s,'above');};r.prototype._shouldMarkAsRead=function(s){"use strict";var t=g.getCurrentStateData().thread_id;return t&&q.getActive.call(this)&&s.isScrolledToBottom();};r.prototype._updateReadStatus=function(s,t){"use strict";var u=g.getCurrentStateData().thread_id;if(u&&t[u]&&t[u].mark_as_read)this.removeMessageNotice();};e.exports=r;});
__d("MercuryListUpdateRenderer",["DOM","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ge'),i={updateList:function(j,k,l,m,n){var o=[];for(var p=0;p<k.length;p++){if(n){var q=n(p);q&&o.push(q);}var r=h(k[p]);if(r&&l(p)){o.push(r);}else o.push(m(p));}g.setContent(j,o);}};e.exports=i;});
__d("WebMessengerMessageIDFinder",["DataStore","DOM","csx"],function(a,b,c,d,e,f){var g=b('DataStore'),h=b('DOM'),i=b('csx'),j={findAll:function(k){var l=h.scry(k,"._53"),m=[];if(l.length){var n=l[0];for(var o=0;o<n.childNodes.length;o++)m.push(g.get(n.childNodes[o],'MessageRenderer:messageID'));}return m;}};e.exports=j;});
__d("WebMessengerMessagesSelection",["CSS","csx","DOM","getObjectValues","WebMessengerMessageIDFinder"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('csx'),i=b('DOM'),j=b('getObjectValues'),k=b('WebMessengerMessageIDFinder'),l={};function m(p,q){var r=p,s=q;if(r==s)return 0;while(true){r=r.nextSibling;s=s.nextSibling;if(!r||s==p){return 1;}else if(!s||r==q)return -1;}}function n(p,q){var r=p.id,s=i.scry(p,"._yh input")[0];if(q){l[r]=p;g.addClass(p,'selected');s.checked=true;}else{delete l[r];g.removeClass(p,'selected');s.checked=false;}}var o={clear:function(){for(var p in l)n(l[p],false);},selectClick:function(p){n(p,!(p.id in l));},getSelectedMessageIDs:function(){var p=j(l);p.sort(m);var q=[];p.forEach(function(r){q=q.concat(k.findAll(r));});return q;}};e.exports=o;});
__d("WebMessengerThreadMessagesRenderer",["Event","AsyncRequest","MercuryAttachment","MercuryAttachmentRenderer","CSS","DOM","DataStore","HTMLEmailRenderer","HovercardLink","Image.react","LinkController","MercuryActionTypeConstants","MercuryMessageStatus.react","MercuryThreadlistConstants","MercuryTimePassed","MercuryMessageRenderer","MercuryMessages","WebMessengerMessagesSelection","Parent","MercuryParticipants","MercuryParticipantsConstants","React","WebMessengerStateManager","MercuryStatusTemplates","Style","WebMessengerTemplates","MercuryThreadMetadataRenderer","Vector","WebMessengerConstants","WebMessengerSubscriptionsHandler","csx","cx","formatDate","ge","isRTL","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('MercuryAttachment'),j=b('MercuryAttachmentRenderer'),k=b('CSS'),l=b('DOM'),m=b('DataStore'),n=b('HTMLEmailRenderer'),o=b('HovercardLink'),p=b('Image.react'),q=b('LinkController'),r=b('MercuryActionTypeConstants'),s=b('MercuryMessageStatus.react'),t=b('MercuryThreadlistConstants'),u=b('MercuryTimePassed'),v=b('MercuryMessageRenderer'),w=b('MercuryMessages').get(),x=b('WebMessengerMessagesSelection'),y=b('Parent'),z=b('MercuryParticipants'),aa=b('MercuryParticipantsConstants'),ba=b('React'),ca=b('WebMessengerStateManager'),da=b('MercuryStatusTemplates'),ea=b('Style'),fa=b('WebMessengerTemplates'),ga=b('MercuryThreadMetadataRenderer').get(),ha=b('Vector'),ia=b('WebMessengerConstants'),ja=b('WebMessengerSubscriptionsHandler'),ka=b('csx'),la=b('cx'),ma=b('formatDate'),na=b('ge'),oa=b('isRTL'),pa=b('tx'),qa={updateSelection:function(ta){var ua=ca.getCurrentStateData().message_action;k.conditionClass(ta,'selectionEnabled',ua);},setupSelectionListener:function(ta){q.registerHandler(function(ua){var va=ca.getCurrentStateData().message_action;if(va&&y.byClass(ua,'webMessengerMessageGroup'))return false;});ja.addSubscriptions(g.listen(ta,'click',function(event){var ua=ca.getCurrentStateData().message_action;if(ua){var va=null;for(var wa=event.getTarget();wa;wa=wa.parentNode)if(k.hasClass(wa,'webMessengerMessageGroup'))va=wa;va&&x.selectClick(va);}}));},renderForwardedMessages:function(ta,ua){var va=qa.calculateMessageGroups(ua),wa=null;va.forEach(function(xa){var ya=qa.renderMessageGroupArray(xa,true);l.appendContent(ta,ya.getRoot());wa=xa[xa.length-1];});},calculateMessageGroups:function(ta){var ua=[],va=null,wa=null;for(var xa=0,ya=ta.length;xa<ya;xa++){var za=ta[xa],ab=qa.canAppendMessageToLastGroup(wa,za);if(!ab){va=[];ua.push(va);}va.push(za);wa=za;}return ua;},canAppendMessageToLastGroup:function(ta,ua){var va=t.GROUPING_THRESHOLD;if(!ta||ra(ta)||ra(ua)||ta.author!=ua.author||ta.timestamp<ua.timestamp-va||ta.is_spoof_warning!==ua.is_spoof_warning)return false;return true;},renderMessageGroupArray:function(ta,ua,va){var wa=qa.renderMessageGroup(ta[0],ua,va);for(var xa=1;xa<ta.length;xa++)qa.appendMessageToGroup(wa,ta[xa]);return wa;},renderMessageGroup:function(ta,ua,va){var wa=ta.action_type==r.LOG_MESSAGE,xa=wa?fa[':fb:web-messenger:read-view:log-message'].build():fa[':fb:web-messenger:read-view:message-group'].build();xa.getRoot().setAttribute('id',(va||'wm:')+ta.message_id);if(wa){qa.renderSingleLogMessage(xa,ta);}else z.get(ta.author,function(ya){qa.renderSingleMessage(xa,ta,ya,ua);});return xa;},appendMessageToGroup:function(ta,ua){var va=fa[':fb:web-messenger:read-view:message'].build();if(ua.is_filtered_content){var wa=da[':fb:mercury:filtered-message'].build();va.setNodeContent('message',wa.getRoot());}else va.setNodeContent('message',v.formatMessageBody(ua.body,null,true));var xa=s({message:ua});if(xa)ba.renderComponent(xa,va.getNode('status'));var ya=va.getRoot();m.set(ya,'MessageRenderer:messageID',ua.message_id);k.addClass(va.getNode('message'),oa(ua.body)?'direction_rtl':'direction_ltr');l.appendContent(ta.getNode('bodyDiv'),ya);z.get(z.user,function(za){if(za.employee)l.setContent(va.getNode('bugReporting'),fa[':fb:web-messenger:bug-reporting'].render());});},renderSingleLogMessage:function(ta,ua){var va=ta.getNode('attachment');v.renderLogMessage(ta.getNode('icon'),ta.getNode('message'),va,ua);qa.renderStatus(ta,ua);if(ua.log_message_data.image)k.addClass(va.firstChild,"_1_vi");ga.renderTimestamp(ta.getNode('timestamp'),ua.timestamp_absolute,ua.timestamp_relative,ua.timestamp);},renderMessageSeparator:function(ta){var ua=fa[':fb:mercury:timestamp'].render();ua.removeAttribute('title');var va=ta.timestamp_absolute;if(!va)va=ma(new Date(ta.timestamp),{withinWeek:'l',withinYear:'F jS',older:'F jS, Y'});if(w.isFirstMessage(ta))if(ta.timestamp_time_passed===u.TODAY){va="Conversation started today";}else va=pa._("Conversation started {timestamp}",{timestamp:va});l.setContent(ua,va);k.show(ua);return l.create('li',{className:"_2n3"},ua);},renderMessageSeparatorForIndex:function(ta,ua){var va=ta[ua][0];if(ua){var wa=va.timestamp,xa=ta[ua-1],ya=xa[xa.length-1].timestamp,za=ia.READ_VIEW_SEPARATOR_TIME_LIMIT;if(wa-ya<za)return false;}return qa.renderMessageSeparator(va);},renderRawAttachments:function(ta,ua){var va=i.convertRaw(ua.raw_attachments||[]);if(ua.photo_fbids)for(var wa=0;wa<ua.photo_fbids.length;wa++)va.push({preview_loading:true});qa.renderAttachments(ta,va,ua);},renderAttachments:function(ta,ua,va){ua.sort(j.booleanLexicographicComparator([j.isPhotoAttachment,j.isShareAttachment,j.isFileAttachment,j.isErrorAttachment]));var wa=j.renderPhotoAttachments(ua.filter(j.isPhotoAttachment),va,468,16);if(wa)l.appendContent(ta,wa);for(var xa=0;xa<ua.length;xa++){if(j.isPhotoAttachment(ua[xa]))continue;var ya=j.renderAttachment(false,ua[xa],va);ya.error&&l.appendContent(ta,ya.error);ya.content&&l.appendContent(ta,ya.content);}},renderStatus:function(ta,ua){if(ua.status!==undefined){var va=s({message:ua}),wa=ta.getNode('statusContainer');if(wa&&va){ba.renderComponent(va,wa);k.show(wa);}}},renderSingleMessage:function(ta,ua,va,wa){ta.setNodeProperty('bodyDiv','id',ua.message_id);if(ua.html_body){var xa=ta.getNode('fbml');g.listen(xa,'click',function(){new h().setURI('/ajax/messaging/async.php').setReadOnly(true).setMethod('GET').setData({action:'htmlDialog',mid:ua.message_id}).send();return false;});k.show(xa);var ya=ta.getNode('bodyDiv'),za=l.create('div',{className:"_5xl"}),ab=l.create('div',{className:"_5xm"},za);l.setContent(ya,ab);m.set(ab,'MessageRenderer:messageID',ua.message_id);var bb=new n({resizeContent:sa}),cb=function(){bb.makeRich(ua.message_id,za,ua.html_body);};cb.defer();qa.renderStatus(ta,ua);}else qa.appendMessageToGroup(ta,ua);var db;if(va.href){db=l.create('a',{href:va.href},va.name);var eb=z.getUserID(va.id);if(eb)db.setAttribute('data-hovercard',o.constructEndpoint({id:eb}));}else db=va.name;ta.setNodeContent('authorName',db);var fb=ta.getNode('image');k.removeClass(fb,'MercuryThreadImage');var gb=p({alt:va.name,width:aa.IMAGE_SIZE,height:aa.IMAGE_SIZE,src:va.image_src,className:"_50dv"});if(va.href)gb=ba.DOM.a({href:va.href},gb);ba.renderComponent(gb,fb);var hb;if(ua.timestamp_time_passed===u.TODAY){hb='g:ia';}else hb='n/j, g:ia';var ib=ma(new Date(ua.timestamp),hb);ga.renderTimestamp(ta.getNode('timestamp'),ua.timestamp_absolute,ib,ua.timestamp);ta.getNode('mapHovercard').removeAttribute('href');if(ua.coordinates){k.hide(ta.getNode('tooltipForSource'));ga.renderMessageLocation(ta.getNode('mapHovercard'),ta.getNode('locationIcon'),ua.coordinates);}else{ta.getNode('mapHovercard').removeAttribute('data-hovercard');ga.renderMessageSourceTags(ta.getNode('tooltipForSource'),ta.getNode('sourceIcon'),ua.source_tags||[],ua.author_email);ga.renderSpoofWarning(ta.getNode('spoofWarning'),ua.is_spoof_warning,va);}if(ua.subject)ta.setNodeContent('subject',ua.subject);if(ua.has_attachment){var jb=ta.getNode('attachments');if(ua.attachments&&ua.attachments.length===0){qa.renderRawAttachments(jb,ua);}else if(ua.attachments!==null&&ua.attachments.length>0){qa.renderAttachments(jb,ua.attachments,ua);}else if(ua.raw_attachments!=null&&ua.raw_attachments.length>0)qa.renderRawAttachments(jb,ua.raw_attachments);}var kb=ta.getNode('forwards'),lb=ua.forward_count&&w.getMessagesFromIDs(ua.forward_message_ids);if(lb)qa.renderForwardedMessages(kb,lb);k.conditionShow(kb,lb);}};function ra(ta){return ta.action_type==r.LOG_MESSAGE||ta.has_attachment||ta.forward_count||ta.html_body||(ta.body&&ta.body.length>t.MAX_CHARS_BEFORE_BREAK);}function sa(ta,ua,va){var wa=na(ta),xa=l.find(wa,'iframe'),ya=l.find(xa,"^._5xm"),za=ya.firstChild;ea.set(xa,'width',ua+'px');ea.set(xa,'height',(va+1)+'px');xa.setAttribute('scrolling','no');var ab=wa&&ha.getElementDimensions(wa).x/ua;if(ab&&ab<1){ea.set(ya,'height',Math.round(ab*(va+1))+'px');var bb=xa.style,cb=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],db;while(db=cb.shift())if(typeof bb[db]!=='undefined'){ea.set(xa,db,'scale('+ab+','+ab+')');return;}ea.set(za,'zoom',ab);}}e.exports=qa;});
__d("WebMessengerInfoBoxRenderer",["Event","cx","DOM","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('Event'),h=b('cx'),i=b('DOM'),j=b('WebMessengerSubscriptionsHandler'),k={render:function(l,m){var n=i.create('div',{className:"_4rk"},l),o=i.create('div',{}),p=true;m.forEach(function(q){if(!p){var r=i.create('span',{className:"_4rl"},'\u00b7');i.appendContent(o,r);}p=false;var s=i.create('a',{},q.text);if(q.handler)j.addSubscriptions(g.listen(s,'click',q.handler));i.appendContent(o,s);});return i.create('div',{className:"_4rh"},[n,o]);}};e.exports=k;});
__d("WebMessengerDetailViewRecentMessagesControl",["Event","Animation","MercuryLastMessageIndicator","CSS","WebMessengerDetailViewUnreadMessagesNotice","DOM","JoinableConversationMessageFilter","Arbiter","MercuryListUpdateRenderer","MercuryAPIArgsSource","MercuryParticipants","MercuryThreadlistConstants","MercuryMessages","WebMessengerMessagesSelection","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","MercuryThreadInformer","WebMessengerThreadMessagesRenderer","MercuryThreads","UserActivity","WebMessengerConstants","WebMessengerInfoBoxRenderer","WebMessengerMessageIDFinder","WebMessengerSubscriptionsHandler","copyProperties","debounce","formatDate","ge","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Animation'),i=b('MercuryLastMessageIndicator'),j=b('CSS'),k=b('WebMessengerDetailViewUnreadMessagesNotice'),l=b('DOM'),m=b('JoinableConversationMessageFilter'),n=b('Arbiter'),o=b('MercuryListUpdateRenderer'),p=b('MercuryAPIArgsSource'),q=b('MercuryParticipants'),r=b('MercuryThreadlistConstants'),s=b('MercuryMessages').get(),t=b('WebMessengerMessagesSelection'),u=b('MessagingTag'),v=b('WebMessengerStateConstants'),w=b('WebMessengerStateManager'),x=b('Style'),y=b('WebMessengerTemplates'),z=b('MercuryThreadInformer').get(),aa=b('WebMessengerThreadMessagesRenderer'),ba=b('MercuryThreads').get(),ca=b('UserActivity'),da=b('WebMessengerConstants'),ea=b('WebMessengerInfoBoxRenderer'),fa=b('WebMessengerMessageIDFinder'),ga=b('WebMessengerSubscriptionsHandler'),ha=b('copyProperties'),ia=b('debounce'),ja=b('formatDate'),ka=b('ge'),la=b('tx');function ma(eb,fb,gb,hb,ib,jb,kb){"use strict";this._manager=eb;this._rootElement=fb;this._loadingSpinner=gb;this._noSelectedConversation=hb;this._newMessageLink=ib;this._showUnreadLink=jb;l.empty(this._rootElement);this._pagerExponent=-1;var lb=y[':fb:web-messenger:read-view:recent-messages'].build();l.setContent(this._rootElement,lb.getRoot());this._selectedConversationView=lb.getRoot();this._messageList=lb.getNode('messagelist');this._loadMoreButton=lb.getNode('loadMoreButton');this._loadMoreLink=lb.getNode('loadMoreLink');this._loadMoreCount=lb.getNode('loadMoreCount');this._loadingMoreCount=lb.getNode('loadingMoreCount');this._indicatorNode=lb.getNode('lastMessageIndicator');this._unseenMessagesNotice=new k(this._manager);this._unseenMessagesNotice.setNoticeContextNode(kb);this._active=false;this._state=null;this._threadID=null;this._bugReportingEnabled=false;this._currentCountMap={};this._olderMessageID={};this._loadMessagesInFlight={};aa.setupSelectionListener(this._messageList);this._manager.setScrollCallback(ia(db.curry(this),500));ga.addSubscriptions(g.listen(this._loadMoreLink,'click',wa.curry(this)),z.subscribe('messages-reordered',function(mb,nb){var ob=this._threadID&&nb[this._threadID];if(ob)sa(this);}.bind(this)),z.subscribe('messages-updated',function(mb,nb){var ob=this._threadID&&nb[this._threadID];if(ob)var pb=Object.keys(ob),qb=pb.length&&ob[pb[0]];if(ob&&qb)sa(this,nb[this._threadID]);}.bind(this)),z.subscribe('messages-updated',db.curry(this)),z.subscribe('messages-received',function(mb,nb){if(this._threadID&&nb[this._threadID])va(this,nb);}.bind(this)),z.subscribe('thread-read-changed',function(mb,nb){if(nb[this._threadID])ab(this,nb[this._threadID]);}.bind(this)),this._manager.subscribe('scrolledNearTop',function(){this._active&&wa(this);}.bind(this)));}ma.prototype.hideView=function(){"use strict";this._active=false;j.hide(this._rootElement);j.hide(this._loadingSpinner);j.hide(this._noSelectedConversation);this._unseenMessagesNotice.hideView();this._manager._flexArea.setBottomAligned(false);};ma.prototype.updateView=function(){"use strict";this._unseenMessagesNotice.updateView();this._active=true;this._manager._flexArea.setBottomAligned(true);j.show(this._rootElement);var eb=oa(this);pa(this);t.clear();if(eb){qa(this);}else ya(this);};ma.prototype.destroy=function(){"use strict";na(this);this._unseenMessagesNotice.destroy();this._lastMessageIndicator&&this._lastMessageIndicator.destroy();};function na(eb){eb._messagesSubscription&&s.unsubscribe(eb._messagesSubscription.subscriber_id,eb._messagesSubscription.thread_id);eb._messagesSubscription=null;}function oa(eb){var fb=w.getCurrentStateData();if(!eb._threadID||eb._threadID!=fb.thread_id)return true;return false;}function pa(eb){var fb=w.getCurrentStateData();eb._state=w.getCurrentDetailState();eb._threadID=fb.thread_id;eb._selectionEnabled=!!fb.message_action;eb._bugReportingEnabled=fb.bug_reporting_enabled;aa.updateSelection(eb._messageList);j.conditionClass(eb._messageList,'bugReportingEnabled',eb._bugReportingEnabled);}function qa(eb){l.empty(eb._messageList);j.show(eb._loadingSpinner);j.hide(eb._loadMoreButton);na(eb);eb._pagerExponent=-1;eb._lastMessageIndicator&&eb._lastMessageIndicator.destroy();delete eb._lastMessageIndicator;if(eb._threadID){j.show(eb._selectedConversationView);j.hide(eb._noSelectedConversation);if(!eb._olderMessageID[eb._threadID]){ra(eb);}else sa(eb);eb._manager.scrollToBottom(false);}else{cb(eb);j.hide(eb._selectedConversationView);j.show(eb._noSelectedConversation);j.hide(eb._loadingSpinner);}}function ra(eb){eb._loadMessagesInFlight[eb._threadID]=true;eb._currentCountMap[eb._threadID]=da.INITIAL_MESSAGES_LIMIT+1;j.hide(eb._loadMoreButton);var fb=s.getThreadMessagesRange(eb._threadID,0,eb._currentCountMap[eb._threadID],ta.curry(eb),null,p.WEBMESSENGER);if(fb){eb._messagesSubscription={subscriber_id:fb,thread_id:eb._threadID};}else sa(eb);}function sa(eb,fb){if(!eb._threadID||!eb._olderMessageID[eb._threadID])return;var gb=s.getThreadMessagesSinceTimestamp(eb._threadID,bb(eb._olderMessageID[eb._threadID]));if(gb.length>eb._currentCountMap[eb._threadID])eb._currentCountMap[eb._threadID]=gb.length;ua(eb,gb,fb);}function ta(eb,fb){eb._loadMessagesInFlight[eb._threadID]=false;if(fb&&fb.length){var gb=fb[0].timestamp,hb=eb._olderMessageID[eb._threadID]?bb(eb._olderMessageID[eb._threadID]):null;if(!hb||gb<hb)eb._olderMessageID[eb._threadID]=fb[0].message_id;}}function ua(eb,fb,gb){fb=m.filterMessages(function(rb){eb._manager.openUserJoinStatusSheet(rb);},fb,false);j.hide(eb._loadingSpinner);j.conditionShow(eb._loadMoreButton,!s.hasLoadedAllMessages(eb._threadID));var hb=ba.getThreadMetaNow(eb._threadID);if(hb){var ib=hb.message_count-fb.length;ib=(ib<0)?0:ib;l.setContent(eb._loadMoreCount,ib);l.setContent(eb._loadingMoreCount,ib);}var jb=function(rb){var sb,tb=ka('wm:'+rb);if(tb)sb=fa.findAll(tb);return sb||[];},kb=[],lb=aa.calculateMessageGroups(fb),mb={},nb=[];lb.forEach(function(rb){var sb=rb[0].message_id,tb=false;if(gb){tb=rb.some(function(vb){return vb.message_id in gb;});if(!tb){kb=jb(sb);tb=kb.some(function(vb){return vb in gb;});}}if(!tb){kb=jb(sb);if(rb.length==kb.length){for(var ub=0;ub<rb.length;ub++)if(rb[ub].message_id!=kb[ub]){tb=true;break;}}else tb=true;}if(tb)mb[sb]=1;nb.push('wm:'+sb);});var ob=function(rb){return !mb[lb[rb][0].message_id];},pb=function(rb){var sb=lb[rb],tb=aa.renderMessageGroupArray(sb);if(rb==nb.length-1)eb._messageGroup=tb;return tb.getRoot();},qb=function(rb){return aa.renderMessageSeparatorForIndex(lb,rb);};o.updateList(eb._messageList,nb,ob,pb,qb);eb._lastMessage=fb[fb.length-1];xa(eb).setLastMessage(eb._lastMessage);ya(eb);eb._manager.poke();}function va(eb,fb){var gb=fb[eb._threadID];gb=m.filterMessages(function(lb){eb._manager.openUserJoinStatusSheet(lb);},gb,true);var hb=eb._manager._flexArea.getScrollableArea(),ib=hb.getScrollHeight();gb.forEach(function(lb){lb.timestamp_relative=ja(new Date(lb.timestamp),'g:ia');var mb=aa.canAppendMessageToLastGroup(eb._lastMessage,lb);if(!mb){eb._messageGroup=aa.renderMessageGroup(lb);var nb=lb.timestamp,ob=eb._lastMessage?eb._lastMessage.timestamp:0,pb=da.READ_VIEW_SEPARATOR_TIME_LIMIT;if(!ob||nb-ob>=pb){var qb=aa.renderMessageSeparator(lb);l.appendContent(eb._messageList,qb);}l.appendContent(eb._messageList,eb._messageGroup.getRoot());}else aa.appendMessageToGroup(eb._messageGroup,lb);if(lb.author!=q.user)j.addClass(eb._messageGroup.getRoot(),'unreadHighlight');eb._lastMessage=lb;});eb._manager._flexArea.poke();var jb=hb.getScrollHeight(),kb=hb.getScrollTop();eb._unseenMessagesNotice.updateOnMessagesReceived(ib,jb,kb,fb);xa(eb).setLastMessage(eb._lastMessage);if(eb._manager.isScrolledToBottom())ya(eb);}function wa(eb){j.addClass(eb._loadMoreButton,'async_saving');if(eb._loadMessagesInFlight[eb._threadID])return;eb._loadMessagesInFlight[eb._threadID]=true;eb._pagerExponent=Math.min(eb._pagerExponent+1,da.EXPONENTIAL_PAGER_MAX_CYCLES);var fb=Math.pow(2,eb._pagerExponent),gb=eb._currentCountMap[eb._threadID]+(fb*r.WEBMESSENGER_MORE_MESSAGES_COUNT);na(eb);var hb=s.getThreadMessagesRange(eb._threadID,0,gb,function(ib){j.removeClass(eb._loadMoreButton,'async_saving');eb._currentCountMap[eb._threadID]=gb;ta(eb,ib);eb._loadMessagesInFlight[eb._threadID]=false;},null,p.WEBMESSENGER);if(hb){eb._messagesSubscription={subscriber_id:hb,thread_id:eb._threadID};}else sa(eb);}function xa(eb){if(!eb._lastMessageIndicator)eb._lastMessageIndicator=new i(eb._threadID,eb._indicatorNode,null,eb._manager._flexArea);return eb._lastMessageIndicator;}function ya(eb){if(ca.isActive(5000)){za(eb);}else ca.subscribeOnce(za.curry(eb));}function za(eb){if(!eb._threadID||!eb._active)return;ba.changeThreadReadStatus(eb._threadID,true);var fb=l.scry(eb._messageList,'.unreadHighlight');fb.forEach(function(gb){j.removeClass(gb,'unreadHighlight');j.addClass(gb,'unreadFading');new h(gb).from('background','#eceff5').to('background','#fff').from('borderColor','#d6d6d6').to('borderColor','#fff').ease(h.ease.both).duration(1500).ondone(function(){j.removeClass(gb,'unreadFading');x.set(gb,'background','');x.set(gb,'borderColor','');}).go();});}function ab(eb,fb){if(!fb.mark_as_read)return;var gb=l.scry(eb._messageList,'.unreadHighlight');for(var hb=0;hb<gb.length;hb++){var ib=gb[hb],jb=fa.findAll(ib),kb=s.getMessagesFromIDs(jb);if(kb[kb.length-1].timestamp<fb.timestamp)j.removeClass(ib,'unreadHighlight');}}function bb(eb){var fb=s.getMessagesFromIDs([eb])[0];return fb?fb.timestamp:0;}function cb(eb){if(eb._builtNoSelectionBox)return;var fb=function(){var hb=w.getCurrentStateData(),ib=ha({},hb);w.updateDetailState(v.DETAIL.COMPOSE_MAIN,ha(ib,{start:true,thread_id:undefined}));},gb=function(){var hb=w.getCurrentStateData(),ib=ha({},hb);w.updateMasterState(v.MASTER.RECENT_THREADS,ha(ib,{folder:u.INBOX,filter:u.UNREAD}));};l.setContent(eb._noSelectedConversation,ea.render("No Conversation Selected",[{text:"New Message",handler:fb},{text:"Show Unread",handler:gb}]));eb._builtNoSelectionBox=true;}function db(eb){var fb=eb._manager._flexArea.getScrollableArea(),gb=eb._manager.getFlexAreaBoundingClientRect();n.inform('messengerScrolled/'+eb._threadID,{scrollTop:fb.getScrollTop(),top:gb.y,viewHeight:gb.height});}e.exports=ma;});
__d("MercurySearchContextResults",["KeyedCallbackManager","MercuryAPIArgsSource","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests","WebMessengerConstants"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=b('MercuryAPIArgsSource'),i=b('MercuryThreadlistConstants'),j=b('RangedCallbackManager'),k=b('MercuryServerDispatcher'),l=b('MercuryServerRequests').get(),m=b('WebMessengerConstants'),n=new g(),o=i.WEBMESSENGER_SEARCH_SNIPPET_COUNT,p=m.MORE_SEARCH_CONTEXT_COUNT,q={getSearchContext:function(u,v,w){if(u){var x=n.executeOrEnqueue(u,function(aa){var ba=s(aa,u);w(ba);}),y=n.getUnavailableResources(x);if(y.length){var z=l.getServerThreadIDNow(v);t({message_id:u,thread_id:z,limit:o+1});}return x;}},getMoreSearchContext:function(u,v,w,x){if(u){var y=n.getResource(u);if(y){var z=w==m.MORE_SEARCH_CONTEXT_UP?y.up_message_ids:y.down_message_ids,aa=z.getCurrentArraySize()+p,ba=z.executeOrEnqueue(0,aa,function(){var ea=s(y,u);x(ea);}),ca=z.getUnavailableResources(ba);if(ca.length){var da=l.getServerThreadIDNow(v);t({message_id:u,thread_id:da,limit:aa,direction:w});}return ba;}}},handleUpdate:function(u){if(u.mercury_payload)l.handleUpdate(u.mercury_payload);var v=u.search_context||{};for(var w in v){var x=v[w],y=x.thread_id,z=l.getClientThreadIDNow(y),aa=!n.getResource(w),ba=aa?{thread_id:z,up_message_ids:new j(),down_message_ids:new j()}:n.getResource(w),ca=aa?o+1:p;if(x.up_message_ids&&(ba.up_message_ids.getCurrentArraySize()===0||x.up_message_ids.length>=ba.up_message_ids.getCurrentArraySize()))r(ba.up_message_ids,x.up_message_ids,ca);if(x.down_message_ids&&(ba.down_message_ids.getCurrentArraySize()===0||x.down_message_ids.length>=ba.down_message_ids.getCurrentArraySize()))r(ba.down_message_ids,x.down_message_ids,ca);if(aa)n.setResource(w,ba);}},unsubscribe:function(u,v,w){if(v){var x=n.getResource(v);if(x){if(w==m.MORE_SEARCH_CONTEXT_UP){x.up_message_ids.unsubscribe(u);}else x.down_message_ids.unsubscribe(u);}else n.unsubscribe(u);}}};function r(u,v,w){var x=u.getCurrentArraySize(),y=v.length<x+w;if(v.length){u.removeAllResources();u.addResourcesWithoutSorting(v,0);}if(y)u.setReachedEndOfArray();}function s(u,v){var w=u.up_message_ids.hasReachedEndOfArray(),x=u.up_message_ids.getAllResources();if(!w)x.shift();var y=u.down_message_ids.hasReachedEndOfArray(),z=u.down_message_ids.getAllResources();if(!y)z.pop();return {thread_id:u.thread_id,message_id:v,up_message_ids:x,up_exhausted:w,down_message_ids:z,down_exhausted:y};}function t(u){u.client=h.WEBMESSENGER;k.trySend('/ajax/mercury/search_context.php',u);}k.registerEndpoints({'/ajax/mercury/search_context.php':{mode:k.IMMEDIATE,handler:q.handleUpdate}});e.exports=q;});
__d("MercurySearchSnippetResults",["MercuryAPIArgsSource","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests"],function(a,b,c,d,e,f){var g=b('MercuryAPIArgsSource'),h=b('MercuryThreadlistConstants'),i=b('RangedCallbackManager'),j=b('MercuryServerDispatcher'),k=b('MercuryServerRequests').get(),l={},m={},n=null,o=h.WEBMESSENGER_SEARCH_SNIPPET_COUNT,p=h.WEBMESSENGER_SEARCH_SNIPPET_LIMIT,q=h.WEBMESSENGER_SEARCH_SNIPPET_MORE,r={getAllThreadSearchResults:function(ba,ca){if(ba)s(ba,p,0,ca);},getAllThreadSearchMoreResults:function(ba,ca){if(ba){var da=l[ba];if(da){var ea=da.getCurrentArraySize();s(ba,q,ea,ca);}}},getSingleThreadSearchResults:function(ba,ca,da){if(!ba||!ca)return;t(ba,ca,o,0,da);},getSingleThreadSearchMoreResults:function(ba,ca,da){if(!ba||!ca)return;if(!m[ca])return;var ea=m[ca][ba];if(ea){var fa=ea.num_total_snippets,ga=ea.snippets_cbm.getCurrentArraySize(),ha=fa-ga;if(ha>0){var ia=ha>q?q:ha;t(ba,ca,ia,ga,da);}}},countSnippetsMatchingQueryInThread:function(ba,ca){var da=m[ca][ba];if(da)return da.num_total_snippets;},findIndexOfSnippet:function(ba,ca,da,ea){var fa=z(ba,ca),ga=fa.getAllResources();for(var ha=0;ha<ga.length;ha++)if(da===ga[ha].message_id)return ha;},findSnippetAtIndex:function(ba,ca,da,ea){w(ba,ca,da);x(ba,ca,da,ea);},handleUpdate:function(ba){if(ba.mercury_payload)k.handleUpdate(ba.mercury_payload);var ca=ba.search_snippets||{};Object.keys(ca).filter(function(qa){return !!ca[qa];}).forEach(function(qa){Object.keys(ca[qa]).forEach(function(ra){ca[qa][ra].snippets.forEach(function(sa){sa.matched_keywords=u(sa.matched_keywords);});});});var da=ba.offset,ea=[];for(var fa in ca){var ga=ca[fa];for(var ha in ga){var ia=ga[ha],ja=k.getClientThreadIDNow(ha),ka=ia.snippets,la=z(fa,ja),ma=la.getCurrentArraySize();if(!ba.thread_id){ea.push(ja);if(ma)continue;}else if(da!=ma)continue;var na=m[ja][fa];na.num_total_snippets=ia.num_total_snippets;la.addResourcesWithoutSorting(ka,ma);if(!ba.thread_id||ba.limit>ka.length)if(la.getCurrentArraySize()==na.num_total_snippets)la.setReachedEndOfArray();}if(!ba.thread_id){var oa=y(fa),pa=oa.getCurrentArraySize();if(da==pa){oa.addResourcesWithoutSorting(ea,pa);if(ba.limit>ea.length)oa.setReachedEndOfArray();}}}}};function s(ba,ca,da,ea){v();var fa=y(ba),ga=da+ca,ha=fa.executeOrEnqueue(0,ga,function(ja){var ka={};for(var la=0;la<ja.length;la++){var ma=ja[la],na=m[ma][ba];ka[ma]={num_total_snippets:na.num_total_snippets,snippets:na.snippets_cbm.getAllResources()};}var oa=fa.hasReachedEndOfArray();ea(ka,oa);}),ia=fa.getUnavailableResources(ha);if(ia.length){n={query:ba,thread_id:null,subscriber_id:ha};aa({query:ba,offset:da,limit:ca+1,snippetLimit:o});}}function t(ba,ca,da,ea,fa){v();var ga=z(ba,ca),ha=ea+da,ia=ga.executeOrEnqueue(0,ha,function(){var la=ga.getAllResources(),ma=m[ca][ba].num_total_snippets;fa(la,ma);}),ja=ga.getUnavailableResources(ia);if(ja.length){n={query:ba,thread_id:ca,subscriber_id:ia};var ka=k.getServerThreadIDNow(ca);aa({query:ba,thread_id:ka,snippetOffset:ea,snippetLimit:da});}}function u(ba){if(ba instanceof Array){var ca={};for(var da=0;da<ba.length;da++)ca[da.toString()]=ba[da];return ca;}else return ba;}function v(){if(n){if(n.thread_id){var ba=z(n.query,n.thread_id);ba.unsubscribe(n.subscriber_id);}else{var ca=y(n.query);ca.unsubscribe(n.subscriber_id);}n=null;}}function w(ba,ca,da){}function x(ba,ca,da,ea){var fa=m[ca][ba],ga=fa.snippets_cbm.getAllResources(),ha=fa.num_total_snippets,ia=ga.length;if(da<ia){ea(ga[da].message_id);return;}var ja=ha-ia,ka=ja>q?q:ja;t(ba,ca,ka,ia,function(la,ma){x(ba,ca,da,ea);});}function y(ba){if(!l[ba])l[ba]=new i();return l[ba];}function z(ba,ca){if(!m[ca])m[ca]={};var da=m[ca][ba];if(!da){da={num_total_snippets:-1,snippets_cbm:new i()};m[ca][ba]=da;}return da.snippets_cbm;}function aa(ba){ba.client=g.WEBMESSENGER;j.trySend('/ajax/mercury/search_snippets.php',ba);}j.registerEndpoints({'/ajax/mercury/search_snippets.php':{mode:j.IMMEDIATE,handler:r.handleUpdate}});e.exports=r;});
__d("WebMessengerDetailViewSearchContextControl",["Event","CSS","DOM","MercuryMessages","WebMessengerMessagesSelection","MercurySearchContextResults","MercurySearchSnippetResults","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadMessagesRenderer","WebMessengerConstants","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryMessages').get(),k=b('WebMessengerMessagesSelection'),l=b('MercurySearchContextResults'),m=b('MercurySearchSnippetResults'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('WebMessengerTemplates'),q=b('WebMessengerThreadMessagesRenderer'),r=b('WebMessengerConstants'),s=b('WebMessengerSubscriptionsHandler');function t(da,ea,fa){"use strict";this._manager=da;this._rootElement=ea;this._paginationBox=fa;i.empty(this._rootElement);var ga=p[':fb:web-messenger:read-view:search-context'].build(),ha=p[':fb:web-messenger:read-view:search-pagination-box'].build();i.setContent(this._rootElement,ga.getRoot());i.setContent(this._paginationBox,ha.getRoot());this._messagelistRoot=ga.getRoot();this._loadingSpinner=ga.getNode('loadingSpinner');this._messageList=ga.getNode('messagelist');this._loadMoreButton=ga.getNode('loadMoreButton');this._loadMoreLink=ga.getNode('loadMoreLink');this._downMoreButton=ga.getNode('downMoreButton');this._downMoreLink=ga.getNode('downMoreLink');this._nextSnippet=ha.getNode('nextSnippet');this._previousSnippet=ha.getNode('previousSnippet');this._backToSnippetsButton=ha.getNode('backToSnippetsButton');this._snippetCountDescription=ha.getNode('snippetCountDescription');this._paginationBoxCloseButton=ha.getNode('paginationBoxCloseButton');this._state=null;this._threadID=null;this._messageID=null;q.setupSelectionListener(this._messageList);s.addSubscriptions(g.listen(this._loadMoreLink,'click',function(){h.addClass(this._loadMoreButton,'async_saving');ba(this,r.MORE_SEARCH_CONTEXT_UP);}.bind(this)),g.listen(this._downMoreLink,'click',function(){h.addClass(this._downMoreButton,'async_saving');ba(this,r.MORE_SEARCH_CONTEXT_DOWN);}.bind(this)),g.listen(this._nextSnippet,'click',u.curry(this,1)),g.listen(this._previousSnippet,'click',u.curry(this,-1)),g.listen(this._backToSnippetsButton,'click',function(){var ia=o.getCurrentStateData(),ja=ia.single_thread_search?n.DETAIL.SEARCH_THREAD_SNIPPET:n.DETAIL.SEARCH_SNIPPET,ka={folder:ia.folder,message_query:ia.message_query,query:ia.query};if(ia.single_thread_search)ka.thread_id=ia.thread_id;o.updateDetailState(ja,ka);}),g.listen(this._paginationBoxCloseButton,'click',function(){o.updateDetailState(n.DETAIL.RECENT_MESSAGES,{thread_id:o.getCurrentStateData().thread_id});}.bind(this)));}t.prototype.hideView=function(){"use strict";h.hide(this._rootElement);h.hide(this._paginationBox);};t.prototype.updateView=function(){"use strict";h.show(this._rootElement);h.show(this._paginationBox);var da=x(this);y(this);k.clear();if(da)aa(this);};t.prototype.destroy=function(){"use strict";w(this);};function u(da,ea){var fa=o.getCurrentStateData(),ga=m.findIndexOfSnippet(da._messageQuery,fa.thread_id,fa.message_id),ha=ga+ea;h.hide(da._messageList);h.hide(da._loadMoreButton);h.hide(da._downMoreButton);h.show(da._loadingSpinner);m.findSnippetAtIndex(da._messageQuery,fa.thread_id,ha,function(ia){h.show(da._messageList);v(fa,ia);});}function v(da,ea){var fa={folder:da.folder,message_id:ea,message_query:da.message_query,query:da.query,single_thread_search:da.single_thread_search,thread_id:da.thread_id};o.updateDetailState(o.getCurrentDetailState(),fa);}function w(da){da._searchContextSubscription&&l.unsubscribe(da._searchContextSubscription.subscriber_id,da._searchContextSubscription.message_id,da._searchContextSubscription.direction);da._searchThreadsSubscription=null;}function x(da){var ea=o.getCurrentStateData();if(da._threadID!=ea.thread_id)return true;if(da._messageQuery!=ea.message_query)return true;if(da._messageID!=ea.message_id)return true;return false;}function y(da){var ea=o.getCurrentStateData();da._state=o.getCurrentDetailState();da._threadID=ea.thread_id;da._messageQuery=ea.message_query;da._messageID=ea.message_id;da._selectionEnabled=!!ea.message_action;q.updateSelection(da._messageList);h.conditionClass(da._messageList,'bugReportingEnabled',ea.bug_reporting_enabled);}function z(da,ea){i.setAttributes(da,{disabled:ea});var fa=i.find(da,'^label');h.conditionClass(fa,'uiButtonDisabled',ea);}function aa(da){var ea=i.create('strong',{},da._messageQuery),fa=m.countSnippetsMatchingQueryInThread(da._messageQuery,da._threadID),ga=m.findIndexOfSnippet(da._messageQuery,da._threadID,da._messageID),ha=ga+1,ia=i.tx._("{index} of {count} results for {query}",{index:ha,count:fa,query:ea});i.setContent(da._snippetCountDescription,ia);z(da._previousSnippet,ga===0);z(da._nextSnippet,ga===fa-1);i.empty(da._messageList);h.show(da._loadingSpinner);h.hide(da._loadMoreButton);h.hide(da._downMoreButton);w(da);if(da._threadID&&da._messageID){var ja=l.getSearchContext(da._messageID,da._threadID,function(ka){h.hide(da._loadingSpinner);ca(da,ka);});if(ja)da._searchContextSubscription={subscriber_id:ja,message_id:da._messageID};}}function ba(da,ea){w(da);if(da._threadID&&da._messageID){var fa=l.getMoreSearchContext(da._messageID,da._threadID,ea,function(ga){if(ea==r.MORE_SEARCH_CONTEXT_UP){h.removeClass(da._loadMoreButton,'async_saving');}else h.removeClass(da._downMoreButton,'async_saving');ca(da,ga);});if(fa)da._searchContextSubscription={subscriber_id:fa,message_id:da._messageID,direction:ea};}}function ca(da,ea){h.conditionShow(da._loadMoreButton,!ea.up_exhausted);h.conditionShow(da._downMoreButton,!ea.down_exhausted);var fa=ea.up_message_ids.concat([ea.message_id],ea.down_message_ids),ga=j.getMessagesFromIDs(fa);i.empty(da._messageList);var ha=q.calculateMessageGroups(ga);ha.forEach(function(ia,ja){var ka=q.renderMessageSeparatorForIndex(ha,ja);if(ka)i.appendContent(da._messageList,ka);var la=q.renderMessageGroupArray(ia,false,'context:').getRoot(),ma=ia.some(function(na){return na.message_id==ea.message_id;});if(ma)h.addClass(la,'selectedHighlight');i.appendContent(da._messageList,la);});}e.exports=t;});
__d("WebMessengerSearchSnippetsRenderer",["Event","CSS","DOM","Image.react","MercuryMessageRenderer","MercuryParticipants","MercuryParticipantsConstants","React","MercurySearchSnippetResults","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadMetadataRenderer","cx","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('Image.react'),k=b('MercuryMessageRenderer'),l=b('MercuryParticipants'),m=b('MercuryParticipantsConstants'),n=b('React'),o=b('MercurySearchSnippetResults'),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateManager'),r=b('WebMessengerTemplates'),s=b('MercuryThreadMetadataRenderer').get(),t=b('cx'),u=b('tx'),v={renderMultipleSnippetBlocks:function(ba,ca,da){da=da||{};var ea=true;for(var fa in da){ea=false;var ga=r[':fb:web-messenger:read-view:search-snippets-block'].build();i.appendContent(ba,ga.getRoot());v.renderSingleSnippetBlock(ga,ca,fa,da[fa]);}if(ea)aa(ba);},renderThreadSnippetBlock:function(ba,ca,da,ea,fa){if(!ea||!ea.length){aa(ba);return;}var ga=r[':fb:web-messenger:read-view:search-snippets-block'].build();i.appendContent(ba,ga.getRoot());h.hide(ga.getNode('searchThreadName'));w(ga,ca,da,ea,fa);},renderSingleSnippetBlock:function(ba,ca,da,ea){var fa=ba.getNode('searchThreadName'),ga=i.create('h3');i.setContent(fa,ga);s.renderAndSeparatedParticipantList(da,ga);w(ba,ca,da,ea.snippets,ea.num_total_snippets);},renderMultipleSnippets:function(ba,ca,da,ea){(ea||[]).forEach(function(fa){var ga=r[':fb:web-messenger:read-view:search-snippet'].build();i.appendContent(ba,ga.getRoot());l.get(fa.author,function(ha){v.renderSingleSnippet(ga,ca,da,fa,ha);});});},renderSingleSnippet:function(ba,ca,da,ea,fa){ba.setNodeProperty('bodyDiv','id','snippet:'+ea.message_id);var ga=ea.matched_keywords||undefined,ha=k.formatMessageBody(ea.body,ga);ba.setNodeContent('body',ha);var ia=ba.getNode('image');h.removeClass(ia,'MercuryThreadImage');h.addClass(ia,'MercuryMediumThreadImage');var ja=j({width:m.IMAGE_SIZE,height:m.IMAGE_SIZE,src:fa.image_src});if(fa.href)ja=n.DOM.a({href:fa.href},ja);n.renderComponent(ja,ia);var ka=fa.short_name;ba.setNodeContent('shortName',i.tx._("{name}: ",{name:ka}));s.renderTimestamp(ba.getNode('timestamp'),ea.timestamp_absolute,ea.timestamp_relative,ea.timestamp);var la=ba.getNode('seeContext');g.listen(la,'click',function(){var ma=q.getCurrentStateData(),na={message_query:ca,query:ma.query,thread_id:da,message_id:ea.message_id},oa=q.getCurrentDetailState();if(oa===p.DETAIL.SEARCH_THREAD_SNIPPET)na.single_thread_search=true;q.updateDetailState(p.DETAIL.SEARCH_CONTEXT,na);return false;});}};function w(ba,ca,da,ea,fa){var ga=ba.getNode('snippetList');v.renderMultipleSnippets(ga,ca,da,ea);var ha=fa-ea.length;x(ba,ca,da,fa,ha);}function x(ba,ca,da,ea,fa){var ga=ba.getNode('totalSnippetsCount'),ha=ba.getNode('moreSnippetsLink');h.conditionShow(ha,fa>0);if(fa>0){var ia=z(fa);i.setContent(ha,ia);}i.setContent(ga,y(ea));if(fa>0)g.listen(ha,'click',function(){o.getSingleThreadSearchMoreResults(ca,da,function(ja){i.empty(ba.getNode('snippetList'));w(ba,ca,da,ja,ea);});});}function y(ba){if(ba==1){return "1 result in total";}else return u._("{count} results in total",{count:ba});}function z(ba){if(ba==1){return "Show 1 more result";}else return u._("Show {count} more results",{count:ba});}function aa(ba){var ca="No results",da=i.create('div',{className:"_2n4"},ca);i.setContent(ba,da);}e.exports=v;});
__d("WebMessengerDetailViewSearchSnippetsControl",["JSXDOM","Event","CSS","DOM","MercurySearchSnippetResults","WebMessengerSearchSnippetsRenderer","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerPermalinks","WebMessengerSubscriptionsHandler","cx","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Event'),i=b('CSS'),j=b('DOM'),k=b('MercurySearchSnippetResults'),l=b('WebMessengerSearchSnippetsRenderer'),m=b('WebMessengerStateConstants'),n=b('WebMessengerStateManager'),o=b('WebMessengerTemplates'),p=b('WebMessengerPermalinks'),q=b('WebMessengerSubscriptionsHandler'),r=b('cx'),s=b('tx');function t(y,z){"use strict";this._manager=y;this._rootElement=z;j.empty(this._rootElement);var aa=o[':fb:web-messenger:read-view:search-snippets'].build();j.setContent(this._rootElement,aa.getRoot());this._loadingSpinner=aa.getNode('loadingSpinner');this._messageList=aa.getNode('messagelist');this._downMoreButton=aa.getNode('downMoreButton');this._downMoreLink=aa.getNode('downMoreLink');this._state=null;this._messageQuery=null;this._threadID=null;i.hide(this._downMoreButton);q.addSubscriptions(h.listen(this._downMoreLink,'click',function(){i.addClass(this._downMoreButton,'async_saving');x(this);}.bind(this)));}t.prototype.hideView=function(){"use strict";i.hide(this._rootElement);};t.prototype.updateView=function(){"use strict";i.show(this._rootElement);var y=u(this);v(this);if(y)w(this);};t.prototype.destroy=function(){"use strict";};function u(y){var z=n.getCurrentDetailState();if(y._state!=z)return true;var aa=n.getCurrentStateData();if(y._messageQuery!=aa.message_query)return true;if(z==m.DETAIL.SEARCH_THREAD_SNIPPET)if(y._threadID!=aa.thread_id)return true;return false;}function v(y){y._state=n.getCurrentDetailState();var z=n.getCurrentStateData();y._threadID=z.thread_id;y._messageQuery=z.message_query;}function w(y){i.hide(y._downMoreButton);j.empty(y._messageList);if(y._messageQuery){i.show(y._loadingSpinner);if(y._state===m.DETAIL.SEARCH_THREAD_SNIPPET&&y._threadID){k.getSingleThreadSearchResults(y._messageQuery,y._threadID,function(z,aa){i.hide(y._loadingSpinner);l.renderThreadSnippetBlock(y._messageList,y._messageQuery,y._threadID,z,aa);var ba=g.a({className:"_4-ii"},s._("Search all conversations for \"{query}\"",{query:y._messageQuery})),ca=p.getURI(m.MASTER.SEARCH,m.DETAIL.SEARCH_SNIPPET,{query:y._messageQuery,message_query:y._messageQuery});ba.setAttribute('href',ca);j.prependContent(y._messageList,g.div({className:"_4-ij"},ba));});}else k.getAllThreadSearchResults(y._messageQuery,function(z,aa){i.hide(y._loadingSpinner);l.renderMultipleSnippetBlocks(y._messageList,y._messageQuery,z);i.conditionShow(y._downMoreButton,!aa);});}}function x(y){if(y._messageQuery)k.getAllThreadSearchMoreResults(y._messageQuery,function(z,aa){i.removeClass(y._downMoreButton,'async_saving');j.empty(y._messageList);l.renderMultipleSnippetBlocks(y._messageList,y._messageQuery,z);i.conditionShow(y._downMoreButton,!aa);});}e.exports=t;});
__d("Ellipsizer",["CSS","DOM","Style","UserAgent","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('UserAgent'),k=b('cx'),l=1.3;function m(n){this.elements=[];n.forEach(function(o){g.addClass(o,"_6qy");this.elements.push({node:o});}.bind(this));return this;}m.prototype._analyzeElements=function(){var n;this.elements.forEach(function(o){n=o.node;while(n.children.length===1)n=n.children[0];if(n===o.node)i.set(n,'width','');j.ie()&&i.set(n,'position','absolute');o.width=n.offsetWidth;j.ie()&&i.set(n,'position','');});this.elements.sort(function(o,p){return o.width-p.width;});};m.prototype.confineWithin=function(n){this._analyzeElements();var o=n;this.elements.forEach(function(p,q){var r=Math.floor(o/(this.elements.length-q));if(p.width<=r||p.width<=0||r<=0||(p.width<=r*l&&o>=r*l)){g.removeClass(p.node,"_6s5");i.set(p.node,'width','');o-=p.width;if(p.titleSet){p.node.setAttribute('title','');p.titleSet=false;}}else{g.addClass(p.node,"_6s5");i.set(p.node,'width',r+'px');o-=r;if(!p.titleSet&&!p.node.getAttribute('title')){p.node.setAttribute('title',h.getText(p.node));p.titleSet=true;}}}.bind(this));};e.exports=m;});
__d("TabIndexDelegator",["CSS","DOM","Event","Focus","JSXDOM"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Event'),j=b('Focus'),k=b('JSXDOM');function l(m,n){"use strict";this._placeholder=n||k.button(null);this._placeholder.setAttribute('aria-describedby',h.getID(m));g.addClass(this._placeholder,'accessible_elem');this._listener=i.listen(this._placeholder,'click',function(){m.click();});j.relocate(this._placeholder,m);this.enable();}l.prototype.enable=function(){"use strict";g.show(this._placeholder);};l.prototype.disable=function(){"use strict";g.hide(this._placeholder);};l.prototype.getPlaceholder=function(){"use strict";return this._placeholder;};l.prototype.destroy=function(){"use strict";this._listener.remove();h.remove(this._placeholder);};e.exports=l;});
__d("UnsentMessageDialog",["Dialog","WebMessengerEvents","fbt"],function(a,b,c,d,e,f){var g=b('Dialog'),h=b('WebMessengerEvents'),i=b('fbt'),j={get:function(){var k=[{label:"Don't Send",name:g.OK.name},{label:"Stay on Message",name:g.CANCEL.name,className:g.CANCEL.className}];return new g().setTitle("Don't Send Message?").setBody("If you leave this page, your message won't be sent.").setButtons(k).setCloseHandler(h.inform.bind(h,h.FOCUS_COMPOSER)).setModal(true);}};e.exports=j;});
__d("WebMessengerForwardedMessages",["Event","CSS","DOM","MercuryMessages","WebMessengerThreadMessagesRenderer","WebMessengerEvents","WebMessengerSubscriptionsHandler","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryMessages').get(),k=b('WebMessengerThreadMessagesRenderer'),l=b('WebMessengerEvents'),m=b('WebMessengerSubscriptionsHandler'),n=b('tx');function o(p,q,r,s){"use strict";this._parent=p;this._title=q;this._shelf=r;this._closeButton=s;this._forwardedMessages=[];m.addSubscriptions(g.listen(this._closeButton,'click',this.clear.bind(this)));}o.prototype.setForwardedMessages=function(p){"use strict";this._forwardedMessages=p;this._render();};o.prototype.clear=function(){"use strict";this._forwardedMessages=[];this._render();};o.prototype.getForwardedMessages=function(){"use strict";return this._forwardedMessages||[];};o.prototype._render=function(){"use strict";i.empty(this._shelf);var p=this._forwardedMessages.length;if(p){var q=(p===1)?"1 forwarded message":n._("{num} forwarded messages",{num:p});i.setContent(this._title,q);k.renderForwardedMessages(this._shelf,j.getMessagesFromIDs(this._forwardedMessages));}h.conditionShow(this._parent,p);l.detailDOMChanged();};e.exports=o;});
__d("WebMessengerDetailViewBottomShelfControl",["Event","Arbiter","ARIA","AsyncDialog","AsyncRequest","Button","MercuryConstants","CSS","DOM","MercuryDraftsController","Ellipsizer","Focus","fbt","MercuryFolders","Input","Keys","Locale","UserAgent","MercuryAPIArgsSource","MercuryConfig","MercuryFileUploader","MercuryPhotoUploader","MercuryShareLinkUploader","MercurySourceType","MercuryMessages","MessagesEmoticonView","PageTransitions","PhotosUploadWaterfall","PUWMethods","WebMessengerPreferences","React","Run","WebMessengerStateConstants","WebMessengerStateManager","StickersFlyout.react","Style","TabIndexDelegator","WebMessengerTemplates","TextAreaControl","MercuryThreadInformer","MercuryThreads","UnsentMessageDialog","VaultBoxURI","Vector","WebMessengerEvents","WebMessengerForwardedMessages","WebMessengerSubscriptionsHandler","copyProperties","csx","isWebMessengerURI","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ARIA'),j=b('AsyncDialog'),k=b('AsyncRequest'),l=b('Button'),m=b('MercuryConstants'),n=b('CSS'),o=b('DOM'),p=b('MercuryDraftsController').get(),q=b('Ellipsizer'),r=b('Focus'),s=b('fbt'),t=b('MercuryFolders'),u=b('Input'),v=b('Keys'),w=b('Locale'),x=b('UserAgent'),y=b('MercuryAPIArgsSource'),z=b('MercuryConfig'),aa=b('MercuryFileUploader'),ba=b('MercuryPhotoUploader'),ca=b('MercuryShareLinkUploader'),da=b('MercurySourceType'),ea=b('MercuryMessages').get(),fa=b('MessagesEmoticonView'),ga=b('PageTransitions'),ha=b('PhotosUploadWaterfall'),ia=b('PUWMethods'),ja=b('WebMessengerPreferences'),ka=b('React'),la=b('Run'),ma=b('WebMessengerStateConstants'),na=b('WebMessengerStateManager'),oa=b('StickersFlyout.react'),pa=b('Style'),qa=b('TabIndexDelegator'),ra=b('WebMessengerTemplates'),sa=b('TextAreaControl'),ta=b('MercuryThreadInformer').get(),ua=b('MercuryThreads').get(),va=b('UnsentMessageDialog'),wa=b('VaultBoxURI'),xa=b('Vector'),ya=b('WebMessengerEvents'),za=b('WebMessengerForwardedMessages'),ab=b('WebMessengerSubscriptionsHandler'),bb=b('copyProperties'),cb=b('csx'),db=b('csx'),eb=b('isWebMessengerURI'),fb=b('tx'),gb="_1rh";function hb(kc,lc){"use strict";this._manager=kc;this._rootElement=lc;this._sendOnEnterDefault=ja.sendOnEnter;o.empty(this._rootElement);var mc=ra[':fb:web-messenger:read-view:bottom-shelf'].build();o.setContent(this._rootElement,mc.getRoot());this._bottomShelfToolbar=mc.getNode('toolbar');this._bottomShelfComposer=mc.getNode('composer');this._bottomShelfButtons=mc.getNode('buttons');this._autogrowContainer=mc.getNode('autogrowContainer');this._composerBox=mc.getNode('composerTextarea');this._composerGrid=mc.getNode('composerGrid');this._sendContainer=mc.getNode('sendContainer');this._replyButton=mc.getNode('replyButton');this._uploadingWarning=mc.getNode('uploadingWarning');this._replyButtonLabel=o.find(this._sendContainer,"._1ri");this._sendOnEnterButton=mc.getNode('sendOnEnterButton');this._loadingIndicator=mc.getNode('loadingIndicator');this._cannotReplyAlert=mc.getNode('noReplyMessage');this._ariaOwns=this._composerBox.getAttribute('aria-owns');ab.addSubscriptions(g.listen(this._autogrowContainer,'click',this.focusComposer.bind(this)),ya.subscribe(ya.UPDATE_SELECTION,jc.curry(this)),ya.subscribe(ya.FOCUS_COMPOSER,this.focusComposer.bind(this)));this._emoteWrapper=mc.getNode('emoteWrapper');this._emoticonsPanel=new fa(mc.getNode('emoticons'),this._composerBox);var nc=mc.getNode('stickers');if(nc)ka.renderComponent(oa({onStickerSelect:function(qc){ub(this,qc);}.bind(this)}),nc);this._messageSent=false;this._fileUploader=new aa(mc.getNode('attachmentShelf'),mc.getNode('attachButtonForm'),mc.getNode('fileInput'),mc.getNode('attachID'));this._forwardedMessages=new za(mc.getNode('forwardedMessages'),mc.getNode('forwardedMessagesTitle'),mc.getNode('forwardedMessagesShelf'),mc.getNode('forwardedMessagesCloseButton'));this._shareLinkUploader=new ca(mc.getNode('shareStage'),mc.getNode('shareStageContent'),mc.getNode('shareStageLoadingIndicator'),mc.getNode('shareStageCloseButton'),this._composerBox);r.relocate(this._replyButton,this._replyButtonLabel);this._delegator=new qa(this._replyButtonLabel);o.prependContent(this._bottomShelfToolbar,this._delegator.getPlaceholder());d(['TypingDetectorController'],function(qc){this._typingDetector=new qc(null,this._composerBox,'web-messenger',null,null);ic(this);}.bind(this));this._photoUploader=new ba(this._composerGrid,mc.getNode('photoButton'),ab,mc.getNode('composer'));var oc=false;ab.addSubscriptions(this._photoUploader.subscribe('dom-updated',ya.detailDOMChanged.bind(ya)),this._photoUploader.subscribe('menu-show',function(qc,rc){if(!oc){this.waterfallStep(ha.BEGIN,rc);oc=true;}}.bind(this)),this._photoUploader.subscribe('selection-start',function(qc,rc){this.waterfallStep(ha.SELECT_START,rc);}.bind(this)),this._photoUploader.subscribe('upload-started',function(qc,rc){this.waterfallStep(ha.IMAGES_SELECTED,{method:rc.method||this._photoUploader.getCurrentMethod()});this.waterfallStep(ha.UPLOAD_START,{count:rc.imageCount});}.bind(this)),this._photoUploader.subscribe('upload-completed',function(qc,rc){var sc=this._photoUploader.getCurrentMethod();if(sc!==ia.FILE_SELECTOR)this.waterfallStep(ha.IMAGES_SELECTED,{method:sc});for(var tc=0;tc<rc.fbids.length;++tc)this.waterfallStep(ha.ONE_UPLOAD_DONE);this._composerBox.focus();var uc="A photo has been attached to your message.";i.notify(uc);}.bind(this)),this._photoUploader.subscribe('all-uploads-completed',function(qc,rc){if(this._blockedOnUpload){xb(this,false);vb(this);}this.waterfallStep(ha.ALL_UPLOADS_DONE,rc);}.bind(this)));var pc=o.scry(this._bottomShelfToolbar,"._6q-");pc.push(mc.getNode('sendOnEnterButtonLabel'));this._ellipsizer=new q(pc);ab.addSubscriptions(this._fileUploader.subscribe('all-uploads-completed',function(){if(this._blockedOnUpload){xb(this,false);vb(this);}}.bind(this)),this._fileUploader.subscribe('upload-canceled',xb.curry(this,false)),this._fileUploader.subscribe('dom-updated',ya.detailDOMChanged.bind(ya)));this._confirmationSubscription=na.registerConfirmationBeforeStateUpdate(function(qc,rc,sc){if(!p.canSaveDrafts(this._threadID)&&ec(this)&&ib(this,rc,sc))return va.get();return false;}.bind(this));fc(this);ab.addSubscriptions(h.subscribe('page_transition',function(qc,rc){if(eb(rc.uri))fc(this);}.bind(this)),this._shareLinkUploader.subscribe('link-detected',ya.detailDOMChanged.bind(ya)),this._shareLinkUploader.subscribe('closed',this.focusComposer.bind(this)));sa.getInstance(this._composerBox).subscribe('resize',function(){ya.detailDOMChanged();}.bind(this));hc(this);ab.addSubscriptions(g.listen(this._replyButtonLabel,'click',vb.curry(this)),g.listen(this._replyButton,'keydown',kb.curry(this)),g.listen(this._composerBox,'keydown',kb.curry(this)),g.listen(this._sendOnEnterButton,'click',mb.curry(this)),g.listen(mc.getNode('cancelButton'),'click',yb),g.listen(mc.getNode('deleteButton'),'click',zb.curry(this)),g.listen(mc.getNode('forwardButton'),'click',dc.curry(this)),g.listen(mc.getNode('reportSpamButton'),'click',bc.curry(this)),ya.subscribe(ya.DETAIL_DOM_CHANGED,lb.curry(this)));ab.addSubscriptions(ta.subscribe('threads-updated',function(qc,rc){rc[this._threadID]&&this.updateView();}.bind(this)));}hb.prototype.waterfallStep=function(kc,lc){"use strict";var mc=this._photoUploader.getWaterfallID();if(!mc)return;ha.sendSignal(bb({qn:mc,step:kc,uploader:ha.APP_MESSENGER},lc||{}));};hb.prototype.hideView=function(){"use strict";n.hide(this._rootElement);};hb.prototype.updateView=function(){"use strict";var kc=na.getCurrentDetailState();n.show(this._rootElement);var lc=na.getCurrentStateData();ib(this,kc,lc)&&wb(this);n.hide(this._bottomShelfComposer);n.removeClass(this._bottomShelfComposer,'invisible_elem');n.hide(this._bottomShelfButtons);n.show(this._sendOnEnterButton);n.hide(this._cannotReplyAlert);ob(this,this._sendOnEnterDefault);switch(kc){case ma.DETAIL.RECENT_MESSAGES:case ma.DETAIL.SEARCH_CONTEXT:this._threadID=lc.thread_id;if(lc.message_action==ma.MESSAGE_ACTION.DELETE||lc.message_action==ma.MESSAGE_ACTION.FORWARD||lc.message_action==ma.MESSAGE_ACTION.REPORT_SPAM){gc(this,lc.message_action);}else if(this._threadID)ua.getThreadMeta(this._threadID,function(mc){if(ua.canReply(this._threadID)){n.show(this._bottomShelfComposer);hc(this);p.loadDraft(this._threadID,this._composerBox,this._fileUploader,this._shareLinkUploader,this._photoUploader);this._shareLinkUploader.check();}else{var nc=mc.recipients_loadable||mc.recipients_loadable===undefined,oc=nc?"You cannot reply to this conversation":"You cannot reply to this conversation. Either the recipient's account was disabled or its privacy settings don't allow replies.";n.show(this._cannotReplyAlert);o.setContent(this._cannotReplyAlert,oc);}jb(this,mc);}.bind(this));break;case ma.DETAIL.COMPOSE_MAIN:this._threadID=null;n.show(this._bottomShelfComposer);hc(this);jb(this,null);break;default:this._threadID=null;break;}ic(this);ya.detailDOMChanged();this._state=kc;};hb.prototype.focusComposer=function(){"use strict";this._composerBox.focus();};hb.prototype.submitReply=function(){"use strict";vb(this);};hb.prototype.destroy=function(){"use strict";this._emoticonsPanel&&this._emoticonsPanel.destroy();this._fileUploader.destroy();na.unregisterConfirmationBeforeStateUpdate(this._confirmationSubscription);};function ib(kc,lc,mc){switch(lc){case ma.DETAIL.RECENT_MESSAGES:case ma.DETAIL.SEARCH_CONTEXT:return !mc.reuse_composer&&(kc._threadID!=mc.thread_id||kc._state!=lc);case ma.DETAIL.COMPOSE_MAIN:return mc.start;case ma.DETAIL.SEARCH_SNIPPET:case ma.DETAIL.SEARCH_THREAD_SNIPPET:case ma.DETAIL.SHARED_PHOTOS:return true;}return false;}function jb(kc,lc){var mc,nc;if(!lc){mc="Send";nc="Write a message...";}else if(lc.participants&&lc.participants.length<=2){mc="Reply";nc="Write a reply...";}else{mc="Reply All";nc="Write a reply...";}if(kc._composerBox.getAttribute('placeholder')!=nc)u.setPlaceholder(kc._composerBox,nc);l.setLabel(kc._replyButton,mc);rb(kc);}function kb(kc,event){var lc=event.getModifiers();if(lc.any&&event.keyCode!==v.RETURN)return;var mc=false;switch(event.keyCode){case v.SPACE:mc=event.getTarget()===kc._replyButton;break;case v.RETURN:var nc=!n.hasClass(kc._bottomShelfComposer,gb),oc=event.getTarget()===kc._replyButton,pc=false;if(!nc){if(x.windows()){pc=lc.control;}else if(x.osx()){pc=lc.meta;}else pc=lc.control||lc.meta;}else if(event.getModifiers().any)return;mc=oc||nc||pc;break;case v.UP:case v.DOWN:var qc=na.getCurrentDetailState();if(kc._composerBox.value||qc!=ma.DETAIL.RECENT_MESSAGES)event.stop();break;}if(mc){vb(kc);kc.focusComposer();return false;}}function lb(kc){hc(kc);pb(kc);}function mb(kc){nb(kc);var lc=!kc._sendOnEnterDefault;kc.focusComposer();kc._sendOnEnterDefault=lc;ja.sendOnEnter=lc;var mc={action:'setPreferences',send_on_enter:lc};new k('/ajax/messaging/async.php').setData(mc).send();}function nb(kc){n.toggleClass(kc._bottomShelfComposer,gb);if(n.hasClass(kc._bottomShelfComposer,gb)){kc._sendOnEnterButton.setAttribute('aria-checked','false');}else kc._sendOnEnterButton.setAttribute('aria-checked','true');rb(kc,true);ya.detailDOMChanged();}function ob(kc,lc){if(lc==n.hasClass(kc._bottomShelfComposer,gb))nb(kc);}function pb(kc){var lc;if(n.hasClass(kc._bottomShelfComposer,gb)){lc=qb(kc);}else lc=0;var mc=xa.getElementDimensions(kc._bottomShelfToolbar).x;kc._ellipsizer.confineWithin(mc-lc-120);}function qb(kc){return xa.getElementDimensions(kc._replyButtonLabel).x+20;}function rb(kc,lc){var mc='',nc='';if(!n.hasClass(kc._bottomShelfComposer,gb)){nc=qb(kc)+'px';mc='-1';kc._delegator.disable();}else kc._delegator.enable();n.conditionClass(kc._sendContainer,'transition',lc);kc._replyButton.setAttribute('tabindex',mc);pa.set(kc._sendContainer,w.isRTL()?'right':'left',nc);}function sb(kc){var lc=na.getCurrentStateData(),mc=ea.constructUserGeneratedMessageObject(u.getValue(kc._composerBox),da.TITAN_WEB,lc.thread_id,lc.participants),nc=kc._fileUploader.getAttachments();if(nc&&nc.length){mc.has_attachment=true;mc.raw_attachments=nc;}var oc=kc._photoUploader.getSelectedFBIDs();if(oc.length>0){mc.has_attachment=true;mc.photo_fbids=oc;}var pc=kc._fileUploader.getImageFiles();if(pc.length>0){mc.has_attachment=true;mc.image_ids=pc;}if(kc._shareLinkUploader.getAttachData()){mc.has_attachment=true;mc.content_attachment=kc._shareLinkUploader.getAttachData();}mc.forward_message_ids=kc._forwardedMessages.getForwardedMessages();mc.forward_count=mc.forward_message_ids.length;mc.force_sms=true;mc.ui_push_phase=m.UIPushPhase;return mc;}function tb(kc,lc,mc){kc.waterfallStep(ha.SESSION_POSTED);kc._sendSubscription=ea.sendMessage(lc,function(nc){kc.waterfallStep(ha.POST_PUBLISHED);if(!mc){p.clearDraft(nc);wb(kc);}kc._messageSent=true;var oc=t.getFromMeta(ua.getThreadMetaNow(nc));na.updateDetailState(ma.DETAIL.RECENT_MESSAGES,{thread_id:nc,folder:oc,reuse_composer:mc});kc._messageSent=false;},y.WEBMESSENGER);kc.focusComposer();}function ub(kc,lc){var mc=na.getCurrentStateData(),nc=ea.constructUserGeneratedMessageObject('',da.TITAN_WEB,mc.thread_id,mc.participants);if(!nc.thread_id&&!nc.specific_to_list.length)return;nc.has_attachment=true;nc.sticker_id=lc;tb(kc,nc,true);}function vb(kc){if(kc._fileUploader.isUploading()||kc._photoUploader.isUploading()){xb(kc,true);return;}var lc=sb(kc),mc=u.isEmpty(kc._composerBox);if((mc&&!lc.has_attachment&&!lc.forward_count)||(!lc.thread_id&&!lc.specific_to_list.length))return;n.show(kc._loadingIndicator);n.hide(kc._replyButtonLabel);kc._composerBox.setAttribute('disabled','disabled');tb(kc,lc);}function wb(kc){u.reset(kc._composerBox);hc(kc);kc._typingDetector&&kc._typingDetector.resetState();kc._fileUploader.removeAttachments();kc._forwardedMessages.clear();kc._shareLinkUploader.clear();if(kc._photoUploader.getSelectedFBIDs().length>0)kc._photoUploader.clear();n.hide(kc._loadingIndicator);n.show(kc._replyButtonLabel);kc._composerBox.removeAttribute('disabled');if(kc._sendSubscription){ea.unsubscribeSend(kc._sendSubscription);kc._sendSubscription=null;}xb(kc,false);}function xb(kc,lc){n.conditionShow(kc._uploadingWarning,lc);kc._blockedOnUpload=lc;}function yb(){var kc=na.getCurrentDetailState(),lc=na.getCurrentStateData();delete lc.message_action;na.updateDetailState(kc,lc);}function zb(kc){var lc=kc._manager.getSelectedMessageIDs().length;j.send(new k('/ajax/mercury/delete_messages_dialog.php').setData({count:lc}),function(mc){mc.subscribe('confirm',ac.curry(kc,mc));});}function ac(kc,lc){var mc=kc._manager.getSelectedMessageIDs();ea.deleteMessages(kc._threadID,mc);lc.hide();var nc=na.getCurrentStateData();if(nc.message_action){var oc=bb({},nc);delete oc.message_action;na.updateDetailState(na.getCurrentDetailState(),oc);}}function bc(kc){var lc=kc._manager.getSelectedMessageIDs().length;j.send(new k('/ajax/mercury/mark_spam_messages_dialog.php').setData({count:lc}),function(mc){mc.subscribe('confirm',cc.curry(kc,mc));});}function cc(kc,lc){var mc=kc._manager.getSelectedMessageIDs();ea.markMessagesSpam(kc._threadID,mc);lc.hide();var nc=na.getCurrentStateData();if(nc.message_action){var oc=bb({},nc);delete oc.message_action;na.updateDetailState(na.getCurrentDetailState(),oc);}}function dc(kc){var lc=kc._manager.getSelectedMessageIDs();if(lc.length){na.updateDetailState(ma.DETAIL.COMPOSE_MAIN,{start:true});kc._forwardedMessages.setForwardedMessages(lc);}}function ec(kc){if(kc._messageSent)return false;if(!u.isEmpty(kc._composerBox))return true;var lc=kc._fileUploader.getAttachments();if((lc&&lc.length)||kc._fileUploader.getImageFiles().length>0||kc._shareLinkUploader.getAttachData()||kc._photoUploader.getSelectedFBIDs().length>0)return true;var mc=na.getCurrentStateData(),nc=na.getCurrentDetailState(),oc=nc==ma.DETAIL.COMPOSE_MAIN||nc==ma.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||nc==ma.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(oc&&!mc.start&&(mc.participants||[]).length)return true;if(kc._forwardedMessages.getForwardedMessages().length)return true;return false;}function fc(kc){la.onBeforeUnload(function(){var lc=ga.getNextURI();if(!lc.getQueryData().hasOwnProperty('theater')&&!wa.isVaultBoxURI(lc))p.saveDraft(kc._threadID,kc._composerBox,kc._fileUploader,kc._shareLinkUploader,kc._photoUploader);if(!eb(lc)&&!lc.getQueryData().hasOwnProperty('theater')&&!wa.isVaultBoxURI(lc)&&ec(kc))return "You haven't sent your message.";},true);la.onBeforeUnload(function(){if(eb(ga.getNextURI())&&ec(kc))return "You haven't sent your message.";},false);la.onUnload(function(){p.saveDraft(kc._threadID,kc._composerBox,kc._fileUploader,kc._shareLinkUploader,kc._photoUploader);});}function gc(kc,lc){n.show(kc._bottomShelfComposer);n.addClass(kc._bottomShelfComposer,'invisible_elem');n.conditionClass(kc._bottomShelfButtons,'delete',lc==ma.MESSAGE_ACTION.DELETE);n.conditionClass(kc._bottomShelfButtons,'forward',lc==ma.MESSAGE_ACTION.FORWARD);n.conditionClass(kc._bottomShelfButtons,'report_spam',lc==ma.MESSAGE_ACTION.REPORT_SPAM);n.show(kc._bottomShelfButtons);}function hc(kc){pa.set(kc._emoteWrapper,w.isRTL()?'right':'left',(kc._composerBox.clientWidth+22)+'px');}function ic(kc){if(kc._typingDetector){var lc=kc._threadID,mc=null;if(lc){mc=ua.getCanonicalUserInThread(lc);var nc=z.chat_multi_typ_send,oc=ua.getThreadMetaNow(lc);if((!nc||!oc||oc.is_canonical)&&!mc)lc=null;}kc._typingDetector.setUserAndThread(mc,lc);}}function jc(kc,lc,mc){if(o.contains(kc._ariaOwns,mc))kc._composerBox.setAttribute('aria-activedescendant',mc);}e.exports=hb;});
__d("WebMessengerSharedPhotos.react",["AsyncRequest","Button.react","cx","copyProperties","fbt","glyph","Grid.react","LoadingIndicator.react","MessagesViewer","Pixelz.react","PhotoStore","React","Image.react","ReactPropTypes","WebMessengerStateConstants","WebMessengerStateManager"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Button.react'),i=b('cx'),j=b('copyProperties'),k=b('fbt'),l=b('glyph'),m=b('Grid.react'),n=b('LoadingIndicator.react'),o=b('MessagesViewer'),p=b('Pixelz.react'),q=b('PhotoStore'),r=b('React'),s=b('Image.react'),t=b('ReactPropTypes'),u=b('WebMessengerStateConstants'),v=b('WebMessengerStateManager'),w=m.GridItem,x="Return to Conversation",y=42,z=r.createClass({displayName:'WebMessengerSharedPhotos',propTypes:{threadID:t.string.isRequired,totalWidth:t.number.isRequired},getInitialState:function(){return {isLoadingMore:true,moreImages:true,imagesData:{}};},componentDidMount:function(){this.requestImages();},componentDidUpdate:function(){if(!this.isVisible())this.requestImages();},componentWillReceiveProps:function(aa){if(aa.threadID&&aa.threadID!==this.props.threadID)this.setState({isLoadingMore:true,moreImages:true,imagesData:{}});},isVisible:function(){return !(this.state.isLoadingMore&&this.state.moreImages&&Object.keys(this.state.imagesData).length===0);},loadMoreImages:function(){if(this.state.moreImages&&!this.state.isLoadingMore){this.setState({isLoadingMore:true});this.requestImages();}},renderImages:function(){var aa=Math.floor((this.props.totalWidth-y)/3),ba=Object.keys(this.state.imagesData).map(function(ca){return (w(null,r.DOM.div({className:"_5dq3",onClick:this.viewFullImage.curry(ca)},p({upscale:true,width:aa,height:aa,resizeMode:'cover',src:this.state.imagesData[ca].URI,borderRadius:1,insetBorderColor:"rgba(0, 0, 0, 0.1)"}))));}.bind(this));return ba;},viewFullImage:function(aa){o.bootstrap(aa,this.state.imagesData[aa].dim,this.state.imagesData[aa].URI,Object.keys(this.state.imagesData).length===1,false);if(!q.hasBeenCreated(o.setID))new g().setURI('/ajax/messaging/attachments/sharedphotos.php').setMethod("POST").setData({thread_id:this.props.threadID,image_id:aa}).send();},requestImages:function(){new g().setURI('/ajax/messaging/attachments/sharedphotos.php').setMethod("POST").setData({thread_id:this.props.threadID,offset:Object.keys(this.state.imagesData).length,limit:30}).setHandler(function(aa){this.setState({isLoadingMore:false,moreImages:aa.payload.moreImagesToLoad,imagesData:j({},this.state.imagesData,aa.payload.imagesData)});}.bind(this)).send();},returnToThread:function(){var aa=j({},v.getCurrentStateData());v.updateDetailState(u.DETAIL.RECENT_MESSAGES,aa);},render:function(){var aa=(r.DOM.div({className:((this.isVisible()?"_5dq2":'')+(!this.isVisible()?' '+"_5dq1":'')+(!this.isVisible()?' '+"_5dpz":''))},n({color:"white",size:"large"})));if(!this.isVisible()){return aa;}else if(!this.state.isLoadingMore)aa=null;return (r.DOM.div({className:"_5dpz"},r.DOM.div({className:"_5dp-"},h({image:s({src:l('back')}),label:x,size:"medium",onClick:this.returnToThread})),r.DOM.div({className:"_5dq0"},m({cols:3,fixed:false},this.renderImages()),aa)));}});e.exports=z;});
__d("WebMessengerDetailViewSharedPhotosControl",["CSS","DOM","React","MercuryServerRequests","WebMessengerSharedPhotos.react","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerEvents","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('React'),j=b('MercuryServerRequests').get(),k=b('WebMessengerSharedPhotos.react'),l=b('WebMessengerStateConstants'),m=b('WebMessengerStateManager'),n=b('WebMessengerEvents'),o=b('WebMessengerSubscriptionsHandler');function p(q,r){"use strict";this.manager=q;this.rootElement=r;this.component=null;this.serverID=null;this.state=null;this.threadID=null;h.empty(this.rootElement);o.addSubscriptions(this.manager.subscribe('scrolledNearBottom',this.notifyImageRequest.bind(this)),n.subscribe(n.DETAIL_DOM_CHANGED,this.render.bind(this)));}p.prototype.hideView=function(){"use strict";g.hide(this.rootElement);};p.prototype.updateView=function(){"use strict";g.show(this.rootElement);this.updateStateAndData();this.render();};p.prototype.destroy=function(){"use strict";o.release();};p.prototype.updateStateAndData=function(){"use strict";this.state=m.getCurrentDetailState();var q=m.getCurrentStateData();this.threadID=q.thread_id;};p.prototype.render=function(){"use strict";this.serverID=j.getServerThreadIDNow(this.threadID);if(!this.serverID)return;if(!this.component){this.component=k({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});i.renderComponent(this.component,this.rootElement);}else this.component.setProps({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});};p.prototype.notifyImageRequest=function(){"use strict";var q=m.getCurrentDetailState();if(q===l.DETAIL.SHARED_PHOTOS&&this.manager.isScrolledToBottom()&&this.component)this.component.loadMoreImages();};e.exports=p;});
__d("WebMessengerJoinStatusTabSheet",["JoinStatusTabSheet","WebMessengerTemplates"],function(a,b,c,d,e,f){var g=b('JoinStatusTabSheet'),h=b('WebMessengerTemplates');for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(){"use strict";if(g!==null)g.apply(this,arguments);}k.prototype._getTemplate=function(){"use strict";return h[':fb:web-messenger:read-view:generic-message-sheet'];};e.exports=k;});
__d("WebMessengerThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","WebMessengerTemplates","mixin"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('WebMessengerTemplates'),k=b("mixin"),l=k(h);for(var m in l)if(l.hasOwnProperty(m))o[m]=l[m];var n=l===null?null:l.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=l;function o(p,q){"use strict";this._rootElement=p;this._sheetView=q;}o.prototype.render=function(){"use strict";var p=j[':fb:web-messenger:read-view:message-mute-sheet'].build();i.setContent(p.getNode('text'),i.tx._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,p.getRoot());g.listen(p.getNode('unmuteButton'),'click',function(){this.inform('clicked',null);}.bind(this));};o.prototype.isPermanent=function(){"use strict";return false;};o.prototype.getType=function(){"use strict";return 'wb-thread-is-muted';};o.prototype.open=function(){"use strict";this._sheetView.open(this);};o.prototype.close=function(){"use strict";this._sheetView.close(this);};e.exports=o;});
__d("WebMessengerDetailViewSheetControl",["DOM","ArbiterMixin","WebMessengerStateManager","MercurySheetView","WebMessengerTemplates","MercuryThreadInformer","MercuryThreadMuter","MercuryThreads","WebMessengerJoinStatusTabSheet","WebMessengerThreadIsMutedTabSheet","WebMessengerSubscriptionsHandler","mixin"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ArbiterMixin'),i=b('WebMessengerStateManager'),j=b('MercurySheetView'),k=b('WebMessengerTemplates'),l=b('MercuryThreadInformer').get(),m=b('MercuryThreadMuter'),n=b('MercuryThreads').get(),o=b('WebMessengerJoinStatusTabSheet'),p=b('WebMessengerThreadIsMutedTabSheet'),q=b('WebMessengerSubscriptionsHandler'),r=b("mixin"),s=r(h);for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w){"use strict";this._template=k[':fb:web-messenger:tab-sheet-container'].build();this._rootElement=this._template.getNode('sheet');this._threadID=i.getCurrentStateData().thread_id;this._sheetView=new j(this._threadID,this._rootElement,w);this._threadIsMutedTabSheet=new p(this._rootElement,this._sheetView);this._userJoinStatusSheet=new o(this._rootElement,this._sheetView);this._muteSetting=undefined;g.setContent(w,this._template.getRoot());this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',function(){n.updateThreadMuteSetting(this._threadID,0);}.bind(this));q.addSubscriptions(this._sheetView.subscribe('resize',this.inform.bind(this,'resize')),l.subscribe('threads-updated',function(x,y){if(this._threadID&&y[this._threadID])this.updateTabSheet(false);}.bind(this)));this.updateTabSheet(true);}v.prototype.updateView=function(){"use strict";var w=i.getCurrentStateData().thread_id;if(this._threadID!=w){this._threadID=w;this.updateTabSheet(true);}};v.prototype.updateTabSheet=function(w){"use strict";if(!this._threadID)return;n.getThreadMeta(this._threadID,function(x){var y=m.getThreadMuteSettingForUser(x);if(y!=this._muteSetting||w){if(y){this._threadIsMutedTabSheet.open();}else this._threadIsMutedTabSheet.close();this._muteSetting=y;}}.bind(this));};v.prototype.openUserJoinStatusSheet=function(w){"use strict";this._userJoinStatusSheet.addToQueue(w);};v.prototype.destroy=function(){"use strict";this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();};e.exports=v;});
__d("WebMessengerDetailViewControlManager",["Event","ArbiterMixin","CSS","WebMessengerDetailViewHeaderControl","DOM","WebMessengerFlexibleScrollArea","WebMessengerDetailViewActionsMenuControl","WebMessengerDetailViewAllPeopleResultsControl","WebMessengerDetailViewComposeTypeaheadControl","WebMessengerDetailViewRecentMessagesControl","WebMessengerDetailViewSearchContextControl","WebMessengerDetailViewSearchSnippetsControl","WebMessengerDetailViewBottomShelfControl","WebMessengerDetailViewSharedPhotosControl","WebMessengerMessagesSelection","Parent","WebMessengerDetailViewSheetControl","WebMessengerStateManager","WebMessengerStateConstants","Style","UserAgent","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTemplates","mixin","getElementPosition"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('CSS'),j=b('WebMessengerDetailViewHeaderControl'),k=b('DOM'),l=b('WebMessengerFlexibleScrollArea'),m=b('WebMessengerDetailViewActionsMenuControl'),n=b('WebMessengerDetailViewAllPeopleResultsControl'),o=b('WebMessengerDetailViewComposeTypeaheadControl'),p=b('WebMessengerDetailViewRecentMessagesControl'),q=b('WebMessengerDetailViewSearchContextControl'),r=b('WebMessengerDetailViewSearchSnippetsControl'),s=b('WebMessengerDetailViewBottomShelfControl'),t=b('WebMessengerDetailViewSharedPhotosControl'),u=b('WebMessengerMessagesSelection'),v=b('Parent'),w=b('WebMessengerDetailViewSheetControl'),x=b('WebMessengerStateManager'),y=b('WebMessengerStateConstants'),z=b('Style'),aa=b('UserAgent'),ba=b('WebMessengerEvents'),ca=b('WebMessengerSubscriptionsHandler'),da=b('WebMessengerTemplates'),ea=b("mixin"),fa=b('getElementPosition'),ga=ea(h);for(var ha in ga)if(ga.hasOwnProperty(ha))ja[ha]=ga[ha];var ia=ga===null?null:ga.prototype;ja.prototype=Object.create(ia);ja.prototype.constructor=ja;ja.__superConstructor__=ga;function ja(ka){"use strict";this._rootElement=ka;k.empty(this._rootElement);var la=da[':fb:web-messenger:read-view'].build();k.setContent(this._rootElement,la.getRoot());this._readContainer=la.getNode('readContainer');this._headerControl=new j(la.getNode('detailViewHeader'));this._actionsMenuControl=new m(la.getNode('detailViewActionsMenu'));this._allPeopleResultsControl=new n(la.getNode('detailViewAllPeopleResults'));this._composeTypeaheadControl=new o(la.getNode('detailViewComposeTypeahead'),la.getNode('detailViewComposeTypeaheadResults'));this._searchContextControl=new q(this,la.getNode('detailViewSearchContext'),la.getNode('snippetPaginationControlBox'));this._searchSnippetsControl=new r(this,la.getNode('detailViewSearchSnippets'));this._sharedPhotosControl=new t(this,la.getNode('detailViewSharedPhotos'));this._sheetControl=new w(la.getNode('detailViewSheetTab'));var ma=la.getNode('detailViewBottomShelf');this._bottomShelfControl=new s(this,ma);this._detailViewScroller=la.getNode('readMessagesScroller');ca.addSubscriptions(g.listen(this._detailViewScroller,'click',function(oa){if(v.byTag(oa.getTarget(),'a')||k.getSelection())return;this._bottomShelfControl.focusComposer();}.bind(this)));var na={fade:!!aa.osx(),persistent:true};this._flexArea=new l(this._detailViewScroller,na).setBottomAligned(false).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearTop'),true).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(200).draw();ca.addSubscriptions(ba.subscribe(ba.DETAIL_DOM_CHANGED,this._flexArea.draw.bind(this._flexArea)),ba.subscribe(ba.SUBMIT_REPLY,this._bottomShelfControl.submitReply.bind(this._bottomShelfControl)),x.subscribe(y.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));ca.addSubscriptions(this._sheetControl.subscribe('resize',this._flexArea.draw.bind(this._flexArea)));this._recentMessagesControl=new p(this,la.getNode('detailViewRecentMessages'),la.getNode('loadingSpinner'),la.getNode('noSelectedConversation'),la.getNode('newMessageLink'),la.getNode('showUnreadLink'),ma);this._stateData={};this._resizeNodes=[this._rootElement,this._detailViewScroller,k.find(this._detailViewScroller,'div.uiScrollableAreaBody')];}ja.prototype.updateOnStateChange=function(){"use strict";var ka=x.getCurrentDetailState(),la=this._stateData;this._stateData=x.getCurrentStateData();this._flexArea.setTabbable(ka!==y.DETAIL.COMPOSE_MAIN);this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();i.removeClass(this._readContainer,'blankComposeState');i.conditionClass(this._readContainer,'blankComposeState',ka===y.DETAIL.COMPOSE_MAIN);this._bottomShelfControl.updateView();this._actionsMenuControl.updateView();this._headerControl.updateView();switch(ka){case y.DETAIL.RECENT_MESSAGES:this._recentMessagesControl.updateView();this._sheetControl.updateView();break;case y.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:this._allPeopleResultsControl.updateView();case y.DETAIL.COMPOSE_MAIN:case y.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this._composeTypeaheadControl.updateView();break;case y.DETAIL.SHARED_PHOTOS:this._sharedPhotosControl.updateView();break;case y.DETAIL.SEARCH_SNIPPET:case y.DETAIL.SEARCH_THREAD_SNIPPET:this._searchSnippetsControl.updateView();break;case y.DETAIL.SEARCH_CONTEXT:this._searchContextControl.updateView();break;}switch(ka){case y.DETAIL.RECENT_MESSAGES:case y.DETAIL.SEARCH_CONTEXT:if(la.thread_id!=this._stateData.thread_id)this._bottomShelfControl.focusComposer();break;}};ja.prototype.openUserJoinStatusSheet=function(ka){"use strict";this._sheetControl.openUserJoinStatusSheet(ka);};ja.prototype.hideAll=function(){"use strict";this._headerControl.hideView();this._actionsMenuControl.hideView();this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();this._bottomShelfControl.hideView();};ja.prototype.getSelectedMessageIDs=function(){"use strict";var ka=x.getCurrentDetailState();switch(ka){case y.DETAIL.RECENT_MESSAGES:case y.DETAIL.SEARCH_CONTEXT:return u.getSelectedMessageIDs();}return [];};ja.prototype.scrollIntoView=function(ka){"use strict";this._flexArea&&this._flexArea.scrollIntoView(ka);};ja.prototype.setScrollTop=function(ka,la){"use strict";this._flexArea&&this._flexArea.setScrollTop(ka,la);};ja.prototype.isScrolledToBottom=function(){"use strict";return this._flexArea&&this._flexArea.isScrolledToBottom();};ja.prototype.scrollToBottom=function(ka){"use strict";this._flexArea&&this._flexArea.scrollToBottom(ka);};ja.prototype.draw=function(){"use strict";this._flexArea&&this._flexArea.draw();};ja.prototype.poke=function(){"use strict";this._flexArea&&this._flexArea.poke();};ja.prototype.setScrollCallback=function(ka){"use strict";this._flexArea&&this._flexArea.setScrollCallback(ka);};ja.prototype.getFlexAreaBoundingClientRect=function(){"use strict";return fa(this._flexArea.flexArea);};ja.prototype.resizeTo=function(ka){"use strict";this._resizeNodes.forEach(function(la){z.set(la,'width',ka+'px');});ba.detailDOMChanged();};ja.prototype.destroy=function(){"use strict";this._headerControl.destroy();this._actionsMenuControl.destroy();this._allPeopleResultsControl.destroy();this._composeTypeaheadControl.destroy();this._recentMessagesControl.destroy();this._searchContextControl.destroy();this._searchSnippetsControl.destroy();this._bottomShelfControl.destroy();this._sharedPhotosControl.destroy();this._flexArea.destroy();this._sheetControl.destroy();};e.exports=ja;});
__d("WebMessengerAuxMenu",["SelectableMenu","MenuSelectableItem","MenuTheme","PopoverMenuOverlappingBorder","Popover","PopoverMenu"],function(a,b,c,d,e,f){var g=b('SelectableMenu'),h=b('MenuSelectableItem'),i=b('MenuTheme'),j=b('PopoverMenuOverlappingBorder'),k=b('Popover'),l=b('PopoverMenu');function m(n,o){"use strict";this._menu=new g([],{className:o,theme:i});var p=new k(n.parentNode,n,null,{alignh:'right'});new l(p,n,this._menu,[j]);}m.prototype.addOption=function(n,o){"use strict";var p=new h({markup:n,title:''});p.setOnClickHandler(o);this._menu.addItem(p);return p;};m.prototype.destroy=function(){"use strict";};e.exports=m;});
__d("WebMessengerMenuFolderControl",["WebMessengerAuxMenu","CSS","Parent","WebMessengerTemplates","Toggler","cx","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('WebMessengerAuxMenu'),h=b('CSS'),i=b('Parent'),j=b('WebMessengerTemplates'),k=b('Toggler'),l=b('cx'),m=b('WebMessengerSubscriptionsHandler'),n,o;function p(r){return i.byClass(r,"_282");}function q(r,s,t){"use strict";var u=!n||n!=s;n=s;this._template=j[':fb:web-messenger:master-view:tab-bar:menu-option'].build();this._template.setNodeContent('folderLabel',r);if(!o||u){o=new g(n,"_1j");h.show(p(n));m.addSubscriptions(k.subscribe(['show','hide'],function(v,w){var x=w.getActive(),y=x&&i.byClass(x,"_282");if(y)h.conditionClass(y,"_50p_",v==='show');}));}this._menuItem=o.addOption(this._template.getRoot(),t);this._menuItem.getRoot();}q.prototype.getCountBadge=function(){"use strict";return this._template.getNode('count');};q.prototype.setSelected=function(r){"use strict";h.conditionClass(p(n),'selectedFolder',r);if(r){this._menuItem.select();}else this._menuItem.deselect();};q.prototype.destroy=function(){"use strict";o&&o.destroy();};e.exports=q;});
__d("MessagingFilteringNux",["Arbiter","AsyncRequest","LayerDestroyOnHide","LayerHideOnTransition","MercuryConfig","isWebMessengerURI"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('LayerDestroyOnHide'),j=b('LayerHideOnTransition'),k=b('MercuryConfig'),l=b('isWebMessengerURI'),m=null,n,o={ACCEPTED_EVENT:'filtering/accepted',DIALOG_REGISTERED_EVENT:'filtering/dialog-registered',tryShow:function(p){g.subscribe(o.DIALOG_REGISTERED_EVENT,function(){if(!m)return;m.setContext(p);m.show();m=null;},g.SUBSCRIBE_ALL);},registerDialog:function(p){m=p.disableBehavior(i).disableBehavior(j);n=g.subscribe('page_transition',function(q,r){if(!l(r.uri)){p&&p.destroy();n.unsubscribe();}},g.SUBSCRIBE_NEW);if(p)p.subscribe('confirm',function(){k.filtering_active=true;new h('/ajax/web_messenger/dismiss_filtering_nux.php').send();p.hide();g.inform(o.ACCEPTED_EVENT,{});});g.inform(o.DIALOG_REGISTERED_EVENT,{},g.BEHAVIOR_PERSISTENT);}};e.exports=o;});
__d("WebMessengerTabbedFolderControl",["Event","CSS","WebMessengerTemplates"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('WebMessengerTemplates');function j(k,l,m){"use strict";this._template=i[':fb:web-messenger:master-view:tab-bar:folder'].build();this._template.setNodeContent('folderLabel',k);this._listener=g.listen(this._template.getNode('link'),'click',m);l.push(this._template.getRoot());}j.prototype.getCountBadge=function(){"use strict";return this._template.getNode('count');};j.prototype.setSelected=function(k){"use strict";h.conditionClass(this._template.getRoot(),'selectedFolder',k);};j.prototype.getElement=function(){"use strict";this._template.getRoot();};j.prototype.destroy=function(){"use strict";this._listener.remove();};e.exports=j;});
__d("WebMessengerEditFilteringSettingDialog",["AsyncDialog","AsyncRequest","MercuryConstants","DOM","csx"],function(a,b,c,d,e,f){var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('MercuryConstants'),j=b('DOM'),k=b('csx'),l='/ajax/mercury/edit_filtering_type.php',m='/ajax/mercury/change_filtering_type.php',n={show:function(){var o=function(q){var r=q.getRoot(),s=j.find(r,"._cq6").checked,t=j.find(r,"._cq7").checked,u='';if(s){u=i.MessagingFilteringType.MODERATE;}else if(t)u=i.MessagingFilteringType.STRICT;new h(m).setData({filtering_type:u}).send();q.hide();},p=function(q){q.subscribe('confirm',o.curry(q));q.show();};g.send(new h(l),p);}};e.exports=n;});
__d("WebMessengerMasterViewTabBarControl",["JSXDOM","Arbiter","CSS","DOM","Event","Ellipsizer","WebMessengerMenuFolderControl","MercuryConfig","MercuryFilters","MercuryFolders","MercuryThreadlistConstants","MessagingFilteringNux","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTabbedFolderControl","WebMessengerTemplates","WebMessengerEditFilteringSettingDialog","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerMercury","copyProperties","csx","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Arbiter'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('Ellipsizer'),m=b('WebMessengerMenuFolderControl'),n=b('MercuryConfig'),o=b('MercuryFilters'),p=b('MercuryFolders'),q=b('MercuryThreadlistConstants'),r=b('MessagingFilteringNux'),s=b('MessagingTag'),t=b('WebMessengerStateConstants'),u=b('WebMessengerStateManager'),v=b('WebMessengerTabbedFolderControl'),w=b('WebMessengerTemplates'),x=b('WebMessengerEditFilteringSettingDialog'),y=b('WebMessengerEvents'),z=b('WebMessengerSubscriptionsHandler'),aa=b('WebMessengerMercury'),ba=b('copyProperties'),ca=b('csx'),da=b('tx');function ea(la,ma,na){"use strict";this._manager=la;this._rootElement=ma;this._rootTopContentElement=na;this._threadInformer=aa.getThreadInformer();this._unreadState=aa.getUnreadState();j.empty(this._rootElement);var oa=w[':fb:web-messenger:master-view:tab-bar'].build(),pa=w[':fb:web-messenger:master-view:top-content'].build();j.setContent(this._rootElement,oa.getRoot());j.setContent(this._rootTopContentElement,pa.getRoot());this._tabList=oa.getRoot();this._moreMenu=oa.getNode('moreMenu');this._topContentCont=pa.getRoot();this._topContent=pa.getNode('masterViewTopContentHolder');this._closeButton=pa.getNode('masterViewTopContentCloseButton');this._closeButtonCont=pa.getNode('masterViewTopContentCloseCont');this._state=null;this._folder=null;this._filter=null;this._query=null;this._threadID=null;this._folders=p.getSupportedFolders();this._foldersToHeader={};this._filters=o.getSupportedFilters();this._filtersToHeader={};this._otherMarkAllRead=g.a({href:"#"},"Mark All as Read");this._unreadMarkAllRead=g.a({href:"#"},"Mark All as Read");this._otherEditSettings=g.a({href:"#"},"Edit Preferences");var qa=[];this._filters.forEach(function(ta){var ua=ja.curry(this,s.INBOX,ta);switch(ta){case s.UNREAD:this._filtersToHeader[ta]=this._filtersToHeader[ta]||new m("Unread",this._moreMenu,ua);break;}}.bind(this));this._folders.forEach(function(ta){var ua=ja.curry(this,ta,o.ALL);switch(ta){case s.INBOX:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new v("Inbox",qa,ua);break;case s.OTHER:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new v("Other",qa,ua);break;case s.ACTION_ARCHIVED:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new m("Archived",this._moreMenu,ua);break;case s.SPAM:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new m("Spam",this._moreMenu,ua);break;}}.bind(this));j.prependContent(this._tabList,qa);var ra=j.scry(this._tabList,"._6xt");ra.push(oa.getNode('moreMenuLabel'));this._ellipsizer=new l(ra);fa(this);var sa=ja.curry(this,s.INBOX,o.ALL);h.subscribe(r.ACCEPTED_EVENT,ia.curry(this));z.addSubscriptions(this._threadInformer.subscribe('unread-updated',ka.curry(this)),k.listen(this._otherMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(s.OTHER);}.bind(this)),k.listen(this._unreadMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(s.INBOX);}.bind(this)),k.listen(this._otherEditSettings,'click',function(){x.show();}),k.listen(this._closeButton,'click',sa));}ea.prototype.updateView=function(){"use strict";var la=ha(this);ga(this);if(la)ia(this);fa(this);};ea.prototype.getOtherFolderLabel=function(){"use strict";var la=s.OTHER,ma=this._foldersToHeader[la];if(!ma||!ma._template)return null;return ma._template.getNode('folderLabel');};ea.prototype.destroy=function(){"use strict";for(var la in this._foldersToHeader)this._foldersToHeader[la]&&this._foldersToHeader[la].destroy();for(var ma in this._filtersToHeader)this._filtersToHeader[ma]&&this._filtersToHeader[ma].destroy();};function fa(la){var ma=85;j.scry(la._tabList,"._1r").forEach(function(na){ma+=na.offsetWidth;});la._ellipsizer.confineWithin(la._rootElement.offsetWidth-ma);}function ga(la){var ma=u.getCurrentStateData();la._state=u.getCurrentMasterState();la._folder=ma.folder;la._filter=ma.filter;la._query=ma.query;}function ha(la){if(!la._state||!la._folder)return true;var ma=u.getCurrentStateData();if(la._folder!=ma.folder)return true;if(la._filter!=ma.filter)return true;return false;}function ia(la){var ma=false,na;la._folders.forEach(function(oa){var pa=la._filter==s.UNREAD,qa=oa==la._folder&&(la._filter==o.ALL||pa),ra,sa;switch(oa){case s.INBOX:if(pa){var ta=g.strong(null,"Unread"),ua=g.strong(null,"Inbox"),va=da._("{unread} messages in {inbox}",{unread:ta,inbox:ua});ra=g.div(null,va,' \u00b7 ',la._unreadMarkAllRead);sa=true;}break;case s.OTHER:var wa='';if(n.filtering_active)wa=g.span(null,la._otherEditSettings,' \u00b7 ');ra=g.div(null,g.p(null,g.strong(null,"Tip:"+' ')," See a message from someone you know? Just reply or click Move to Inbox. "),wa,la._otherMarkAllRead);r.tryShow(la.getOtherFolderLabel());break;}if(qa){na=oa;i.conditionShow(la._closeButtonCont,sa);}else la._foldersToHeader[oa].setSelected(false);if(qa&&ra){ma=true;j.setContent(la._topContent,ra);}});la._filters.forEach(function(oa){var pa=la._folder==s.INBOX&&oa==la._filter;la._filtersToHeader[oa].setSelected(pa);});na&&la._foldersToHeader[na].setSelected(true);i.conditionShow(la._topContentCont,ma);ka(la);la._manager.draw();}function ja(la,ma,na){var oa=la._state==t.MASTER.SEARCH;if(oa||la._folder!=ma||la._filter!=na){var pa=ba({},u.getCurrentStateData()),qa=u.getCurrentDetailState();if(qa!==t.DETAIL.SEARCH_SNIPPET&&qa!==t.DETAIL.SEARCH_CONTEXT)delete pa.query;u.updateMasterState(t.MASTER.RECENT_THREADS,ba(pa,{folder:ma,filter:na}));}y.focusComposer();return false;}function ka(la){for(var ma in la._foldersToHeader){if(ma==s.ACTION_ARCHIVED)continue;var na=la._unreadState.exceedsMaxCount(ma)?q.MAX_UNREAD_COUNT+'+':la._unreadState.getUnreadCount(ma),oa=[la._foldersToHeader[ma].getCountBadge()];if(ma==s.INBOX)la._filters.forEach(function(pa){oa.push(la._filtersToHeader[pa].getCountBadge());});oa.forEach(function(pa){if(na)j.setContent(pa,j.tx._("({unread_count})",{unread_count:na}));i.conditionShow(pa,na);});}fa(la);}e.exports=ea;});
__d("MercuryLocalThreadResults",["Env","MercuryFolders","MercuryOrderedThreadlist","MercuryIDs","MercuryParticipants","MercuryThreadSearchUtils","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Env'),h=b('MercuryFolders'),i=b('MercuryOrderedThreadlist').get(),j=b('MercuryIDs'),k=b('MercuryParticipants'),l=b('MercuryThreadSearchUtils'),m=b('MercuryThreads').get(),n={findMatchingThreadsFromIds:function(q,r){return r.filter(function(s){var t=m.getThreadMetaNow(s);return o(t,q);});},findMatchingThreads:function(q){var r=[];h.getSupportedFolders().forEach(function(s){r=r.concat(i.getThreadlistUntilTimestamp(0,s));}.bind(this));return this.findMatchingThreadsFromIds(q,r);}};function o(q,r){var s=p(q.participants),t=l.wordsInString(r),u=null;k.getMulti(s,function(v){u=s.map(function(w){return v[w];});});if(!u)return false;return l.allMatchPredicate(t,function(v){var w=l.anyMatchPredicate(u,function(y){return y&&y.name&&l.queryWordMatchesAnyNameWord(v,l.wordsInString(y.name));}),x=q.name&&l.queryWordMatchesAnyNameWord(v,l.wordsInString(q.name));return w||x;});}function p(q){if(q.length===1&&j.tokenize(q[0]).value===g.user)return q;return q.filter(function(r){var s=j.tokenize(r).value;return s!==g.user;});}e.exports=n;});
__d("MercurySearchThreadResults",["KeyedCallbackManager","MercuryAPIArgsSource","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=b('MercuryAPIArgsSource'),i=b('MercuryThreadlistConstants'),j=b('RangedCallbackManager'),k=b('MercuryServerDispatcher'),l=b('MercuryServerRequests').get(),m=new g(),n=i.WEBMESSENGER_THREAD_COUNT,o=i.WEBMESSENGER_MORE_COUNT,p={getThreadlist:function(s,t){if(s){var u=m.executeOrEnqueue(s,function(x){var y=x.getAllResources(),z=x.hasReachedEndOfArray();t(y,z);}),v=m.getUnavailableResources(u),w=h.WEBMESSENGER;if(v.length)r({client:w,query:s,offset:0,limit:n+1});return u;}},isExhausted:function(s){var t=m.getResource(s);return t?t.hasReachedEndOfArray():false;},getCachedThreadlist:function(s){var t=m.getResource(s);return t?t.getAllResources():null;},cacheThreadlist:function(s,t){m.getResource(s);var u=new j();u.addResourcesWithoutSorting(t,0);u.setReachedEndOfArray();m.setResource(s,u);},getMoreThreadlist:function(s,t){if(s){var u=m.getResource(s);if(u){var v=u.getCurrentArraySize(),w=o,x=u.executeOrEnqueue(0,v+w,function(){var z=u.getAllResources(),aa=u.hasReachedEndOfArray();t(z,aa);}),y=u.getUnavailableResources(x);if(y.length)r({query:s,offset:v,limit:w+1});return x;}}},handleUpdate:function(s){if(s.mercury_payload)l.handleUpdate(s.mercury_payload);var t=s.search_threads||{};for(var u in t){var v=t[u]||[],w=v.map(l.getClientThreadIDNow.bind(l)),x=m.getResource(u);if(x){q(x,w,o+1);}else{x=new j();q(x,w,n+1);m.setResource(u,x);}}},unsubscribe:function(s,t){if(t){var u=m.getResource(t);if(u){u.unsubscribe(s);}else m.unsubscribe(s);}},setInitialCount:function(s){n=s;}};function q(s,t,u){var v=s.getCurrentArraySize(),w=t.length<u;if(!w)t.pop();s.addResourcesWithoutSorting(t,v);if(w)s.setReachedEndOfArray();}function r(s){s.client=h.WEBMESSENGER;k.trySend('/ajax/mercury/search_threads.php',s);}k.registerEndpoints({'/ajax/mercury/search_threads.php':{mode:k.IMMEDIATE,handler:p.handleUpdate}});e.exports=p;});
__d("MercurySearchThreadsStrategy",["WebMessengerConstants","MercuryLocalThreadResults","MercurySearchThreadResults","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('WebMessengerConstants'),h=b('MercuryLocalThreadResults'),i=b('MercurySearchThreadResults'),j=b('copyProperties'),k=b('createObjectFrom'),l=null,m=null,n=g.SEARCH_THREAD_DELAY,o={clearTimer:function(){l=null;clearTimeout(m);m=null;},search:function(r,s,t,u){if(r!=l){l=r;clearTimeout(m);m=null;}var v=h.findMatchingThreads(r),w=i.getCachedThreadlist(r);if(w){var x=q(v,w);s(x);t([],i.isExhausted(r));u(null,r);return;}var y=p(r),z=q(v,y.thread_ids);if(y.from_exhausted_remote_results){i.cacheThreadlist(r,z);s(z);t([],true);u(null,r);return;}s(z);m=setTimeout(function(){var aa=i.getThreadlist(r,t);u(aa,r);},n);}};function p(r){var s='',t=[];for(var u=r.length-1;u>0;u--){var v=r.slice(0,u),w=i.getCachedThreadlist(v);if(!w)continue;if(i.isExhausted(v)){return {from_exhausted_remote_results:true,thread_ids:h.findMatchingThreadsFromIds(r,w)};}else if(s.length===0){s=v;t=h.findMatchingThreadsFromIds(r,w);}}return {from_exhausted_remote_results:false,thread_ids:t};}function q(r,s){return Object.keys(j(k(r),k(s)));}e.exports=o;});
__d("WebMessengerMasterViewSearchInputControl",["Event","CSS","DOM","Input","Keys","MercurySearchThreadsStrategy","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerSubscriptionsHandler","WebMessengerEvents","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('Input'),k=b('Keys'),l=b('MercurySearchThreadsStrategy'),m=b('WebMessengerShortcuts'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('WebMessengerTemplates'),q=b('WebMessengerSubscriptionsHandler'),r=b('WebMessengerEvents'),s=b('cx');function t(ba,ca){"use strict";this._manager=ba;this._rootElement=ca;i.empty(this._rootElement);var da=p[':fb:web-messenger:master-view:search-input'].build();i.replace(this._rootElement,da.getRoot());this._searchBox=da.getRoot();this._searchInput=da.getNode('searchInput');this._searchClear=da.getNode('searchClear');this._searchButton=i.find(this._searchBox,'button');this._state=null;this._query=null;this._folder=null;this._threadID=null;this._ariaOwns=this._searchInput.getAttribute('aria-owns');q.addSubscriptions(r.subscribe(r.UPDATE_SELECTION,aa.curry(this)),g.listen(this._searchButton,'click',function(){var ea=j.getValue(this._searchInput);if(ea)y(this,ea);}.bind(this)),g.listen(this._searchClear,'click',x.curry(this)),g.listen(this._searchInput,'keyup',function(event){var ea=j.getValue(this._searchInput);if(event.keyCode==k.ESC){x(this);}else if(event.keyCode==k.RETURN&&ea){m.openSearchThread();}else if(ea){z(this,ea);}else if(ea!==o.getCurrentStateData().query){x(this);this.focus();}return false;}.bind(this)),g.listen(this._searchInput,'focus',function(ea){this._focused=true;}.bind(this)),g.listen(this._searchInput,'blur',function(ea){this._focused=false;}.bind(this)));}t.prototype.updateView=function(){"use strict";var ba=v(this);u(this);if(ba)w(this);};t.prototype.focusAndSelectSearch=function(){"use strict";y(this,j.getValue(this._searchInput));this._manager.scrollToTop(false);this.focus();this._searchInput.select();};t.prototype.focus=function(){"use strict";(function(){if(!this._focused){this._searchInput.focus();this._searchInput.value=this._searchInput.value;}}).bind(this).defer();};t.prototype.destroy=function(){"use strict";};function u(ba){var ca=o.getCurrentStateData();ba._state=o.getCurrentMasterState();ba._folder=ca.folder;if(ba._state!=n.MASTER.SEARCH){ba._query=null;}else ba._query=ca.query;}function v(ba){if(!ba._state||!ba._folder)return true;var ca=o.getCurrentMasterState(),da=o.getCurrentStateData();if(ba._folder!=da.folder)return true;if(ca!=ba._state)return true;if(ca==n.MASTER.SEARCH&&ba._query!=da.query)return true;return false;}function w(ba){if(ba._state==n.MASTER.SEARCH){var ca=ba._query||'';if(j.getValue(ba._searchInput)!=ca)j.setValue(ba._searchInput,ca);ba.focus();}else{j.reset(ba._searchInput);ba._searchInput.blur();}h.conditionClass(ba._searchBox,"_47",!j.isEmpty(ba._searchInput));}function x(ba){l.clearTimer();var ca=o.getCurrentStateData();ca.no_uri=true;delete ca.query;o.updateMasterState(n.MASTER.RECENT_THREADS,ca);}function y(ba,ca){var da=o.getCurrentMasterState();if(da!=n.MASTER.SEARCH)ba._threadID=o.getCurrentStateData().thread_id;if(ca)o.updateDetailState(n.DETAIL.SEARCH_SNIPPET,{query:ca,message_query:ca});}function z(ba,ca){var da=o.getCurrentStateData();if(ca!==da.query){var ea=o.getCurrentMasterState();if(ea!=n.MASTER.SEARCH)ba._threadID=da.thread_id;if(ca)o.updateMasterState(n.MASTER.SEARCH,{all_people_query:da.all_people_query,message_query:da.message_query,message_id:da.message_id,query:ca,thread_id:da.thread_id});}}function aa(ba,ca,da){if(i.contains(ba._ariaOwns,da))ba._searchInput.setAttribute('aria-activedescendant',da);}e.exports=t;});
__d("MercuryLogger",["JSLogger","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=b('MercuryServerRequests').get(),i=b('MercuryThreads').get(),j=g.create('messaging_impressions');function k(event,o){j.log(event,o);}function l(o,p){var q=i.getThreadMetaNow(o);if(q){var r=h.getServerThreadIDNow(o);if(r){var event=p?'thread_search':'thread',s={is_single_thread:q.is_canonical_user,is_subscribed:q.is_subscribed,query:p||null,thread_id:r};k(event,s);}j.bump('opened_thread_'+q.folder);}}function m(o,p){var q={};p.forEach(function(r){var s=h.getServerThreadIDNow(r),t=i.getThreadMetaNow(r);if(t&&s){var u={is_single_thread:t.is_canonical_user,thread_id:s,folder:t.folder,participants:t.participants,canonical_fbid:t.canonical_fbid};q[s]=u;}});k('threadlist',{folder:o,threads:q});j.bump('opened_threadlist_'+o);}var n={logThread:function(o){l(o);},logThreadlist:function(o,p){m(o,p);},logThreadFromSearch:function(o,p){l(p,o);},logThreadlistFromSearch:function(o,p){k('threadlist_search',{folder:p,query:o});}};e.exports=n;});
__d("WebMessengerThreadlistRenderer",["CSS","DOM","Event","Focus","MercuryListUpdateRenderer","MercuryAPIArgsSource","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","Tooltip","WebMessengerMercury","WebMessengerPermalinks","WebMessengerDeleteThreadDialog","cx","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Event'),j=b('Focus'),k=b('MercuryListUpdateRenderer'),l=b('MercuryAPIArgsSource'),m=b('MessagingTag'),n=b('WebMessengerStateConstants'),o=b('WebMessengerStateManager'),p=b('WebMessengerTemplates'),q=b('MercuryThreadMetadataRawRenderer'),r=b('MercuryThreadMetadataRenderer'),s=b('Tooltip'),t=b('WebMessengerMercury'),u=b('WebMessengerPermalinks'),v=b('WebMessengerDeleteThreadDialog'),w=b('cx'),x=b('tx'),y={renderThreadsFromIDs:function(aa,ba,ca,da,ea,fa){da=da||function(ga){return ga;};ea=ea||{};k.updateList(aa,ba.map(da),function(ga){return !ea[ba[ga]]&&ba[ga]!=ca;},function(ga){var ha=ba[ga],ia=p[':fb:web-messenger:threadlist-row'].build();ia.getRoot().setAttribute('id',da(ha));var ja=ia.getNode('threadLink');j.listen(ja,function(ka){g.conditionClass(ia.getRoot(),"_5fes",ka);});i.listen(ja,'click',function(ka){if(ka.getModifiers().any)return true;var la=o.getCurrentMasterState(),ma={thread_id:ha};if(la===n.MASTER.SEARCH)ma.query=o.getCurrentStateData().query;o.updateDetailState(n.DETAIL.RECENT_MESSAGES,ma);return false;});if(ha==ca)g.addClass(ia.getRoot(),"_kv");t.getThreads().getThreadMeta(ha,function(ka){var la=r.getForFBID(o.getCurrentUserID());la.renderCoreThreadlist(ka,ia,z.curry(fa),{names_renderer:q.renderShortNames,show_unread_count:false},true);},l.WEBMESSENGER);return ia.getRoot();});}};function z(aa,ba,ca){var da=ba.getNode('readToggler'),ea=ba.getNode('archiveButton'),fa=ba.getNode('deleteButton');ba.getNode('threadLink').setAttribute('href',u.getURI(aa,n.DETAIL.RECENT_MESSAGES,{thread_id:ca.thread_id}).toString());if(ca.unread_count>0){g.addClass(ba.getRoot(),"_kx");h.setContent(ba.getNode('newCount'),h.tx._("{num} new",{num:ca.unread_count}));g.addClass(da,"_ky");s.set(da,"Mark as Read",'above','right');}else{g.addClass(da,"_kz");s.set(da,"Mark as Unread",'above','right');}i.listen(da,'click',function(event){t.getThreads().changeThreadReadStatus(ca.thread_id,g.hasClass(da,"_ky"));return false;});var ga=o.getCurrentStateData().folder;if(ga==m.SPAM){s.set(fa,"Delete Conversation",'above','right');g.addClass(fa,"_4_3q");i.listen(fa,'click',function(event){v.show(ca.thread_id);});g.hide(ea);}else{g.hide(fa);var ha=true;if(ga==m.ACTION_ARCHIVED){ha=false;s.set(ea,"Unarchive",'above','right');g.addClass(ea,"_2s2");}else{s.set(ea,"Archive",'above','right');g.addClass(ea,"_l9");}i.listen(ea,'click',function(event){t.getThreads().changeThreadArchivedStatus(ca.thread_id,ha);var ia=o.getCurrentStateData();if(ia.thread_id==ca.thread_id)o.updateDetailState(n.DETAIL.RECENT_MESSAGES,{folder:ia.folder});return false;});}}e.exports=y;});
__d("WebMessengerMasterViewUnseenMessagesNotice",["MessagingTag","WebMessengerStateManager","UserActivity","WebMessengerSubscriptionsHandler","WebMessengerMessagesNotice","WebMessengerConstants","WebMessengerMercury","throttle"],function(a,b,c,d,e,f){var g=b('MessagingTag'),h=b('WebMessengerStateManager'),i=b('UserActivity'),j=b('WebMessengerSubscriptionsHandler'),k=b('WebMessengerMessagesNotice'),l=b('WebMessengerConstants'),m=b('WebMessengerMercury'),n=b('throttle'),o=l.THREADLIST_SCROLLTOP_OFFSET,p=l.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;for(var q in k)if(k.hasOwnProperty(q))s[q]=k[q];var r=k===null?null:k.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=k;function s(x){"use strict";k.call(this);this._manager=x;this._threadInformer=m.getThreadInformer();this._unseenState=m.getUnseenState();j.addSubscriptions(this._threadInformer.subscribe('messages-received',function(y,z){var aa=!i.isActive(p),ba=!this.isScrolledWithinTopThreshold();if(!r.getActive.call(this)||v(z)||!u(z))return;if(r.onlyReceivedFromSelf.call(this,z))return;if(aa){this.removeMessageNotice();this._manager.scrollToTop();}else if(ba)this.showMessageNotice();}.bind(this)),this._threadInformer.subscribe('unseen-updated',t.curry(this)));this._manager.setScrollCallback(n.withBlocking(function(y){if(r.getActive.call(this)&&y.getScrollTop()<=l.THREADLIST_TOP_OFFSET&&i.isActive(p)&&w()){this.removeMessageNotice();this._unseenState.markAsSeen();}}.bind(this),100,null));}s.prototype.isScrolledWithinTopThreshold=function(){"use strict";return this._manager.getScrollTop()<=o;};s.prototype.showMessageNotice=function(){"use strict";if(!w())return;var x=function(){this._manager.scrollToTop();}.bind(this);r.showMessageNotice.call(this,x,'below');};function t(x){if(x._unseenState.getUnseenCount()===0)x.removeMessageNotice();}function u(x){for(var y in x)for(var z=0;z<x[y].length;z++)if(x[y][z].folder==g.INBOX)return true;return false;}function v(x){var y=h.getCurrentStateData().thread_id,z=true;for(var aa in x)if(x.hasOwnProperty(aa))if(aa!==y){z=false;break;}return w()&&z;}function w(){var x=h.getCurrentStateData().folder;return x===g.INBOX;}e.exports=s;});
__d("WebMessengerMasterViewRecentThreadsControl",["Event","function-extensions","CSS","DOM","MercuryLogger","MercuryAPIArgsSource","MercuryConfig","MercuryFilters","MercuryFolders","MercuryThreadlistConstants","MessagingTag","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadlistRenderer","UserActivity","WebMessengerConstants","WebMessengerEvents","WebMessengerInfoBoxRenderer","WebMessengerSubscriptionsHandler","WebMessengerMasterViewUnseenMessagesNotice","WebMessengerMercury","createObjectFrom","cx","ge","tx"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('CSS'),i=b('DOM'),j=b('MercuryLogger'),k=b('MercuryAPIArgsSource'),l=b('MercuryConfig'),m=b('MercuryFilters'),n=b('MercuryFolders'),o=b('MercuryThreadlistConstants'),p=b('MessagingTag'),q=b('WebMessengerShortcuts'),r=b('WebMessengerStateConstants'),s=b('WebMessengerStateManager'),t=b('WebMessengerTemplates'),u=b('WebMessengerThreadlistRenderer'),v=b('UserActivity'),w=b('WebMessengerConstants'),x=b('WebMessengerEvents'),y=b('WebMessengerInfoBoxRenderer'),z=b('WebMessengerSubscriptionsHandler'),aa=b('WebMessengerMasterViewUnseenMessagesNotice'),ba=b('WebMessengerMercury'),ca=b('createObjectFrom'),da=b('cx'),ea=b('ge'),fa=b('tx'),ga='recent:';function ha(cb,db,eb,fb){"use strict";this._manager=cb;this._rootElement=db;this._infoBox=eb;this._orderedThreadlist=ba.getOrderedThreadlist();this._serverRequests=ba.getServerRequests();this._threadInformer=ba.getThreadInformer();this._threads=ba.getThreads();this._unseenState=ba.getUnseenState();i.empty(this._rootElement);this._pagerExponent=-1;var gb=t[':fb:web-messenger:threadlist'].build();i.setContent(this._rootElement,gb.getRoot());this._loadingSpinner=gb.getNode('loadingSpinner');this._threadlistRows=gb.getNode('threadlistRows');this._loadMoreButton=gb.getNode('loadMoreButton');this._loadMoreLink=gb.getNode('loadMoreLink');this._active=false;this._state=null;this._folder=null;this._filter=null;this._selection=null;this._threadIDs=[];this._unreadThreadIDs=[];this._folders=n.getSupportedFolders();this._filters=m.getSupportedFilters();this._olderTimestamp={};this._currentCountMap={};this._folders.forEach(function(hb){this._currentCountMap[hb]={};this._filters.concat([m.ALL]).forEach(function(ib){this._currentCountMap[hb][ib]=o.WEBMESSENGER_THREAD_COUNT+1;}.bind(this));}.bind(this));this._unseenMessagesNotice=new aa(this._manager);this._unseenMessagesNotice.setNoticeContextNode(fb);z.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(hb,ib){ua(this,ca(ib));}.bind(this)),this._serverRequests.subscribe('model-update-completed',function(){za(this);}.bind(this)),g.listen(this._loadMoreLink,'click',function(){ta(this);}.bind(this)),this._manager.subscribe('scrolledNearBottom',function(){this._active&&ta(this);}.bind(this)));}ha.prototype.updateView=function(){"use strict";this._active=true;this._unseenMessagesNotice.updateView();h.show(this._rootElement);var cb=ja(this),db=ka(this),eb=this._folder,fb=this._selection;la(this);if(db)ma(this,fb);if(cb){sa(this);}else na(this);za(this);if(eb!=this._folder)j.logThreadlist(this._folder,this._threadIDs);if(this._selection&&fb!=this._selection)j.logThread(this._selection);};ha.prototype.hideView=function(){"use strict";this._active=false;this._unseenMessagesNotice.hideView();h.hide(this._rootElement);};ha.prototype.destroy=function(){"use strict";ia(this);this._unseenMessagesNotice.destroy();};function ia(cb){cb._threadlistSubscription&&cb._orderedThreadlist.unsubscribe(cb._threadlistSubscription.subscriber_id,cb._threadlistSubscription.folder,cb._threadlistSubscription.filter);cb._threadlistSubscription=null;}function ja(cb){var db=s.getCurrentStateData();if((cb._folder!=db.folder)||(cb._filter!=db.filter))return true;return false;}function ka(cb){var db=s.getCurrentStateData();if(cb._selection!=db.thread_id)return true;return false;}function la(cb){var db=s.getCurrentStateData();cb._state=s.getCurrentMasterState();if((cb._folder!=db.folder)||(cb._filter!=db.filter))cb._pageExponent=-1;cb._folder=db.folder;cb._filter=db.filter;cb._selection=db.thread_id;}function ma(cb,db){var eb=ea(ya(db));if(eb){h.removeClass(eb,"_kv");eb.removeAttribute('aria-selected');}var fb=ea(ya(cb._selection));if(fb){h.addClass(fb,"_kv");fb.setAttribute('aria-selected','true');}x.updateSelection(fb&&fb.id);}function na(cb){if(cb._active)q.updateThreadlistIndex(cb,cb._threadIDs.map(ya),ya(cb._selection));}function oa(cb){h.addClass(cb._manager.getFlexAreaElement(),"_3j6");h.addClass(cb._manager.getFlexAreaElement(),"_3j7");}function pa(cb){h.removeClass(cb._manager.getFlexAreaElement(),"_3j6");h.removeClass(cb._manager.getFlexAreaElement(),"_3j7");}function qa(cb){h.hide(cb._threadlistRows);pa(cb);}function ra(cb){if(cb._threadIDs.length){h.show(cb._threadlistRows);pa(cb);}else{h.hide(cb._threadlistRows);oa(cb);}}function sa(cb){h.show(cb._loadingSpinner);h.hide(cb._infoBox);qa(cb);h.hide(cb._loadMoreButton);ia(cb);var db=cb._orderedThreadlist.getFilteredThreadlist(o.RECENT_THREAD_OFFSET,cb._currentCountMap[cb._folder][cb._filter],cb._folder,cb._filter,function(eb,fb){h.hide(cb._loadingSpinner);va(cb,eb,fb);ra(cb);na(cb);cb._manager.poke();cb._manager.forceFireScrollCallbacks();},null,k.WEBMESSENGER);if(db)cb._threadlistSubscription={subscriber_id:db,folder:cb._folder,filter:cb._filter};}function ta(cb){if(cb._requestInFlight||h.hasClass(cb._loadMoreButton,'hidden_elem'))return;cb._requestInFlight=true;h.addClass(cb._loadMoreButton,'async_saving');cb._pagerExponent=Math.min(cb._pagerExponent+1,w.EXPONENTIAL_PAGER_MAX_CYCLES);var db=Math.pow(2,cb._pagerExponent),eb=cb._currentCountMap[cb._folder][cb._filter]+db*(o.WEBMESSENGER_MORE_COUNT);ia(cb);var fb=cb._orderedThreadlist.getFilteredThreadlist(o.RECENT_THREAD_OFFSET,eb,cb._folder,cb._filter,function(gb,hb){h.removeClass(cb._loadMoreButton,'async_saving');cb._currentCountMap[cb._folder][cb._filter]=eb;va(cb,gb,hb);na(cb);cb._manager.poke();cb._requestInFlight=false;},null,k.WEBMESSENGER);if(fb)cb._threadlistSubscription={subscriber_id:fb,folder:cb._folder,filter:cb._filter};}function ua(cb,db){if(!cb._folder||!cb._olderTimestamp[cb._folder])return;var eb=cb._orderedThreadlist.getThreadlistUntilTimestamp(cb._olderTimestamp[cb._folder],cb._folder,cb._filter);if(cb._filter==p.UNREAD){eb=xa(cb,eb);}else cb._unreadThreadIDs=[];if(eb.length>cb._currentCountMap[cb._folder][cb._filter])cb._currentCountMap[cb._folder][cb._filter]=eb.length;cb._threadIDs=eb;ra(cb);u.renderThreadsFromIDs(cb._threadlistRows,eb,cb._selection,ya,db,r.MASTER.RECENT_THREADS);na(cb);cb._manager.poke();}function va(cb,db,eb){var fb=(db.length==cb._currentCountMap[cb._folder][cb._filter]);if(fb)db.pop();if(db.length){var gb=db[db.length-1];cb._threads.getThreadMeta(gb,function(hb){cb._olderTimestamp[cb._folder]=hb.timestamp;},k.WEBMESSENGER);}if(cb._filter==p.UNREAD){cb._unreadThreadIDs=db;}else cb.unreadThreadIDs=[];h.conditionShow(cb._loadMoreButton,fb);cb._threadIDs=db;u.renderThreadsFromIDs(cb._threadlistRows,db,cb._selection,ya,null,r.MASTER.RECENT_THREADS);eb=eb&&db.length===0;eb&&wa(cb);h.conditionShow(cb._infoBox,eb);}function wa(cb){if(cb._builtErrorMessage)return;i.setContent(cb._infoBox,y.render("Could Not Load Conversations",[{text:"Try Again",handler:sa.bind(null,cb)}]));cb._builtErrorMessage=true;}function xa(cb,db){db.forEach(function(eb){if(cb._unreadThreadIDs.indexOf(eb)<0)cb._unreadThreadIDs.push(eb);});cb._unreadThreadIDs.sort(function(eb,fb){var gb=cb._threads.getThreadMetaNow(eb).timestamp,hb=cb._threads.getThreadMetaNow(fb).timestamp;return hb-gb;});cb._unreadThreadIDs=cb._unreadThreadIDs.filter(function(eb){var fb=cb._threads.getThreadMetaNow(eb);return n.getFromMeta(fb)==cb._folder;});return cb._unreadThreadIDs;}function ya(cb){if(cb)return ga+cb;return null;}function za(cb){if(!bb(cb))return;if(v.isActive(5000)){ab(cb);}else v.subscribeOnce(ab.curry(cb));}function ab(cb){if(bb(cb))cb._unseenState.markAsSeen();}function bb(cb){return !l.WebMessengerDontMarkSeen&&cb._active&&cb._folder==p.INBOX&&cb._unseenMessagesNotice.isScrolledWithinTopThreshold();}e.exports=ha;});
__d("MercurySearchThreadResultOrderer",["MessagingTag","MercuryThreads","createObjectFrom"],function(a,b,c,d,e,f){var g=b('MessagingTag'),h=b('MercuryThreads').get(),i=b('createObjectFrom'),j={separateCanonicalThreadsInFolder:function(p,q){var r=[],s=[];p.forEach(function(t){var u=h.getThreadMetaNow(t);if(u.folder===q&&u.is_canonical){r.push(t);}else s.push(t);});return {canonical_in_folder:r.sort(l),remaining:s};},orderResults:function(p,q,r,s){var t=o(q,r),u=t.sort(k.curry(s));return o(p,u);}};function k(p,q,r){var s=h.getThreadMetaNow(q),t=h.getThreadMetaNow(r),u=m(s),v=m(t);if(u!==v)return n(u,p)>n(v,p)?-1:1;if(s.is_canonical!==t.is_canonical)return s.is_canonical?-1:1;return l(q,r);}function l(p,q){var r=h.getThreadMetaNow(p),s=h.getThreadMetaNow(q);return r.timestamp>s.timestamp?-1:1;}function m(p){return p.is_archived?g.ACTION_ARCHIVED:p.folder;}function n(p,q){if(p===q)return 5;var r={};r[g.INBOX]=4;r[g.ACTION_ARCHIVED]=3;r[g.OTHER]=2;r[g.SPAM]=1;return r[p];}function o(p,q){var r=i(p),s=q.filter(function(t){return !(t in r);});return p.concat(s);}e.exports=j;});
__d("WebMessengerMasterViewSearchThreadsControl",["Event","CSS","DOM","MercuryFolders","MercuryLogger","MercurySearchThreadResultOrderer","MercurySearchThreadResults","MercurySearchThreadsStrategy","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadlistRenderer","WebMessengerEvents","WebMessengerMercury","WebMessengerSubscriptionsHandler","createObjectFrom","csx","cx","ge"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryFolders'),k=b('MercuryLogger'),l=b('MercurySearchThreadResultOrderer'),m=b('MercurySearchThreadResults'),n=b('MercurySearchThreadsStrategy'),o=b('WebMessengerShortcuts'),p=b('WebMessengerStateConstants'),q=b('WebMessengerStateManager'),r=b('WebMessengerTemplates'),s=b('WebMessengerThreadlistRenderer'),t=b('WebMessengerEvents'),u=b('WebMessengerMercury'),v=b('WebMessengerSubscriptionsHandler'),w=b('createObjectFrom'),x=b('csx'),y=b('cx'),z=b('ge'),aa='search:',ba='search-indicator';function ca(ya,za,ab,bb){"use strict";this._manager=ya;this._rootElement=za;this._noMessagesIndicator=bb;this._orderedThreadlist=u.getOrderedThreadlist();this._threadInformer=u.getThreadInformer();this._threads=u.getThreads();i.empty(this._rootElement);var cb=r[':fb:web-messenger:thread-search'].build();i.setContent(this._rootElement,cb.getRoot());this._loadingSpinner=cb.getNode('loadingSpinner');this._threadlistRows=cb.getNode('threadlistRows');this._loadMoreButton=cb.getNode('loadMoreButton');this._loadMoreLink=cb.getNode('loadMoreLink');var db=r[':fb:web-messenger:master-view-snippets-link'].build();this._threadSearchResultDescription=db.getNode('threadSearchResultDescription');this._searchMessagesIndicator=db.getRoot();this._searchMessagesIndicator.setAttribute('id',aa+ba);i.replace(ab,this._searchMessagesIndicator);this._snippetSearchLink=db.getNode('snippetSearchLink');this._snippetSearchLinkText=db.getNode('snippetSearchLinkText');this._active=false;this._detailState=null;this._query=null;this._folder=null;this._selection=null;this._keyboardSelection=null;this._threadIDs=[];this._oldestTimestamps=ea(this);this._namesChangedSinceLastRedraw=false;this._remoteResultsCompleted=true;v.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(eb,fb){qa(this,w(fb));}.bind(this)),this._threadInformer.subscribe('messages-received',function(){this._namesChangedSinceLastRedraw=true;}.bind(this)),g.listen(this._loadMoreLink,'click',function(){pa(this);}.bind(this)),g.listen(this._snippetSearchLink,'click',function(){this.updateKeyboardSelection(ba);xa(this);}.bind(this)));}ca.prototype.updateView=function(){"use strict";this._active=true;h.show(this._rootElement);h.hide(this._loadingSpinner);var ya=fa(this),za=ga(this),ab=this._folder,bb=this._query,cb=this._selection;ha(this);if(za||ya){var db=this._keyboardSelection;switch(this._detailState){case p.DETAIL.RECENT_MESSAGES:this._keyboardSelection=this._selection;break;case p.DETAIL.SEARCH_SNIPPET:case p.DETAIL.SEARCH_CONTEXT:this._keyboardSelection=ba;}ia(this,db);}if(ya){na(this);}else{ja(this,false);oa(this);}if(bb!=this._query||ab!=this._folder)k.logThreadlistFromSearch(this._query,this._folder);if(this._selection&&cb!=this._selection)k.logThreadFromSearch(this._query,this._selection);};ca.prototype.hideView=function(){"use strict";this._active=false;h.hide(this._rootElement);ra(this,false);oa(this);};ca.prototype.openSearchThread=function(ya){"use strict";if(ya==ba){xa(this);}else q.updateDetailState(p.DETAIL.RECENT_MESSAGES,{query:this._query,thread_id:ya});};ca.prototype.updateKeyboardSelection=function(ya){"use strict";var za=this._keyboardSelection;this._keyboardSelection=ya;ia(this,za);};ca.prototype.destroy=function(){"use strict";da(this);};function da(ya){ya._searchThreadsSubscription&&m.unsubscribe(ya._searchThreadsSubscription.subscriber_id,ya._searchThreadsSubscription.query);ya._searchThreadsSubscription=null;}function ea(ya){var za={};j.getSupportedFolders().forEach(function(ab){var bb=ya._orderedThreadlist.getThreadlistUntilTimestamp(0,ab);za[ab]=bb.length>0?ya._threads.getThreadMetaNow(bb[bb.length-1]).timestamp:Infinity;}.bind(this));return za;}function fa(ya){var za=ya._namesChangedSinceLastRedraw;ya._namesChangedSinceLastRedraw=false;if(za)return true;if(!ya._remoteResultsCompleted)return true;var ab=ea(ya),bb=ya._oldestTimestamps;ya._oldestTimestamps=ab;var cb=q.getCurrentStateData();if(ya._query!==cb.query||ya._folder!==cb.folder)return true;for(var db in bb)if(bb[db]>ab[db])return true;return false;}function ga(ya){var za=q.getCurrentStateData();if(ya._selection!=za.thread_id)return true;return false;}function ha(ya){var za=q.getCurrentStateData();ya._detailState=q.getCurrentDetailState();ya._query=za.query;ya._folder=za.folder;ya._selection=za.thread_id;}function ia(ya,za){var ab=z(va(za));if(ab){h.removeClass(ab,"_kv");ab.removeAttribute('aria-selected');}var bb=z(va(ya._keyboardSelection));if(bb){h.addClass(bb,"_kv");bb.setAttribute('aria-selected',true);}t.updateSelection(bb&&bb.id);}function ja(ya,za){if(ya._keyboardSelection&&ya._keyboardSelection!=ba&&ya._threadIDs.indexOf(ya._keyboardSelection)<0)ya._keyboardSelection=null;if(!ya._keyboardSelection)if(ya._threadIDs.length){ya._keyboardSelection=ya._threadIDs[0];}else if(!za){ya._keyboardSelection=ba;ia(ya);}var ab=ya._threadIDs.slice(0);ab.push(ba);if(ya._active)o.updateThreadlistIndex(ya,ab.map(va),va(ya._keyboardSelection));}function ka(ya){var za=i.scry(ya._threadlistRows,"._l5");za.filter(function(ab){return i.getText(ab)!==q.getCurrentStateData().folder;}).forEach(h.show.bind(h));}function la(ya){var za=i.scry(ya._threadlistRows,"._l5");za.forEach(h.hide.bind(h));}function ma(ya){ka(ya);ya._manager.draw();}function na(ya){h.show(ya._loadingSpinner);ra(ya,false);h.hide(ya._threadlistRows);h.hide(ya._loadMoreButton);la(ya);da(ya);if(ya._query){var za=[],ab=[];ya._remoteResultsCompleted=false;n.search(ya._query,function(bb){var cb=l.separateCanonicalThreadsInFolder(bb,q.getCurrentStateData().folder);za=cb.canonical_in_folder;ab=cb.remaining;wa(ya);h.show(ya._threadlistRows);ta(ya,za);ma(ya);},function(bb,cb){ya._remoteResultsCompleted=true;var db=l.orderResults(za,ab,bb,q.getCurrentStateData().folder);if(db.length>0){h.conditionShow(ya._loadMoreButton,!cb);ua(ya,db);}else sa(ya);h.hide(ya._loadingSpinner);ma(ya);},function(bb,cb){if(bb)ya._searchThreadsSubscription={subscriber_id:bb,query:cb};});}else{n.clearTimer();h.hide(ya._loadingSpinner);i.empty(ya._threadlistRows);h.show(ya._threadlistRows);ya._threadIDs=[];}oa(ya);}function oa(ya){var za=!!ya._query&&ya._active,ab=za^h.shown(ya._searchMessagesIndicator);h.conditionShow(ya._searchMessagesIndicator,za);ya._manager.sizeToFit(za);ab&&ya._manager.draw();}function pa(ya){da(ya);h.addClass(ya._loadMoreButton,'async_saving');var za=m.getMoreThreadlist(ya._query,function(ab,bb){h.removeClass(ya._loadMoreButton,'async_saving');h.conditionShow(ya._loadMoreButton,!bb);ua(ya,ab);ya._manager.poke();});if(za)ya._searchThreadsSubscription={subscriber_id:za,query:ya._query};}function qa(ya,za){if(ya._threadIDs.length){s.renderThreadsFromIDs(ya._threadlistRows,ya._threadIDs,ya._keyboardSelection,va,za,p.MASTER.SEARCH);ya._manager.poke();}}function ra(ya,za){za=za&&ya._active;h.conditionClass(ya._searchMessagesIndicator,"_33x",za!==false);h.conditionShow(ya._noMessagesIndicator,za!==false);}function sa(ya){ya._threadIDs=[];ja(ya,false);var za=i.tx._("No people or conversations named {query}",{query:ya._query}),ab=i.create('div',{},za);i.setContent(ya._noMessagesIndicator,ab);ra(ya,true);}function ta(ya,za){ua(ya,za,true);}function ua(ya,za,ab){ya._threadIDs=za;ja(ya,ab);s.renderThreadsFromIDs(ya._threadlistRows,za,ya._keyboardSelection,va,null,p.MASTER.SEARCH);t.updateSelection(ya._keyboardSelection);if(ya._keyboardSelection==ba)ia(ya);}function va(ya){if(ya)return aa+ya;return null;}function wa(ya){var za=i.tx._("Showing results for name: {query}",{query:ya._query});i.setContent(ya._threadSearchResultDescription,za);}function xa(ya){if(ya._query){q.updateDetailState(p.DETAIL.SEARCH_SNIPPET,{query:ya._query,message_query:ya._query});t.focusSearch();}}e.exports=ca;});
__d("WebMessengerMasterViewControlManager",["ArbiterMixin","DOM","WebMessengerFlexibleScrollArea","WebMessengerMasterViewTabBarControl","WebMessengerMasterViewSearchInputControl","WebMessengerMasterViewRecentThreadsControl","WebMessengerMasterViewSearchThreadsControl","WebMessengerStateManager","WebMessengerStateConstants","Style","WebMessengerTemplates","WebMessengerEvents","WebMessengerSubscriptionsHandler","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DOM'),i=b('WebMessengerFlexibleScrollArea'),j=b('WebMessengerMasterViewTabBarControl'),k=b('WebMessengerMasterViewSearchInputControl'),l=b('WebMessengerMasterViewRecentThreadsControl'),m=b('WebMessengerMasterViewSearchThreadsControl'),n=b('WebMessengerStateManager'),o=b('WebMessengerStateConstants'),p=b('Style'),q=b('WebMessengerTemplates'),r=b('WebMessengerEvents'),s=b('WebMessengerSubscriptionsHandler'),t=b("mixin"),u=t(g);for(var v in u)if(u.hasOwnProperty(v))x[v]=u[v];var w=u===null?null:u.prototype;x.prototype=Object.create(w);x.prototype.constructor=x;x.__superConstructor__=u;function x(y){"use strict";this._rootElement=y;h.empty(this._rootElement);var z=q[':fb:web-messenger:master-view'].build();h.setContent(this._rootElement,z.getRoot());this._tabBarControl=new j(this,z.getNode('masterViewTabBar'),z.getNode('masterViewTopContent'));this._searchInputControl=new k(this,z.getNode('masterViewSearchInput'));this._searchThreadsControl=new m(this,z.getNode('masterViewSearchThreads'),z.getNode('searchMessagesIndicator'),z.getNode('noMessages'));this._threadlistRowsWrapper=z.getNode('threadlistRowsWrapper');this._flexArea&&this._flexArea.destroy();var aa={fade:true,persistent:true};this._flexArea=new i(this._threadlistRowsWrapper,aa).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(40).draw();this._recentThreadsControl=new l(this,z.getNode('masterViewRecentThreads'),z.getNode('masterInfoBox'),z.getNode('masterViewTabBar'));s.addSubscriptions(r.subscribe(r.FOCUS_AND_SELECT_SEARCH,this._searchInputControl.focusAndSelectSearch.bind(this._searchInputControl)),r.subscribe(r.FOCUS_SEARCH,this._searchInputControl.focus.bind(this._searchInputControl)),r.subscribe(r.MASTER_DOM_CHANGED,function(){this._tabBarControl.updateView();this._flexArea&&this._flexArea.draw();}.bind(this)),n.subscribe(o.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));this._resizeNodes=[this._rootElement,this._threadlistRowsWrapper,h.find(this._threadlistRowsWrapper,'div.uiScrollableAreaBody')];}x.prototype.updateOnStateChange=function(){"use strict";var y=n.getCurrentMasterState();this._tabBarControl.updateView();this._searchInputControl.updateView();switch(y){case o.MASTER.RECENT_THREADS:this._searchThreadsControl.hideView();this._recentThreadsControl.updateView();break;case o.MASTER.SEARCH:this._recentThreadsControl.hideView();this._searchThreadsControl.updateView();break;}};x.prototype.scrollIntoView=function(y,z){"use strict";this._flexArea&&this._flexArea.scrollIntoView(y,z);};x.prototype.scrollToBottom=function(y){"use strict";this._flexArea&&this._flexArea.scrollToBottom(y);};x.prototype.scrollToTop=function(y){"use strict";this._flexArea&&this._flexArea.scrollToTop(y);};x.prototype.isScrolledToTop=function(){"use strict";return this._flexArea&&this._flexArea.isScrolledToTop();};x.prototype.getScrollTop=function(){"use strict";return this._flexArea.getScrollableArea().getScrollTop();};x.prototype.draw=function(){"use strict";this._flexArea&&this._flexArea.draw();};x.prototype.poke=function(){"use strict";this._flexArea&&this._flexArea.poke();};x.prototype.sizeToFit=function(y){"use strict";this._flexArea&&this._flexArea.setSizeToFit(y);};x.prototype.setScrollCallback=function(y){"use strict";this._flexArea&&this._flexArea.setScrollCallback(y);};x.prototype.forceFireScrollCallbacks=function(){"use strict";this._flexArea&&this._flexArea._onScroll();};x.prototype.getFlexAreaElement=function(){"use strict";return this._flexArea.flexArea;};x.prototype.resizeTo=function(y){"use strict";this._resizeNodes.forEach(function(z){p.set(z,'width',y+'px');});r.masterDOMChanged();};x.prototype.destroy=function(){"use strict";this._tabBarControl.destroy();this._recentThreadsControl.destroy();this._searchThreadsControl.destroy();this._flexArea.destroy();};e.exports=x;});
__d("WebMessengerPageTitleRenderer",["DocumentTitle","MercuryAPIArgsSource","MercuryParticipants","WebMessengerStateConstants","WebMessengerStateManager","MercuryThreadMetadataRenderer","MercuryThreads","tx"],function(a,b,c,d,e,f){var g=b('DocumentTitle'),h=b('MercuryAPIArgsSource'),i=b('MercuryParticipants'),j=b('WebMessengerStateConstants'),k=b('WebMessengerStateManager'),l=b('MercuryThreadMetadataRenderer').get(),m=b('MercuryThreads').get(),n=b('tx'),o={updateTitleForState:function(r,s,t){this.withTitleForState(r,s,t||function(u){var v=k.getCurrentDetailState(),w=k.getCurrentStateData();if(r===v&&s===w)g.set(u);});},withTitleForState:function(r,s,t){switch(r){case j.DETAIL.RECENT_MESSAGES:p(s.thread_id,t);break;default:q(t);break;}}};function p(r,s){if(!r){q(s);return;}m.getThreadMeta(r,function(t){if(t.name){s(n._("{conversation_name} - Messages",{conversation_name:t.name}));return;}i.getMulti(t.participants,function(u){var v=[];for(var w in u)if(u.hasOwnProperty(w))v.push(u[w]);var x=l.renderParticipantList(r,v,u[i.user]?t.participants.length-1:t.participants.length,{abbr_mode:true,last_separator_uses_and:true,names_renderer:function(y){var z=[];if(y.length===1&&y[0]===i.user){z.push(y[0].name);}else for(var aa=0;aa<y.length;aa++)if(y[aa].id!==i.user)z.push(y[aa].name);return z;}});s(n._("{conversation_name} - Messages",{conversation_name:x}));});},h.WEBMESSENGER);}function q(r){r("Messages");}e.exports=o;});
__d("WebMessengerPageTitleControl",["WebMessengerPageTitleRenderer","WebMessengerStateManager","WebMessengerStateConstants","WebMessengerSubscriptionsHandler","WebMessengerEvents"],function(a,b,c,d,e,f){var g=b('WebMessengerPageTitleRenderer'),h=b('WebMessengerStateManager'),i=b('WebMessengerStateConstants'),j=b('WebMessengerSubscriptionsHandler'),k=b('WebMessengerEvents'),l=function(){var m=function(){g.updateTitleForState(h.getCurrentDetailState(),h.getCurrentStateData());};j.addSubscriptions(h.subscribe(i.STATE_CHANGE_EVENT,m),k.subscribe(k.DETAIL_DOM_CHANGED,m));};e.exports=l;});
__d("WebMessengerComposerDataSource",["MercuryConstants","ExpandableDataSource","MercuryIDs","WebMessengerStateManager"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('ExpandableDataSource'),i=b('MercuryIDs'),j=b('WebMessengerStateManager');for(var k in h)if(h.hasOwnProperty(k))m[k]=h[k];var l=h===null?null:h.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=h;function m(q){"use strict";q=q||{};q.kanaNormalization=true;h.call(this,q,g.MercuryTypeaheadConstants.COMPOSER_THREADS_INITIAL_LIMIT,g.MercuryTypeaheadConstants.COMPOSER_SHOW_MORE_LIMIT);this._maxResults=g.MercuryTypeaheadConstants.COMPOSER_FRIENDS_MAX+g.MercuryTypeaheadConstants.COMPOSER_THREADS_INITIAL_LIMIT+g.MercuryTypeaheadConstants.COMPOSER_NON_FRIENDS_MAX;this._statesPerTokens={};this.subscribe('fetchComplete',function(r,s){var t=s.fetch_context,u=s.response.getPayload().entries;if(t.bootstrap)p(u);});}m.prototype.buildData=function(q){"use strict";var r=[],s=[],t=[],u=[];q.forEach(function(w){var x=l.getEntry.call(this,w);switch(x.render_type){case g.MercuryTypeaheadConstants.FRIEND_TYPE:if(r.length<g.MercuryTypeaheadConstants.COMPOSER_FRIENDS_MAX)r.push(w);break;case g.MercuryTypeaheadConstants.THREAD_TYPE:s.push(w);break;case g.MercuryTypeaheadConstants.NON_FRIEND_TYPE:if(t.length<g.MercuryTypeaheadConstants.COMPOSER_NON_FRIENDS_MAX)t.push(w);break;case g.MercuryTypeaheadConstants.FB4C_TYPE:if(u.length<g.MercuryTypeaheadConstants.COMPOSER_FRIENDS_MAX)u.push(w);break;}}.bind(this));var v=r.concat(u,s,t);if(!this.hasLoadedAllResults()){this._maxResults=v.length+1;}else this._maxResults=v.length;return l.buildData.call(this,v);};m.prototype.query=function(q,r,s){"use strict";this.value=q;l.query.call(this,q,r,s);};m.prototype.getQueryData=function(q,r){"use strict";var s=l.getQueryData.call(this,q,r);s.existing_token_ids=o();return s;};m.prototype.getStates=function(){"use strict";var q=n();if(!this._statesPerTokens[q])this._statesPerTokens[q]={};return this._statesPerTokens[q];};m.prototype.fetchHandler=function(q,r){"use strict";this.getState('loaded_all_threads_per_query')[r.value]=q.getPayload().end_of_threads;this.getState('loaded_initial_per_query')[r.value]=true;l.fetchHandler.call(this,q,r);};m.prototype.hasLoadedInitialResults=function(q){"use strict";if(q===undefined)q=this.value;return this.getState('loaded_initial_per_query')[q];};m.prototype.hasLoadedAllResults=function(q){"use strict";if(q===undefined)q=this.value;return this.getState('loaded_all_threads_per_query')[q];};function n(){var q=o().sort();return ','+q.join(',');}function o(){var q=j.getCurrentStateData();return (q.participants||[]).map(function(r){return i.tokenize(r).value;});}function p(q){q.forEach(function(r){r.render_type=g.MercuryTypeaheadConstants.FRIEND_TYPE;});}e.exports=m;});