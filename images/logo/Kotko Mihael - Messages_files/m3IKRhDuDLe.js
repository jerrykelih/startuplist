/*!CK:2309594031!*//*1384754590,178129961*/

if (self.CavalryLogger) { CavalryLogger.start_js(["B52Dz"]); }

__d("PhotoSnowliftAds",["Event","copyProperties","CSS","csx","DataStore","DOM","PhotoSessionLog","UIPagelet","URI","Vector","extendArray"],function(a,b,c,d,e,f){var g=b('Event'),h=b('copyProperties'),i=b('CSS'),j=b('csx'),k=b('DataStore'),l=b('DOM'),m=b('PhotoSessionLog'),n=b('UIPagelet'),o=b('URI'),p=b('Vector'),q=b('extendArray'),r={DEFAULT_UNITS_REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,displayedCallback:null,refreshUnitsRate:null,position:null,adsStatus:'null',adsEvents:{},snowliftRedesign:false,resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(s,t){if(t)this.adsStatus=s;var u=Date.now();this.adsEvents[s+'_'+u]=u;},init:function(s,t,u,v){this.reset();this.root=s;this.snowlift=t;this.minAds=u.min_ads;this.displayedCallback=v;this.addEvent('init',true);this.snowliftRedesign=u.snowlift_redesign;this.refreshUnitsRate=r.DEFAULT_UNITS_REFRESH_RATE;if(u.refresh_fast)this.refreshUnitsRate=u.refresh_rate;},reset:function(){this.lastLoadTime=0;this.position=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(s){this.availableDimensions=s;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(s,t,u){var v={};s.forEach(function(w){var x=w.root.firstChild.offsetHeight;w.units.forEach(function(z){if(!i.hasClass(z,'hidden')&&!this.getIsHoldout(z)){var aa=this.getHeight(z.firstChild,t);x-=aa;}}.bind(this));var y={height:x,visible:false};w.units.forEach(function(z){var aa=this.getIsAds(z),ba=this.getHeight(z.firstChild,t),ca=this.getUnitId(z),da=this.getIsHoldout(z);if(da&&u)return;v[ca]={height:ba,visible:false,priority:0,is_ads:aa,is_holdout:da,section_ref:y};}.bind(this));}.bind(this));return v;},calculateVisibleUnits:function(s,t,u){var v=0,w=this.getUnitPriority(t);w.forEach(function(x){if(t.hasOwnProperty(x)){var y=t[x],z=y.height;if(!y.section_ref.visible)z+=y.section_ref.height;y.height_below=u-z;y.visible=y.height_below>=0&&z>0;if(y.visible){y.section_ref.visible=true;u-=z;v++;}}}.bind(this));return t;},displayUnits:function(s,t){s.forEach(function(u){var v=false,w=true;u.units.forEach(function(x){var y=this.getUnitId(x),z=t[y];if(!z)return;var aa=z.visible,ba=z.height_below,ca=z.is_ads;i.conditionClass(x,'hidden',!aa);if(ca&&aa&&w){var da=l.find(x,'div.ego_unit');i.addClass(da,'ego_unit_no_top_border');w=false;}v=v||aa;this.calcUnitStats(this.units[ca][y],aa,ba);}.bind(this));i.conditionClass(u.root,'hidden',!v);}.bind(this));},getUnitsDisplayed:function(s,t){var u=0;s.forEach(function(v){v.units.forEach(function(w){var x=this.getUnitId(w),y=t[x];if(!y||!y.visible)return;u++;}.bind(this));}.bind(this));return u;},getHeightsRequired:function(s,t){var u=0,v=[];s.forEach(function(w){var x=false;w.units.forEach(function(y){var z=this.getUnitId(y),aa=t[z];if(!aa)return;u+=aa.height;if(!x){u+=aa.section_ref.height;x=true;}v.push(u);}.bind(this));}.bind(this));return v;},getUnitPriority:function(s){var t=[],u=0,v=0;for(var w in s){var x=s[w];t.push(w);var y=this.minAds+u+v;if(x.is_ads){if(v<this.minAds)y=v;v++;}else u++;x.priority=y;}t=t.sort(function(z,aa){var ba=s[z],ca=s[aa];return ba.priority-ca.priority;}.bind(this));return t;},updateUnitsStatus:function(){var s=this.availableDimensions.x,t=this.availableDimensions.y,u=this.calculateUnitSizes(this.sections,s);u=this.calculateVisibleUnits(this.sections,u,t);for(var v in u){if(!u.hasOwnProperty(v))continue;var w=u[v];if(!w.is_holdout||!w.visible)continue;var x=this.units[1][v];this.calcUnitStats(x,w.visible,w.height_below);}u=this.calculateUnitSizes(this.sections,s,true);u=this.calculateVisibleUnits(this.sections,u,t);this.displayUnits(this.sections,u);if(this.displayedCallback){var y=this.getUnitsDisplayed(this.sections,u),z=this.getHeightsRequired(this.sections,u);this.displayedCallback(y,z);}},calcUnitStats:function(s,t,u){var v=Date.now();if(s.visible)s.totalTime+=v-s.lastShowTime;if(s.trackingCode!==null&&s.totalTime>=this.UNITS_REGISTER_DELAY){var w=s.trackingCode;s.trackingCode=null;this.registerImpression(w,s.registerUrl);}s.visible=t;s.heightBelow=u;s.lastShowTime=v;},prepareResize:function(){var s=function(t){var u=l.create('div',{className:'inner'}),v=l.create('div',{className:'wrapper'},u);l.replace(t,v);l.setContent(u,t);return v;};this.sections=l.scry(this.root,'div.ego_section').map(function(t){return {root:s(t),units:l.scry(t,'div.ego_unit').map(s)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var s=this.nextRegisterTime();if(s!==Infinity)this.processResize.bind(this).defer(s,true);},setIsLogAdData:function(s){this.isLogAdData=s;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var s=this.snowlift.getImageId();if(this.isLogAdData&&s){var t=p.getElementDimensions(this.snowlift.getImage()),u=p.getElementDimensions(this.snowlift.getRHCHeader()),v=p.getElementDimensions(this.snowlift.getRHCBody()),w=p.getElementDimensions(this.snowlift.getRHCFooter()),x={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:t.x,image_y:t.y,header_x:u.x,header_y:u.y,body_x:v.x,body_y:v.y,footer_x:w.x,footer_y:w.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents,refreshRate:this.refreshUnitsRate,position:this.position};m.updateAdData(s,x);}},getAdsBelowSpace:function(){var s=[],t=this.units[1];for(var u in t)if(t.hasOwnProperty(u)&&!this.getIsHoldout(this.getAdUnit(u)))s.push(t[u].heightBelow);return s;},getIsAds:function(s){var t=l.scry(s,"div._4u8");return t.length;},getUnitId:function(s){if(this.getIsAds(s)){return this.getAdId(s);}else return this.getEgoId(s);},getEgoId:function(s){var t=l.find(s,'div.ego_unit');return t.getAttribute('data-ego-fbid');},getAdData:function(s){var t=l.find(s,"div._4u8"),u=t.getAttribute('data-ad');return u&&JSON.parse(u)||{};},getAdId:function(s){return this.getAdData(s).adid;},getIsHoldout:function(s){return s&&this.getIsAds(s)&&this.getAdData(s).holdout;},getAdUnit:function(s){if(!this.sections)return null;var t=[];this.sections.forEach(function(v){q(t,v.units);});for(var u=0;u<t.length;u++)if(this.getIsAds(t[u])&&this.getAdId(t[u])==s)return t[u];return null;},nextRegisterTime:function(){var s=Infinity,t=h(h({},this.units[0]),this.units[1]);for(var u in t)if(t.hasOwnProperty(u)){var v=t[u];if(v.trackingCode!==null&&v.visible)s=Math.min(s,this.UNITS_REGISTER_DELAY-v.totalTime);}return s;},getHeight:function(s,t){var u=k.get(s,'height');if(u&&u.x===t)return u.y;return this.cacheHeight(s,t);},cacheHeight:function(s,t){var u={x:t,y:s.offsetHeight};k.set(s,'height',u);return u.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);this.position++;var s=this.getCursorFBID(this.loadQuery);n.loadFromEndpoint('WebEgoPane',this.root,{pid:34,data:[this.loadQuery.set,s,this.snowliftRedesign,this.snowlift.getOpaqueCursor(s)]},{crossPage:true,bundle:false});},getCursorFBID:function(s){if(s.v!==undefined)return s.v;if(s.fbid!==undefined)return s.fbid;return '0';},unitsLoaded:function(s,t){var u;if(t){u='/ai.php';this.addEvent('adsLoaded',true);}else{u='/ajax/ei.php';this.addEvent('egoLoaded',true);}var v={};for(var w in s)if(s.hasOwnProperty(w))v[w]={trackingCode:s[w],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:u};this.units[t]=v;if(t)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();i.removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var s=Date.now(),t=this.refreshUnitsRate;if(!this.isLoading&&s-this.lastLoadTime>t){i.addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(s,t){var u=l.create('iframe',{src:o(t).addQueryData({aed:s}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});u.setAttribute('aria-hidden','true');l.appendContent(this.root,u);},waitForImages:function(s){var t=l.scry(this.root,'img.img'),u=t.length,v=u;if(v===0)s();var w=function(){v--;if(v===0)s.defer();};for(var x=0;x<u;x++){var y=t[x];if(y.complete){w();}else g.listen(y,{load:w,error:w,abort:w});}}};e.exports=r;});
__d("PhotoSnowlift",["function-extensions","Arbiter","Assert","AsyncRequest","Bootloader","CSS","Dialog","DOM","DOMControl","Event","FullScreen","ImageUtils","Input","Keys","Layer","LikeConfirmer","LinkController","LitestandStoryInsertionStatus","Locale","PageTransitions","Parent","PhotosConst","PhotoLogger","PhotoPermalinkURI","PhotoSessionLog","PhotoSnowliftAds","PhotoStreamCache","PhotosUtils","PhotoViewer","Rect","ScrollableArea","Style","Toggler","UIPagelet","URI","UserAgent","Vector","$","asyncCallback","computeRelativeURI","copyProperties","createArrayFrom","csx","cx","emptyFunction","ge","getActiveElement","goURI","shield","startsWith","tx","userAction"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('Assert'),i=b('AsyncRequest'),j=b('Bootloader'),k=b('CSS'),l=b('Dialog'),m=b('DOM'),n=b('DOMControl'),o=b('Event'),p=b('FullScreen'),q=b('ImageUtils'),r=b('Input'),s=b('Keys'),t=b('Layer'),u=b('LikeConfirmer'),v=b('LinkController'),w=b('LitestandStoryInsertionStatus'),x=b('Locale'),y=b('PageTransitions'),z=b('Parent'),aa=b('PhotosConst'),ba=b('PhotoLogger'),ca=b('PhotoPermalinkURI'),da=b('PhotoSessionLog'),ea=b('PhotoSnowliftAds'),fa=b('PhotoStreamCache'),ga=b('PhotosUtils'),ha=b('PhotoViewer'),ia=b('Rect'),ja=b('ScrollableArea'),ka=b('Style'),la=b('Toggler'),ma=b('UIPagelet'),na=b('URI'),oa=b('UserAgent'),pa=b('Vector'),qa=b('$'),ra=b('asyncCallback'),sa=b('computeRelativeURI'),ta=b('copyProperties'),ua=b('createArrayFrom'),va=b('csx'),wa=b('cx'),xa=b('emptyFunction'),ya=b('ge'),za=b('getActiveElement'),ab=b('goURI'),bb=b('shield'),cb=b('startsWith'),db=b('tx'),eb=b('userAction'),fb=74,gb=75,hb=70,ib=76;for(var jb in ha)if(ha.hasOwnProperty(jb))lb[jb]=ha[jb];var kb=ha===null?null:ha.prototype;lb.prototype=Object.create(kb);lb.prototype.constructor=lb;lb.__superConstructor__=ha;function lb(){"use strict";if(ha!==null)ha.apply(this,arguments);}lb.prototype.preload=function(mb,nb){"use strict";j.loadModules(['PhotoTagger','Live','PhotoTagApproval','PhotoTags','TagTokenizer','fb-photos-snowlift-fullscreen-css'],function(pb){this.PhotoTagger=pb;}.bind(this));var ob=this.getImageSrc(na(mb).getQueryData());if(ob)if(!this._log(ob))(new Image()).src=ob;};lb.prototype.bootstrap=function(mb,nb){"use strict";if(mb&&na(mb).getQueryData().makeprofile){this.enableCropperOnInit=true;this.isUserProfilePic=na(mb).getQueryData().makeuserprofile;this.isInProfilePicAlbum=na(mb).getQueryData().inprofilepicalbum;}this.preload(mb,nb);if(this.closeDirty){this.bootstrap.bind(this,mb,nb).defer();return;}ea.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.ua=eb('snowlift',nb).uai('open');this.returningToStart=false;this.loading&&k.removeClass(this.loading,'loading');if(nb){k.addClass((this.loading=nb),'loading');if(this.container){var ob=z.byClass(nb,'uiStreamStory')||z.byClass(nb,"_5jmm");if(ob){this.container.setAttribute('data-ownerid',ob.id);}else this.container.removeAttribute('data-ownerid');}this.getThumbAndSize(nb);}else this.loading=null;g.inform('PhotoSnowlift.GO',mb,g.BEHAVIOR_STATE);this.loadFrameIfUninitialized();};lb.prototype.getCurrentImageServerSizeDimensions=function(){"use strict";return this.stream.getCurrentImageData().dimensions;};lb.prototype.getEventPrefix=function(){"use strict";return 'PhotoSnowlift';};lb.prototype.getRoot=function(){"use strict";return this.root;};lb.prototype.getSourceString=function(){"use strict";return 'snowlift';};lb.prototype.getViewerSource=function(){"use strict";return this.source;};lb.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};lb.prototype.getVersionConst=function(){"use strict";return aa.VIEWER_SNOWLIFT;};lb.prototype.getImage=function(){"use strict";return this.image;};lb.prototype.getImageId=function(){"use strict";return this.stream.getCursor();};lb.prototype.getRHCHeader=function(){"use strict";return this.rhcHeader;};lb.prototype.getRHCBody=function(){"use strict";return this.ufiForm;};lb.prototype.getRHCFooter=function(){"use strict";return this.rhcFooter;};lb.prototype.getLoadQuery=function(){"use strict";return this.loadQuery;};lb.prototype.getCurrentPhotoInfo=function(){"use strict";var mb=this.stream.getCurrentImageData();if(mb)return mb.info;return null;};lb.prototype.getOwnerId=function(){"use strict";var mb=this.stream.getCurrentImageData();if(mb)return mb.info.owner;return null;};lb.prototype.getThumbAndSize=function(mb){"use strict";this.currentImageSize=null;this.thumbSrc=null;var nb=na(mb.getAttribute('ajaxify')).getQueryData();if(!nb.size)return;var ob=pa.deserialize(nb.size);if(!ob.x||!ob.y)return;this.currentImageSize=ob;if(!k.hasClass(mb,'uiMediaThumb')&&!k.hasClass(mb,'uiPhotoThumb')&&!k.hasClass(mb,'uiScaledThumb'))return;if(mb.getAttribute('data-cropped'))return;var pb=m.scry(mb,'img')[0],qb=m.scry(mb,'i')[0],rb=z.byAttribute(mb,'data-size');this.shouldStretch=rb&&this.currentImageSize&&pb&&rb.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=lb.TIMELINE_STRETCH_WIDTH&&pb.offsetWidth===lb.TIMELINE_STRETCH_WIDTH;var sb;if(pb){sb=pb.src;}else if(qb){sb=ka.get(qb,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=sb;};lb.prototype.loadFrameIfUninitialized=function(){"use strict";if(this.root)return;new i('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};lb.prototype.init=function(mb,nb){"use strict";this.init=xa;this._shouldLog=nb.photos_client_loading;this._logger=null;if(this._shouldLog)this._logger=new ba(aa.VIEWER_SNOWLIFT_STRING);this.showHover=nb.pivot_hover;da.setEndMetrics(nb.pivot_end_metric);this.enableSnowliftProfilePicCropper=nb.snowlift_profile_pic_cropper;this.pagersOnKeyboardNav=nb.pagers_on_keyboard_nav;this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=p.isSupported();this.showOGVideos=nb.og_videos;this.resizeCommentsForAds=nb.resize_comments_for_ads;this.spotlight=mb;this.spotlight.subscribe('blur',function(){this.closingAction=da.OUTSIDE;}.bind(this));this.spotlight.subscribe('hide',bb(this.closeHandler,this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());ea.init(this.sideAdUnit,this,nb,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){v.registerHandler(this.handleNavigateAway.bind(this));this.subscription=g.subscribe('PhotoSnowlift.GO',function(ob,pb){this.openExplicitly=true;this.loading&&k.removeClass(this.loading,'loading');this.open(pb);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;y.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)p.subscribe('changed',this.onFullScreenChange.bind(this));this.redesign=nb.snowlift_redesign;this.slideshowGk=nb.snowlift_slideshow;this.allowIrrelevantRequests=!!nb.snowlift_allow_irrelevant_requests;};lb.prototype.onFullScreenChange=function(){"use strict";var mb=p.isFullScreen();k.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',mb);if(mb){if(!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var nb=this.stream.getCurrentImageData();if(nb&&nb.url&&this.image.src!==nb.url&&this.shouldShowHiRes(nb))this.switchImage(nb.url);this.adjustForResize();}else{this.uncollapseRHC();if(oa.chrome()&&!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);g.inform('reflow');}la.hide();if(this.cropper)this.cropper.resetPhoto();};lb.prototype.initializeNodes=function(mb){"use strict";this.root=mb;this.container=m.find(mb,'div.fbPhotoSnowliftContainer');this.snowliftPopup=m.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=m.find(this.snowliftPopup,'div.rhc');this.rhcHeader=m.find(this.rhc,'div.rhcHeader');this.rhcFooter=m.find(this.rhc,'div.rhcFooter');this.ufiForm=m.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=m.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=m.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=m.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=m.find(this.snowliftPopup,'div.stageWrapper');this.overlay=m.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=m.find(this.stageWrapper,'div.stageError');this.image=m.find(this.stageWrapper,'img.spotlight');this.stage=m.find(this.stageWrapper,'div.stage');this.videoStage=m.find(this.stageWrapper,'div.videoStage');this.prevPager=m.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=m.find(this.snowliftPopup,'a.snowliftPager.next');this.stageActions=m.find(mb,'div.stageActions');this.buttonActions=m.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=m.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=m.find(mb,"._5ciw");g.inform('Amoeba/instrumentMulti',[[this.container,'snowlift'],[this.rhc,'rhc'],[this.rhcHeader,'rhc_header'],[this.ufiForm,'ufi_form'],[this.ufiInputContainer,'ufi_input'],[this.prevPager,'prev_pager'],[this.nextPager,'next_pager'],[this.stageActions,'stage_actions'],[this.sideAdUnit,'side_ads']],g.BEHAVIOR_PERSISTENT);k.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};lb.prototype.initializeScroller=function(){"use strict";this.initializeScroller=xa;this.scrollableArea=ja.fromNative(this.scroller,{fade:true,persistent:true});var mb=function(event){var nb=o.$E(event).getTarget();if(m.contains(this.ufiInputContainer,nb)){var ob=n.getInstance(nb);if(ob){this.scrollableArea.scrollToBottom();var pb=ob.subscribe('resize',function(){var rb=this.scrollableArea.isScrolledToBottom();this.adjustScroller();rb&&this.scrollableArea.scrollToBottom();}.bind(this)),qb=o.listen(nb,'blur',function(){ob.unsubscribe(pb);qb.remove();});}}}.bind(this);g.subscribe('ufi/changed',function(nb,ob){if(this.ufiForm===ob.form)this.adjustScrollerIfNecessary();}.bind(this));g.subscribe('ufi/comment',function(nb,ob){if(this.ufiForm===ob.form){this.adjustScrollerIfNecessary();if(ob.isranked){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));o.listen(this.rhc,'click',function(event){var nb=event.getTarget();if(z.byTag(nb,'a')||z.byTag(nb,'button')||m.isNodeOfType(nb,'input'))this.adjustScrollerIfNecessary();}.bind(this));g.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));o.listen(this.ufiForm,'focusin',mb);};lb.prototype.openHandler=function(mb){"use strict";if(this.isOpen||!ca.isValid(mb)||this.returningToStart||mb.getQueryData().closeTheater||mb.getQueryData().permPage||mb.getQueryData().makeprofile){this.openHandlerRegistered=false;return false;}this.open(mb);this._uriStack.push(na(mb).getQualifiedURI().toString());y.transitionComplete(true);return true;};lb.prototype.getImageSrc=function(mb){"use strict";if(mb.smallsrc){if(!mb.size)return mb.smallsrc;var nb=pa.deserialize(mb.size),ob=this.getStageSize(nb);ob=this._adjustStageSizeForPixelRatio(ob);if(ob.x<=lb.STAGE_NORMAL_MAX.x&&ob.y<=lb.STAGE_NORMAL_MAX.y)return mb.smallsrc;}return mb.src;};lb.prototype.open=function(mb){"use strict";var nb=na(mb),ob=nb.getQueryData(),pb=ca.parse(nb);if(pb!==null){ob.fbid=pb.photo_id;ob.set=pb.set_token;}var qb=this.getImageSrc(ob);if(qb){delete ob.src;delete ob.smallsrc;}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){ob.firstLoad=true;this.initialLoad=true;w.registerBlocker(function(){return this.isOpen;}.bind(this));}this.sessionID=Date.now();this.loadQuery=ta(ob,{ssid:this.sessionID});this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.source=null;this.saveTagSubscription=g.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new fa();this.stream.init(aa.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this._shouldLog?this._logger:null);this.fetchInitialData();this.setLoadingState(lb.STATE_HTML,true);this.rhcCollapsed=false;this._open(mb,qb);if(this.enableSnowliftProfilePicCropper)j.loadModules(['SnowliftPicCropper'],function(rb){this.cropper=rb.getInstance(this);this.cropper.init();if(this.enableCropperOnInit){var sb=g.subscribe('PhotoSnowlift.SWITCH_IMAGE',function(){if(this.isInProfilePicAlbum){this.cropper.showPicInProfileAlbumDialog();}else this.cropper.enableCropping(this.isUserProfilePic);g.unsubscribe(sb);}.bind(this));this.enableCropperOnInit=false;}}.bind(this));j.loadModules(['PhotosButtonTooltips'],function(rb){rb.init();});};lb.prototype._open=function(mb,nb){"use strict";this.createLoader(nb);this.spotlight.show();this.ua&&this.ua.add_event('frame');g.inform('layer_shown',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.OPEN');this.stageHandlers=[o.listen(window,'resize',this.adjustForResize.bind(this)),o.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),o.listen(this.stageWrapper,'mouseleave',function(event){var qb=event.getTarget();if(!(z.byClass(qb,'snowliftOverlay')||z.byClass(qb,'fbPhotoSnowliftTagApproval')||z.byClass(qb,'tagPointer')||z.byClass(qb,'arrow')||z.byClass(qb,'faceboxSuggestion')||z.byClass(qb,'typeaheadWrapper')||z.byClass(qb,'photoTagTypeahead')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),o.listen(this.stageWrapper,'mousemove',this.hilitePagerOnMouseMove.bind(this)),o.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),o.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this))];this.stageHandlers.push(o.listen(this.container,'click',function(event){var qb=event.getTarget();if(z.byClass(qb,'rotateRight')){this.rotate('right');}else if(z.byClass(qb,'rotateLeft')){this.rotate('left');}else if(z.byClass(qb,'closeTheater')){if(p.isFullScreen()){p.toggleFullScreen();return;}this.closingAction=da.X;this.closeHandler();return false;}else if(this.fullscreen)if(z.byClass(qb,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(z.byClass(qb,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var ob=ya('fbPhotoSnowliftFeedback');if(ob)this.stageHandlers.push(o.listen(ob,'click',function(event){var qb=event.getTarget();if(z.byClass(qb,'like_link')||(z.byClass(qb,'UFILikeLink')&&z.byClass(qb,'UIActionLinks'))||(this.redesign&&z.byClass(qb,"_6k6")))this.toggleLikeButton();var rb=z.byClass(event.getTarget(),'uiUfiCollapsedComment');if(rb)k.addClass(rb,'uiUfiCollapsedCommentToggle');}.bind(this)));var pb=ya('fbPhotoSnowliftOnProfile');if(pb)this.stageHandlers.push(o.listen(pb,'click',function(event){if(z.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=na.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!nb)this.setLoadingState(lb.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){y.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}da.initLogging(da.SNOWLIFT);if(this.pivots)da.setRelevantCount(this.pivots.relevantCount);};lb.prototype.toggleFullScreen=function(){"use strict";var mb=p.toggleFullScreen(document.documentElement);if(mb){var nb=this.stream.getCurrentImageData();if(nb&&nb.url&&this.image.src!==nb.url&&this.shouldShowHiRes(nb))if(!this._log(nb.url))(new Image()).src=nb.url;da.logEnterFullScreen(this.stream.getCursor());}};lb.prototype.getStream=function(){"use strict";return this.stream;};lb.prototype.fetchInitialData=function(){"use strict";this.ua&&this.ua.add_event('init_data');this.stream.waitForInitData();ma.loadFromEndpoint('PhotoViewerInitPagelet',ya('pagelet_photo_viewer_init',this.root),this.loadQuery,{usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};lb.prototype.toggleCollapse=function(){"use strict";if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};lb.prototype.collapseRHC=function(){"use strict";this.rhcCollapsed=true;k.addClass(this.root,'collapseRHC');this.adjustForResize();};lb.prototype.uncollapseRHC=function(){"use strict";this.rhcCollapsed=false;k.removeClass(this.root,'collapseRHC');this.adjustForResize();};lb.prototype.closeHandler=function(){"use strict";if(!this.isOpen)return;this.closingAction=this.closingAction||da.ESC;if(na.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};lb.prototype.returnToStartingURI=function(mb,nb){"use strict";if(!mb)if(nb){this.squashNextTransition(ab.curry(nb));}else this.squashNextTransition();this.returningToStart=true;var ob=g.subscribe('page_transition',(function(){this.returningToStart=false;ob.unsubscribe();}).bind(this)),pb=mb||isNaN(oa.opera()),qb=this._uriStack.length;if(pb&&qb<window.history.length){window.history.go(-qb);}else{var rb=this.startingURI,sb=new na(rb).removeQueryData('closeTheater');if(rb.getQueryData().sk=='approve'&&rb.getPath()=='/profile.php'){sb.removeQueryData('highlight');sb.removeQueryData('notif_t');}ab(sb);}};lb.prototype.squashNextTransition=function(mb){"use strict";this.squashNext=true;y.registerHandler(function nb(){if(this.squashNext){this.squashNext=false;if(mb)mb.defer();y.transitionComplete(true);return true;}return false;}.bind(this),7);};lb.prototype.handleNavigateAway=function(mb){"use strict";var nb=sa(y._most_recent_uri.getQualifiedURI(),mb.getAttribute('href'));if(this.isOpen&&cb(nb.getPath(),'/hashtag/')){this.close();return true;}if(this.isOpen&&(nb instanceof na)&&nb.getUnqualifiedURI().toString()!=this.startingURI.toString()&&nb.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=da.NAVIGATE;this.returnToStartingURI(false,nb);this.close();return false;}return true;};lb.prototype.postProcessTaggedPhotos=function(){"use strict";if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var mb=null;if(this.source===lb.COLLECTIONS_UNTAGGED_PHOTOS){mb='/ajax/photos/photo/edit/skiptag/';}else if(this.source===lb.PHOTOS_OF_YOU_SUGGESTIONS||this.source===lb.FRIENDS_IN_PHOTOS_SUGGESTIONS)mb='/ajax/photos/photo/add_to_star_grid/';if(mb)new i().setURI(mb).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};lb.prototype.onTagSaved=function(mb,nb){"use strict";if(this.taggedPhotoIds){if(this.source===lb.PHOTOS_OF_YOU_SUGGESTIONS&&!nb.self_tag)return;this.taggedPhotoIds.push(nb.photo_fbid);}};lb.prototype.close=function(){"use strict";if(!this.isOpen)return;this.isOpen=false;if(this.fullscreen)p.disableFullScreen();eb('snowlift').uai('close');this.cropper&&this.cropper.disableCropping();this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();g.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;this.closeCleanup.bind(this).defer();};lb.prototype.closeCleanup=function(){"use strict";this.closeDirty=false;k.removeClass(this.root,'dataLoading');da.logPhotoViews(this.closingAction);this.destroy();k.hide(this.errorBox);k.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;k.removeClass(this.stageWrapper,'showVideo');m.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();m.empty(this.sideAdUnit);this.stream.destroy();var mb=this.closingAction===da.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){y.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}g.inform('layer_hidden',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.CLOSE',mb);this.root.setAttribute('aria-busy','true');};lb.prototype.createLoader=function(mb){"use strict";if(this.currentImageSize===null){this.adjustStageSize(lb.STAGE_MIN);}else{var nb=this.getStageSize(this.currentImageSize);nb=new pa(Math.max(nb.x,lb.STAGE_MIN.x),Math.max(nb.y,lb.STAGE_MIN.y));var ob=this.getImageSizeInStage(this.currentImageSize,nb);if(this.thumbSrc===null){this.adjustStageSize(ob);}else this.useImage(m.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:ob.x+'px',height:ob.y+'px'}}),ob,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(mb)(function(){var pb=new Image(),qb=o.listen(pb,'load',ra(function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(mb,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(lb.STATE_IMAGE_DATA,false);}}.bind(this),'photo_theater')),rb=function(){if(qb){qb.remove();qb=null;}};g.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',rb);g.subscribeOnce('PhotoSnowlift.CLOSE',rb);this._log(mb);pb.src=mb;}).bind(this).defer();k.hide(this.stageActions);this.setStagePagersState('disabled');};lb.prototype.initDataFetched=function(mb){"use strict";da.setPhotoSet(this.stream.getPhotoSet());da.setLogFbids(mb.logids);var nb=this.stream.getCurrentImageData();da.addPhotoView(nb.info,this.shouldShowHiRes(nb),this.fullscreen&&p.isFullScreen());var ob=this.stream.getCurrentExtraData();if(ob&&ob.source!==undefined){this.source=parseInt(ob.source,10);da.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[o.listen(this.root,'click',this.pageListener.bind(this)),o.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];k.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=mb.loggedin;this.disableAds=!this.isLoggedInViewer||mb.fromad;this.loadAds();};lb.prototype.adjustScrollerIfNecessary=function(){"use strict";clearTimeout(this.scrollerTimeout);this.scrollerTimeout=this.adjustScroller.bind(this).defer();};lb.prototype.adjustScroller=function(mb){"use strict";clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var nb=pa.getElementDimensions(this.rhc),ob=nb.y;ob-=pa.getElementDimensions(this.rhcHeader).y;ob-=pa.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var pb=pa.getElementDimensions(this.placeInfo);ob-=pb.y;ka.set(this.sideAdUnit,'bottom',pb.y+'px');}if(mb==null)mb=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=mb;ob=Math.max(0,ob);var qb=pa.getElementDimensions(this.scrollerBody).y,rb=Math.max(lb.MIN_UFI_HEIGHT,ob-mb);if(qb>=rb){if(ob>rb){k.removeClass(this.rhc,'pinnedUfi');ob-=rb;}else{if(this.redesign&&pa.getElementDimensions(this.ufiInputContainer).y<lb.ADD_COMMENT_HEIGHT)rb-=lb.PINNED_UFI_ADJUSTMENT;k.addClass(this.rhc,'pinnedUfi');ob=0;}ka.set(this.scroller,'height',rb+'px');}else{ka.set(this.scroller,'height','auto');k.removeClass(this.rhc,'pinnedUfi');ob-=qb;}if(this.redesign){var sb=m.scry(this.ufiInputContainer,'li.UFIAddComment');if(sb.length!==0){var tb=m.scry(this.scrollerBody,'li.UFIComment.display');if(tb.length===0){k.addClass(sb[0],'UFIFirstComponent');}else k.removeClass(sb[0],'UFIFirstComponent');}}var ub=pa.getElementDimensions(this.ufiInputContainer).y;ka.set(this.ufiForm,'padding-bottom',ub+'px');ea.resize(new pa(nb.x,ob));this.scrollableArea.adjustGripper();};lb.prototype.adjustForResize=function(){"use strict";this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();};lb.prototype.shouldShowHiRes=function(mb){"use strict";if(!mb||!mb.smallurl)return false;var nb=this.getStageSize(mb.dimensions);nb=this._adjustStageSizeForPixelRatio(nb);var ob=this.getImageSizeInStage(mb.dimensions,nb);return (ob.x>lb.STAGE_NORMAL_MAX.x||ob.y>lb.STAGE_NORMAL_MAX.y);};lb.prototype._adjustStageSizeForPixelRatio=function(mb){"use strict";if(window.devicePixelRatio&&window.devicePixelRatio>1)mb=new pa(mb.x*window.devicePixelRatio,mb.y*window.devicePixelRatio);return mb;};lb.prototype.getImageURL=function(mb){"use strict";if(mb.video){return null;}else if(mb.smallurl&&!this.shouldShowHiRes(mb))return mb.smallurl;return mb.url;};lb.prototype.getImageDimensions=function(mb){"use strict";if(mb.smalldims&&(!this.shouldShowHiRes(mb)||this.image.src===mb.smallurl))return mb.smalldims;return mb.dimensions;};lb.prototype.getStageSize=function(mb,nb){"use strict";var ob=pa.getViewportDimensions(),pb=new pa(mb.x,mb.y);if(nb)pb=new pa(Math.max(mb.x,nb.x),Math.max(mb.y,nb.y));var qb,rb;if(this.fullscreen&&p.isFullScreen()){return new pa((this.rhcCollapsed?screen.width:screen.width-lb.SIDEBAR_SIZE_MAX),screen.height-lb.FULL_SCREEN_PADDING*2);}else{qb=Math.min(pb.x,(ob.x-lb.SIDEBAR_SIZE_MAX-lb.STAGE_CHROME.x));rb=Math.min(pb.y,ob.y-lb.STAGE_CHROME.y);}if(qb===0&&rb===0)return new pa(0,0);var sb=qb/rb,tb=pb.x/pb.y;if(sb<tb)return new pa(qb,Math.round(qb/tb));return new pa(Math.round(rb*tb),rb);};lb.prototype.getImageSizeInStage=function(mb,nb){"use strict";var ob=mb.x,pb=mb.y;if(ob>=nb.x||pb>=nb.y){var qb=nb.x/nb.y,rb=ob/pb;if(qb<rb){ob=nb.x;pb=Math.round(ob/rb);}else if(qb>rb){pb=nb.y;ob=Math.round(pb*rb);}else{ob=nb.x;pb=nb.y;}}return new pa(ob,pb);};lb.prototype.adjustStageSize=function(mb){"use strict";var nb=this.currentImageSize;if(mb){nb=mb;}else{var ob=this.stream&&this.stream.getCurrentImageData();if(ob)nb=this.getImageDimensions(ob);}if(!nb)return;this.currentImageSize=nb;var pb=0;if(this.shouldStretch&&!this.getVideoOnStage()&&nb.x>nb.y&&nb.x<=lb.TIMELINE_STRETCH_WIDTH&&nb.x>=lb.TIMELINE_STRETCH_MIN){nb.y=Math.round(nb.y*lb.TIMELINE_STRETCH_WIDTH/nb.x);nb.x=lb.TIMELINE_STRETCH_WIDTH;}else if(this.getVideoOnStage())pb=lb.VIDEO_BOTTOM_BAR_SPACE*2;var qb=this.getStageSize(nb,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new pa(0,0);this.currentMinSize=new pa(Math.max(qb.x,lb.STAGE_MIN.x,this.currentMinSize.x),Math.max(qb.y,lb.STAGE_MIN.y,this.currentMinSize.y));var rb=this.getImageSizeInStage(nb,this.currentMinSize),sb=this.currentMinSize.x-rb.x,tb=this.currentMinSize.y-rb.y;if(sb>0&&sb<lb.PADDING_MIN){this.currentMinSize.x-=sb;}else if(tb>0&&tb<lb.PADDING_MIN)this.currentMinSize.y-=tb;var ub=this.currentMinSize.x+lb.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)ub=this.currentMinSize.x;this.snowliftPopup.style.cssText='width:'+ub+'px;'+'height:'+this.currentMinSize.y+'px;';var vb=this.currentMinSize.y-pb+'px';if(oa.firefox()||oa.ie()<8){var wb=ka.get(this.stageWrapper,'font-size');if(oa.ie()&&wb.indexOf('px')<0){var xb=m.create('div');xb.style.fontSize=wb;xb.style.height='1em';wb=xb.style.pixelHeight;}vb=((this.currentMinSize.y-pb)/parseFloat(wb))+'em';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+vb+';';if(oa.ie()<8){ka.set(this.root,'height',pa.getViewportDimensions().y+'px');ka.set(this.container,'min-height',(this.currentMinSize.y+lb.STAGE_CHROME.y)+'px');}this.image.style.cssText='width:'+rb.x+'px;'+'height:'+rb.y+'px;';var yb=this.getTagger();if(yb)yb.repositionTagger();this.adjustScrollerIfNecessary();};lb.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var mb=m.scry(this.stage,'div.tagsWrapper')[0],nb=pa.getElementDimensions(this.image);if(mb){ka.set(mb,'width',nb.x+'px');ka.set(mb,'height',nb.y+'px');if(oa.ie()<=7){var ob=m.scry(this.root,'div.tagContainer')[0];if(ob)k.conditionClass(mb,'ie7VerticalFix',pa.getElementDimensions(ob).y>nb.y);}}};lb.prototype.adsDisplayedCallback=function(mb,nb){"use strict";var ob=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&mb<lb.MIN_ADS_VISIBLE&&nb.length>=lb.MIN_ADS_VISIBLE;if(ob){this.inAdsDisplayedCallback=true;var pb=nb[lb.MIN_ADS_VISIBLE-1];this.adjustScroller(pb);this.inAdsDisplayedCallback=false;}};lb.prototype.setLoadingState=function(mb,nb){"use strict";switch(mb){case lb.STATE_IMAGE_PIXELS:k.conditionClass(this.root,'imagePixelsLoading',nb);break;case lb.STATE_IMAGE_DATA:this.loadingStates[mb]=nb;k.conditionClass(this.root,'imageLoading',nb);break;case lb.STATE_HTML:this.loadingStates[mb]=nb;k.conditionClass(this.root,'dataLoading',nb);this.rhc.setAttribute('aria-busy',nb?'true':'false');break;}};lb.prototype.destroy=function(){"use strict";this.stageHandlers.forEach(function(mb){mb.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(mb){mb.remove();});this.pageHandlers=null;}this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;};lb.prototype.checkState=function(mb){"use strict";if(mb!=lb.STATE_ERROR&&!this.loadingStates[mb])return;switch(mb){case lb.STATE_IMAGE_DATA:var nb=this.stream.getCurrentImageData();if(nb){var ob=this.getImageURL(nb);if(ob){this.switchImage(ob,null,true);}else if(nb.video)this.switchVideo(nb.video,true);this.setLoadingState(mb,false);}break;case lb.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(mb,false);}break;default:if(this.stream.errorInCurrent()){k.hide(this.image);k.show(this.errorBox);}break;}};lb.prototype.buttonListener=function(event){"use strict";var mb=event.getTarget(),nb=Date.now();if(z.byClass(mb,'fbPhotoTagApprovalBox'))return;if(nb-this.lastPage<350)return;if(z.byClass(mb,'fbPhotosPhotoLike')){this.likePhoto();}else if(z.byClass(mb,'tagApproveIgnore')){this.updateTagBox(event,mb);}else if(z.byClass(mb,"_5ge9")){this.toggleSlideshow();return false;}};lb.prototype.toggleSlideshow=function(){"use strict";if(!this.slideshowGk)return;if(this._slideshowToken){this.stopSlideshow();}else this.startSlideshow();};lb.prototype.startSlideshow=function(){"use strict";this._slideshowToken=window.setInterval(this.page.bind(this,1,oa.chrome()&&p.isFullScreen()),lb.SLIDESHOW_TIME);k.addClass(this.root,'slideshowStarted');k.removeClass(this.root,'slideshowAvailable');};lb.prototype.stopSlideshow=function(){"use strict";this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;k.addClass(this.root,'slideshowAvailable');k.removeClass(this.root,'slideshowStarted');};lb.prototype.likePhoto=function(){"use strict";da.addButtonLike();var mb=qa('fbPhotoSnowliftFeedback'),nb=m.scry(mb,'button.like_link')[0];if(!nb)if(this.redesign){nb=m.scry(this.root,"a._6k6")[0];}else nb=m.scry(mb,'a.UFILikeLink')[0];var ob=nb.getAttribute('href');if(p.isFullScreen())if(oa.chrome())nb.setAttribute('href','javascript:;');nb.click();nb.setAttribute('href',ob);};lb.prototype.toggleLikeButton=function(){"use strict";var mb=m.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(mb){var nb=m.find(this.root,'.likeCount'),ob=m.find(nb,'.likeCountNum');if(nb)if(k.hasClass(mb,'viewerLikesThis')){m.setContent(ob,parseInt(ob.textContent,10)-1);}else m.setContent(ob,parseInt(ob.textContent,10)+1);k.toggleClass(mb,'viewerLikesThis');k.removeClass(mb,'viewerAlreadyLikedThis');}};lb.prototype.likePhotoWithKey=function(){"use strict";return u.like(this.likePhoto.bind(this),za());};lb.prototype.updateTagBox=function(mb,nb){"use strict";this.unhiliteAllTags();var ob=ya(mb);if(!ob)return;k.addClass(ob,'tagBox');k.addClass(ob,'tagBoxPendingResponse');k.removeClass(ob,'tagBoxPending');k.hide(m.find(ob,'span.tagForm'));if(nb){k.show(m.find(ob,'span.tagApproved'));}else k.show(m.find(ob,'span.tagIgnored'));};lb.prototype.rotate=function(mb){"use strict";var nb=this.stream.getCursor();if(this.getVideoOnStage()){var ob=(mb=='left')?270:90;h.isTruthy(this.videoRotateURI,"Video rotate URI not set.");j.loadModules(['VideoRotate'],function(qb){new qb(nb,this.videoRotateURI).motionRotate(ob);}.bind(this));return;}var pb=ta({fbid:nb,opaquecursor:this.stream.getOpaqueCursor(nb),cs_ver:aa.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());pb[mb]=1;this.setLoadingState(lb.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);k.hide(this.image);new i('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(pb).setErrorHandler(this.rotationError.bind(this,nb)).setFinallyHandler(this.rotationComplete.bind(this,nb)).setMethod('POST').setReadOnly(false).send();};lb.prototype.rotationComplete=function(mb,nb){"use strict";if(mb==this.stream.getCursor()){this.setLoadingState(lb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};lb.prototype.rotationError=function(mb,nb){"use strict";if(mb==this.stream.getCursor()){this.setLoadingState(lb.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));j.loadModules(['AsyncResponse'],function(ob){ob.defaultErrorHandler(nb);});}};lb.prototype.saveTagsFromPayload=function(mb){"use strict";this.storeFromData(mb);if('data' in mb&&this.stream.getCursor() in mb.data)this.swapData();};lb.prototype.saveEdit=function(){"use strict";if(!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;j.loadModules(['PhotoInlineEditor','Form'],function(mb,nb){var ob=mb.getInstance(this.getViewerConst());ob&&nb.bootstrap(ob.getForm().controller);}.bind(this));};lb.prototype.mouseLeaveListener=function(event){"use strict";this.unhiliteAllTags();this.reHilitePendingTag();};lb.prototype.hilitePagerOnMouseMove=function(event){"use strict";var mb=pa.getEventPosition(event),nb=pa.getElementPosition(this.stage);if(x.isRTL()){var ob=pa.getElementDimensions(this.stage);this.stagePagerPrev=ob.x-(mb.x-nb.x)<lb.GOPREV_AREA;}else this.stagePagerPrev=mb.x-nb.x<lb.GOPREV_AREA;k.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);k.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var pb,qb=event.getTarget();if(!z.byClass(qb,'snowliftOverlay')&&!z.byClass(qb,'bottomBarActions')&&!z.byClass(qb,'snowliftPager'))pb=lb.PAGER_FADE;this.showPagers(pb);};lb.prototype.showPagers=function(mb){"use strict";clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof mb!=='undefined')this.fadePagerTimer=this.hidePagers.bind(this).defer(mb);};lb.prototype.hidePagers=function(){"use strict";var mb=m.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(mb)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};lb.prototype.getTagger=function(){"use strict";if(!this.PhotoTagger)return null;var mb=this.PhotoTagger.getInstance(aa.VIEWER_SNOWLIFT);if(!mb||!mb.tagHoverFacebox)return null;return mb;};lb.prototype.unhiliteAllTags=function(){"use strict";clearTimeout(this.unhiliteTimer);m.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(nb){k.removeClass(nb,'hover');});m.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(nb){k.removeClass(nb,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!k.hasClass(this.root,'taggingMode')){var mb=this.getTagger();if(mb){mb.hideTagger();mb.setCurrentFacebox(null);}}};lb.prototype.switchHilitedTags=function(mb,nb){"use strict";if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var ob=ya(mb);if(ob){this.hilitedTag=mb;if(!k.hasClass(this.root,'taggingMode')&&ga.isFacebox(this.hilitedTag)){var pb=this.getTagger();if(pb){k.addClass(ob,'hover');var qb=pb.getFacebox(mb);pb.setCurrentFacebox(qb);if(qb)pb.addTagFromFacebox(qb);}}else k.addClass(ob,'hover');if(k.hasClass(ob,'tagBoxPending')&&!k.hasClass(ob,'showPendingTagName')&&nb===true){m.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(rb){k.removeClass(rb,'showPendingTagName');});k.addClass(ob,'showPendingTagName');}}};lb.prototype.reHilitePendingTag=function(){"use strict";var mb=ya(this.hilitedTag);if(mb&&k.hasClass(mb,'showPendingTagName'))return;var nb=m.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(nb)this.switchHilitedTags(nb.id);};lb.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var mb=event.getTarget();if(z.byClass(mb,'snowliftOverlay')||z.byClass(mb,'fbPhotoSnowliftTagApproval')||z.byClass(mb,'tagPointer')||z.byClass(mb,'arrow')||z.byClass(mb,'faceboxSuggestion')||z.byClass(mb,'typeaheadWrapper')||z.byClass(mb,'photoTagTypeahead'))return;var nb=z.byClass(mb,'tagBoxPending'),ob=false;if(this.hilitedTag){var pb=ya(this.hilitedTag);ob=pb&&k.hasClass(pb,'tagBoxPending');}var qb=((!this.hilitedTag&&nb)||(!ob&&nb));if(qb){this.switchHilitedTags(nb.id);return;}if(nb&&(nb.id==this.hilitedTag))return;var rb=250,sb=15,tb=pa.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=tb;var ub=ga.absoluteToNormalizedPosition(this.image,tb);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(tb)<sb){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(ub))return;var vb=ga.getNearestBox(this.stream.getCurrentExtraData().tagRects,ub);if(!vb){if(!ob){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var wb=null;if(ob){var xb={};xb[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];wb=ga.getNearestBox(xb,ub);}if(wb!==null&&ob)return;if(this.hilitedTag!=vb)if(ob){this.switchTimer=this.switchHilitedTags.bind(this,vb).defer(rb);}else{if(this.showHover){if(!this.seenTags)this.seenTags=[];if(!this.seenTags[vb]){da.addFaceTagImpression();this.seenTags[vb]=true;}}this.switchHilitedTags(vb);}};lb.prototype.currentTagHasPrecedence=function(mb){"use strict";if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===undefined){this.hilitedTag=null;return false;}var nb=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],ob=new ia(nb.t+(nb.h()/2),nb.r,nb.b+(ga.isFacebox(this.hilitedTag)?10:0),nb.l,nb.domain);return ob.contains(mb);};lb.prototype.getVideoOnStage=function(){"use strict";var mb=this.stream&&this.stream.getCurrentImageData();return mb&&mb.video;};lb.prototype.shouldPageOnAction=function(mb,nb){"use strict";if(!this.isOpen||u.isShowingConfirmation())return false;var ob=m.isNode(nb)&&(z.byClass(nb,'snowliftPager')||z.byClass(nb,'stagePagers')||z.byClass(nb,'pivotPageColumn')),pb=m.isNode(nb)&&z.byClass(nb,'stage'),qb=k.hasClass(nb,'faceBox'),rb=(!k.hasClass(this.root,'taggingMode')&&qb&&!ob);if(rb){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();(function(){m.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this).defer();}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var sb=((pb&&k.hasClass(this.root,'taggingMode'))||z.byClass(nb,'tagBoxPending')||z.byClass(nb,'tagBoxPendingResponse')||z.byClass(nb,'fbPhotoTagApprovalBox')||z.byClass(nb,'tag')||(this.cropper&&this.cropper.croppingMode));if(sb)return false;return mb==s.LEFT||mb==s.RIGHT||mb==fb||mb==gb||ob||rb||pb;};lb.prototype.keyHandler=function(mb,event){"use strict";if(event.getModifiers().any||t.getTopmostLayer()!==this.spotlight)return true;switch(o.getKeyCode(event)){case s.LEFT:case s.RIGHT:case fb:case gb:if(!this.pagersOnKeyboardNav)this.showPagers(lb.PAGER_FADE);this.pageListener(event);return false;case hb:return this.toggleFullScreen();case ib:return this.likePhotoWithKey();case s.SPACE:this.toggleSlideshow();this.showPagers(lb.PAGER_FADE);return false;}};lb.prototype.shouldHandlePendingTag=function(event){"use strict";var mb=this.getTagger();if(!mb||!mb.tags.length)return false;var nb=ga.absoluteToNormalizedPosition(this.getImage(),pa.getEventPosition(event)),ob=mb.findNearestTag(nb);if(!ob||!k.hasClass(ob.node,'tagBoxPending'))return false;g.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:ob.id,version:this.getVersionConst()});return true;};lb.prototype.pageListener=function(event){"use strict";var mb=o.getKeyCode(event),nb=event.getTarget();if(this._slideshowToken){this.stopSlideshow();return;}if(!this.shouldPageOnAction(mb,nb))return;if(this.shouldHandlePendingTag(event))return;var ob=0;if(mb==s.RIGHT||mb==gb){ob=1;da.setPagingAction('key_right');}else if(mb==s.LEFT||mb==fb){ob=-1;da.setPagingAction('key_left');}else if(z.byClass(nb,'next')){ob=1;da.setPagingAction('click_next');}else if(z.byClass(nb,'prev')){ob=-1;da.setPagingAction('click_prev');}else if(!this.stagePagerPrev){ob=1;da.setPagingAction('click_stage');}else{ob=-1;da.setPagingAction('click_stage_back');}var pb=m.scry(this.ufiForm,'input.mentionsHidden'),qb=false;for(var rb=0;rb<pb.length;rb++)if(!r.isEmpty(pb[rb])){qb=true;break;}if(qb||k.hasClass(this.root,'fbPhotoSnowliftEditMode')||(this.cropper&&this.cropper.croppingMode)){this.warnLeavePage(ob);}else{this.page(ob,oa.chrome()&&p.isFullScreen());eb('snowlift',nb,event).uai(da.pagingAction);}};lb.prototype.warnLeavePage=function(mb){"use strict";new l().setTitle("Are you sure you want to leave this page?").setBody("You have unsaved changes that will be lost if you leave the page.").setButtons([{name:'leave_page',label:"Leave this Page",handler:this.page.bind(this,mb)},{name:'continue_editing',label:"Stay on this Page",className:'inputaux'}]).setModal(true).show();};lb.prototype.getUsesOpaqueCursor=function(){"use strict";return this.stream.getUsesOpaqueCursor();};lb.prototype.getOpaqueCursor=function(mb){"use strict";return this.stream.getOpaqueCursor(mb);};lb.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};lb.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};lb.prototype.page=function(mb,nb){"use strict";if(!this.stream.isValidMovement(mb)||!this.stream.nonCircularPhotoSetCanPage(mb)){this.showPagers(lb.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.seenTags=[];this.startingMousePos=null;this.haveLeftBufferRegion=false;var ob=this.getVideoOnStage();if(ob)this.switchVideo(ob,false);if(this.pivots&&this.pivots.page(mb))return;g.inform('PhotoSnowlift.PAGE');la.hide();this.recacheData();this.stream.moveCursor(mb);k.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(lb.STATE_HTML,true);k.show(this.errorBox);return;}var pb=this.stream.getCurrentImageData();if(pb){var qb=this.getImageURL(pb);if(qb){this.switchImage(qb,null,true);}else if(pb.video)this.switchVideo(pb.video,true);if(!nb){this.replaceUrl=true;ab(pb.info.permalink);}this.setLoadingState(lb.STATE_IMAGE_DATA,false);}else{this.setLoadingState(lb.STATE_IMAGE_PIXELS,true);this.setLoadingState(lb.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(lb.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer;this.loadAds();if(this.cropper)this.cropper.resetPhoto();this.setLeftAndRightPagersState();if(this._slideshowToken){k.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)k.addClass(this.root,'slideshowAvailable');};lb.prototype.logImpressionDetailsForPhoto=function(){"use strict";var mb=[].concat(m.scry(qa('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),m.scry(qa('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(mb.length===0)return;var nb={};for(var ob=0;ob<mb.length;ob++)nb[mb[ob].name]=mb[ob].value;if(this.getVideoOnStage()){nb.width=0;nb.height=0;}else{var pb=this.getImageDimensions(this.stream.getCurrentImageData());nb.width=pb.x;nb.height=pb.y;}da.addDetailData(this.stream.getCursor(),nb);ea.setIsLogAdData(true);};lb.prototype.loadAds=function(){"use strict";if(this.disableAds)return;ea.loadAdsFromUserActivity();};lb.prototype.transitionHandler=function(mb){"use strict";if(mb.getQueryData().closeTheater||mb.getQueryData().permPage||mb.getQueryData().makeprofile||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(cb(mb.getPath(),'/hashtag/')){this.close();y.transitionComplete(true);return true;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(mb.getQualifiedURI().toString());y.transitionComplete(true);return true;}var nb=this._uriStack.length;if(nb>=2&&this._uriStack[nb-2]==mb.getQualifiedURI().toString())this._uriStack.pop();var ob=this.stream.getCursorForURI(mb.getUnqualifiedURI().toString());if(ob){var pb=this.stream.getRelativeMovement(ob);this.page(pb,true);y.transitionComplete(false);return true;}if(this.isOpen){y.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};lb.prototype.recacheData=function(){"use strict";if(!this.loadingStates.html){var mb=this.stream.getCurrentHtml();for(var nb in mb){mb[nb]=ua(qa(nb).childNodes);m.empty(qa(nb));}}};lb.prototype.reloadIfTimeout=function(){"use strict";if(!q.hasLoaded(this.image)){var mb=this.makeNewImage(this.image.src,true);o.listen(mb,'load',this.useImage.bind(this,mb,null,true));this._log(mb.src);}};lb.prototype.useImage=function(mb,nb,ob){"use strict";if(ob&&q.hasLoaded(this.image))return;m.replace(this.image,mb);this.image=mb;g.inform('Amoeba/instrument',[this.image,'image'],g.BEHAVIOR_PERSISTENT);this.adjustStageSize(nb);};lb.prototype.makeNewImage=function(mb,nb){"use strict";if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!nb)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),lb.LOADING_TIMEOUT);var ob=m.create('img',{className:'spotlight',alt:''});ob.setAttribute('aria-describedby','fbPhotosSnowliftCaption');ob.setAttribute('aria-busy','true');o.listen(ob,'load',ra(function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);(function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this).defer();}.bind(this),'photo_theater'));this._log(mb);ob.src=mb;return ob;};lb.prototype.switchImage=function(mb,nb,ob){"use strict";k.hide(this.image);k.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var pb=this.stream&&this.stream.getCurrentImageData();if(pb)da.addPhotoView(pb.info,this.shouldShowHiRes(pb),this.fullscreen&&p.isFullScreen());this.useImage(this.makeNewImage(mb,false),nb,false);if(ob)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(this.cropper&&this.cropper.croppingMode)this.cropper.resetPhoto();g.inform('PhotoSnowlift.SWITCH_IMAGE');};lb.prototype.switchVideo=function(mb,nb){"use strict";var ob='swf_'+mb;if(nb){k.addClass(this.stageWrapper,'showVideo');var pb=m.create('div',{className:'videoStageContainer'});m.appendContent(this.videoStage,pb);pb.id=mb;if(window[ob]&&!ya(ob))window[ob].write(mb);var qb='video_warning_'+mb,rb=ya(mb);if(!this.videoWarnings)this.videoWarnings=[];if(rb&&this.videoWarnings[qb])m.setContent(rb,this.videoWarnings[qb]);this.adjustStageSizeForVideo.bind(this,ob).defer();}else{window[ob]&&window[ob].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);m.empty(this.videoStage);k.removeClass(this.stageWrapper,'showVideo');}};lb.prototype.checkVideoStatus=function(mb){"use strict";if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var nb=this.getVideoOnStage();if(!nb){return;}else{var ob='swf_'+nb;if(mb!==ob)return;this.adjustStageSizeForVideo(mb);}};lb.prototype.adjustStageSizeForVideo=function(mb){"use strict";var nb=ya(mb);if(!nb){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,mb),200);}else this.adjustStageSize(new pa(nb.width,nb.height));};lb.prototype.handleServerError=function(mb,nb){"use strict";m.setContent(this.errorBox,mb);this.storeFromData(nb);};lb.prototype.swapData=function(){"use strict";var mb,nb=this.stream.getCurrentHtml();if(nb){this.setLoadingState(lb.STATE_HTML,false);for(var ob in nb){mb=ya(ob);mb&&m.setContent(mb,nb[ob]);}g.inform('PhotoSnowlift.DATA_CHANGE',this.stream.getCurrentImageData().info,g.BEHAVIOR_STATE);if(this.stream.getCurrentExtraData())g.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};lb.prototype.updateTotalCount=function(mb,nb,ob){"use strict";var pb=this.stream.getCurrentHtml();if(pb){var qb=qa('fbPhotoSnowliftPositionAndCount');m.replace(qb,ob);qb=ob;k.show(qb);var rb='fbPhotoSnowliftPositionAndCount';pb[rb]=ua(qb.childNodes);}this.stream.setTotalCount(mb);this.stream.setFirstCursorIndex(nb);};lb.prototype.addPhotoFbids=function(mb,nb,ob,pb){"use strict";if(pb&&this.sessionID&&pb!=this.sessionID)return;var qb=this.stream.getCursor()===null;this.stream.attachToFbidsList(mb,nb,ob);if(ob&&qb)this.page(0,true);if(this.pivots&&ob)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;k.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();};lb.prototype.attachTagger=function(mb){"use strict";m.appendContent(this.stageActions,mb);};lb.prototype.storeFromData=function(mb){"use strict";if(!this.isOpen)return;if(mb.ssid&&this.sessionID&&this.sessionID!=mb.ssid)return;var nb=this.stream.storeToCache(mb);if('error' in nb){this.checkState(lb.STATE_ERROR);return;}if('init' in nb){this.initDataFetched(nb.init);if(this.openExplicitly){this.replaceUrl=true;ab(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();this.ua&&this.ua.add_event('ufi');}if('image' in nb)this.checkState(lb.STATE_IMAGE_DATA);if('data' in nb)this.checkState(lb.STATE_HTML);};lb.prototype.setLeftAndRightPagersState=function(){"use strict";if(this.stream.isNonCircularPhotoSet()){k.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));k.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}};lb.prototype.setStagePagersState=function(mb){"use strict";switch(mb){case 'ready':k.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':k.addClass(this.root,'pagingActivated');return;case 'inactive':k.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':k.removeClass(this.root,'pagingReady');return;}};lb.prototype.deletePhoto=function(mb){"use strict";this.closeRefresh();};lb.prototype.closeRefresh=function(){"use strict";this.refreshOnClose=true;this.closeHandler();};lb.prototype.onHiliteTag=function(mb,nb){"use strict";if(nb.version!=aa.VIEWER_SNOWLIFT)return;var ob=nb.tag;if(ob)this.switchHilitedTags(ob,true);};lb.prototype.onUpdateTagBox=function(mb,nb){"use strict";if(nb.version==aa.VIEWER_SNOWLIFT)this.updateTagBox(nb.id,nb.approve);};lb.prototype._log=function(mb){"use strict";if(this._shouldLog){this._logger&&this._logger.log(mb);return true;}return false;};lb.getInstance=function(){"use strict";if(!lb._instance)lb._instance=new lb();return lb._instance;};lb.initWithSpotlight=function(mb,nb){"use strict";lb.getInstance().init(mb,nb);};lb.addPhotoFbids=function(mb,nb,ob,pb){"use strict";lb.getInstance().addPhotoFbids(mb,nb,ob,pb);};lb.setReachedLeftEnd=function(){"use strict";lb.getInstance().setReachedLeftEnd();};lb.setReachedRightEnd=function(){"use strict";lb.getInstance().setReachedRightEnd();};lb.attachFollowFlyout=function(mb){"use strict";m.insertAfter(qa('fbPhotoSnowliftSubscribe'),mb);};lb.attachSubscribeFlyout=function(mb){"use strict";m.insertAfter(qa('fbPhotoSnowliftSubscribe'),mb);};lb.attachTagger=function(mb){"use strict";lb.getInstance().attachTagger(mb);};lb.preload=function(mb,nb){"use strict";lb.getInstance().preload(mb,nb);};lb.bootstrap=function(mb,nb){"use strict";if(mb&&na(mb).getQueryData().hasOwnProperty('share_id')){j.loadModules(['SpotlightShareViewer'],function(ob){ob.bootstrap(mb,nb);});return;}lb.getInstance().bootstrap(mb,nb);};lb.closeRefresh=function(){"use strict";lb.getInstance().closeRefresh();};lb.deletePhoto=function(mb){"use strict";lb.getInstance().deletePhoto(mb);};lb.getImage=function(){"use strict";return lb.getInstance().getImage();};lb.getImageId=function(){"use strict";return lb.getInstance().getImageId();};lb.getLoadQuery=function(){"use strict";return lb.getInstance().getLoadQuery();};lb.getRHCBody=function(){"use strict";return lb.getInstance().getRHCBody();};lb.getRHCFooter=function(){"use strict";return lb.getInstance().getRHCFooter();};lb.getRHCHeader=function(){"use strict";return lb.getInstance().getRHCHeader();};lb.getRoot=function(){"use strict";return lb.getInstance().getRoot();};lb.likePhotoSkipConfirmation=function(mb){"use strict";lb.getInstance().likePhotoSkipConfirmation(mb);};lb.saveTagsFromPayload=function(mb){"use strict";lb.getInstance().saveTagsFromPayload(mb);};lb.saveTagsFromPayloadDelayed=function(mb){"use strict";lb.saveTagsFromPayload.curry(mb).defer(2000);};lb.handleServerError=function(mb,nb){"use strict";lb.getInstance().handleServerError(mb,nb);};lb.setVideoWarning=function(mb,nb){"use strict";var ob=lb.getInstance(),pb='video_warning_'+mb;if(!ob.videoWarnings)ob.videoWarnings=[];ob.videoWarnings[pb]=nb;};lb.storeFromData=function(mb){"use strict";lb.getInstance().storeFromData(mb);};lb.swapData=function(){"use strict";lb.getInstance().swapData();};lb.updateTotalCount=function(mb,nb,ob){"use strict";lb.getInstance().updateTotalCount(mb,nb,ob);};lb.setVideoRotateURI=function(mb){"use strict";lb.getInstance().videoRotateURI=mb;};ta(lb,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:360,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:xa,touchMarkup:xa});ta(lb.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:lb.STAGE_NORMAL_MAX,stageChrome:lb.STAGE_CHROME,stagePagerPrev:null,ua:null,PhotoTagger:null,showHover:false});e.exports=lb;});