/*!CK:3993568988!*//*1384744670,178191153*/

if (self.CavalryLogger) { CavalryLogger.start_js(["Yp5jG"]); }

__d("GenderConst",[],function(a,b,c,d,e,f){var g={UNKNOWN:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11};e.exports=g;});
__d("ChatOpenTab",["Arbiter","Banzai","Bootloader","ChatApp","ChatVisibility","ContextualThing","cx","Event","MercuryIDs","MercuryMessages","MercuryServerRequests","MercuryThreads","Parent"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Banzai'),i=b('Bootloader'),j=b('ChatApp'),k=b('ChatVisibility'),l=b('ContextualThing'),m=b('cx'),n=b('Event'),o=b('MercuryIDs'),p=b('MercuryMessages').get(),q=b('MercuryServerRequests').get(),r=b('MercuryThreads').get(),s=b('Parent'),t='messaging_tracking';function u(z){r.getThreadMeta(z,function(){g.inform('chat/open-tab',{thread_id:z});});}function v(z,aa,ba,ca){n.listen(z,'click',function(da){if(ca(aa,ba))return;return da.kill();});}function w(z,aa,ba){var ca={referrer:z||'',message_thread_id:aa,message_view:'chat',timestamp_send:Date.now()};if(ba!==undefined)ca.message_target_ids=[ba];h.post(t,ca,{delay:0,retry:true});}function x(z){var aa=l.getContext(z);return (aa&&s.byClass(aa,"_3qw")!==null);}var y={openEmptyTab:function(z,aa){if(!window.Chat||!k.isOnline()||!j.getInstance()||j.getInstance().isHidden())return true;i.loadModules(['ChatTabModel'],function(ba){var ca=ba.getEmptyTab();if(!ca){ca='root:'+p.generateNewClientMessageID(Date.now());r.createNewLocalThread(ca,[]);}u(ca);w(aa,ca);});},listenOpenEmptyTab:function(z,aa){v(z,null,aa,y.openEmptyTab);},openThread:function(z,aa){if(o.isValid(z)){u(z);}else q.getClientThreadID(z,u);w(aa,z);},listenOpenThread:function(z,aa,ba){v(z,aa,ba,y.openThread);},openUserTab:function(z,aa){var ba=r.getCanonicalThreadToUser(z);u(ba.thread_id);w(aa,ba.thread_id,z);},listenOpenUserTab:function(z,aa,ba){if(!x(z))v(z,aa,ba,y.openUserTab);}};e.exports=y;});
__d("TypingDetectorController",["AsyncRequest","AvailableList","AvailableListConstants","ChannelConnection","ChatVisibility","Keys","PresencePrivacy","ShortProfiles","TypingDetector","copyProperties","emptyFunction","shield"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChannelConnection'),k=b('ChatVisibility'),l=b('Keys'),m=b('PresencePrivacy'),n=b('ShortProfiles'),o=b('TypingDetector'),p=b('copyProperties'),q=b('emptyFunction'),r=b('shield');function s(u){if(!k.isOnline())return false;if(u){var v=n.getNow(u);return v&&v.type=="friend"&&m.allows(u);}return true;}function t(u,v,w,x,y){"use strict";this.userID=u;this.input=v;this.source=w;this.threadID=y;this.remoteState=o.INACTIVE;this.notifyTimer=null;x=x||{};this.notifyDelay=x.notifyDelay||this.notifyDelay;this._typingDetector=new o(v);this._typingDetector.init(x);this._typingDetector.subscribe('change',this._stateChange.bind(this));}t.prototype.setUserAndThread=function(u,v){"use strict";if(this.userID!==u||this.threadID!==v){this.resetState();this.userID=u;this.threadID=v;}};t.prototype.setIgnoreEnter=function(u){"use strict";var v=u?[l.RETURN]:[];this._typingDetector.setIgnoreKeys(v);};t.prototype.resetState=function(){"use strict";this.remoteState=t.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};t.prototype._stateChange=function(u,v){"use strict";if(v!=o.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=r(this._notifyState,this,v).defer(this.notifyDelay,false);}else this._notifyState(v,true);};t.prototype._notifyState=function(u,v){"use strict";if(!this.userID&&!this.threadID)return;var w=this.userID,x=s(w);if(x&&u!=this.remoteState){this.remoteState=u;if(j.disconnected())return;var y={typ:u,to:w,source:this.source,thread:this.threadID};new g().setHandler(this._onTypResponse.bind(this,w)).setErrorHandler(q).setData(y).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous',!v).send();}};t.prototype._onTypResponse=function(u,v){"use strict";var w=v.getPayload()||{};if(w.offline)h.set(u,i.OFFLINE,'typing_response');};p(t.prototype,{notifyDelay:1000});e.exports=t;});
__d("VideoCallingTour",["Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Chat'),j=b('ChatSidebar'),k=b('ChatVisibility'),l=b('CSS'),m=b('DOM'),n=b('PresencePrivacy'),o=b('Run'),p=b('Toggler'),q=b('Vector'),r=b('copyProperties'),s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=y.defer();}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=y.defer();}));});x.inform('videocallingtour/start');}});e.exports=x;});
__d("MercuryResizableMixin.react",["DOMDimensions","Event"],function(a,b,c,d,e,f){var g=b('DOMDimensions'),h=b('Event'),i={_prevDimensions:{width:0,height:0},triggerResizeGetDimensions:function(){if(this.isMounted()){return g.getElementDimensions(this.getDOMNode());}else return this._prevDimensions;},triggerResizeGetDimensionsChange:function(){var j=this.triggerResizeGetDimensions();return {heightChange:j.height-this._prevDimensions.height,widthChange:j.width-this._prevDimensions.width};},triggerResizeMaybe:function(){var j=this.triggerResizeGetDimensionsChange();if(j.heightChange!==0||j.widthChange!==0)this.triggerResize();},triggerResize:function(){var j=this.triggerResizeGetDimensions(),k=this.triggerResizeGetDimensionsChange();this.props&&this.props.onResize&&this.props.onResize(k);this.componentDidResize&&this.componentDidResize(k);this._prevDimensions=j;},componentDidUpdate:function(){this.triggerResizeMaybe();},componentDidMount:function(){this.triggerResizeMaybe();h.listen(this.getDOMNode(),'load',this.triggerResizeMaybe);}};e.exports=i;});
__d("MercuryActionMessage.react",["React","ReactPropTypes","MercuryLogMessageType","MercuryParticipants","TooltipLink.react","MercuryResizableMixin.react","fbt","cx","copyProperties"],function(a,b,c,d,e,f){var g=b('React'),h=b('ReactPropTypes'),i=b('MercuryLogMessageType'),j=b('MercuryParticipants'),k=b('TooltipLink.react'),l=b('MercuryResizableMixin.react'),m=b('fbt'),n=b('cx'),o=b('copyProperties'),p=g.createClass({displayName:'MercuryEventMessage',props:{message:h.object.isRequired},mixins:[l],getInitialState:function(){return {};},isYou:function(q){return q===j.user;},render:function(){var q=this.props.message,r=q.log_message_data,s=false;j.getMap({author:q.author,joined:r.joined_user,caller:r.caller,callee:r.callee,added:r.added_participants},function(u){if(u.added)for(var v=0;v<u.added.length;v++)if(v!==0&&this.isYou(u.added[v].id)){var w=u.added[0];u.added[0]=u.added[v];u.added[v]=w;}if(this.isMounted()){this.setState(u);}else o(this.state,u);s=true;}.bind(this));var t;if(s){t=this._messageRenderers[this.getType()].call(this);}else t=null;return this.transferPropsTo(g.DOM.div({className:"_5her"},t));},renderUserLink:function(q){return g.DOM.a({href:q.href,className:"_5hes"},q.name);},renderMoreLink:function(q){return k({tooltip:this.renderMoreTooltip(q),alignH:"center",position:"above"},m._("{num} more",[m.param("num",q.length)]));},renderMoreTooltip:function(q){return g.DOM.div(null,q.map(function(r){return g.DOM.div(null,r.name);}));},getType:function(){var q=this.props.message,r=q.author,s=q.log_message_data,t=q.log_message_type,u=s.event_name,v=this.isYou(r)?'You':'Other',w=this.isYou(r)?'Outgoing':'Incoming',x=s.answered?'Answered':'Missed';if(t===i.JOINABLE_CREATED){return 'joinableCreated'+v;}else if(t===i.JOINABLE_JOINED){return 'joinableJoined'+v;}else if(t===i.SUBSCRIBE){if(this.isYou(r)){return 'subscribedByYou';}else if(this.isYou(s.added_participants[0])){return 'subscribedYou';}else return 'subscribedOther';}else if(t===i.UNSUBSCRIBE){return 'unsubscribed'+v;}else if(t===i.VIDEO_CALL){if(u==='installing'){return 'videoInstalling';}else if(u==='install_canceled'){return 'videoInstallCancelled';}else return 'videoCall'+w+x;}else if(t===i.PHONE_CALL){return 'phoneCall'+w+x;}else if(t===i.THREAD_NAME){var y=s.name?'Changed':'Cleared';return 'threadName'+y+v;}else if(t===i.THREAD_IMAGE){var z=s.image?'Changed':'Cleared';return 'threadImage'+z+v;}else if(t===i.SERVER_ERROR)return 'error';},_messageRenderers:{joinableCreatedYou:function(){return "Other people can join this chat from News Feed and add their friends.";},joinableCreatedOther:function(){var q=this.state.author;return m._("{actor} shared this chat to News Feed. Other people can join and add their friends.",[m.param("actor",this.renderUserLink(q))]);},joinableJoinedYou:function(){return "You joined the chat. Other people can join from News Feed and add their friends.";},joinableJoinedOther:function(){var q=this.state.author;return m._("{actor} joined the chat.",[m.param("actor",this.renderUserLink(q))]);},videoInstalling:function(){var q=this.state.author;return m._("{firstname} is setting up video calling...",[m.param("firstname",this.renderUserLink(q))]);},videoInstallCancelled:function(){return "You canceled the video calling installation.";},videoCallOutgoingAnswered:function(){var q=this.state.caller;return m._("You called {firstname}.",[m.param("firstname",this.renderUserLink(q))]);},videoCallOutgoingMissed:function(){var q=this.state.callee;return m._("{firstname} missed a call from you.",[m.param("firstname",this.renderUserLink(q))]);},videoCallIncomingAnswered:function(){var q=this.state.caller;return m._("{firstname} called you.",[m.param("firstname",this.renderUserLink(q))]);},videoCallIncomingMissed:function(){var q=this.state.caller;return m._("You missed a call from {firstname}.",[m.param("firstname",this.renderUserLink(q))]);},unsubscribedYou:function(){return "You left the conversation.";},unsubscribedOther:function(){var q=this.state.author;return m._("{actor} left the conversation.",[m.param("actor",this.renderUserLink(q))]);},error:function(){return "We were unable to fetch previous messages in this conversation.";},phoneCallOutgoingAnswered:function(){var q=this.state.callee;return m._("You called {firstname}.",[m.param("firstname",this.renderUserLink(q))]);},phoneCallOutgoingMissed:function(){var q=this.state.callee;return m._("{firstname} missed a call from you.",[m.param("firstname",this.renderUserLink(q))]);},phoneCallIncomingAnswered:function(){var q=this.state.caller;return m._("{firstname} called you.",[m.param("firstname",this.renderUserLink(q))]);},phoneCallIncomingMissed:function(){var q=this.state.caller;return m._("You missed a call from {firstname}.",[m.param("firstname",this.renderUserLink(q))]);},threadImageChangedYou:function(){return "You changed the conversation picture.";},threadImageClearedYou:function(){return "You removed the conversation picture.";},threadImageChangedOther:function(){var q=this.state.author;return m._("{actor} changed the conversation picture.",[m.param("actor",this.renderUserLink(q))]);},threadImageClearedOther:function(){var q=this.state.author;return m._("{actor} removed the conversation picture.",[m.param("actor",this.renderUserLink(q))]);},threadNameChangedYou:function(){var q=this.props.message,r=q.log_message_data.name;return m._("You named the conversation: {name}.",[m.param("name",g.DOM.b(null,r))]);},threadNameClearedYou:function(){return "You removed the conversation name.";},threadNameChangedOther:function(){var q=this.state.author,r=this.props.message,s=r.log_message_data.name;return m._("{actor} named the conversation: {name}.",[m.param("actor",this.renderUserLink(q)),m.param("name",g.DOM.b(null,s))]);},threadNameClearedOther:function(){var q=this.state.author;return m._("{actor} removed the conversation name.",[m.param("actor",this.renderUserLink(q))]);},subscribedByYou:function(){var q=this.state.added;if(q.length===1){return m._("You added {subscriber1}.",[m.param("subscriber1",this.renderUserLink(q[0]))]);}else if(q.length===2){return m._("You added {subscriber1} and {subscriber2}.",[m.param("subscriber1",this.renderUserLink(q[0])),m.param("subscriber2",this.renderUserLink(q[1]))]);}else if(q.length===3){return m._("You added {subscriber1}, {subscriber2} and {subscriber3}.",[m.param("subscriber1",this.renderUserLink(q[0])),m.param("subscriber2",this.renderUserLink(q[1])),m.param("subscriber3",this.renderUserLink(q[2]))]);}else return m._("You added {subscriber1}, {subscriber2} and {more_people}.",[m.param("subscriber1",this.renderUserLink(q[0])),m.param("subscriber2",this.renderUserLink(q[1])),m.param("more_people",this.renderMoreLink(q.slice(2)))]);},subscribedYou:function(){var q=this.state.added,r=this.state.author;if(q.length===1){return m._("{actor} added you.",[m.param("actor",this.renderUserLink(r))]);}else if(q.length===2){return m._("{actor} added you and {subscriber2}.",[m.param("actor",this.renderUserLink(r)),m.param("subscriber2",this.renderUserLink(q[1]))]);}else if(q.length===3){return m._("{actor} added you, {subscriber2} and {subscriber3}.",[m.param("actor",this.renderUserLink(r)),m.param("subscriber2",this.renderUserLink(q[1])),m.param("subscriber3",this.renderUserLink(q[2]))]);}else return m._("{actor} added you, {subscriber2} and {more_people}.",[m.param("actor",this.renderUserLink(r)),m.param("subscriber2",this.renderUserLink(q[1])),m.param("more_people",this.renderMoreLink(q.slice(2)))]);},subscribedOther:function(){var q=this.state.added,r=this.state.author;if(q.length===1){return m._("{actor} added {subscriber1}.",[m.param("actor",this.renderUserLink(r)),m.param("subscriber1",this.renderUserLink(q[0]))]);}else if(q.length===2){return m._("{actor} added {subscriber1} and {subscriber2}",[m.param("actor",this.renderUserLink(r)),m.param("subscriber1",this.renderUserLink(q[0])),m.param("subscriber2",this.renderUserLink(q[1]))]);}else if(q.length===3){return m._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",[m.param("actor",this.renderUserLink(r)),m.param("subscriber1",this.renderUserLink(q[0])),m.param("subscriber2",this.renderUserLink(q[1])),m.param("subscriber3",this.renderUserLink(q[2]))]);}else return m._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",[m.param("actor",this.renderUserLink(r)),m.param("subscriber1",this.renderUserLink(q[0])),m.param("subscriber2",this.renderUserLink(q[1])),m.param("more_people",this.renderMoreLink(q.slice(2)))]);}}});e.exports=p;});
__d("MercuryDateBreak.react",["React","ReactPropTypes","Timestamp.react","formatDate","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('ReactPropTypes'),i=b('Timestamp.react'),j=b('formatDate'),k=b('cx'),l=g.createClass({displayName:'MercuryMessageBody',propTypes:{date:h.instanceOf(Date).isRequired},render:function(){var m=this.props.date,n=j(m,{today:'g:ia',withinWeek:'l g:ia',thisYear:'F jS, g:ia',older:'F j, Y g:i a'}),o=Math.round(m.getTime()/1000);return this.transferPropsTo(g.DOM.div({className:"_5hde"},g.DOM.div({className:"_5hdf"},i({time:o,verbose:n,text:n}))));}});e.exports=l;});
__d("MercuryMessageAttachments.react",["MercuryAttachmentRenderer","DOM","MercuryResizableMixin.react","React","ReactPropTypes","cx"],function(a,b,c,d,e,f){var g=b('MercuryAttachmentRenderer'),h=b('DOM'),i=b('MercuryResizableMixin.react'),j=b('React'),k=b('ReactPropTypes'),l=b('cx'),m=j.createClass({displayName:'MercuryMessageAttachments',propTypes:{message:k.object.isRequired,attachments:k.array.isRequired},mixins:[i],render:function(){return this.transferPropsTo(j.DOM.div({className:"_5h9y"}));},componentDidMount:function(){this._render();},_render:function(){var n=this.getDOMNode(),o=this.props.message,p=this.props.attachments;p.sort(g.booleanLexicographicComparator([g.isPhotoAttachment,g.isShareAttachment,g.isFileAttachment,g.isErrorAttachment]));var q=g.renderPhotoAttachments(p.filter(g.isPhotoAttachment),o,176,4);if(q)h.appendContent(n,q);for(var r=0;r<p.length;r++){var s=p[r];if(!g.isPhotoAttachment(s)){var t=g.renderAttachment(true,s,o);t.error&&h.appendContent(n,t.error);t.content&&h.appendContent(n,t.content);}}this.triggerResizeMaybe();}});e.exports=m;});
__d("MercuryMessageBody.react",["React","ReactPropTypes","DOM","MercuryMessageRenderer","DOMDimensions"],function(a,b,c,d,e,f){var g=b('React'),h=b('ReactPropTypes'),i=b('DOM'),j=b('MercuryMessageRenderer'),k=b('DOMDimensions'),l=g.createClass({displayName:'MercuryMessageBody',propTypes:{children:h.string},render:function(){return this.transferPropsTo(g.DOM.span(null));},isShort:function(){var m=this.getDOMNode(),n=m.getClientRects(),o=k.getElementDimensions(m).height;return !(n&&n.length>1&&n[0].height<o);},componentDidMount:function(){var m=this.props.children||'',n=j.formatMessageBody(m);i.appendContent(this.getDOMNode(),n);}});e.exports=l;});
__d("MercuryShrinkwrapableMixin.react",["DOMDimensions","Style"],function(a,b,c,d,e,f){var g=b('DOMDimensions'),h=b('Style');function i(j){return {_shrinkwrap:function(){if(!this.isMounted())return;var k=this.getDOMNode(),l=-1;for(var m=0;m<k.childNodes.length;m++){var n=k.childNodes[m];l=Math.max(l,this._shrinkwrapChildWidth(n));}if(l!==-1){h.set(k,'width','');var o=g.getElementDimensions(k).width,p=Math.min(o,l);h.set(k,'width',''+p+'px');}},componentDidUpdate:function(){this._shrinkwrap();},componentDidMount:function(){this._shrinkwrap();},_shrinkwrapChildWidth:function(k){var l=g.getElementDimensions(k).width,m;if(j&&j.boxWidth!==undefined){m=j.boxWidth;}else m=g.measureElementBox(k,'width',true,true,true);return l+m;}};}e.exports=i;});
__d("MercuryMessageBubble.react",["cx","MercuryShrinkwrapableMixin.react","React","ReactPropTypes"],function(a,b,c,d,e,f){var g=b('cx'),h=b('MercuryShrinkwrapableMixin.react'),i=b('React'),j=b('ReactPropTypes'),k=i.createClass({displayName:'MercuryMessageBubble',propTypes:{direction:j.oneOf(['left','right']).isRequired,color:j.oneOf(['white','blue']).isRequired},mixins:[h({boxWidth:0})],_directionClassName:{left:"_5ea1",right:"_5ea2"},_colorClassName:{blue:"_5ea3",white:"_5ea4"},render:function(){var l=["_5ea5",this._colorClassName[this.props.color],this._directionClassName[this.props.direction]].join(' ');return this.transferPropsTo(i.DOM.div({className:l},this.props.children));}});e.exports=k;});
__d("MercuryUserMessage.react",["CSS","cx","fbt","DOM","formatDate","MercuryMessageAttachments.react","MercuryMessageBody.react","MercuryMessageBubble.react","MercuryMessageStatus.react","MercuryParticipants","MercuryMessages","MercuryResizableMixin.react","React","ReactPropTypes","Tooltip","MercuryAttachmentRenderer","MercuryAttachment","MercuryIDs"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx'),i=b('fbt'),j=b('DOM'),k=b('formatDate'),l=b('MercuryMessageAttachments.react'),m=b('MercuryMessageBody.react'),n=b('MercuryMessageBubble.react'),o=b('MercuryMessageStatus.react'),p=b('MercuryParticipants'),q=b('MercuryMessages').get(),r=b('MercuryResizableMixin.react'),s=b('React'),t=b('ReactPropTypes'),u=b('Tooltip'),v=b('MercuryAttachmentRenderer'),w=b('MercuryAttachment'),x=b('MercuryIDs'),y=s.createClass({displayName:'MercuryUserMessage',propTypes:{message:t.object.isRequired},_directionClassName:{right:"_5h9z",left:"_5h9-"},mixins:[r],getInitialState:function(){return {author:{name:'',href:'#',image_src:''}};},componentWillMount:function(){p.get(this.props.message.author,(function(z){if(this.isMounted()){this.setState({author:z});}else this.state.author=z;}).bind(this));},componentDidMount:function(){g.conditionClass(this.getDOMNode(),"_5h9_",this.isShortBubble());if(this.refs.authorPhoto){var z=j.create('div');s.renderComponent(this._renderTimestampTooltip(),z);u.set(this.refs.authorPhoto.getDOMNode(),z,this.props.direction);}},isShortBubble:function(){var z=this.props.message;return q.isInbound(z)&&!this.refs.attachmentsInside&&this.refs.body&&this.refs.body.isShort();},render:function(){var z=this.props.message,aa=q.isInbound(z),ba=x.isMultichat(z.thread_id),ca=["_5ha0",this._directionClassName[aa?'left':'right'],aa&&ba?"_5ha1":'',aa?"_5ha2":''].join(' '),da=new Date(z.timestamp);return this.transferPropsTo(s.DOM.div({className:ca,title:aa?null:k(da,'g:ia')},s.DOM.div({className:"_5ha3"},this.state.author.name),s.DOM.a({className:"_5ha4",href:this.state.author.href,ref:"authorPhoto"},s.DOM.img({src:this.state.author.image_src})),this._renderInner()));},_renderInner:function(){var z=this.props.message,aa=this.state.author;if(z.is_filtered_content){return s.DOM.div({className:"_5ha5",ref:"inner"},this._renderFilteredContent());}else return s.DOM.div({className:"_5ha5",ref:"inner"},this._renderBubble(),this._renderAttachments('outside'),o({className:"_5ha6 clearfix",message:z,author:aa,ref:"status"}),this._renderSpoofWarning());},_renderSpoofWarning:function(){if(this.props.message.is_spoof_warning){var z=this.state.author;if(z)return s.DOM.div({className:"_5ha7"},i._("Unable to confirm {name_or_email} as the sender.",[i.param("name_or_email",z.name)]));}},_renderFilteredContent:function(){return s.DOM.div({className:"_5ha8 uiBoxYellow clearfix"},"This message is no longer available because it was identified as abusive or marked as spam.");},_renderAttachments:function(z){var aa=this.props.message,ba=z=='inside'?'attachmentsInside':'attachmentsOutside',ca=w.get(aa).filter(function(da){var ea=v.isBubblePreferred(da);return (ea&&z==='inside')||(!ea&&z==='outside');});if(ca.length>0)return l({className:"_5haa clearfix",message:aa,attachments:ca,ref:ba,onResize:this.triggerResizeMaybe});},_renderBubble:function(){var z=this.props.message,aa=z.body,ba=this._renderAttachments('inside'),ca=q.isInbound(z);if(aa||ba)return (s.DOM.div({className:"_5hab"},n({className:"_5hac",direction:ca?'left':'right',color:ca?'white':'blue',ref:"bubble"},m({className:"_5had",ref:"body"},aa),ba)));},_renderTimestampTooltip:function(){var z=this.state.author,aa=this.props.message;return (s.DOM.div({className:"_5hae"},s.DOM.div({className:"_5haf"},k(new Date(aa.timestamp),'g:ia')),s.DOM.div({className:"_5hag"},z.name)));}});e.exports=y;});
__d("ChatPeopleSuggestionList.react",["ChatSidebarItem.react","fbt","React","ShortProfiles","PresenceStatus","cx"],function(a,b,c,d,e,f){var g=b('ChatSidebarItem.react'),h=b('fbt'),i=b('React'),j=b('ShortProfiles'),k=b('PresenceStatus'),l=b('cx'),m=i.createClass({displayName:'ChatPeopleSuggestionList',_renderPeopleList:function(){var n=[];this.props.uids.map(function(o){var p=j.getNow(o);if(p)n.push(i.DOM.li(null,g({isAdded:false,showEditButton:true,images:p.thumbSrc,name:p.name,status:k.get(o),onClick:this.props.onClick.curry(o)})));}.bind(this));return n;},render:function(){return (i.DOM.div(null,i.DOM.div({className:"_57zm"},i.DOM.span({className:"_57zn"},"SUGGESTIONS")),i.DOM.ul({className:"_56ym"},this._renderPeopleList())));}});e.exports=m;});
__d("DataViewPolyfill",["copyProperties"],function(a,b,c,d,e,f){"use strict";var g=b('copyProperties');function h(i,j,k){if(j===undefined){this._ba=new Uint8Array(i);}else if(k===undefined){this._ba=new Uint8Array(i,j);}else this._ba=new Uint8Array(i,j,k);this.byteLength=this._ba.byteLength;}g(h,{isSupported:function(){return !!a.Uint8Array;}});g(h.prototype,{getUint8:function(i){if(i>=this._ba.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this._ba[i];},getUint16:function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1);return j?(l*256)+k:(k*256)+l;},getUint32:function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1),m=this.getUint8(i+2),n=this.getUint8(i+3);return j?(((n*256+m)*256+l)*256)+k:(((k*256+l)*256+m)*256)+n;}});e.exports=h;});
__d("ChatActivity",["Event","Arbiter","AvailableList","AvailableListConstants","JSLogger","MercuryConfig","PresenceState","UserActivity","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AvailableList'),j=b('AvailableListConstants'),k=b('JSLogger'),l=b('MercuryConfig'),m=b('PresenceState'),n=b('UserActivity'),o=b('copyProperties'),p=l.activity_limit||60000,q=l.idle_limit||1800000,r=l.idle_poll_interval||300000,s=k.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&(aa-t<p));}var x=o(new h(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);m.doSync();}x.inform('activity');}i.subscribe(j.ON_AVAILABILITY_CHANGED,function(){if(!i.isUserIdle())u=Date.now();});g.listen(window,'focus',function(){v=true;y();});g.listen(window,'blur',function(){v=false;});n.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&m.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(m.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);m.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});h.subscribe(k.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});e.exports=x;});
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryMessages","MercuryParticipants","MercuryThreads","tx"],function(a,b,c,d,e,f){var g=b('MercuryAssert'),h=b('MercuryMessages').get(),i=b('MercuryParticipants'),j=b('MercuryThreads').get(),k=b('tx');function l(m,n){g.isThreadID(m);j.getThreadMeta(m,function(o){h.getThreadMessagesRange(m,0,1,function(p){var q=p.length&&p[p.length-1];if(q&&q.author!=i.user){i.get(q.author,function(r){if(o.name){n(k._("{senderName} messaged {groupName}",{senderName:r.short_name,groupName:o.name}));}else n(k._("{name} messaged you",{name:r.short_name}));});}else n("New message!");});});}e.exports={renderDocumentTitle:l};});
__d("MercuryTimestampTracker",["MercuryActionTypeConstants","MercuryPayloadSource","MercurySingletonMixin","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f){var g=b('MercuryActionTypeConstants'),h=b('MercuryPayloadSource'),i=b('MercurySingletonMixin'),j=b('MercuryServerRequests'),k=b('copyProperties');function l(m){this._fbid=m;this._serverRequests=j.getForFBID(this._fbid);this._lastTimestamp=0;this._serverRequests.subscribe('update-messages',function(n,o){if(!o.actions||!o.actions.length)return;if(o.payload_source==h.CLIENT_SEND_MESSAGE||o.payload_source==h.UNKNOWN)return;for(var p=0;p<o.actions.length;p++){var q=o.actions[p],r=q.action_type;if(r==g.USER_GENERATED_MESSAGE&&q.thread_id&&q.timestamp>this._lastTimestamp)this._lastTimestamp=q.timestamp;}}.bind(this));}k(l.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});k(l,i);e.exports=l;});
__d("ChatTitleBarBlinker",["ChatActivity","DocumentTitle","JSLogger","MercuryThreadInformer","MercuryNotificationRenderer","PresenceState","MercuryTimestampTracker"],function(a,b,c,d,e,f){var g=b('ChatActivity'),h=b('DocumentTitle'),i=b('JSLogger'),j=b('MercuryThreadInformer').get(),k=b('MercuryNotificationRenderer'),l=b('PresenceState'),m=b('MercuryTimestampTracker').get(),n=i.create('chat_title'),o=null,p=0,q=false;function r(){if(o){o.stop();o=null;return true;}return false;}function s(x){var y=x||m.getLastUserMessageTimestamp();if(p<=y){p=y;if(r()||q)l.doSync();}}var t={blink:function(x,y){if(!o&&p<y)k.renderDocumentTitle(x,function(z){if(!o)o=h.blink(z);});},stopBlinking:function(){s();},blinkingElsewhere:function(){q=true;}};function u(x){var y=l.verifyNumber(x.sb2);if(!y||y<=p)return null;return y;}function v(x){var y=x&&u(x);if(y){p=y;n.debug('load',p);r();q=false;}}function w(x){var y=u(x);if(!y){n.debug('store',p);x.sb2=p;q=false;}return x;}l.registerStateStorer(w);l.registerStateLoader(v);j.subscribe('thread-read-changed',function(x,y){var z=m.getLastUserMessageTimestamp(),aa=0;for(var ba in y)if(y[ba].mark_as_read&&y[ba].timestamp>=z&&y[ba].timestamp>aa)aa=y[ba].timestamp;aa&&s(aa);});g.subscribe('activity',function(){s();});(function(){var x=l.getInitial();if(x)p=u(x)||0;})();e.exports=t;});
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","MercuryParticipants","MercuryThreadMuter","MercuryThreads","MessagingTag","Sound","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatActivity'),i=b('ChatConfig'),j=b('ChatOptions'),k=b('ChatTitleBarBlinker'),l=b('MercuryParticipants'),m=b('MercuryThreadMuter'),n=b('MercuryThreads').get(),o=b('MessagingTag'),p=b('Sound'),q=b('copyProperties');p.init(['audio/ogg','audio/mpeg']);function r(t){if(j.getSetting('sound'))p.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],t,false);}var s={messageReceived:function(t){if(t.author==l.user||!t.is_unread||(t.folder!=o.INBOX&&t.folder!=o.ARCHIVED))return;var u=t.thread_id,v=h.isActive();if(v){var w=false;s.inform('before-alert',{threadID:u,cancelAlert:function(){w=true;}});}n.getThreadMeta(u,function(x){var y=m.isThreadMuted(x);if(y)return;var z=t.timestamp;if(v){!w&&r(z);}else{k.blink(u,z);r(z);}k.blinkingElsewhere();}.bind(this));}};e.exports=q(s,g);});
__d("ActiveXSupport",["UserAgent"],function(a,b,c,d,e,f){var g=b('UserAgent'),h=null,i={isSupported:function(){if(h!==null)return h;try{if(g.ie()>=11){h=!!new ActiveXObject("htmlfile");}else h=!!window.ActiveXObject&&!!new ActiveXObject("htmlfile");}catch(j){h=false;}return h;}};e.exports=i;});
__d("VideoCallSupport",["MercuryConfig","UserAgent"],function(a,b,c,d,e,f){var g=b('MercuryConfig'),h=b('UserAgent'),i={newVCIsSupported:function(){return g.NewVCGK&&(h.chrome()>=24||h.firefox()>=22);}};e.exports=i;});
__d("VideoCallRecordMessageDialog",["AsyncDialog","AsyncRequest","Dialog","URI","tx"],function(a,b,c,d,e,f){var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('Dialog'),j=b('URI'),k=b('tx'),l={get:function(m,n){var o="Would you like to leave a message?",p="New Message";return new i().setTitle(k._("{firstname} is Unavailable",{firstname:n})).setBody(o).setButtons([{name:'record-message',label:p},i.CANCEL]).setHandler(function(){var q=j('/ajax/messaging/composer.php').setQueryData({ids:[m],autoloadvideo:true}).toString();g.send(new h(q));});}};e.exports=l;});
__d("VideoCallCore",["Event","ActiveXSupport","Arbiter","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","ChannelConstants","Cookie","CSS","Dialog","MercuryConfig","UserAgent","VideoCallSupport","emptyFunction","ge","VideoCallTemplates","ShortProfiles","VideoCallRecordMessageDialog"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ActiveXSupport'),i=b('Arbiter'),j=b('AsyncRequest'),k=b('AvailableList'),l=b('AvailableListConstants'),m=b('Bootloader'),n=b('ChannelConstants'),o=b('Cookie'),p=b('CSS'),q=b('Dialog'),r=b('MercuryConfig'),s=b('UserAgent'),t=b('VideoCallSupport'),u=b('emptyFunction'),v=b('ge');b('VideoCallTemplates');var w=[],x=[],y={isSupported:function(){if(t.newVCIsSupported())return true;if(s.windows()){var ca=navigator.userAgent;if(/Windows NT 6.3/.exec(ca))return false;if(s.ie()>=9&&!s.ie64()){return h.isSupported();}else return (s.ie()>=7&&!s.ie64())||s.firefox()>=3.6||s.chrome()>=5||s.opera()>=12;}else if(s.osx()>10.4&&s.osx()<10.9)return (s.firefox()>=3.6||s.chrome()>=5||s.webkit()>=500||s.opera()>=12);return false;},isInstalled:function(){var ca=false;if(this.isSupported())if(z()){var da=null;try{da=new ActiveXObject('SkypeLimited.SkypeWebPlugin');ca=!!da;}catch(ea){}da=null;}else{ca=aa();if(r.VideoCallingNoJavaGK)if(ca&&s.osx()>=10.8)if(ca.description&&ca.description.charAt(0)!='v')ca=false;}return ca;},mightReloadPostInstall:function(){return s.windows();},onVideoMessage:function(ca){w.push(ca);m.loadModules(['VideoCallController'],u);},onRTCMessage:function(ca){if(t.newVCIsSupported()){x.push(ca);m.loadModules(['FBRTCCallController'],u);}},setMessageHandler:function(ca){this.onVideoMessage=ca;if(ca)while(w.length)ca(w.shift());},setRTCMessageHandler:function(ca){this.onRTCMessage=ca;if(ca)while(x.length)ca(x.shift());},availableForCall:function(ca){var da=k.get(ca);return da==l.ACTIVE||da==l.IDLE;},onProfileButtonClick:function(ca){y.startCallOrLeaveMessage(ca,'profile_button_click');},attachListenerToProfileButton:function(ca){var da=v('videoCallProfileButton');if(da){if(!y.isSupported()){p.hide(da);return;}g.listen(da,'click',function(event){y.startCallOrLeaveMessage(ca,'profile_button_click_timeline');});}},startCallOrLeaveMessage:function(ca,da){if(this.availableForCall(ca)){y.showOutgoingCallDialog(ca,da);}else b('ShortProfiles').get(ca,function(ea){b('VideoCallRecordMessageDialog').get(ca,ea.firstName).show();});},showOutgoingCallDialog:function(ca,da){var ea=da||'unknown';y.logClick(ca,ea);var fa=y.isInstalled()||r.NewVCGK?'outgoing_dialog.php':'intro.php',ga='/ajax/chat/video/'+fa+'?idTarget='+ca;new q().setAllowCrossPageTransition(true).setAsync(new j(ga).setHandler(u).setServerDialogCancelHandler(u)).show();},logClick:function(ca,da){new j().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:ca,clickSource:da}).setAllowCrossPageTransition(true).setErrorHandler(u).send();}};function z(){return s.ie()&&s.windows()&&!s.opera();}function aa(){if(!navigator)return null;navigator.plugins.refresh(false);var ca=navigator.mimeTypes['application/skypesdk-plugin'];return ca&&ca.enabledPlugin;}function ba(){if(!y.mightReloadPostInstall())return;var ca=o.get('vcpwn');if(ca){o.clear('vcpwn');var da=o.get('vctid');if(da){o.clear('vctid');if(o.get('vctid'))return;if(da&&y.isInstalled()){var ea='/ajax/chat/video/outgoing_dialog.php?idTarget='+da;new q().setAllowCrossPageTransition(true).setAsync(new j(ea)).show();}}}}i.subscribe(n.getArbiterType('video'),function(ca,da){y.onVideoMessage(da.obj);});i.subscribe(n.getArbiterType('webrtc'),function(ca,da){y.onRTCMessage(da.obj);});i.subscribe(n.getArbiterType('chat_event'),function(ca,da){if(da.obj.event_name=="missed-call")m.loadModules(['VideoCallController'],function(ea){ea.onMissedCallEvent(da.obj);});});ba();e.exports=y;});
__d("getImageSize",["DataViewPolyfill"],function(a,b,c,d,e,f){var g=b('DataViewPolyfill'),h=a.DataView||g;function i(m){return {width:m.getUint16(6,true),height:m.getUint16(8,true)};}function j(m){return {width:m.getUint32(16,false),height:m.getUint32(20,false)};}function k(m){var n=m.byteLength,o=2;while(o<n){var p=m.getUint16(o,false);o+=2;if(p==65472||p==65474){return {width:m.getUint16(o+5,false),height:m.getUint16(o+3,false)};}else o+=m.getUint16(o,false);}return null;}function l(m){var n=new h(m);if(n.getUint8(0)==255&&n.getUint8(1)==216)return k(n);if(n.getUint8(0)==71&&n.getUint8(1)==73&&n.getUint8(2)==70)return i(n);if(n.getUint8(0)==137&&n.getUint8(1)==80&&n.getUint8(2)==78&&n.getUint8(3)==71)return j(n);return null;}e.exports=l;l.gif=i;l.png=j;l.jpeg=k;});
__d("ChatAutoSendPhotoUploader",["ArbiterMixin","AsyncUploadRequest","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","MercuryAttachmentType","PhotosUploadID","SubscriptionsHandler","arrayContains","csx","getImageSize","getObjectValues","isEmpty","mixin","shield"],function(a,b,c,d,e,f){"use strict";var g=b('ArbiterMixin'),h=b('AsyncUploadRequest'),i=b('DOM'),j=b('Event'),k=b('FileForm'),l=b('FileFormResetOnSubmit'),m=b('FileInput'),n=b('FormSubmitOnChange'),o=b('MercuryAttachmentType'),p=b('PhotosUploadID'),q=b('SubscriptionsHandler'),r=b('arrayContains'),s=b('csx'),t=b('getImageSize'),u=b('getObjectValues'),v=b('isEmpty'),w=b('mixin'),x=b('shield');function y(){return 'upload_'+p.getNewID();}var z=w(g);for(var aa in z)if(z.hasOwnProperty(aa))ca[aa]=z[aa];var ba=z===null?null:z.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=z;function ca(da,ea,fa){this.$ChatAutoSendPhotoUploader0=fa;this.$ChatAutoSendPhotoUploader1=ea;this.$ChatAutoSendPhotoUploader2=new q();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};this.$ChatAutoSendPhotoUploader5=da.getAttribute('action');this.$ChatAutoSendPhotoUploader6=new k(da,[n,l]);this.$ChatAutoSendPhotoUploader6.setAllowCrossOrigin(true);this.$ChatAutoSendPhotoUploader6.setUploadInParallel(true);var ga=i.find(da,"._4q60"),ha=i.find(ga,"._4q61");new m(ga,ha,ea);this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.$ChatAutoSendPhotoUploader6.subscribe('submit',this.$ChatAutoSendPhotoUploader7.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('success',this.$ChatAutoSendPhotoUploader8.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('failure',this.$ChatAutoSendPhotoUploader9.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('progress',this.$ChatAutoSendPhotoUploadera.bind(this)),j.listen(ha,'click',x(this.inform,this,'open')));}ca.prototype.isUploading=function(){return !v(this.$ChatAutoSendPhotoUploader3);};ca.prototype.destroy=function(){this.$ChatAutoSendPhotoUploader2.release();this.$ChatAutoSendPhotoUploader6.destroy();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};};ca.prototype.$ChatAutoSendPhotoUploaderb=function(da,ea){var fa=this.$ChatAutoSendPhotoUploaderc(da);if(ea){fa.preview_width=ea.width;fa.preview_height=ea.height;}return fa;};ca.prototype.$ChatAutoSendPhotoUploaderc=function(da){var ea={upload_id:da,on_progress:function(fa){this.subscribe('progress',fa);}.bind(this),attach_type:o.PHOTO,preview_uploading:true};return ea;};ca.prototype.$ChatAutoSendPhotoUploader7=function(){var da=y();this.$ChatAutoSendPhotoUploaderd(da,this.$ChatAutoSendPhotoUploader1.files);};ca.prototype.$ChatAutoSendPhotoUploaderd=function(da,ea){var fa={};if(typeof FileReader!=='undefined'&&FileReader.prototype.readAsArrayBuffer&&ea&&ea.length===1){this.$ChatAutoSendPhotoUploader3[da]=da;fa[da]=ea[0];var ga=new FileReader();ga.onload=function(){this.inform('submit',{upload_id:da,preview_attachments:[this.$ChatAutoSendPhotoUploaderb(da,t(ga.result))]});}.bind(this);ga.onerror=function(){this.inform('submit',{upload_id:da,preview_attachments:[this.$ChatAutoSendPhotoUploaderc(da)]});}.bind(this);ga.readAsArrayBuffer(ea[0]);}else{var ha=[];if(!ea){this.$ChatAutoSendPhotoUploader3[da]=da;this.$ChatAutoSendPhotoUploader0.value=da;ha.push(this.$ChatAutoSendPhotoUploaderc(da));}else for(var ia=0;ia<ea.length;++ia){var ja=y();fa[ja]=ea[ia];this.$ChatAutoSendPhotoUploader3[ja]=da;ha.push(this.$ChatAutoSendPhotoUploaderc(ja));}this.inform('submit',{upload_id:da,preview_attachments:ha});}if(Object.keys(fa).length>0)this.$ChatAutoSendPhotoUploader6.setFiles(fa);};ca.prototype.$ChatAutoSendPhotoUploader8=function(event,da){var ea=this.$ChatAutoSendPhotoUploadere(da);if(this.$ChatAutoSendPhotoUploader3[ea]){var fa=this.$ChatAutoSendPhotoUploader3[ea];delete this.$ChatAutoSendPhotoUploader3[ea];var ga=da.response.getPayload();if(!this.$ChatAutoSendPhotoUploader4[fa])this.$ChatAutoSendPhotoUploader4[fa]=[];this.$ChatAutoSendPhotoUploader4[fa].push(ga.metadata[0].image_id);if(!this.$ChatAutoSendPhotoUploaderf(fa)){this.inform('all-uploads-completed',{upload_id:fa,image_ids:this.$ChatAutoSendPhotoUploader4[fa]});delete this.$ChatAutoSendPhotoUploader4[fa];}}};ca.prototype.$ChatAutoSendPhotoUploadera=function(event,da){this.inform('progress',{upload_id:da.upload.getName(),event:da.event});};ca.prototype.$ChatAutoSendPhotoUploaderf=function(da){return r(u(this.$ChatAutoSendPhotoUploader3),da);};ca.prototype.$ChatAutoSendPhotoUploader9=function(event,da){var ea=this.$ChatAutoSendPhotoUploadere(da);if(this.$ChatAutoSendPhotoUploader3[ea]){var fa=this.$ChatAutoSendPhotoUploader3[ea];delete this.$ChatAutoSendPhotoUploader3[ea];if(!this.$ChatAutoSendPhotoUploaderf(fa))this.inform('all-uploads-failed',{upload_id:fa});}return false;};ca.prototype.$ChatAutoSendPhotoUploadere=function(da){if(da.upload){return da.upload.getName();}else return da.response.getPayload().uploadID;};ca.prototype.uploadFile=function(da){var ea=y(),fa={};fa[ea]=da;var ga=new h(this.$ChatAutoSendPhotoUploader5).setAllowCrossOrigin(true).setRelativeTo(this.$ChatAutoSendPhotoUploader6.getRoot()).setData({store_as_message_image:1}).setFiles(fa);this.$ChatAutoSendPhotoUploader2.addSubscriptions(ga.subscribe('success',function(event,ha){this.$ChatAutoSendPhotoUploader8(event,{upload:ha,response:ha.getResponse()});}.bind(this)),ga.subscribe('failure',this.$ChatAutoSendPhotoUploader9.bind(this)));ga.send();this.$ChatAutoSendPhotoUploaderd(ea,[da]);};e.exports=ca;});
__d("ChatTabModel",["function-extensions","Arbiter","ArbiterMixin","ChatBehavior","ChatConfig","JSLogger","MercuryAssert","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker","PresenceInitialData","PresenceState","PresenceUtil","areObjectsEqual","arrayContains","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatBehavior'),j=b('ChatConfig'),k=b('JSLogger'),l=b('MercuryAssert'),m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o=b('MercuryTimestampTracker').get(),p=b('PresenceInitialData'),q=b('PresenceState'),r=b('PresenceUtil'),s=b('areObjectsEqual'),t=b('arrayContains'),u=b('copyProperties'),v=[],w=null,x=null,y=null,z=null;function aa(){return parseInt(p.serverTime,10);}var ba=j.get('tab_max_load_age')||3600000,ca=aa()-ba,da=0,ea=20,fa=k.create('chat_tab_model'),ga=false;function ha(ab){var bb=q.verifyNumber(ab.uct2);if(!bb||typeof bb!=='number'){fa.warn('bad_cookie_version',ab.uct2);return null;}if(bb<da||bb<ca)return null;return bb;}function ia(ab){var bb=ha(ab);if(!bb){var cb={};cb.old_tabs=ab&&ab.t2&&JSON.stringify(ab.t2);cb.old_promoted=ab&&ab.lm2;cb.old_time=ab&&ab.uct2;cb.old_reason=ab&&ab.tr;cb.old_window=ab&&ab.tw;var db;if(x&&ab.t2)for(var eb=0;eb<ab.t2.length;eb++){var fb=ab.t2[eb];if(fb.i===x)db=fb.r;}var gb=[];v.forEach(function(hb){if(!hb.fragile){var ib={i:hb.id,si:hb.server_id};if(hb.raised||(hb.id===x&&db))ib.r=1;gb.push(ib);}});ab.t2=gb;ab.uct2=da;ab.lm2=w;ab.tr=z;ab.tw=r.getSessionID();cb.new_tabs=JSON.stringify(ab.t2);cb.new_promoted=ab.lm2;cb.new_time=ab.uct2;cb.new_reason=ab.tr;cb.new_window=ab.tw;fa.debug('store',cb);}return ab;}function ja(ab){if(ab){var bb=ha(ab);if(bb&&bb!==da){var cb={};cb.old_tabs=JSON.stringify(v);cb.old_promoted=w;cb.old_time=da;cb.old_reason=z;cb.window_id=r.getSessionID();cb.cookie_tabs=ab&&ab.t2&&JSON.stringify(ab.t2);cb.cookie_promoted=ab&&ab.lm2;cb.cookie_time=ab&&ab.uct2;cb.cookie_reason=ab&&ab.tr;cb.cookie_window=ab&&ab.tw;da=bb;z='load';var db=ka(ab.t2,ab.lm2||null);cb.load_result=db;cb.new_tabs=JSON.stringify(v);cb.new_promoted=w;cb.new_time=da;cb.new_reason=z;var event='load';if(!ga)event+='_init';fa.log(event,cb);return db;}}return false;}function ka(ab,bb){if(la(ab,bb)){var cb=v.filter(function(fb){return fb.fragile;}),db={};w=null;v=ab.map(function(fb){var gb={id:fb.i,server_id:fb.si};if(gb.id==bb)w=gb.id;if(x==fb.i){var hb=qa(x);if(hb!=-1){gb.raised=v[hb].raised;return gb;}else return null;}if(fb.r)gb.raised=true;db[gb.id]=gb;return gb;});v=v.filter(function(fb){return fb!=null;});if(y)for(var eb in y)if(!db[eb]||!db[eb].raised)delete y[eb];cb=cb.filter(function(fb){return !db[fb.id];});v=v.concat(cb);pa();return true;}return false;}function la(ab,bb){if(bb!=w)return true;var cb=v.filter(function(fb){return !fb.fragile;});if(ab.length!=cb.length)return true;for(var db=0,eb=ab.length;db<eb;db++){if(ab[db].id===x)continue;if(!s(ab[db],cb[db]))return true;}return false;}function ma(ab,bb,cb){var db=ja(q.get());if(bb===undefined||bb>da){if(ab()){db=true;z=cb||null;oa(bb);}}else fa.error('rejected',{change_time:bb,state_time:da});db&&na();}function na(){if(ga)ya.inform('chat/tabs-changed',ya.get());}function oa(ab){if(ab===undefined)ab=Math.max(o.getLastUserMessageTimestamp()||1,da+1);da=ab;q.doSync();}function pa(ab){var bb=v.length-ea;if(bb>0)v=v.filter(function(cb){return cb.raised||cb.id==ab||bb--<=0;});if(bb>0)v=v.filter(function(cb){return cb.id==w||cb.id==ab||bb--<=0;});}function qa(ab){for(var bb=0;bb<v.length;bb++)if(v[bb].id==ab)return bb;return -1;}function ra(ab,bb){var cb=n.getThreadMetaNow(ab);if(!cb)return false;if(cb.is_canonical_user){return ua(ab,bb);}else{var db=sa(ab);if(db)m.getServerThreadID(ab,function(eb){if(wa(ab,eb)){oa();na();}});return db;}}function sa(ab){if(qa(ab)===-1){v.push({id:ab,fragile:true});fa.log('open_fragile_tab',{tabs:JSON.stringify(v),opened:ab,window_id:r.getSessionID()});return true;}return false;}function ta(ab){var bb=[];ab.forEach(function(cb){var db=qa(cb);if(db!==-1)bb.push(v[db]);});v.forEach(function(cb){if(!t(ab,cb.id))bb.push(cb);});ma(function(){if(la(bb,w)){v=bb;return true;}return false;});}function ua(ab,bb){var cb=qa(ab);if(cb!=-1)if(v[cb].fragile){v.splice(cb,1);}else{bb&&(v[cb].signatureID=bb);return true;}for(var db=0;db<=v.length;db++)if(db==v.length||v[db].fragile){v.splice(db,0,{id:ab,signatureID:bb});pa(ab);fa.log('open_tab',{tabs:JSON.stringify(v),opened:ab,window_id:r.getSessionID()});return true;}}function va(ab){var bb=qa(ab);if(bb!=-1&&(!v[bb].raised||w!==ab)){v[bb].raised=true;w=ab;return true;}return false;}function wa(ab,bb){var cb=qa(ab);if(cb!=-1&&v[cb].fragile){var db=v[cb];db.fragile=false;db.server_id=bb;var eb=[];v.forEach(function(fb){if(fb.id!=ab){if(db&&fb.fragile){eb.push(db);db=null;}eb.push(fb);}});if(db)eb.push(db);v=eb;fa.log('make_permanent',{tabs:JSON.stringify(v),tab_id:ab,window_id:r.getSessionID()});return true;}return false;}function xa(ab){var bb=qa(ab);if(ab==w)w=null;if(bb!=-1){v.splice(bb,1);fa.log('close_tab',{tabs:JSON.stringify(v),closed:ab,window_id:r.getSessionID()});return true;}return false;}q.registerStateStorer(ia);q.registerStateLoader(function(ab){if(ja(ab))na();});function ya(){}u(ya,h,{isTabPromoted:function(ab){if(ab)return ab==w;return false;},indexOf:function(ab){return qa(ab);},getTab:function(ab){l.isThreadID(ab);var bb=this.indexOf(ab);if(bb>-1){var cb=v[bb];return u({},cb);}return null;},getEmptyTab:function(){for(var ab=0;ab<v.length;ab++){var bb=v[ab].id;if(n.isNewEmptyLocalThread(bb))return bb;}return null;},getServerTime:function(){return aa();},changeShowingTabs:function(ab){return ta(ab);},closeAllTabs:function(){if(v.length){fa.log('close_all_tabs',{closed_tabs:JSON.stringify(v),window_id:r.getSessionID()});v=[];w=null;if(y)y={};oa();na();}},closeFragileTabs:function(){var ab=[];for(var bb=0;bb<v.length;bb++)if(v[bb].fragile&&!n.isNewEmptyLocalThread(v[bb].id)){ab.push(v[bb]);v.splice(bb);na();break;}fa.log('close_fragile_tabs',{tabs:JSON.stringify(v),fragile_closed:ab,window_id:r.getSessionID()});},closeTab:function(ab,bb){l.isThreadID(ab);var cb=false;if(y){delete y[ab];cb=true;}ma(function(){if(xa(ab))cb=true;return cb;},undefined,bb);},raiseTab:function(ab,bb,cb){l.isThreadID(ab);var db=false;if(y&&bb){y[ab]=true;db=true;}if(!bb&&ab===x){db&&na();return;}ma(function(){if(ra(ab,cb))db=true;var eb=qa(ab);if(eb!=-1&&!v[eb].raised){v[eb].raised=true;db=true;fa.log('raise_tab',{tabs:JSON.stringify(v),raised:ab,window_id:r.getSessionID()});}return db;});},get:function(){var ab=v.map(function(bb){var cb=u({},bb);delete cb.fragile;if(y)cb.raised=y[cb.id];return cb;});return {tabs:ab,promoted:w};},openFragileTab:function(ab){l.isThreadID(ab);if(sa(ab))na();},openTab:function(ab){l.isThreadID(ab);ma(ra.curry(ab));},lowerTab:function(ab){l.isThreadID(ab);var bb=false;if(y){delete y[ab];bb=true;}ma(function(){var cb=qa(ab);if(cb!=-1&&v[cb].raised){delete v[cb].raised;fa.log('lower_tab',{tabs:JSON.stringify(v),lowered:ab,window_id:r.getSessionID()});bb=true;}return bb;});},raiseAndPromoteTab:function(ab,bb,cb,db,eb){l.isThreadID(ab);var fb=false;if(y&&bb){y[ab]=true;fb=true;}if(!bb&&ab===x){fb&&na();return;}ma(function(){if(ra(ab,cb))fb=true;if(va(ab)){fb=true;fa.log('raise_and_promote_tab',{tabs:JSON.stringify(v),promoted:ab,window_id:r.getSessionID()});}return fb;},db,eb);},setPromotedTab:function(ab){l.isThreadID(ab);ma(va.curry(ab));},promoteThreadInPlaceOfThread:function(ab,bb,cb,db){l.isThreadID(ab);l.isThreadID(bb);ma(function(){var eb=qa(ab),fb=qa(bb);if(db){w=ab;}else if(w===bb)return true;var gb=v[eb];if(j.get('chat_tabs_management')&&cb){l.isThreadID(cb);var hb=qa(cb),ib=v[fb];v[fb]=gb;v.splice(eb,1);v.splice(hb,0,ib);}else{v[eb]=v[fb];v[fb]=gb;}return true;});},squelchTab:function(ab){l.isThreadID(ab);x=ab;this.lowerTab(ab);fa.log('squelch_tab',{squelched:ab,tabs:JSON.stringify(v),window_id:r.getSessionID()});},clearSquelchedTab:function(){if(x)fa.log('unsquelch_tab',{squelched:x,tabs:JSON.stringify(v),window_id:r.getSessionID()});x=null;},persistLocalRaised:function(){if(y){ma(function(){var ab=false;v.forEach(function(bb){if(bb.raised!=y[bb.id]){ab=true;if(y[bb.id]){bb.raised=true;}else delete bb.raised;}});return ab;});fa.log('persist_local_raise',{tabs:JSON.stringify(v),window_id:r.getSessionID()});}}});g.subscribe(k.DUMP_EVENT,function(ab,bb){bb.chat_tabs={promoted:w,tabs:v.map(function(cb){return u({},cb);}),time:da,max_load_age:ba};});function za(){var ab=i.ignoresRemoteTabRaise();if(ab&&!y){fa.log('start_ignore_remote_raise');y={};na();}else if(!ab&&y){fa.log('stop_ignore_remote_raise');y=null;na();}}i.subscribe(i.ON_CHANGED,za);za();ja(q.getInitial(),true);if(da===0)da=aa()-600000;ga=true;e.exports=ya;});
__d("VideoCallPromo",["ArbiterMixin","AsyncRequest","ChatConfig","ChatVisibility","LegacyContextualDialog","CSS","MercuryParticipants","MercuryThreads","ChatTabTemplates","VideoCallCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('ChatConfig'),j=b('ChatVisibility'),k=b('LegacyContextualDialog'),l=b('CSS'),m=b('MercuryParticipants'),n=b('MercuryThreads').get(),o=b('ChatTabTemplates'),p=b('VideoCallCore'),q=b('copyProperties'),r=b('emptyFunction');function s(){this._dialog=null;}function t(v){if(!(p.isSupported()&&i.get('video.show_promo')))return false;var w=n.getCanonicalUserInThread(v);if(!w)return false;return j.isOnline()&&p.availableForCall(w);}function u(v){new h().setURI('/ajax/chat/video/log_promo.php').setData({viewedUserID:v}).setAllowCrossPageTransition(true).setErrorHandler(r).send();}q(s.prototype,g);q(s.prototype,{render:function(v,w){var x=t(w);if(!x)return;var y=n.getCanonicalUserInThread(w);m.get('fbid:'+y,function(z){if(!z.call_promo)return;var aa=o[':fb:mercury:call:promo'].build();this._dialog=new k();this._dialog.init(aa.getRoot()).setWidth(250).setAlignH('center').setContext(v).show();l.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');l.addClass(v,'video_call_promo');u(n.getCanonicalUserInThread(w));this.inform('chat/dialog-rendered',{dialog:this,thread_id:w});}.bind(this));},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=s;});
__d("VideoCallTourDialog",["ArbiterMixin","LegacyContextualDialog","CSS","MercuryThreads","ChatTabTemplates","VideoCallCore","VideoCallingTour","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('LegacyContextualDialog'),i=b('CSS'),j=b('MercuryThreads').get(),k=b('ChatTabTemplates'),l=b('VideoCallCore'),m=b('VideoCallingTour'),n=b('copyProperties');function o(){this._dialog=null;}n(o.prototype,g);n(o.prototype,{render:function(p,q){var r=j.getCanonicalUserInThread(q);if(!r||!l.availableForCall(r))return;var s=k[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();i.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');i.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});m.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;});
__d("ChatContextualDialogController",["Event","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallPromo","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('ChatTabModel'),j=b('VideoCallingTour'),k=b('VideoCallPromo'),l=b('VideoCallTourDialog'),m=b('copyProperties'),n=b('setTimeoutAcrossTransitions'),o=60000,p=false,q=false,r=function(y,z){this._videoCallPromo=new k();this._videoCallTour=new l();this._threadID=y;this._tabMainElement=z;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function s(y,event,z){if(y._openDialog)y._openDialog.updatePosition();}function t(y){if(y._openDialog)y._openDialog.updatePosition();}function u(y){if(y._openDialog){y._openDialog.hide();y._openDialog=null;}if(y._timeout){clearTimeout(y._timeout);y._timeout=null;}while(y._subscriptionTokens.length)y._subscriptionTokens.pop().unsubscribe();if(y._scrollListener){y._scrollListener.remove();y._scrollListener=null;}}function v(y,event,z){if(z.thread_id===y._threadID){y._openDialog=z.dialog;p=true;x(y);y._timeout=n(y.destroy.bind(y,y._threadID),o);y._scrollListener=g.listen(window,'scroll',t.curry(y));}}function w(y,z){if(!y._openDialog){y._subscriptionTokens.push(z.subscribe('chat/dialog-rendered',v.curry(y)));z.render(y._tabMainElement,y._threadID);}}function x(y){y._subscriptionTokens.push(i.subscribe('chat/tabs-changed',s.curry(y)),r.subscribe('dialog/close-all',u.curry(y)));}m(r,h);m(r.prototype,{destroy:function(){u(this);},tabFocused:function(){if(q){w(this,this._videoCallTour);return;}if(!p)w(this,this._videoCallPromo);},tabNotActive:function(){u(this);},hideVideoCallouts:function(){u(this);}});j.subscribe('videocallingtour/start',function(){q=true;r.inform('dialog/close-all');});j.subscribe('videocallingtour/end',function(){q=false;});e.exports=r;});
__d("ChatPrivacyActionController",["ChatVisibility","JSLogger","PresencePrivacy","copyProperties"],function(a,b,c,d,e,f){var g=b('ChatVisibility'),h=b('JSLogger'),i=b('PresencePrivacy'),j=b('copyProperties'),k=function(l,m){this._userID=l;this._logger=h.create('blackbird');this._getState=function(){if(g.isOnline())return i.allows(this._userID)?k.NORMAL:k.BLOCKED;return k.OFFLINE;};this._togglePrivacy=function(){var n=this._getState();switch(this._getState()){case k.OFFLINE:if(g.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});g.goOnline(function(){if(!i.allows(this._userID)){if(this._getState()!==k.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case k.BLOCKED:i.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case k.NORMAL:i.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};(function(){var n=function(){m&&m(this._getState());}.bind(this);n();this._subscribeToken=i.subscribe('privacy-changed',n);}.bind(this)).defer();};k.OFFLINE='offline';k.BLOCKED='blocked';k.NORMAL='normal';j(k.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){i.unsubscribe(this._subscribeToken);}});e.exports=k;});
__d("ChatShareLinkUploader",["AsyncRequest","CSS","DOM","URLScraper","MercuryShareLinkUploader","MercuryAttachmentTemplates","Event"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('URLScraper'),k=b('MercuryShareLinkUploader'),l=b('MercuryAttachmentTemplates'),m=b('Event');for(var n in k)if(k.hasOwnProperty(n))p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(q,r){"use strict";this.$ChatShareLinkUploader0=q;this.$ChatShareLinkUploader1=r;this.$ChatShareLinkUploader2=false;this.$ChatShareLinkUploader3=null;this.$ChatShareLinkUploader4=null;m.listen(r,'keyup',function(){!r.value.length&&this.$ChatShareLinkUploader5.enable();}.bind(this));this.$ChatShareLinkUploader5=new j(r);this.$ChatShareLinkUploader5.subscribe('match',function(s,t){this.loadShare(t&&t.url);}.bind(this));this.$ChatShareLinkUploader6=null;}p.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$ChatShareLinkUploader2,this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader1);};p.prototype.close=function(){"use strict";this.$ChatShareLinkUploader7();this.$ChatShareLinkUploader5.disable();this.inform('closed');};p.prototype.clear=function(){"use strict";this.$ChatShareLinkUploader7();this.$ChatShareLinkUploader5.enable();};p.prototype.$ChatShareLinkUploader7=function(){"use strict";var q=this.$ChatShareLinkUploader6;delete this.$ChatShareLinkUploader6;if(q){i.remove(q);this.inform('dom-updated');}this.$ChatShareLinkUploader2=false;this.$ChatShareLinkUploader3=null;this.$ChatShareLinkUploader4&&this.$ChatShareLinkUploader4.abort();this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5&&this.$ChatShareLinkUploader5.reset();};p.prototype.loadShare=function(q){"use strict";this.$ChatShareLinkUploader3=q;this.$ChatShareLinkUploader4&&this.$ChatShareLinkUploader4.abort();var r=l[':fb:mercury:share-link-row'].build();if(this.$ChatShareLinkUploader6)i.remove(this.$ChatShareLinkUploader6);this.$ChatShareLinkUploader6=r.getRoot();m.listen(r.getNode('closeFileUpload'),'click',function(event){this.close();event.kill();}.bind(this));i.appendContent(this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader6);h.show(this.$ChatShareLinkUploader0);this.inform('dom-updated');this.$ChatShareLinkUploader4=new g().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:q,chat:true}).setHandler(this.$ChatShareLinkUploader8.bind(this).curry(q));this.$ChatShareLinkUploader4.send();this.inform('link-detected');};p.prototype.$ChatShareLinkUploader8=function(q,r){"use strict";if(this.$ChatShareLinkUploader3!==q)return;this.$ChatShareLinkUploader3=null;this.$ChatShareLinkUploader4=null;i.appendContent(this.$ChatShareLinkUploader6,r.payload);this.$ChatShareLinkUploader2=true;if(!this.getAttachData()){this.close();return;}h.addClass(this.$ChatShareLinkUploader6,'done');};e.exports=p;});
__d("ChatPhotoEditorContextualDialog",["ContextualDialog","CSS","Event","LayerHideOnBlur","PhotoEditorConfig","URI"],function(a,b,c,d,e,f){var g=b('ContextualDialog'),h=b('CSS'),i=b('Event'),j=b('LayerHideOnBlur'),k=b('PhotoEditorConfig'),l=b('URI');function m(n,o,p,q,r){"use strict";var s=l(k.Constants.CHAT_DIALOG_PATH).addQueryData({thread_id:r}).toString(),t=l(k.Constants.BROWSE_ALBUMS_PATH).addQueryData({browse_mode:k.BrowseModes.CHOOSE_CHAT_TARGET,browse_args:{thread_id:r}}).toString();o.setAttribute('ajaxify',t);p.setAttribute('ajaxify',s);this.$ChatPhotoEditorContextualDialog0=n;this.$ChatPhotoEditorContextualDialog1=q;i.listen(n,'click',this.$ChatPhotoEditorContextualDialog2.bind(this));i.listen(q,'click',this.$ChatPhotoEditorContextualDialog3.bind(this));}m.prototype.$ChatPhotoEditorContextualDialog2=function(){"use strict";var n=this.$ChatPhotoEditorContextualDialog4();if(n.isShown()){n.hide();}else n.show();};m.prototype.$ChatPhotoEditorContextualDialog3=function(){"use strict";this.$ChatPhotoEditorContextualDialog4().hide();};m.prototype.$ChatPhotoEditorContextualDialog4=function(){"use strict";if(!this.$ChatPhotoEditorContextualDialog5){var n={context:this.$ChatPhotoEditorContextualDialog0,width:115,alignment:'center',addedBehaviors:[j]};this.$ChatPhotoEditorContextualDialog5=new g(n,this.$ChatPhotoEditorContextualDialog1);h.show(this.$ChatPhotoEditorContextualDialog1);}return this.$ChatPhotoEditorContextualDialog5;};e.exports=m;});
__d("MercuryTypingIndicator",["Animation","CSS","DOM","MercuryTypingReceiver","MercuryParticipants","Style","ChatTabTemplates","MercuryThreadInformer","Tooltip","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('CSS'),i=b('DOM'),j=b('MercuryTypingReceiver'),k=b('MercuryParticipants'),l=b('Style'),m=b('ChatTabTemplates'),n=b('MercuryThreadInformer').get(),o=b('Tooltip'),p=b('copyProperties'),q=b('cx'),r=b('tx'),s=[];n.subscribe('messages-received',function(v,w){s.forEach(function(x){var y=w[x._threadID];y&&x.receivedMessages(y);});});j.addRetroactiveListener('state-changed',function(v){s.forEach(function(w){var x=v[w._threadID];x&&w._handleStateChanged(x);});});function t(v){var w=m[':fb:chat:conversation:message-group'].build(),x=m[':fb:mercury:typing-indicator:typing'].build();h.addClass(w.getRoot(),"_50kd");var y=w.getNode('profileLink');o.set(y,v.name,'left');y.href=v.href;w.setNodeContent('profileName',v.name);w.setNodeProperty('profilePhoto','src',v.image_src);var z=r._("{name} is typing...",{name:v.short_name});o.set(x.getRoot(),z,'above');i.appendContent(w.getNode('messages'),x.getRoot());return w;}function u(v,w,x){this._animations={};this._activeUsers={};this._typingIndicator=w;this._messagesView=x;this._threadID=v;this._subscription=j.addRetroactiveListener('state-changed',function(y){var z=y[this._threadID];z&&this._handleStateChanged(z);}.bind(this));s.push(this);}p(u.prototype,{destroy:function(){Object.keys(this._activeUsers).forEach(this._removeUserBubble.bind(this));this._controller.destroy();s.remove(this);},receivedMessages:function(v){v.forEach(function(w){if(!k.isAuthor(w.author))this._removeUserBubble(w.author);}.bind(this));},_handleStateChanged:function(v){for(var w in this._activeUsers)if(v.indexOf(w)===-1){this._slideOutUserBubble(w);delete this._activeUsers[w];}if(v.length)k.getMulti(v,function(x){var y=this._messagesView.isScrolledToBottom(),z={};for(var aa in x){var ba=this._activeUsers[aa];z[aa]=ba||t(x[aa]).getRoot();if(!ba)i.appendContent(this._typingIndicator,z[aa]);}var ca=Object.keys(z).length>0;y&&this._messagesView.scrollToBottom(ca);this._activeUsers=z;}.bind(this));},_removeUserBubble:function(v,w){var x=this._getCurrentAnimation(v,w);if(x){x.animation.stop();i.remove(x.elem);delete this._animations[v];}if(v in this._activeUsers){i.remove(this._activeUsers[v]);delete this._activeUsers[v];}w&&i.remove(w);},_slideOutUserBubble:function(v){var w=this._activeUsers[v];if(this._getCurrentAnimation(v,w)){return;}else if(w){l.set(w,'overflow','hidden');var x=(new g(w)).from('opacity',1).from('height',w.offsetHeight).to('height',0).to('opacity',0).ease(g.ease.end).duration(250).ondone(this._removeUserBubble.bind(this,v,w)).go();this._animations[v]={animation:x,elem:w};}},_getCurrentAnimation:function(v,w){if(this._animations[v]&&(!w||this._animations[v].elem===w))return this._animations[v];}});e.exports=u;});
__d("ChatTabMessagesView",["JSXDOM","Animation","Arbiter","ArbiterMixin","MercuryAttachment","MercuryAttachmentRenderer","ChannelConstants","ChatConfig","ChatVisibility","CSS","DOM","Env","Event","JoinableConversationMessageFilter","LiveTimer","MercuryActionTypeConstants","MercuryAPIArgsSource","MercuryLastMessageIndicator","MercuryLogMessageType","MercurySourceType","MercuryActionMessage.react","MercuryMessages","MercuryServerRequests","MercuryMessageStatus.react","MercuryThreadMetadataRenderer","MercuryThreadlistConstants","MercuryThreads","MercuryTypingIndicator","MercuryUserMessage.react","MercuryDateBreak.react","MercuryMessageRenderer","Parent","MercuryParticipants","React","ServerTime","MercuryStatusTemplates","Style","SubscriptionsHandler","ChatTabTemplates","MercuryThreadInformer","Timestamp.react","Tooltip","UserAgent","VideoCallCore","copyProperties","createArrayFrom","csx","cx","extendArray","formatDate","getElementPosition","isRTL","removeFromArray","shield","startsWith","throttle","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Animation'),i=b('Arbiter'),j=b('ArbiterMixin'),k=b('MercuryAttachment'),l=b('MercuryAttachmentRenderer'),m=b('ChannelConstants'),n=b('ChatConfig'),o=b('ChatVisibility'),p=b('CSS'),q=b('DOM'),r=b('Env'),s=b('Event'),t=b('JoinableConversationMessageFilter'),u=b('LiveTimer'),v=b('MercuryActionTypeConstants'),w=b('MercuryAPIArgsSource'),x=b('MercuryLastMessageIndicator'),y=b('MercuryLogMessageType'),z=b('MercurySourceType'),aa=b('MercuryActionMessage.react'),ba=b('MercuryMessages').get(),ca=b('MercuryServerRequests').get(),da=b('MercuryMessageStatus.react'),ea=b('MercuryThreadMetadataRenderer').get(),fa=b('MercuryThreadlistConstants'),ga=b('MercuryThreads').get(),ha=b('MercuryTypingIndicator'),ia=b('MercuryUserMessage.react'),ja=b('MercuryDateBreak.react'),ka=b('MercuryMessageRenderer'),la=b('Parent'),ma=b('MercuryParticipants'),na=b('React'),oa=b('ServerTime'),pa=b('MercuryStatusTemplates'),qa=b('Style'),ra=b('SubscriptionsHandler'),sa=b('ChatTabTemplates'),ta=b('MercuryThreadInformer').get(),ua=b('Timestamp.react'),va=b('Tooltip'),wa=b('UserAgent'),xa=b('VideoCallCore'),ya=b('copyProperties'),za=b('createArrayFrom'),ab=b('csx'),bb=b('cx'),cb=b('extendArray'),db=b('formatDate'),eb=b('getElementPosition'),fb=b('isRTL'),gb=b('removeFromArray'),hb=b('shield'),ib=b('startsWith'),jb=b('throttle'),kb=b('tx'),lb,mb=34,nb=1000*60*60,ob=70,pb=null,qb=20;function rb(bc){return db(new Date(bc),'g:ia');}function sb(bc){var cc=sa[':fb:chat:conversation:message-group'].build(),dc=cc.getNode('profileLink'),ec=n.get('chat_tab_bubbles'),fc=ma.isAuthor(bc.author),gc=ca.tokenizeThreadID(bc.thread_id),hc=gc.type!=='user',ic=!fc||!ec;if(!ec)cc.setNodeContent('timestamp',rb(bc.timestamp));p.conditionClass(cc.getRoot(),"_50kd",!fc&&ec);p.conditionClass(cc.getRoot(),"_50x4",hc&&!fc&&ec);p.conditionShow(dc,ic);ma.get(bc.author,function(jc){if(ic){dc.href=jc.href;var kc=fc?"You":jc.name;if(!fc&&ec)kc=g.div({className:"_522l"},g.div({className:"_522m"},rb(bc.timestamp)),jc.name);va.set(dc,kc,'left');if(!fc&&ec&&hc)cc.setNodeContent('profileName',jc.name);cc.setNodeProperty('profilePhoto','src',jc.image_src);}});return cc;}function tb(bc){if(n.get('chat_react')){var cc=q.create('div'),dc=aa({message:bc});na.renderComponent(dc,cc);return cc;}else{var ec=sa[':fb:chat:conversation:message:event'].build(),fc=n.get('chat_tab_bubbles'),gc=rb(bc.timestamp);if(fc){ec.getRoot().setAttribute('title',gc);}else ec.setNodeContent('timestamp',gc);ka.renderLogMessage(ec.getNode('icon'),ec.getNode('message'),ec.getNode('attachment'),bc);var hc=vb(bc);if(hc)q.appendContent(ec.getNode('message'),hc);return ec.getRoot();}}function ub(bc,cc){if(!n.get('chat_tab_bubbles'))return;if(pb===null){var dc=cc.childNodes[0];qa.set(cc,'overflow','scroll');pb=dc.clientWidth-ob;qa.set(cc,'overflow','');}if(!p.hasClass(bc,"_kso")){var ec=q.scry(bc,"._kso");if(ec.length===1){bc=ec[0];}else return;}qa.set(bc,'max-width',pb+'px');var fc,gc,hc=bc.firstChild;if(bc.childNodes.length===1&&hc.getAttribute('data-measureme')){fc=hc.getClientRects();var ic=hc.offsetHeight;if(fc&&fc.length>1&&fc[0].height<ic){gc=true;if(!lb){q.remove(hc);lb=bc.offsetWidth;q.appendContent(bc,hc);}var jc=hc.offsetWidth,kc=bc.offsetWidth-jc-lb;if(kc>0)qa.set(bc,'max-width',jc+'px');}}var lc=la.byClass(bc,"_50x4");if(lc)p.conditionClass(lc,"_51lo",fc?!gc:bc.offsetHeight<mb);}function vb(bc){var cc,dc;if(bc.log_message_type==y.VIDEO_CALL)if(bc.log_message_data.event_name=='install_canceled'){cc=q.tx._("Retry setup and call back.");dc='callback_cancelinstall_link';return wb(cc,bc.thread_id,bc.log_message_data.to,dc);}else if(!bc.log_message_data.event_name&&bc.log_message_data.callee==ma.user&&!bc.log_message_data.answered){cc=q.tx._("Call Back");dc='callback_link';return wb(cc,bc.thread_id,bc.log_message_data.caller.split(':')[1],dc);}return null;}function wb(bc,cc,dc,ec){if(xa.isSupported()){var fc=!o.isOnline()||!xa.availableForCall(dc),gc=q.create('a',{href:'#',className:'callBackLink'},bc);if(fc)p.hide(gc);gc.setAttribute('data-gt',JSON.stringify({videochat:'clicked_callback_link'}));s.listen(gc,'click',function(){zb.inform('video-call-clicked',{userID:dc,threadID:cc,clickSource:ec});});return gc;}return null;}function xb(bc){var cc=sa[':fb:mercury:chat:message:forward'].build(),dc=cc.getNode('forwardText');if(dc){p.hide(cc.getRoot());ea.renderTitanLink(bc.thread_id,cc.getNode('forwardLink'),p.show.bind(p,cc.getRoot()));if(bc.forward_count>1){q.appendContent(dc,kb._("{count} forwarded messages",{count:bc.forward_count}));}else q.appendContent(dc,"1 forwarded message");}return cc.getRoot();}var yb=[];function zb(bc,cc,dc,ec,fc,gc,hc,ic){this.loadingIcon=fc;this.threadID=bc;this.sheetController=cc;this.scrollContainer=dc;this.conversationElem=ec;this.messageElements={};this.tabView=ic;this.messageGroup=null;this.prevMessage=null;u.restart(oa.get()/1000);this._fetchMultiplier=1;this._oldestMessageDisplayedTimestamp=null;this._loadingMoreMessages=false;this._currentMessageCount=0;this._hasReachedClearedMessages=false;var jc=fa.MESSAGE_TIMESTAMP_THRESHOLD;this._oldestMessageDisplayedTimestamp=Date.now()-jc;yb.push(this);function kc(){zb.inform('interaction-with-tab',bc);}this._subscriptions=new ra();this._subscriptions.addSubscriptions(i.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),s.listen(this.scrollContainer,'mousedown',kc));if(wa.firefox()){var lc=('WheelEvent' in window)?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(lc,kc,false);}else this._subscriptions.addSubscriptions(s.listen(this.scrollContainer,'mousewheel',kc));this._subscriptions.addSubscriptions(s.listen(this.scrollContainer,'scroll',jb(this.scrolling,50,this)));var mc=n.get('chat_tab_bubbles');this.lastMessageIndicator=new x(this.threadID,gc,mc,this);if(mc)this.typingIndicator=new ha(this.threadID,hc,this);ba.getThreadMessagesRange(this.threadID,0,fa.RECENT_MESSAGES_LIMIT,this._updateTimestamp.bind(this));this.rerender();}ya(zb,j);ya(zb.prototype,{scrolling:function(){this._checkToAnimateSticker();if(!this._loadingMoreMessages&&this.isScrolledNearTop()&&!this.isScrolledToBottom()&&!this._hasReachedClearedMessages&&!this.tabView._isDragDropActive)this.loadMoreMessages();if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&this.scrollContainer.scrollTop;},destroy:function(){q.empty(this.conversationElem);this._subscriptions&&this._subscriptions.release();gb(yb,this);this.lastMessageIndicator&&this.lastMessageIndicator.destroy();this.destroyed=true;},_appendMessage:function(bc){if(bc==this.prevMessage)return;if(bc.is_cleared){this._hasReachedClearedMessages=true;return;}this._appendDateBreak(bc);if(n.get('chat_react')){this._appendUserMessageReact(bc);}else this._appendUserMessageXHP(bc);this.prevMessage=bc;},_appendUserMessageXHP:function(bc){var cc=fa.GROUPING_THRESHOLD,dc=this._renderMessageWithStatus(bc);if(bc.action_type==v.LOG_MESSAGE){q.appendContent(this.conversationElem,dc);this.messageGroup=null;}else{var ec=n.get('chat_tab_bubbles');if(!this.messageGroup||ec&&bc.author!==ma.user||this.prevMessage.author!=bc.author||this.prevMessage.timestamp<bc.timestamp-cc){this.messageGroup=sb(bc);q.appendContent(this.conversationElem,this.messageGroup.getRoot());}q.appendContent(this.messageGroup.getNode('messages'),dc);ub(dc,this.scrollContainer);}},_appendUserMessageReact:function(bc){var cc=q.create('div');q.appendContent(this.conversationElem,cc);function dc(event){if(this.isScrolledToBottom(event.heightChange))this.scrollToBottom();}var ec=(ia({onResize:dc.bind(this),message:bc}));na.renderComponent(ec,cc);this.messageElements[bc.message_id]=ec;},_appendDateBreak:function(bc){var cc=(bc.action_type===v.LOG_MESSAGE)&&(bc.log_message_type===y.SERVER_ERROR),dc;if(this.prevMessage!==null){dc=bc.timestamp-this.prevMessage.timestamp;}else dc=Infinity;if(!cc&&(dc>=nb)){if(n.get('chat_react')){var ec=q.create('div'),fc=new Date(bc.timestamp);na.renderComponent(ja({date:fc}),ec);q.appendContent(this.conversationElem,ec);}else{var gc=Math.round(bc.timestamp/1000),hc=bc.timestamp_datetime,ic=sa[':fb:chat:conversation:date-break'].build();na.renderComponent(ua({time:gc,verbose:hc,text:hc}),ic.getNode('date'));q.appendContent(this.conversationElem,ic.getRoot());}this.messageGroup=null;}},rerender:function(){if(!this._oldestMessageDisplayedTimestamp)return;var bc=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollHeight,cc=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollTop,dc=this.isScrolledToBottom();q.empty(this.conversationElem);this.messageElements={};this.messageGroup=null;this.prevMessage=null;var ec=ba.getThreadMessagesSinceTimestamp(this.threadID,this._oldestMessageDisplayedTimestamp);this._renderOlderMessages(ec,bc,cc,dc);this._finishedFetchingMoreMessages=false;},update:function(bc){for(var cc in bc){var dc=this.messageElements[cc];if(dc){var ec=this.isScrolledToBottom(),fc=ba.getMessagesFromIDs([cc])[0];if(n.get('chat_react')){dc.setState({message:fc});}else{var gc=this._renderMessageWithStatus(fc);q.replace(dc,gc);ub(gc,this.scrollContainer);}if(ec)this.scrollToBottom();}}if(this.scrollContainer.scrollTop===0)this._checkToAnimateSticker();},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_appendMessages:function(bc){var cc=this.scrollContainer.style.overflowY;qa.set(this.scrollContainer,'overflow-y','scroll');bc.forEach(this._appendMessage.bind(this));this.lastMessageIndicator&&this.lastMessageIndicator.setLastMessage(this.prevMessage);qa.set(this.scrollContainer,'overflow-y',cc);},_appendNewMessages:function(bc){bc=t.filterMessages(function(ec){this.sheetController.openUserJoinStatusSheet(ec);}.bind(this),bc,true);var cc=this.isScrolledToBottom(),dc=this._messagesOnlySentFromSelf(bc);this._appendMessages(bc);if(cc){this.scrollToBottom();}else if(!dc){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}},_messagesOnlySentFromSelf:function(bc){for(var cc=0;cc<bc.length;cc++)if(bc[cc].author!==ma.user)return false;return true;},_renderOlderMessages:function(bc,cc,dc,ec){if(!bc)return;bc=t.filterMessages(function(fc){this.sheetController.openUserJoinStatusSheet(fc);}.bind(this),bc,false);this._appendMessages(bc);if(ec){this.scrollToBottom();}else if(this._finishedFetchingMoreMessages)this.scrollToPosition(this.scrollContainer.scrollHeight-cc-this.loadingHeight+dc);},_updateTimestamp:function(bc){if(bc&&bc.length){this._oldestMessageDisplayedTimestamp=bc[0].timestamp;this._currentMessageCount=bc.length;}this._loadingMoreMessages=false;this._finishedFetchingMoreMessages=true;p.hide(this.loadingIcon);},isScrolledToBottom:function(bc){var cc=this.scrollContainer;bc=bc||qb;return cc.scrollTop+cc.clientHeight>=cc.scrollHeight-bc;},isScrolledNearTop:function(){return this.scrollContainer.scrollTop<this.scrollContainer.clientHeight;},scrollToBottom:function(bc){this.scrollToPosition(this.scrollContainer.scrollHeight,bc);},scrollToPosition:function(bc,cc){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(cc===true){this._scrollTopAnimation=(new h(this.scrollContainer)).to('scrollTop',bc).ease(h.ease.end).duration(400).go();}else this.scrollContainer.scrollTop=bc;},loadMoreMessages:function(){if(ba.hasLoadedExactlyNMessages(this.threadID,this._currentMessageCount)&&ba.hasLoadedAllMessages(this.threadID))return;if(ga.isNewEmptyLocalThread(this.threadID))return;p.show(this.loadingIcon);this.loadingHeight=this._getLoadingHeight();this._loadingMoreMessages=true;if(this._fetchMultiplier<10)this._fetchMultiplier+=1;var bc=fa.RECENT_MESSAGES_LIMIT*this._fetchMultiplier,cc=this._currentMessageCount+bc,dc=ba.hasLoadedNMessages(this.threadID,cc);ba.getThreadMessagesRange(this.threadID,0,cc,this._updateTimestamp.bind(this),null,w.CHAT);if(dc)this.rerender();},_renderMessageWithStatus:function(bc){var cc=(bc.action_type===v.LOG_MESSAGE)?tb(bc):this._makeSingleMessage(bc),dc=da({message:bc}),ec=dc.getType();if(ec!=='none'){var fc=sa[':fb:chat:conversation:message:status'].build();p.conditionClass(fc.getRoot(),"_542q",ib(ec,'error'));q.appendContent(fc.getNode('message'),cc);na.renderComponent(dc,fc.getNode('status'));cc=fc.getRoot();}this.messageElements[bc.message_id]=cc;return cc;},_makeSingleMessage:function(bc){var cc=this._renderSingleMessage(bc);p.addClass(cc,"_55r0");return cc;},_renderSingleMessage:function(bc){var cc=sa[':fb:chat:conversation:message'].render(),dc=n.get('chat_tab_bubbles');if(dc&&ma.isAuthor(bc.author))cc.setAttribute('title',rb(bc.timestamp));if(bc.subject){var ec=sa[':fb:chat:conversation:message:subject'].render();q.setContent(ec,bc.subject);q.appendContent(cc,ec);}function fc(lc){if(dc)lc=q.create('span',{'data-measureme':1},lc);return lc;}if(bc.is_filtered_content){var gc=pa[':fb:mercury:filtered-message'].build();q.appendContent(cc,fc(gc.getRoot()));return cc;}if(bc.body.substr(0,4)=='?OTR'){q.setContent(cc,fc("[encrypted message]"));p.addClass(cc,"_542c");}else{p.addClass(cc,fb(bc.body)?'direction_rtl':'direction_ltr');var hc=ka.formatMessageBody(bc.body);q.appendContent(cc,fc(hc));}if(bc.has_attachment){var ic=g.div(null),jc=this._appendMessageAttachments(ic,bc);if(dc&&!bc.body&&!jc)return ic;q.appendContent(cc,za(ic.childNodes));}if(bc.forward_count)q.appendContent(cc,xb(bc));if(bc.is_spoof_warning){var kc=sa[':fb:chat:conversation:message:undertext'].build();q.appendContent(kc.getNode('message'),cc);ma.get(bc.author,function(lc){ea.renderChatSpoofWarning(kc.getNode('status'),bc.is_spoof_warning,lc);});return kc.getRoot();}return cc;},_appendMessageAttachments:function(bc,cc){var dc=0,ec=cc.attachments;ec.sort(l.booleanLexicographicComparator([l.isPhotoAttachment,l.isShareAttachment,l.isFileAttachment,l.isErrorAttachment]));if(cc.raw_attachments&&cc.raw_attachments.length>0)ec=k.convertRaw(cc.raw_attachments);if(cc.attachments.length===0&&cc.preview_attachments&&cc.preview_attachments.length>0)cb(ec,cc.preview_attachments);var fc=l.renderPhotoAttachments(ec.filter(l.isPhotoAttachment),cc,176,4);if(fc)q.appendContent(bc,fc);for(var gc=0;gc<ec.length;gc++){if(l.isPhotoAttachment(ec[gc])){dc=1;continue;}var hc=l.renderAttachment(true,ec[gc],cc);hc.error&&q.appendContent(bc,hc.error);hc.content&&q.appendContent(bc,hc.content);dc|=hc.bubblePreferred;}var ic=q.scry(bc,'img');ic.forEach(function(jc){this._subscriptions.addSubscriptions(s.listen(jc,'load',hb(this._thumbLoaded,this,jc)));}.bind(this));return !!dc;},_thumbLoaded:function(bc){var cc=this.scrollContainer.scrollTop+this.scrollContainer.clientHeight;if(cc+bc.offsetHeight>=this.scrollContainer.scrollHeight)this.scrollToBottom();},_checkToAnimateSticker:function(){var bc=eb(this.scrollContainer);i.inform('chatScrolled/'+this.threadID,{scrollTop:this.scrollContainer.scrollTop,top:bc.y,viewHeight:bc.height});}});ta.subscribe('messages-reordered',function(bc,cc){yb.forEach(function(dc){cc[dc.threadID]&&dc.rerender();});});ta.subscribe('messages-updated',function(bc,cc){yb.forEach(function(dc){cc[dc.threadID]&&dc.update(cc[dc.threadID]);});});ta.subscribe('messages-received',function(bc,cc){yb.forEach(function(dc){var ec=cc[dc.threadID];if(ec&&ec.length)dc._currentMessageCount+=ec.length;ec&&dc._appendNewMessages(ec);});});i.subscribe(m.getArbiterType('chat_event'),function(bc,cc){if(ac(cc.obj)){var dc=(r.user==cc.obj.from)?cc.obj.to:cc.obj.from,ec=ga.getThreadIdForUser(dc),fc=yb.filter(function(ic){return ic.threadID===ec;});if(fc.length>0){var gc=fc[0],hc=ba.constructLogMessageObject(z.CHAT_WEB,ec,y.VIDEO_CALL,cc.obj);hc.author='fbid:'+cc.obj.from;gc._appendNewMessages([hc]);}}});function ac(bc){return (bc.event_name==='installing'||bc.event_name==='install_canceled');}e.exports=zb;});
__d("MercuryPeopleSuggestions",["KeyedCallbackManager","MercuryServerDispatcher","OrderedFriendsList","ShortProfiles","arrayContains"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=b('MercuryServerDispatcher'),i=b('OrderedFriendsList'),j=b('ShortProfiles'),k=b('arrayContains'),l=new g(),m=6;function n(s){return s.sort().join(',');}function o(s,t){if(s.length<m){var u=i.getList();for(var v=0;v<u.length;v++)if(!(k(s,u[v])||k(t,u[v]))){s.push(u[v]);if(s.length>=m)break;}}return s;}function p(s){h.trySend('/ajax/chat/people_suggest.php',s);}function q(s,t,u){s=s.filter(function(w){return !k(t,w);});var v=o(s,t);j.getMulti(v,function(){u(v);});}var r={getPeopleSuggestions:function(s,t){if(s)if(s.length){var u=n(s),v=l.executeOrEnqueue(u,function(x){q(x,s,t);}),w=l.getUnavailableResources(v);if(w.length)p({query:u,size:m});return v;}else q([],[],t);return 0;},handleUpdate:function(s){if(s.query){var t=s.suggestions||"",u=t.length?t.split(','):[];l.setResource(s.query,u);}}};h.registerEndpoints({'/ajax/chat/people_suggest.php':{mode:h.IMMEDIATE,handler:r.handleUpdate}});e.exports=r;});
__d("ChatTabPeopleSuggestionView",["ChatPeopleSuggestionList.react","ChatQuietLinks","CSS","DOM","Event","MercuryPeopleSuggestions","MercuryIDs","React","ShortProfiles","Style","copyProperties"],function(a,b,c,d,e,f){var g=b('ChatPeopleSuggestionList.react'),h=b('ChatQuietLinks'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('MercuryPeopleSuggestions'),m=b('MercuryIDs'),n=b('React'),o=b('ShortProfiles'),p=b('Style'),q=b('copyProperties');function r(s,t,u){this.sheetController=s;this.viewNode=t;this.loadingIcon=u;this.addFriendsSheet=s.getAddFriendsTabSheet();this.mercuryTypeahead=this.addFriendsSheet&&this.addFriendsSheet._typeahead;this.typeaheadInput=this.mercuryTypeahead&&this.mercuryTypeahead._input;this.typeaheadView=this.mercuryTypeahead&&this.mercuryTypeahead.getTypeahead().getView();var v=this.showSuggestions.bind(this);if(this.typeaheadInput)k.listen(this.typeaheadInput,'focus',v);if(this.typeaheadView){this.typeaheadView.subscribe('reset',v);this.typeaheadView.subscribe('render',this.clearSuggestions.bind(this));}this.tokenizer=this.mercuryTypeahead&&this.mercuryTypeahead.getTokenizer();if(this.tokenizer)this.tokenizer.subscribe('removeToken',v);this.showSuggestions();}q(r.prototype,{addSelectedParticipant:function(s){var t=o.getNow(s);if(t&&this.tokenizer){this.tokenizer.addToken(this.tokenizer.createToken({uid:s,text:t.name}));this.showSuggestions();}},showSuggestions:function(){if(this.mercuryTypeahead){var s=this.mercuryTypeahead.getSelectedParticipantIDs();s=s.map(m.getUserIDFromParticipantID);j.empty(this.viewNode);i.show(this.loadingIcon);l.getPeopleSuggestions(s,function(t){var u=g({uids:t,onClick:this.addSelectedParticipant.bind(this)});i.hide(this.loadingIcon);n.renderComponent(u,this.viewNode);h.removeAllHrefs(this.viewNode);}.bind(this));}},clearSuggestions:function(){j.empty(this.viewNode);i.hide(this.loadingIcon);p.set(this.viewNode,'margin-top',0);},destroy:function(){this.clearSuggestions();}});e.exports=r;});
__d("ChatAddFriendsTabSheetRawRenderer",["ContextualTypeaheadView","DOM","Event","MercuryTypeahead","ChatTabTemplates","fbt","tx","MercuryDataSourceWrapper"],function(a,b,c,d,e,f){var g=b('ContextualTypeaheadView'),h=b('DOM'),i=b('Event'),j=b('MercuryTypeahead'),k=b('ChatTabTemplates'),l=b('fbt'),m=b('tx'),n=b('MercuryDataSourceWrapper').source,o={render:function(p,q,r,s,t,u){var v=u?k[':fb:mercury:chat:tab-sheet:add-friends-empty-tab'].build():k[':fb:mercury:chat:tab-sheet:add-friends'].build(),w=new j(n,g);w.setExcludedParticipantsFromThreadMeta(s);if(!u)w.setPlaceholder("Add friends to this chat");w.build();h.replace(v.getNode('participantsTypeahead'),w.getElement());h.setContent(r,v.getRoot());w.getTokenizer().adjustWidth();var x=v.getNode('participantsTypeahead').getAttribute('data-labelid'),y=h.scry(w.getElement(),'input[type="text"]')[0];if(y)if(x){y.setAttribute('aria-labelledby',x);}else y.setAttribute('aria-label',"To");w.focus();if(!u){var z=function(){var aa=w.getSelectedParticipantIDs();if(aa.length)t(aa);q.close(p);};i.listen(v.getNode('doneButton'),'click',z);w.subscribe('tokens-return',function(){if(w.getTokens().length)z();});}return w;}};e.exports=o;});
__d("MultiChatController",["Arbiter","AsyncSignal","copyProperties","Form","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncSignal'),i=b('copyProperties'),j=b('Form'),k=b('MercuryMessages').get(),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get();function n(){}i(n,{subscribe:function(o,p){o.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(o,p);}.bind(this));},createGroupThreadFromChooserDialog:function(o,p){var q=j.serialize(o.getRoot()),r=JSON.parse(q.profileChooserItems),s=[];for(var t in r)if(r[t])s.push(t);var u=n.createThreadForFBIDs(s);l.subscribe('update-thread-ids',function(v,w){for(var x in w)if(w[x]==u)new h('/ajax/groups/chat/log',{group_id:p,message_id:x}).send();});o.hide();},createThreadForTokens:function(o){if(!o.length)return;var p;if(o.length==1){p='user:'+o[0].split(':')[1];}else p='root:'+k.generateNewClientMessageID(Date.now());m.createNewLocalThread(p,o);g.inform('chat/open-tab',{thread_id:p});return p;},createThreadForFBIDs:function(o){var p=[];for(var q=0;q<o.length;q++)p.push("fbid:"+o[q]);return n.createThreadForTokens(p);}});e.exports=n;});
__d("ChatAddFriendsTabSheet",["Arbiter","ArbiterMixin","ChatAddFriendsTabSheetRawRenderer","MercuryLogMessageType","MercurySourceType","MercuryMessages","MultiChatController","Style","MercuryThreads","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatAddFriendsTabSheetRawRenderer'),j=b('MercuryLogMessageType'),k=b('MercurySourceType'),l=b('MercuryMessages').get(),m=b('MultiChatController'),n=b('Style'),o=b('MercuryThreads').get(),p=b('copyProperties');function q(t,u,v){this._threadID=t;this._rootElement=u;this._sheetView=v;this._typeahead=null;}p(q.prototype,h,{render:function(){o.getThreadMeta(this._threadID,function(t){var u=t.is_canonical_user?r:s;this._typeahead=i.render(this,this._sheetView,this._rootElement,t,u.curry(t),o.isNewEmptyLocalThread(this._threadID));this._typeahead.subscribe('tokens-changed',function(){this.inform('chat/tokens-changed',{token_count:this._typeahead.getTokens().length});}.bind(this));this._typeahead.subscribe('resize',function(){this._sheetView.resize();}.bind(this));}.bind(this));},getParticipants:function(){if(!this._typeahead)return null;return this._typeahead.getSelectedParticipantIDs();},isPermanent:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);},getHeight:function(){return n.get(this._rootElement,'height');}});function r(t,u){var v=t.participants;m.createThreadForTokens(v.concat(u));}function s(t,u){var v=t.thread_id;if(o.isEmptyLocalThread(v)){o.addParticipantsToThreadLocally(v,u);g.inform('chat/open-tab',{thread_id:v});}else{l.sendMessage(l.constructLogMessageObject(k.CHAT_WEB,v,j.SUBSCRIBE,{added_participants:u}));g.inform('chat/open-tab',{thread_id:v});}}e.exports=q;});
__d("ChatNameConversationTabSheetRawRenderer",["DOM","Event","Input","Keys","ChatTabTemplates","fbt"],function(a,b,c,d,e,f){"use strict";var g=b('DOM'),h=b('Event'),i=b('Input'),j=b('Keys'),k=b('ChatTabTemplates'),l=b('fbt'),m={render:function(n,o,p,q,r,s){var t=k[':fb:mercury:chat:tab-sheet:name-conversation'].build(),u=t.getNode('nameInput'),v=t.getNode('doneButton'),w="Done",x="Hide",y=q.name;if(y){i.setValue(u,y);}else g.setContent(v,x);var z=function(){var aa=i.getValue(u);if(aa)r(aa);s();o.close(n);};h.listen(u,'input',function(){g.setContent(v,i.getValue(u).length===0?x:w);});h.listen(v,'click',z);h.listen(u,'keyup',function(aa){if(aa.keyCode===j.RETURN){z();return false;}});g.setContent(p,t.getRoot());!n.isAutomatic()&&u.focus();}};e.exports=m;});
__d("ChatNameConversationTabSheet",["AsyncRequest","ChatNameConversationTabSheetRawRenderer","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('ChatNameConversationTabSheetRawRenderer'),i=b('MercuryAPIArgsSource'),j=b('MercuryLogMessageType'),k=b('MercurySourceType'),l=b('MercuryMessages').get(),m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o='/ajax/chat/multichat/name_conversation/dismiss.php',p={};function q(r,s,t){"use strict";this.$ChatNameConversationTabSheet0=r;this.$ChatNameConversationTabSheet1=s;this.$ChatNameConversationTabSheet2=t;this.$ChatNameConversationTabSheet3=false;}q.prototype.render=function(){"use strict";n.getThreadMeta(this.$ChatNameConversationTabSheet0,function(r){h.render(this,this.$ChatNameConversationTabSheet2,this.$ChatNameConversationTabSheet1,r,this.$ChatNameConversationTabSheet4.curry(r),this.$ChatNameConversationTabSheet5.bind(this,r));this.$ChatNameConversationTabSheet2.resize();}.bind(this));};q.prototype.isPermanent=function(){"use strict";return true;};q.prototype.getType=function(){"use strict";return 'name_conversation_type';};q.prototype.open=function(r){"use strict";this.$ChatNameConversationTabSheet3=r;if(!(this.$ChatNameConversationTabSheet3&&this.$ChatNameConversationTabSheet6()))this.$ChatNameConversationTabSheet2.open(this);};q.prototype.close=function(){"use strict";this.$ChatNameConversationTabSheet2.close(this);};q.prototype.isAutomatic=function(){"use strict";return this.$ChatNameConversationTabSheet3;};q.prototype.$ChatNameConversationTabSheet6=function(){"use strict";return !!p[this.$ChatNameConversationTabSheet0];};q.prototype.$ChatNameConversationTabSheet7=function(){"use strict";p[this.$ChatNameConversationTabSheet0]=true;};q.prototype.$ChatNameConversationTabSheet5=function(r){"use strict";if(!r.name_conversation_sheet_dismissed||!this.$ChatNameConversationTabSheet6()){this.$ChatNameConversationTabSheet7();m.getServerThreadID(r.thread_id,function(s){new g(o).setData({thread_id:s}).send();});}};q.prototype.$ChatNameConversationTabSheet4=function(r,s){"use strict";var t=r.name;if((s||t)&&(s!=t))l.sendMessage(l.constructLogMessageObject(k.CHAT_WEB,r.thread_id,j.THREAD_NAME,{name:s}),null,i.CHAT);};e.exports=q;});
__d("ChatNewMessagesTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('ChatTabTemplates'),k=b('copyProperties');function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:clickable-message-icon-sheet'].build();i.setContent(m.getNode('text'),i.tx._("Scroll down to see new messages."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getRoot(),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return true;},getType:function(){return 'new_messages_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;});
__d("ChatNoRecipientsTabSheet",["DOM","fbt","MercuryParticipants","ChatTabTemplates","MercuryThreadInformer","MercuryThreads","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('fbt'),i=b('MercuryParticipants'),j=b('ChatTabTemplates'),k=b('MercuryThreadInformer').get(),l=b('MercuryThreads').get(),m=b('copyProperties');function n(o,p,q){this._threadID=o;this._rootElement=p;this._sheetView=q;k.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}m(n.prototype,{render:function(){var o=j[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(o.getNode('text'),"Everyone has left the conversation.");g.setContent(this._rootElement,o.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){l.getThreadMeta(this._threadID,function(o){var p=i.user,q=o.participants.filter(function(r){return r!=p;});if(q.length<1&&!o.is_joinable&&!l.isNewEmptyLocalThread(this._threadID)){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=n;});
__d("ChatOfflineTabSheet",["ChatPrivacyActionController","ChatVisibility","CSS","DOM","Event","JSLogger","MercuryParticipants","MercuryThreads","ChatTabTemplates","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('ChatPrivacyActionController'),h=b('ChatVisibility'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('JSLogger'),m=b('MercuryParticipants'),n=b('MercuryThreads').get(),o=b('ChatTabTemplates'),p=b('copyProperties'),q=b('cx');function r(s,t,u){this._rootElement=t;this._sheetView=u;this._logger=l.create('blackbird');this._canonicalUser=n.getCanonicalUserInThread(s);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}p(r.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('offline_sheet_open_with_non_friend');return;}var s=o[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),t='fbid:'+this._canonicalUser;m.get(t,function(u){var v='fbChatGoOnlineLink',w=j.tx._("turn on chat"),x=j.create('a',{href:'#',className:v},w),y=j.tx._("To chat with {name} and other friends, {link}.",{name:u.short_name,link:x});j.setContent(s.getNode('text'),y);i.addClass(s.getRoot(),"_1sk1");j.setContent(this._rootElement,s.getRoot());k.listen(this._rootElement,'click',function(event){if(i.hasClass(event.getTarget(),v)){if(h.isOnline())this._logger.error('tab_sheet_already_online');this._privacyActionController.togglePrivacy();this._logger.log('tab_sheet_go_online',{tab_id:this._canonicalUser});return false;}}.bind(this));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(s){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(s){case g.OFFLINE:this._sheetView.open(this);break;case g.NORMAL:case g.BLOCKED:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'offline_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=r;});
__d("ChatUploadWarningTabSheet",["DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ChatTabTemplates'),i=b('copyProperties');function j(k,l,m){this._threadID=k;this._rootElement=l;this._sheetView=m;}i(j.prototype,{render:function(){var k=h[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(k.getNode('text'),g.tx._("Please wait until the upload is complete before you send your message."));g.setContent(this._rootElement,k.getRoot());},isPermanent:function(){return false;},getType:function(){return 'upload_warning_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=j;});
__d("ChatThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('ChatTabTemplates'),k=b('copyProperties');function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:message-mute-sheet'].build();i.setContent(m.getNode('text'),i.tx._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getNode('unmuteButton'),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return false;},getType:function(){return 'chat-thread-is-muted';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;});
__d("ChatUserBlockedTabSheet",["ChatPrivacyActionController","CSS","DOM","Event","GenderConst","JSLogger","MercuryParticipants","MercuryThreads","ChatTabTemplates","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('ChatPrivacyActionController'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('GenderConst'),l=b('JSLogger'),m=b('MercuryParticipants'),n=b('MercuryThreads').get(),o=b('ChatTabTemplates'),p=b('copyProperties'),q=b('cx'),r=b('tx');function s(t,u,v){this._rootElement=u;this._sheetView=v;this._logger=l.create('blackbird');this._canonicalUser=n.getCanonicalUserInThread(t);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}p(s.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('user_blocked_sheet_open_with_non_friend');return;}var t=o[':fb:mercury:chat:tab-sheet:user-blocked'].build(),u='fbid:'+this._canonicalUser;m.get(u,function(v){var w=null;switch(v.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:w=r._("You turned off chat for {name} but you can still send her a message. ",{name:v.short_name});break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:w=r._("You turned off chat for {name} but you can still send him a message. ",{name:v.short_name});break;default:w=r._("You turned off chat for {name} but you can still send them a message. ",{name:v.short_name});}i.setContent(t.getNode('text'),w);var x=r._("Turn on chat for {name}?",{name:v.short_name});i.setContent(t.getNode('actionLink'),x);h.addClass(t.getRoot(),"_1sk0");i.setContent(this._rootElement,t.getRoot());j.listen(t.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(t){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(t){case g.BLOCKED:this._sheetView.open(this);break;case g.NORMAL:case g.OFFLINE:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=s;});
__d("ChatUserJoinStatusTabSheet",["JoinStatusTabSheet","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('JoinStatusTabSheet'),h=b('ChatTabTemplates');for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(){"use strict";if(g!==null)g.apply(this,arguments);}k.prototype._getTemplate=function(){"use strict";return h[':fb:mercury:chat:tab-sheet:message-icon-sheet'];};e.exports=k;});
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatUploadWarningTabSheet","ChatThreadIsMutedTabSheet","ChatUserBlockedTabSheet","ChatUserJoinStatusTabSheet","copyProperties","MercurySheetView","MercuryThreads"],function(a,b,c,d,e,f){var g=b('ChatAddFriendsTabSheet'),h=b('ChatNameConversationTabSheet'),i=b('ChatNewMessagesTabSheet'),j=b('ChatNoRecipientsTabSheet'),k=b('ChatOfflineTabSheet'),l=b('ChatUploadWarningTabSheet'),m=b('ChatThreadIsMutedTabSheet'),n=b('ChatUserBlockedTabSheet'),o=b('ChatUserJoinStatusTabSheet'),p=b('copyProperties'),q=b('MercurySheetView'),r=b('MercuryThreads').get(),s=function(t,u,v){this._sheetView=new q(t,u,v);this._addFriendsTabSheet=new g(t,u,this._sheetView);this._nameConversationTabSheet=new h(t,u,this._sheetView);this._userBlockedTabSheet=new n(t,u,this._sheetView);this._offlineTabSheet=new k(t,u,this._sheetView);this._newMessagesTabSheet=new i(t,u,this._sheetView);this._uploadWarningTabSheet=new l(t,u,this._sheetView);this._threadIsMutedTabSheet=new m(t,u,this._sheetView);this._userJoinStatusTabSheet=new o(u,this._sheetView);if(!r.getCanonicalUserInThread(t))this._noRecipientsTabSheet=new j(t,u,this._sheetView);};p(s.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},openUserJoinStatusSheet:function(t){this._userJoinStatusTabSheet.addToQueue(t);},getAddFriendsTabSheet:function(){return this._addFriendsTabSheet;},getAddFriendsParticipants:function(){var t=this._addFriendsTabSheet.getParticipants();this._addFriendsTabSheet.close();return t;},openNameConversationSheet:function(t){this._nameConversationTabSheet.open(t);},openNewMessagesSheet:function(){this._newMessagesTabSheet.open();},openUploadWarningTabSheet:function(){this._uploadWarningTabSheet.open();},openThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.open();},closeAutomaticNameConversationSheet:function(){if(this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();},closeThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.close();},closeNewMessagesSheet:function(){this._newMessagesTabSheet.close();},closeUploadWarningTabSheet:function(){this._uploadWarningTabSheet.close();},onClickNewMessagesSheet:function(t){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',t);},onClickThreadIsMutedSheet:function(t){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',t);},onResize:function(t){this._sheetView.subscribe('resize',t);},onTokensChanged:function(t){this._addFriendsTabSheet.subscribe('chat/tokens-changed',t);},destroy:function(){this._sheetView&&this._sheetView.destroy();this._offlineTabSheet&&this._offlineTabSheet.destroy();this._userBlockedTabSheet&&this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();}});e.exports=s;});
__d("ChatTabView",["function-extensions","Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AsyncSignal","AvailableListConstants","ChatBehavior","ChatConfig","ChatContextualDialogController","ChatAutoSendPhotoUploader","ChatPrivacyActionController","ChatQuietLinks","ChatShareLinkUploader","ChatPhotoEditorContextualDialog","ChatTabMessagesView","ChatTabPeopleSuggestionView","ChatTabSheetController","ChatVisibility","MercuryConstants","CSS","Dialog","Dock","DOM","Env","Event","Focus","Input","Keys","Locale","MercuryConfig","MercuryFileUploader","MercuryLogMessageType","MercuryMessages","MercuryParticipants","MercuryServerRequests","MercurySourceType","MercuryThreadInformer","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","MercuryThreadMuter","MercuryThreads","MercuryTypingReceiver","MessagesEmoticonView","NubController","Parent","PhotosUploadWaterfall","PresencePrivacy","PresenceStatus","React","Run","StickersFlyout.react","Style","SubscriptionsHandler","ChatTabTemplates","TextAreaControl","Tooltip","Toggler","TypingDetectorController","URI","UserAgent","VideoCallCore","WaterfallIDGenerator","copyProperties","cx","isEmpty","setIntervalAcrossTransitions","tx","fbt"],function(a,b,c,d,e,f){"use strict";b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('AsyncSignal'),l=b('AvailableListConstants'),m=b('ChatBehavior'),n=b('ChatConfig'),o=b('ChatContextualDialogController'),p=b('ChatAutoSendPhotoUploader'),q=b('ChatPrivacyActionController'),r=b('ChatQuietLinks'),s=b('ChatShareLinkUploader'),t=b('ChatPhotoEditorContextualDialog'),u=b('ChatTabMessagesView'),v=b('ChatTabPeopleSuggestionView'),w=b('ChatTabSheetController'),x=b('ChatVisibility'),y=b('MercuryConstants'),z=b('CSS'),aa=b('Dialog'),ba=b('Dock'),ca=b('DOM'),da=b('Env'),ea=b('Event'),fa=b('Focus'),ga=b('Input'),ha=b('Keys'),ia=b('Locale'),ja=b('MercuryConfig'),ka=b('MercuryFileUploader'),la=b('MercuryLogMessageType'),ma=b('MercuryMessages').get(),na=b('MercuryParticipants'),oa=b('MercuryServerRequests').get(),pa=b('MercurySourceType'),qa=b('MercuryThreadInformer').get(),ra=b('MercuryThreadMetadataRawRenderer'),sa=b('MercuryThreadMetadataRenderer').get(),ta=b('MercuryThreadMuter'),ua=b('MercuryThreads').get(),va=b('MercuryTypingReceiver'),wa=b('MessagesEmoticonView'),xa=b('NubController'),ya=b('Parent'),za=b('PhotosUploadWaterfall'),ab=b('PresencePrivacy'),bb=b('PresenceStatus'),cb=b('React'),db=b('Run'),eb=b('StickersFlyout.react'),fb=b('Style'),gb=b('SubscriptionsHandler'),hb=b('ChatTabTemplates'),ib=b('TextAreaControl'),jb=b('Tooltip'),kb=b('Toggler'),lb=b('TypingDetectorController'),mb=b('URI'),nb=b('UserAgent'),ob=b('VideoCallCore'),pb=b('WaterfallIDGenerator'),qb=b('copyProperties'),rb=b('cx'),sb=b('isEmpty'),tb=b('setIntervalAcrossTransitions'),ub=b('tx'),vb=b('fbt'),wb=/^\s*$/,xb={},yb=null,zb,ac=10;function bc(wc,xc){var yc=ca.create('div');xc=xc.filter(function(bd){return bd!=na.user;});if(!xc.length)return jb.remove(wc);var zc=xc.length,ad=zc-ac;if(ad>1)xc=xc.slice(0,ac);na.getMulti(xc,function(bd){for(var cd in bd){var dd=bd[cd],ed=hb[':fb:mercury:chat:multichat-tooltip-item'].build();ca.setContent(ed.getNode('name'),dd.name);var fd=na.getUserID(cd),gd=fd&&bb.get(fd)==l.ACTIVE;z.conditionShow(ed.getNode('icon'),gd);z.conditionClass(ed.getNode('name'),'tooltipItemWithIcon',gd);ca.appendContent(yc,ed.getRoot());}if(ad>1){var hd=vb._("and {number of hidden chat participants} more.",[vb.param("number of hidden chat participants",ad)]);ca.appendContent(yc,ca.create('div',{},hd));}jb.set(wc,yc,'above');});}var cc={},dc=null,ec=false;function fc(wc,xc,yc){if(yc){cc[wc]=xc;if(!dc)dc=tb(gc,600);}else{z.removeClass(xc,'highlightTitle');delete cc[wc];}}function gc(){for(var wc in cc){var xc=cc[wc];if(xc.parentNode){z.conditionClass(xc,'highlightTitle',ec);}else delete cc[wc];}ec=!ec;if(!Object.keys(cc).length){clearInterval(dc);dc=null;}}function hc(wc){var xc=oa.tokenizeThreadID(wc);switch(xc.type){case 'user':return hb[':fb:mercury:chat:user-tab'].build();}return hb[':fb:mercury:chat:multichat-tab'].build();}function ic(wc){var xc=wc._tabTemplate.getNode('input').value||'',yc=wc._fileUploader.getAttachments();if(oc(wc))kc(wc,xc,yc,function(zc){var ad=wc._fileUploader.getImageFiles();if(ad.length>0){zc.image_ids=ad;zc.has_attachment=true;}ma.sendMessage(zc);wc._fileUploader.removeAttachments();n.get('chat_tab_share_sheet')&&wc._shareLinkUploader.clear();wc._getNode('input').value='';wc._lastMessageIndicator&&wc._lastMessageIndicator.resetState();wc._messagesView&&wc._messagesView.scrollToBottom();});}function jc(wc,xc){if(xc===0)return;sc(wc,za.POST_PUBLISHED,{count:xc});wc._waterfallID=pb.generate();}function kc(wc,xc,yc,zc){ua.getThreadMeta(wc._threadID,function(ad){var bd=ma.constructUserGeneratedMessageObject(xc,pa.CHAT_WEB,wc._threadID);if(yc.length>0){bd.has_attachment=true;bd.raw_attachments=yc;}if(n.get('chat_tab_share_sheet')){var cd=wc._shareLinkUploader.getAttachData();if(cd){bd.has_attachment=true;bd.content_attachment=cd;}}if(ua.isNewEmptyLocalThread(wc._threadID)){var dd=wc._sheetController.getAddFriendsParticipants();if(dd===null||dd.length===0){return;}else if(dd.length===1){var ed='user:'+na.getUserID(dd[0]);bd.thread_id=ed;}else ua.addParticipantsToThreadLocally(wc._threadID,dd);}if(ua.isEmptyLocalThread(wc._threadID)){var fd=oa.tokenizeThreadID(wc._threadID);bd.message_id=fd.value;bd.specific_to_list=ad.participants;}if(typeof bd!='undefined')bd.signatureID=wc._signatureID;bd.ui_push_phase=y.UIPushPhase;zc(bd);if(wc._threadID!==bd.thread_id){tc.inform('closed-tab',wc._threadID);g.inform('chat/open-tab',{thread_id:bd.thread_id});}});}function lc(wc){wc._blocked=true;wc._sheetController.openUploadWarningTabSheet();}function mc(wc){return (wc._fileUploader.isUploading()||wc._photoUploader.isUploading());}function nc(wc){return wc._fileUploader.isUploading();}function oc(wc){var xc=wc._tabTemplate.getNode('input').value||'';if(!wb.test(xc))return true;if(wc._fileUploader.getAttachments().length>0||wc._fileUploader.getImageFiles().length>0)return true;if(n.get('chat_tab_share_sheet')&&wc._shareLinkUploader.getAttachData())return true;return false;}function pc(wc){if(wc._blocked){if(nc(wc))return;wc._blocked=false;ic(wc);wc._sheetController.closeUploadWarningTabSheet();}}function qc(wc){wc._nubController.flyoutContentChanged();wc._attachmentsDiv.scrollTop=wc._attachmentsDiv.scrollHeight;}function rc(wc,xc,yc){wc._subscriptionsHandler.addSubscriptions(wc._photoUploader.subscribe(xc,function(zc,ad){sc(wc,yc,ad);}));}function sc(wc,xc,yc){za.sendSignal(qb({qn:wc._waterfallID,step:xc,uploader:za.APP_CHAT},yc||{}));}function tc(wc,xc,yc){if(xc)oa.ensureThreadIsFetched(xc);this._threadID=wc;this._signatureID=yc;this._eventListeners=[];this._isDragDropActive=false;this._tabTemplate=hc(wc);this._tabElem=this._tabTemplate.getRoot();this._titlebar=this._getNode('nubFlyoutTitlebar');this._iconsContainerNode=this._getNode('iconsContainer');this._inputContainerNode=this._getNode('inputContainer');this._waterfallID=pb.generate();this._subscriptionsHandler=new gb();this._fileUploader=new ka(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('attachButtonForm'),this._tabTemplate.getNode('fileInput'),this._tabTemplate.getNode('attachID'));this._initializeUploader(this._fileUploader);this._initializeAutoSendPhotoUploader();this._attachmentsDiv=this._getNode('attachmentShelf');if(n.get('chat_tab_share_sheet')){this._shareLinkUploader=new s(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('input'));this._initializeUploader(this._shareLinkUploader);}this._sheetController=new w(this._threadID,this._getNode('sheet'),this._tabElem);this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();tc.inform('read',this._threadID);}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){ua.updateThreadMuteSetting(this._threadID,0);this.focus();}.bind(this));this._nubController=new xa().init(this._tabElem);this._sheetController.onResize(this._nubController.flyoutContentChanged.bind(this._nubController));this._sheetController.onTokensChanged(function(ld,md){ua.getThreadMeta(this._threadID,function(nd){this._updateInputContainers((nd.participants.length+md.token_count)>0);}.bind(this));}.bind(this));this._contextualDialogController=new o(this._threadID,this._getNode('videoCallLink'));if(yb===null)yb=!n.get('seen_autosend_photo_nux');this._messagesView=null;var zc=this._getNode('conversationLink');if(zc){z.hide(zc);sa.renderTitanLink(wc,zc,z.show.bind(z,zc));}if(!ua.getCanonicalUserInThread(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var ad=this._getCanonicalUserID(),bd=this._getNode('titlebarText'),cd=function(ld){bd.setAttribute('href',ld);bd.removeAttribute('rel');z.removeClass(bd,'noLink');};if(this._isTitleTextLinked())if(this._getCanonicalUserID()){na.get(na.getIDForUser(ad),function(ld){if(ld.href)cd(ld.href);});}else if(zc.href)cd(zc.href);var dd=this._inputContainerNode.clientHeight;ib.getInstance(this._getNode('input')).subscribe('resize',function(){var ld=this._inputContainerNode.clientHeight;if(ld!=dd)this._nubController.flyoutContentChanged();dd=ld;}.bind(this));this._nubController.subscribe('resize',function(){this._resizeInputContainer();}.bind(this));var ed=n.get('chat_tab_height');if(ed){var fd=this._tabTemplate.getNode('chatWrapper');fb.set(fd,'height',ed+'px');}this._setNameConversationLink();this._listen('closeButton','click',this._closeClicked);this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('inputContainer','click',this._inputContainerClicked);this._listen('addFriendLink','click',this._addFriendLinkClicked,true);this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);this._listen('nameConversationLink','click',this._nameConversationLinkClicked,true);this._listen('clearWindowLink','click',this._clearHistory,true);this._listen('unsubscribeLink','click',this._unsubscribeLinkClicked,true);this._listen('videoCallLink','click',this._callClicked,true);this._listen('reportSpamLink','click',this._reportSpamClicked,true);this._listen('muteThreadLink','click',ta.showMuteChangeDialog.curry(this._threadID),true);this._listen('unmuteThreadLink','click',function(){ua.updateThreadMuteSetting(this._threadID,0);kb.hide();}.bind(this),true);this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===ha.TAB){this._getNode('input').focus();event.kill();}}.bind(this));var gd=this._getNode('emoticons');this._emoticonView=null;if(gd)this._emoticonView=new wa(gd,this._getNode('input'));var hd=this._getNode('stickers');if(hd)cb.renderComponent(eb({onStickerSelect:function(ld){this._stickerSelected(ld);}.bind(this)}),hd);if(nb.firefox()&&da.locale=='ko_KR'){this._listen('input','keyup',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._privacyLink=this._getNode('privacyLink');if(this._privacyLink){this._privacyActionController=new q(ad,this._updatePrivacyLink.bind(this));this._eventListeners.push(ea.listen(this._privacyLink,'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController)));}ua.getThreadMeta(this._threadID,function(ld){var md=ad||(n.get('chat_multi_typ_send')&&!ld.is_canonical);if(md)oa.getServerThreadID(this._threadID,function(od){this._lastMessageIndicator=new lb(ad,this._getNode('input'),'mercury-chat',null,od);}.bind(this));this._setUpMutingSettings(ld);if(ja.PicassoWebChatGK){var nd=this._tabTemplate.getNode('photoAttachmentMenu');new t(this._tabTemplate.getNode('photoAttachLink'),this._tabTemplate.getNode('editPhotoLink'),this._tabTemplate.getNode('newPhotoLink'),nd,this._threadID);}}.bind(this));var id=this._getNode('muteGroupLink');if(id){var jd=ua.getCanonicalGroupInThread(this._threadID);if(jd)id.setAttribute('ajaxify',mb(id.getAttribute('ajaxify')).addQueryData({id:jd}));}r.removeEmptyHrefs(this._tabElem);xb[wc]=this;this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);var kd={threadID:wc,userID:ad,signatureID:this._signatureID};new k('/ajax/chat/opentab_tracking.php',kd).send();db.onBeforeUnload(function(){if(this._hasUnfinishedPost())return "You haven't sent your message yet. Do you want to leave without sending?";if(ma.getNumberLocalMessages(this._threadID))return "Your message is still being sent. Are you sure you want to leave?";return null;}.bind(this),false);db.onUnload(function(){uc(this);}.bind(this));}function uc(wc){if(wc._photoUploader.isUploading())sc(wc,za.CANCEL_DURING_UPLOAD);}function vc(){for(var wc in xb){xb[wc].updateAvailableStatus();xb[wc].updateMultichatTooltip();}}g.subscribe(['buddylist/availability-changed'],vc);ab.subscribe(['privacy-changed','privacy-availability-changed'],vc);m.subscribe(m.ON_CHANGED,function(){for(var wc in xb)ua.getThreadMeta(wc,function(xc){xb[wc]._updateUnreadCount(xc);});});va.addRetroactiveListener('state-changed',function(wc){for(var xc in wc){var yc=wc[xc]&&wc[xc].length,zc=xb[xc];zc&&zc.showTypingIndicator(yc);}});qa.subscribe('threads-updated',function(wc,xc){for(var yc in xb)xc[yc]&&xb[yc].updateTab();});qa.subscribe('threads-deleted',function(wc,xc){for(var yc in xb)xc[yc]&&tc.inform('thread-deleted',yc);});qb(tc,h,{get:function(wc){return xb[wc];}});qb(tc.prototype,{getThreadID:function(){return this._threadID;},showAddFriend:function(){(function(){this._sheetController.openAddFriendsSheet();}).bind(this).defer();},showPeopleSuggestions:function(){(function(){this._peopleSuggestions=new v(this._sheetController,this._getNode('conversation'),this._getNode('loadingIndicator'));}).bind(this).defer();},showNameConversation:function(wc){(function(){this._sheetController.openNameConversationSheet(wc);}).bind(this).defer();},hideAutomaticNameConversation:function(){(function(){this._sheetController.closeAutomaticNameConversationSheet();}).bind(this).defer();},isVisible:function(){return z.shown(this._tabElem);},setVisibleState:function(wc,xc){var yc=z.shown(this._tabElem),zc=z.hasClass(this._tabElem,'opened');z.conditionShow(this._tabElem,wc);z.conditionClass(this._tabElem,'opened',xc);if(!(yc&&zc)&&wc&&xc){if(!this._messagesView)this._messagesView=new u(this._threadID,this._sheetController,this._getNode('chatConv'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(yc&&zc&&!(wc&&xc))this._contextualDialogController.tabNotActive();},focus:function(){var wc=z.hasClass(this._tabElem,'opened')?'input':'dockButton';this._getNode(wc).focus();},isFocused:function(){var wc=document.activeElement;return ya.byClass(wc,"_50mz")===this._tabElem;},hasEmptyInput:function(){return wb.test(this._getNode('input').value);},getInputElem:function(){return this._getNode('input');},setInput:function(wc){this._getNode('input').value=wc;},insertBefore:function(wc){ca.insertBefore(wc._tabElem,this._tabElem);},appendTo:function(wc){ca.appendContent(wc,this._tabElem);},nextTabIs:function(wc){var xc=wc&&wc._tabElem;return this._tabElem.nextSibling==xc;},getScrollTop:function(){return ca.find(this._tabElem,'.scrollable').scrollTop;},setScrollTop:function(wc){ca.find(this._tabElem,'.scrollable').scrollTop=wc;},destroy:function(){ca.remove(this._tabElem);this._emoticonView&&this._emoticonView.destroy();while(this._eventListeners.length)this._eventListeners.pop().remove();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();this._fileUploader&&this._fileUploader.destroy();this._subscriptionsHandler&&this._subscriptionsHandler.release();this._contextualDialogController&&this._contextualDialogController.destroy();this._privacyActionController&&this._privacyActionController.destroy();delete xb[this._threadID];ba.unregisterNubController(this._nubController);ga.reset(this._getNode('input'));},updateAvailableStatus:function(){ua.getThreadMeta(this._threadID,function(wc){var xc=l.OFFLINE,yc=this._getCanonicalUserID();if(yc){xc=bb.get(yc);}else{var zc=wc.participants.map(function(bd){return na.getUserID(bd);});xc=bb.getGroup(zc);}if(!x.isOnline())xc=l.OFFLINE;if(yc)this._updateCallLink(xc);z.conditionClass(this._tabElem,"_5238",xc===l.ACTIVE);z.conditionClass(this._tabElem,"_5239",xc===l.MOBILE);var ad=this._getNode('presenceIndicator');switch(xc){case l.ACTIVE:ad.setAttribute('alt',"Online");break;case l.MOBILE:ad.setAttribute('alt',"Mobile");break;default:ad.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){this._setNameConversationLink();ua.getThreadMeta(this._threadID,function(wc){this._updateInputContainers(!sb(wc.participants));if(!wc.is_subscribed){tc.inform('unsubscribed',this._threadID);return;}sa.renderAndSeparatedParticipantList(this._threadID,[this._getNode('name'),this._getNode('titlebarText')],{names_renderer:ra.renderShortNames,check_length:true});if(wc.is_joinable&&!n.get('joinable_conversation_is_modal'))this._updateJoinableAddFriendSheet(wc);this._updateMutingSettings(wc);this._updateUnreadCount(wc);this.updateMultichatTooltip();this._updateArchiveWarning(wc);this._updateNewThread(wc);this._updateNameConversationSheet(wc);}.bind(this));},_setNameConversationLink:function(){var wc=this._getNode('nameConversationLink');if(wc)ua.isEmptyLocalThread(this._threadID)?z.hide(wc):z.show(wc);},_updateNameConversationSheet:function(wc){if(!wc.name&&!wc.is_canonical&&!wc.name_conversation_sheet_dismissed&&!ua.isEmptyLocalThread(wc.thread_id)){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateJoinableAddFriendSheet:function(wc){var xc=na.user,yc=wc.participants.filter(function(zc){return zc!=xc;});if(wc.is_joinable&&yc.length<1)this.showAddFriend();},updateSignatureID:function(wc){this._signatureID=wc;},_showPhotoNUXIfNecessary:function(){if(yb){yb=false;new j('/ajax/chat/photo_nux.php').setRelativeTo(this._getNode('photoAttachLink')).setData({threadID:this._threadID}).send();return true;}},_setUpMutingSettings:function(wc){var xc=ta.isThreadMuted(wc);if(xc)this._sheetController.openThreadIsMutedTabSheet();this._updateActionMenu(xc);},_updateMutingSettings:function(wc){var xc=ta.isThreadMuted(wc);if(xc&&z.shown(this._getNode('muteThreadLink').parentNode)){this._sheetController.openThreadIsMutedTabSheet();}else if(!xc&&z.shown(this._getNode('unmuteThreadLink').parentNode))this._sheetController.closeThreadIsMutedTabSheet();this._updateActionMenu(xc);},_updateActionMenu:function(wc){z.conditionShow(this._getNode('muteThreadLink').parentNode,!wc);z.conditionShow(this._getNode('unmuteThreadLink').parentNode,wc);},_updateArchiveWarning:function(wc){var xc=false;na.get(na.user,function(yc){xc=yc.employee;if(xc)na.getMulti(wc.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_updateInputContainers:function(wc){z.conditionShow(this._inputContainerNode,wc);z.conditionShow(this._iconsContainerNode,wc);this._resizeInputContainer();},_resizeInputContainer:function(){var wc=this._tabElem.clientWidth,xc=2,yc=wc-(this._inputContainerNode.clientWidth+xc),zc=ia.isRTL()?'left':'right';fb.set(this._iconsContainerNode,zc,yc+'px');ib.getInstance(this._getNode('input')).update();},_updateNewThread:function(wc){var xc=ua.isNewEmptyLocalThread(wc.thread_id);z.conditionShow(this._getNode('dropdown'),!xc);z.conditionShow(this._getNode('addToThreadLink'),!xc);if(xc){this.showAddFriend();if(n.get('www_chat_compose_suggestions',0))this.showPeopleSuggestions();}else if(this._peopleSuggestions){this._peopleSuggestions.destroy();this._peopleSuggestions=null;}},_showArchiveWarningIfAllParticipantsAreEmployees:function(wc){var xc=true;for(var yc in wc)xc=xc&&wc[yc].employee;var zc=this._getNode('titanArchiveWarning');if(zc){if(this._titlebarTooltipAnchor)z.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',xc);z.conditionShow(zc,xc);}},updateMultichatTooltip:function(){ua.getThreadMeta(this._threadID,function(wc){if(!wc.is_canonical)bc(this._titlebarTooltipAnchor,wc.participants);}.bind(this));},_getNode:function(wc){return this._tabTemplate.getNode(wc);},_getCanonicalUserID:function(){return ua.getCanonicalUserInThread(this._threadID);},_listen:function(wc,event,xc,yc){var zc=this._getNode(wc);if(zc){this._eventListeners.push(ea.listen(zc,event,xc.bind(this)));}else if(!yc)throw new Error('Could not find node "'+wc+'"');},_closePreClicked:function(wc){this._closeMouseDown=true;},_closeClicked:function(wc){uc(this);tc.inform('closed-tab',this._threadID);wc.kill();},_closeEnter:function(wc){if(wc.keyCode===ha.RETURN)this._closeClicked(wc);},_nubClicked:function(wc){if(!this._isDragDropActive){wc.kill();return tc.inform('nub-activated',this._threadID);}},_dockKeyDown:function(event){if(event.keyCode===ha.RETURN||event.keyCode===ha.SPACE){tc.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===ha.ESC){this._handleEscape();event.kill();}else if(event.keyCode===ha.TAB&&!event.ctrlKey){var wc=tc.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!wc&&event.kill();}},_handleEscape:function(){uc(this);if(this.hasEmptyInput()){tc.inform('esc-pressed',this._threadID);}else{var wc="Are you sure you want to close this chat window?",xc="You haven't sent your message.",yc=new aa().setTitle(wc).setBody(xc).setButtons([aa.CLOSE,aa.CANCEL]).setHandler(tc.inform.bind(tc,'esc-pressed',this._threadID,null)).setModal(true).show(),zc=yc.getButtonElement('yes');zc&&fa.set(zc);}},_handlePhotoUploadFailed:function(){var wc="Photo Upload Failed",xc="Please try again. Make sure you are uploading a valid photo.";new aa().setTitle(wc).setBody(xc).setButtons(aa.OK).show();},_isTitleTextLinked:function(){return n.get('chat_tab_title_link_timeline');},_titleClicked:function(event){var wc=event.getTarget(),xc=ya.byClass(wc,'titlebarText'),yc=xc&&this._isTitleTextLinked();if(!yc&&!ya.byClass(wc,'uiSelector')&&!ya.byClass(wc,'addToThread')&&!this._isDragDropActive){tc.inform('lower-activated',this._threadID);event.kill();}},_callClicked:function(wc){var xc=this._getCanonicalUserID();if(ob.availableForCall(xc)){var yc='chat_tab_icon';if(wc.target&&z.hasClass(wc.target,'video_call_promo')){yc='chat_tab_icon_promo';}else if(wc.target&&z.hasClass(wc.target,'video_call_tour'))yc='chat_tab_icon_tour';tc.inform('video-call-clicked',{threadID:this._threadID,userID:xc,clickSource:yc});}return false;},_addFriendLinkClicked:function(){this.showAddFriend();},_nameConversationLinkClicked:function(){this.showNameConversation();},_clearHistory:function(){var wc=ua.getThreadMetaNow(this._threadID);if(wc){var xc=this._getCanonicalUserID();oa.clearChat(this._threadID,xc,wc.timestamp);}},_unsubscribeLinkClicked:function(){var wc=[];wc.push({name:'unsubscribe',label:"Leave Conversation",handler:this._unsubscribeToThread.bind(this)});wc.push(aa.CANCEL);new aa().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(wc).show();},_reportSpamClicked:function(){var wc=this._getCanonicalUserID(),xc=mb('/ajax/chat/report.php').addQueryData({id:wc}).addQueryData({src:'top_report_link'});i.send(new j(xc));},_focusTab:function(){z.addClass(this._tabElem,'focusedTab');if(this._peopleSuggestions)this._peopleSuggestions.clearSuggestions();this.tryMarkAsRead();this._contextualDialogController.tabFocused();if(!zb&&this._showPhotoNUXIfNecessary())g.subscribe(['ChatNUX/show','ChatNUX/hide'],function(event){zb=event==='ChatNUX/show';});this._closeMouseDown=false;this._setCloseTooltip(true);tc.inform('focus-tab',this._threadID);},_blurTab:function(){z.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(wc){var xc=this._getNode('titlebarCloseButton'),yc=wc?"Press Esc to close":"Close tab";jb.set(xc,yc,'above');},_inputKeyDown:function(event){if(event.keyCode===ha.RETURN&&!event.shiftKey){if(nc(this)){lc(this);event.kill();return;}ic(this);event.kill();return;}if(event.keyCode===ha.DOWN&&event.shiftKey&&this._getNode('input').value===''){tc.inform('lower-activated',this._threadID);event.kill();return;}this._handleHotkeyPressed(event);},_hasUnfinishedPost:function(){return oc(this)||mc(this);},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){tc.inform('read',this._threadID);return true;}return false;},_chatConvClicked:function(wc){this.tryMarkAsRead();if(ya.byTag(wc.getTarget(),'a')||ca.getSelection())return;this.focus();},_inputContainerClicked:function(wc){this.tryMarkAsRead();this.focus();},showTypingIndicator:function(wc){var xc=ua.getThreadMetaNow(this._threadID),yc=this._getCanonicalUserID()||(n.get('chat_multi_typ')&&xc&&!xc.is_canonical);if(yc)z.conditionClass(this._tabElem,'typing',wc);},_updateUnreadCount:function(wc){var xc=wc.unread_count;if(typeof xc!='undefined'){var yc=!!xc&&(!m.showsTabUnreadUI||m.showsTabUnreadUI()),zc=this._getNode('numMessages');z.conditionShow(zc,yc);z.conditionClass(this._tabElem,'highlightTab',yc);fc(this._threadID,this._tabElem,yc);ca.setContent(zc,xc);}},_updateCallLink:function(wc){var xc=this._getNode('videoCallLink');if(x.isOnline()){var yc=this._getCanonicalUserID(),zc='fbid:'+yc;na.get(zc,function(ad){if(ob.availableForCall(yc)){jb.set(xc,ub._("Start a video call with {firstname}",{firstname:ad.short_name}));this._updateCallBackLinks(this._tabElem,true);}else{jb.set(xc,ub._("{firstname} is currently unavailable for video calling",{firstname:ad.short_name}));this._hideVideoCallouts();this._updateCallBackLinks(this._tabElem,false);}}.bind(this));}else{jb.set(xc,"You must be online to make a call.");this._hideVideoCallouts();this._updateCallBackLinks(document.body,false);}},_updateCallBackLinks:function(wc,xc){var yc=ca.scry(wc,'a.callBackLink');if(xc){yc.forEach(z.show);}else yc.forEach(z.hide);},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_updatePrivacyLink:function(wc){if(wc==q.OFFLINE){ca.setContent(this._privacyLink,"Go online");}else{var xc=this._getCanonicalUserID(),yc='fbid:'+xc;na.get(yc,function(zc){var ad=null;if(wc==q.BLOCKED){ad=ub._("Turn On Chat for {name}",{name:zc.short_name});}else ad=ub._("Turn Off Chat for {name}",{name:zc.short_name});ca.setContent(this._privacyLink,ad);}.bind(this));}},_unsubscribeToThread:function(){if(ua.isEmptyLocalThread(this._threadID)){tc.inform('unsubscribed',this._threadID);}else{var wc=ma.constructLogMessageObject(pa.CHAT_WEB,this._threadID,la.UNSUBSCRIBE,{});ma.sendMessage(wc);}return true;},_initializeUploader:function(wc){this._subscriptionsHandler.addSubscriptions(wc.subscribe(['all-uploads-completed','upload-canceled'],function(){pc(this);}.bind(this)),wc.subscribe('dom-updated',function(){qc(this);}.bind(this)),wc.subscribe('submit',function(){this._getNode('input').focus();}.bind(this)));},_initializeAutoSendPhotoUploader:function(){this._photoUploader=new p(this._tabTemplate.getNode('photoAttachButtonForm'),this._tabTemplate.getNode('photoFileInput'),this._tabTemplate.getNode('photoAttachID'));rc(this,'submit',za.UPLOAD_START);rc(this,'all-uploads-completed',za.ALL_UPLOADS_DONE);rc(this,'all-uploads-failed',za.CLIENT_ERROR);this._subscriptionsHandler.addSubscriptions(this._photoUploader.subscribe('submit',function(wc,xc){kc(this,'',[],function(yc){ma.updateNewMessage(yc,xc.upload_id,xc);ma.sendMessage(yc);});this._getNode('input').focus();}.bind(this)),this._photoUploader.subscribe('all-uploads-failed',function(wc,xc){var yc=ma.updateMessageAfterUpload(xc.upload_id,xc);ma.clearUploadedMessage(xc.upload_id);ma.deleteMessages(yc.thread_id,[yc.message_id]);ma.deleteLocalMessage(yc.thread_id);this._handlePhotoUploadFailed();}.bind(this)),this._photoUploader.subscribe('all-uploads-completed',function(wc,xc){var yc=ma.updateMessageAfterUpload(xc.upload_id,xc);ma.clearUploadedMessage(xc.upload_id);ma.sendMessage(yc);var zc=xc.image_ids.length||xc.attachments.length;jc(this,zc);}.bind(this)),g.subscribe('ChatPhotoEditor/save'+this._threadID,function(wc,xc){this._photoUploader.uploadFile(xc);}.bind(this)));},_stickerSelected:function(wc){kc(this,'',[],function(xc){xc.has_attachment=true;xc.sticker_id=wc;ma.sendMessage(xc);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonView:null});e.exports=tc;});
__d("ChatNewMessageHandler",["ArbiterMixin","ChatActivity","ChatTabModel","ChatTabView","JSLogger","MercuryAssert","MercuryBrowserAlerts","MercuryUnseenState","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatActivity'),i=b('ChatTabModel'),j=b('ChatTabView'),k=b('JSLogger'),l=b('MercuryAssert'),m=b('MercuryBrowserAlerts'),n=b('MercuryUnseenState').get(),o=b('copyProperties'),p=k.create('chat_new_message'),q={_raiseNewMessageTab:function(r,s){var t=i.getTab(r),u=false;if(t){u=t.raised;}else u=true;q.inform('chat/new-message-from-server',{thread_id:r});s.to_new_tab=!t;s.to_raised_tab=!!u;},_notify:function(r,s,t){var u=j.get(r);t.view_is_visible=u&&u.isVisible();t.view_is_focused=u&&u.isFocused();if(!t.view_is_visible)p.log('message_to_hidden');t.is_active=h.isActive();m.messageReceived(s);},newMessage:function(r,s,t){l.isThreadID(r);var u={thread_id:r,message_id:s.message_id};this._raiseNewMessageTab(r,u);this._notify(r,s,u);p.log('message',u);}};o(q,g);m.subscribe('before-alert',function(r,event){var s=event.threadID,t=j.get(s),u=i.getTab(s);if(u&&u.raised&&t&&t.isVisible()&&t.isFocused()&&t.tryMarkAsRead()){n.markThreadSeen(s);event.cancelAlert();}});e.exports=q;});
__d("ChatTabPresence",["AvailableList","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('ChatTabModel'),i=b('MercuryThreads').get(),j={};function k(l){var m=i.getCanonicalUserInThread(l);if(m)g.updateForID(m);}h.subscribe('chat/tabs-changed',function(event,l){l.tabs.forEach(function(m){if(m.raised&&!j[m.id])k(m.id);});j={};l.tabs.forEach(function(m){if(m.raised)j[m.id]=true;});});e.exports={};});
__d("ChatTabLRUManager",["ChatTabView","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f){var g=b('ChatTabView'),h=b('ChatTabModel'),i=b('MercuryThreads').get(),j={getLRUVisibleTab:function(k){if(k.hasRoomForRaisedTab())return undefined;var l=Object.keys(k.getTabsToShow()||{}),m=1*60,n=null,o=Infinity;for(var p=0;p<l.length;p++){var q=l[p],r=i.getThreadMetaNow(q);if(h.isTabPromoted(q))continue;if(!g.get(q).hasEmptyInput()||!r)continue;var s=(h.getServerTime()-r.timestamp)/1000;if(!r.timestamp||(r.timestamp&&r.timestamp<o&&s>m)){n=r.thread_id;o=r.timestamp;}}return n;}};e.exports=j;});
__d("ChatTabPolicy",["ChatBehavior","FBDesktopPlugin","JSLogger","MercuryActionTypeConstants","MercuryAssert","MercuryParticipants","MercuryParticipantTypes","MercurySourceType","MercuryThreadMode","MercuryThreadMuter","MercuryUnseenState","MessagingTag","PresencePrivacy","ShortProfiles"],function(a,b,c,d,e,f){var g=b('ChatBehavior'),h=b('FBDesktopPlugin'),i=b('JSLogger'),j=b('MercuryActionTypeConstants'),k=b('MercuryAssert'),l=b('MercuryParticipants'),m=b('MercuryParticipantTypes'),n=b('MercurySourceType'),o=b('MercuryThreadMode'),p=b('MercuryThreadMuter'),q=b('MercuryUnseenState').get(),r=b('MessagingTag'),s=b('PresencePrivacy'),t=b('ShortProfiles'),u=i.create('tab_policy');function v(w,x){q.markThreadSeen(w,x);}e.exports={messageIsAllowed:function(w,x,y){var z=w.thread_id,aa=x.message_id;k.isThreadID(z);k.isParticipantID(x.author);var ba;if(p.isThreadMuted(w)){ba={thread_id:z,message_id:aa,mute_settings:w.mute_settings};u.log('message_thread_muted',ba);return;}if(w.mode==o.OBJECT_ORIGINATED){ba={thread_id:z,message_id:aa,mode:w.mode};u.log('message_object_originated',ba);return;}if(x.source==n.EMAIL||x.source==n.TITAN_EMAIL_REPLY){ba={thread_id:z,message_id:aa,source:x.source};u.log('message_source_not_allowed',ba);return;}var ca=l.getUserID(x.author);if(!ca){u.log('message_bad_author',{thread_id:z,message_id:aa,user:ca});return;}if(x.action_type!=j.USER_GENERATED_MESSAGE){ba={thread_id:z,message_id:aa,type:x.action_type};u.log('message_non_user_generated',ba);return;}if(w.is_canonical_user&&!g.notifiesUserMessages()){u.log('message_jabber',{thread_id:z,message_id:aa});v(z,true);return;}if(w.is_canonical&&!w.canonical_fbid){u.log('message_canonical_contact',{thread_id:z,message_id:aa});return;}if(h.shouldSuppressMessages()){u.log('message_desktop',{thread_id:z,message_id:aa});return;}if(w.folder!=r.INBOX){u.log('message_folder',{thread_id:z,message_id:aa,folder:w.folder});return;}var da=l.getUserID(l.user);t.getMulti([ca,da],function(ea){if(!s.allows(ca)){u.log('message_privacy',{thread_id:z,message_id:aa,user:ca});return;}var fa=ea[ca].employee&&ea[da].employee;if(!fa&&ea[ca].type!==m.FRIEND){u.log('message_non_friend',{thread_id:z,message_id:aa,user:ca});return;}y();});}};});
__d("ChatTabViewSelector",["Event","Arbiter","CSS","DataStore","DOM","MenuDeprecated","MercuryThreadInformer","MercuryThreads","NubController","ChatTabTemplates","MercuryThreadMetadataRenderer","Toggler","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('MenuDeprecated'),m=b('MercuryThreadInformer').get(),n=b('MercuryThreads').get(),o=b('NubController'),p=b('ChatTabTemplates'),q=b('MercuryThreadMetadataRenderer').get(),r=b('Toggler'),s=b('copyProperties');function t(u){var v=p[':fb:chat:tab:selector'].build(),w=v.getRoot(),x=v.getNode('menu'),y=k.find(x,'.uiMenuInner'),z={},aa=new o().init(w);i.hide(w);k.insertBefore(u,w);function ba(ea){var fa=0;for(var ga in z){var ha=z[ga],ia=n.getThreadMetaNow(ga),ja=ha.getNode('unreadCount'),ka=(ia&&ia.unread_count)||0;fa+=ka;if(ka>9)ka='+';i.conditionClass(ja,'invisible_elem',!ka);k.setContent(ja,ka);}var la=v.getNode('numMessages');i.conditionShow(la,fa);k.setContent(la,fa);}this.setTabData=function(ea){z={};if(ea.length<1){i.hide(w);return;}i.show(w);k.empty(y);ea.forEach(function(fa){var ga=p[':fb:chat:tab:selector:item'].build();z[fa.id]=ga;var ha=ga.getNode('content');q.renderAndSeparatedParticipantList(fa.id,ha);k.prependContent(y,ga.getRoot());j.set(ga.getRoot(),'threadID',fa.id);var ia=ga.getNode('closeButton');g.listen(ia,'click',function(event){t.inform('selector/close-tab',fa.id);event.kill();});});aa.flyoutContentChanged();k.setContent(v.getNode('numTabs'),ea.length);ba();};function ca(event,ea){if(ea.menu!=x)return;var fa=j.get(ea.item,'threadID');t.inform('selected',fa);r.hide(w);}function da(event,ea){l.register(x);}l.subscribe('select',ca.bind(this));r.listen('show',w,function(){h.inform('layer_shown',{type:'ChatTabSelector'});da();});r.listen('hide',w,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});m.subscribe('threads-updated',ba);}s(t,new h());e.exports=t;});
__d("ChatTabController",["ChatTabPresence","ChatTypeaheadBehavior","Arbiter","ChatActivity","ChatConfig","ChatNewMessageHandler","ChatTabLRUManager","ChatTabMessagesView","ChatTabModel","ChatTabPolicy","ChatTabView","ChatTabViewSelector","JSLogger","MercuryParticipants","MercuryThreadInformer","MercuryThreads","MercuryUnseenState","Style","UserAgent","VideoCallCore"],function(a,b,c,d,e,f){b('ChatTabPresence');b('ChatTypeaheadBehavior');var g=b('Arbiter'),h=b('ChatActivity'),i=b('ChatConfig'),j=b('ChatNewMessageHandler'),k=b('ChatTabLRUManager'),l=b('ChatTabMessagesView'),m=b('ChatTabModel'),n=b('ChatTabPolicy'),o=b('ChatTabView'),p=b('ChatTabViewSelector'),q=b('JSLogger'),r=b('MercuryParticipants'),s=b('MercuryThreadInformer').get(),t=b('MercuryThreads').get(),u=b('MercuryUnseenState').get(),v=b('Style'),w=b('UserAgent'),x=b('VideoCallCore'),y=i.get('tab_auto_close_timeout')||7200000,z=q.create('tab_controller');function aa(na){t.changeThreadReadStatus(na,true);ba(na);}function ba(na){u.markThreadSeen(na);}function ca(na,oa,pa){var qa=m.get().tabs;na+=oa?1:-1;while(na>=0&&na<qa.length){var ra=qa[na],sa=o.get(ra.id);if(sa&&sa.isVisible()&&(!pa||ra.raised)){sa.focus();return true;}na+=oa?1:-1;}return false;}function da(na,oa){var pa=oa&&oa.getRightmostHiddenTab();if(pa===na)return null;return pa;}function ea(na,oa,pa,qa){if(i.get('chat_tabs_management')){m.raiseTab(na,true,pa);var ra=oa&&oa.getLeftmostVisibleTab(),sa=oa&&oa.getTabsToShow();if(sa&&!sa[na]&&ra){m.promoteThreadInPlaceOfThread(na,ra,da(na,oa),true);}else m.setPromotedTab(na);}else{var ta=qa||oa.shouldPromoteOnRaise(na);g.inform("chat/promote-tab",na);if(ta){m.raiseAndPromoteTab(na,true,pa);}else m.raiseTab(na,true,pa);}var ua=o.get(na);ua&&ua.focus();}function fa(na,oa,pa){var qa=pa.forceDrop();if(!m.getTab(na))m.raiseTab(na,false);if(qa)return;var ra=oa&&k.getLRUVisibleTab(oa),sa=oa&&oa.getTabsToShow();if(sa&&!sa[na]&&ra)m.promoteThreadInPlaceOfThread(na,ra,da(na,oa));}function ga(na,oa){var pa=m.indexOf(na);m.closeTab(na,oa);return pa;}function ha(na,oa){j.subscribe('chat/new-message-from-server',function(qa,ra){fa(ra.thread_id,na,oa);});p.subscribe('selected',function(qa,ra){ea(ra,na);});g.subscribe('chat/open-tab',function(qa,ra){ea(ra.thread_id,na,ra.signature_id);});g.subscribe('chat/tabs-order-changed',function(qa,ra){m.changeShowingTabs(ra);});g.subscribe('page_transition',function(qa,ra){m.closeFragileTabs();});o.subscribe('read',function(event,qa){aa(qa);});h.subscribe('idle',function(qa,ra){if(ra>y){var sa=m.get().tabs;sa.forEach(function(ta){var ua=ta.id;t.getThreadMeta(ua,function(va){if(!va.unread_count){z.log('autoclose_idle_seen',{thread_id:ua,idleness:ra});m.closeTab(ua,'autoclose_idle_seen');}});});}});o.subscribe('nub-activated',function(qa,ra){ea(ra,na);});o.subscribe('lower-activated',function(qa,ra){m.lowerTab(ra);var sa=o.get(ra);sa&&sa.focus();});o.subscribe('focus-tab',function(qa,ra){var sa=m.getTab(ra);if(sa&&sa.raised)ea(ra,na,sa.signatureID,true);});function pa(qa,ra){x.showOutgoingCallDialog(ra.userID,ra.clickSource);m.lowerTab(ra.threadID);}o.subscribe('video-call-clicked',pa);l.subscribe('video-call-clicked',pa);l.subscribe('interaction-with-tab',function(qa,ra){var sa=m.getTab(ra);sa&&sa.raised&&ba(ra);});o.subscribe('closed-tab',function(qa,ra){z.log('close_view',{thread_id:ra});ga(ra,'close_view');return false;});o.subscribe('thread-deleted',function(qa,ra){z.log('close_thread_deleted',{thread_id:ra});ga(ra,'close_thread_deleted');return false;});o.subscribe('unsubscribed',function(qa,ra){z.log('close_view_unsubscribed',{thread_id:ra});ga(ra,'close_view_unsubscribed');return false;});o.subscribe('esc-pressed',function(qa,ra){z.log('close_esc',{thread_id:ra});var sa=ga(ra,'close_esc');(function(){ca(sa-1,true,true)||ca(sa,false,true);}).defer();});p.subscribe('selector/close-tab',function(qa,ra){z.log('close_chat_from_selector',{thread_id:ra});ga(ra,'close_chat_from_selector');});s.subscribe('messages-received',function(qa,ra){for(var sa in ra){var ta=ra[sa];for(var ua=0;ua<ta.length;ua++){var va=ta[ua];if(va.author!=r.user){if(!va.is_unread){z.log('message_already_read',{action_id:va.action_id,thread_id:va.thread_id});continue;}t.getThreadMeta(sa,function(wa){n.messageIsAllowed(wa,va,function(){j.newMessage(sa,va,na);});});}}}});s.subscribe('thread-read-changed',function(qa,ra){for(var sa in ra)if(!ra[sa].mark_as_read){z.log('autoclose_marked_unread',{thread_id:sa});m.closeTab(sa,'autoclose_marked_unread');}});o.subscribe('tab-pressed',function(qa,ra){return !ca(m.indexOf(ra.id),ra.shiftPressed);});g.subscribe(q.DUMP_EVENT,function(qa,ra){ra.chat_controller={auto_close_timeout:y};});}if(w.firefox()){var ia=function(){return v.get(document.body,'overflowX')+' '+v.get(document.body,'overflowY');},ja=ia(),ka=function(){var na=ia();if(na!==ja){ja=na;g.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var la=new MutationObserver(ka),ma={attributes:true,attributeFilter:['class','style']};la.observe(document.documentElement,ma);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))ka();},false);}e.exports=ha;});
__d("ChatTabViewCoordinator",["Arbiter","Bootloader","ChatConfig","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","JSLogger","Style","Rect","VideoCallCore","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Bootloader'),i=b('ChatConfig'),j=b('ChatTabModel'),k=b('ChatTabView'),l=b('ChatTabViewSelector'),m=b('CSS'),n=b('JSLogger'),o=b('Style'),p=b('Rect'),q=b('VideoCallCore'),r=b('copyProperties'),s=n.create('chat_tab_coordinator'),t,u;function v(w,x){var y=new l(w),z={},aa={},ba=false;function ca(){var oa=j.get(),pa={};oa.tabs.forEach(function(ra){pa[ra.id]=1;});s.log('process_tab_changed',{model_tabs:Object.keys(pa),view_tabs:Object.keys(z)});for(var qa in z)if(!pa[qa]){s.log('remove_tab',{tab_id:qa});z[qa].destroy();delete(z[qa]);}da(oa);ma(oa);if(oa.tabNeedsFocus&&!oa.tabNeedsFocus.isFocused())oa.tabNeedsFocus.focus();}function da(oa){var pa=null;oa.tabs.forEach(function(qa){var ra=qa.id,sa=false;if(!z[ra]){s.log('add_tab',{tab_id:ra});z[ra]=new k(ra,qa.server_id,qa.signatureID);sa=true;}else z[ra].updateSignatureID(qa.signatureID);if(z[ra].isFocused())oa.tabNeedsFocus=z[ra];if(sa||!z[ra].nextTabIs(pa)){var ta=z[ra].getScrollTop();if(pa){z[ra].insertBefore(pa);}else z[ra].appendTo(w);if(ta)z[ra].setScrollTop(ta);}pa=z[ra];});}function ea(){var oa=x.getShowingTabsOrder();if(!oa||!oa.length)return;var pa=z[oa[0].id]._tabElem,qa=z[oa[oa.length-1].id]._tabElem,ra=parseInt(o.get(qa,'margin-left'),10)||0,sa=p.getElementBounds(qa).l-2*ra;sa=sa>0?sa:0;t&&t.setBoundingBox(new p(0,p.getElementBounds(pa).r,0,sa));}function fa(oa,pa){var qa=false;pa.forEach(function(ta){if(ta.raised){if(aa[ta.id]){qa=true;delete aa[ta.id];}}else if(!aa[ta.id]){qa=true;aa[ta.id]=true;}});if(qa)return true;if(!t)return true;var ra=ga()||[];if(ra.length!==oa.length)return true;for(var sa=0;sa<oa.length;sa++)if(ra[sa]!==oa[sa].id)return true;return false;}function ga(){var oa=t&&t.getOrder();oa&&oa.reverse();return oa;}function ha(){var oa=ga();oa&&g.inform('chat/tabs-order-changed',oa);}function ia(oa,pa,qa){if(z[qa]._scrollTop!=null)z[qa].setScrollTop(z[qa]._scrollTop);}function ja(oa,pa){u=pa;z[pa]._isDragDropActive=true;z[pa]._scrollTop=z[pa].getScrollTop();o.set(z[pa]._tabElem,'z-index',1);ea();}function ka(oa){o.set(z[oa]._tabElem,'z-index','');if(z[oa]._scrollTop!=null)z[oa].setScrollTop(z[oa]._scrollTop);z[oa]._scrollTop=null;u=null;(function(){z[oa]._isDragDropActive=false;}).defer();}function la(oa){if(!i.get('chat_tabs_management'))return;h.loadModules(['SortableGroup'],function(pa){var qa=x.getShowingTabsOrder(),ra=fa(qa,oa);if(qa.length<=1){t&&t.removeAllSortables();return;}if(ra){if(t){t.removeAllSortables();}else t=new pa().setBeforeGrabCallback(ja).setDragOverCallback(ia).setDropCallback(ka).setOrderChangeHandler(ha).setUseScroller(false).setDragOverHorizontally();for(var sa=0;sa<qa.length;sa++){var ta=qa[sa];t.addSortable(ta.id,z[ta.id]._tabElem,aa[ta.id]?null:z[ta.id]._titlebar);}}});}function ma(oa){var pa=x.getTabsToShow(oa),qa=[],ra=false;oa.tabs.forEach(function(sa){if(!pa[sa.id]){z[sa.id].setVisibleState(false,sa.raised);qa.push(sa);}});oa.tabs.forEach(function(sa){if(pa[sa.id]){z[sa.id].setVisibleState(true,sa.raised);ra|=sa.raised;}});y.setTabData(qa);na(ra);la(oa.tabs);}function na(oa){if(!oa&&ba){g.inform('layer_hidden',{type:'ChatTab'});ba=false;}else if(oa&&!ba){g.inform('layer_shown',{type:'ChatTab'});ba=true;}}if(q.isSupported())m.addClass(w,'videoCallEnabled');x.subscribe('tabs-changed',ca);ca();}r(v.prototype,{forceDrop:function(){if(t&&u){t.forceDrop(u);u=null;return true;}return false;}});e.exports=v;});
__d("XLinkshimLogControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/si\/ajax\/l\/render_linkshim_log\/",{u:{type:"String",required:true},h:{type:"String",required:true},render_verification:{type:"Bool"},enc:{type:"String"}});});
__d("LinkshimHandler",["Event","LinkshimAsyncLink","LinkshimHandlerConfig","URI","XLinkshimLogControllerURIBuilder","shield"],function(a,b,c,d,e,f){var g=b('Event'),h=b('LinkshimAsyncLink'),i=b('LinkshimHandlerConfig'),j=b('URI'),k=b('XLinkshimLogControllerURIBuilder'),l=b('shield'),m={setUpLinkshimHandling:function(s){try{var u=j(s.getAttribute('href')),v=n(u);if(v&&o(u)){g.listen(s,'mouseover',l(h.swap,null,s,v));var w=q(u);g.listen(s,'click',function(){if(i.supports_meta_referrer){h.referrer_log(s,w,p(u).toString());}else h.swap(s,u);});}}catch(t){}}};function n(s){return s.getQueryData().u?new j(s.getQueryData().u):null;}function o(s){return s.getQueryData().hasOwnProperty('s');}function p(s){var t=s.getQueryData().hasOwnProperty('enc')?s.getQueryData().enc:'';return (new k()).setString('u',s.getQueryData().u).setString('h',s.getQueryData().h).setBool('render_verification',s.getQueryData().hasOwnProperty('render_verification')).setString('enc',t).getURI();}function q(s){var t;if(r()){t=j(s).addQueryData({render_verification:true});}else t=n(s);return t;}function r(){var s=i.render_verification_rate||0;return Math.floor(Math.random()*s+1)===s;}e.exports=m;});