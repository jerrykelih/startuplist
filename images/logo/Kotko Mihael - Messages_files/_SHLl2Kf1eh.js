/*!CK:2983146409!*//*1384744670,173220921*/

if (self.CavalryLogger) { CavalryLogger.start_js(["z034d"]); }

__d("legacy:UIControllerRegistry",[],function(a,b,c,d){a.__UIControllerRegistry=a.__UIControllerRegistry||{};},3);
__d("UIIntentionalStreamRefresh",["Arbiter","LiveTimer","Run","UIIntentionalStreamMessage","UserActivity","DOM","coalesce","copyProperties","csx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('LiveTimer'),i=b('Run'),j=b('UIIntentionalStreamMessage'),k=b('UserActivity'),l=b('DOM'),m=b('coalesce'),n=b('copyProperties'),o=b('csx');function p(q,r){this.isAutoRefreshing=false;this.lastRefresh=Date.now();p.instance=this;this.setAutoRefreshConfig(q);this.updateConfigHandler=g.subscribe(j.UPDATE_AUTOREFRESH_CONFIG,this.updateAutoRefreshConfig.bind(this));this.updateRefreshTimeHandler=g.subscribe(j.UPDATE_LAST_REFRESH_TIME,this.updateLastRefreshTime.bind(this));i.onLeave(this.unload.bind(this));this.userActivity();this.uaToken=k.subscribe(this.userActivity.bind(this));this.autoRefreshInterval=setInterval(this.checkAutoPageRefresh.bind(this),this.checkAutoRefreshTimeInterval);this.activeRefreshInterval=setInterval(this.checkActiveRefresh.bind(this),this.checkActiveRefreshTimeInterval);this.enableAutoRefresh(r);g.subscribe(j.UPDATE_STREAM,h.loop.bind(h,true));g.subscribe(j.REFRESH_STREAM,h.loop.bind(h,true));this.feedAdsDialogHandler=g.subscribe(['FeedProfileQuestionAnswered','ProfileQuestionAnswered'],this.refreshFeedAdsDialog.bind(this));}n(p,{DISABLE_AUTOREFRESH_TIME:4*60*1000,CHECK_AUTOREFRESH_INTERVAL:5*60*1000,AUTOREFRESH_INACTIVE_TIME:30*60*1000,CHECK_ACTIVE_REFRESH_TIME:5*60*1000,ACTIVE_REFRESH_TIME:30*1000});n(p.prototype,{updateAutoRefreshConfig:function(q,r){if(q==j.UPDATE_AUTOREFRESH_CONFIG)this.setAutoRefreshConfig(r);},updateLastRefreshTime:function(q){if(q==j.UPDATE_LAST_REFRESH_TIME)this.lastRefresh=Date.now();},refreshFeedAdsDialog:function(q,r){l.scry(document.body,".personalizeStreamAds").forEach(function(s){l.replace(s,r);});},setAutoRefreshConfig:function(q){q=q||{};var r=24*60*60*1000;if(!this.storyInterval)this.storyInterval=m(q.story_interval,null);this.allowAutoRefresh=m(q.allow_auto_refresh,false);this.inactiveThreshold=m(q.inactive_threshold,0);this.activeRefreshTime=m(q.fast_refresh_rate,r);this.inactiveRefreshTime=m(q.slow_refresh_rate,r);this.allowPolling=m(q.allow_polling,false);this.refreshFactor=m(q.refresh_factor,10);this.minRefreshInterval=m(q.min_refresh_interval,60*1000);this.activeRefresh=m(q.active_refresh,false);this.checkActiveRefreshTimeInterval=m(q.check_active_refresh_interval,p.CHECK_ACTIVE_REFRESH_TIME);this.activeRefreshTimeInterval=m(q.active_refresh_interval,p.ACTIVE_REFRESH_TIME);this.disableAutoRefreshTime=m(q.disable_autorefresh_time,p.DISABLE_AUTOREFRESH_TIME);this.checkAutoRefreshTimeInterval=m(q.check_autorefresh_time_interval,p.CHECK_AUTOREFRESH_INTERVAL);this.autoRefreshInactiveTime=m(q.autorefresh_inactive_time,p.AUTOREFRESH_INACTIVE_TIME);return this;},unload:function(){this.enableAutoRefresh(false);this.cleanupRefreshInterval();k.unsubscribe(this.uaToken);this.updateConfigHandler&&this.updateConfigHandler.unsubscribe();this.updateRefreshTimeHandler&&this.updateRefreshTimeHandler.unsubscribe();this.feedAdsDialogHandler&&this.feedAdsDialogHandler.unsubscribe();},userActivity:function(){var q=this.isInactive();this.lastActivity=Date.now();this.isAutoRefreshing=true;if(q&&this.canAutoRefresh())this.runAutoRefresh();return true;},isInactive:function(){return this.getMSSinceLastActivity()>this.inactiveThreshold;},getMSSinceLastActivity:function(){return Date.now()-this.lastActivity;},getMSSinceLastRefresh:function(){return Date.now()-this.lastRefresh;},getRefreshInterval:function(){if(this.isInactive()){return this.inactiveRefreshTime;}else if(this.storyInterval!=null){var q=this.storyInterval*this.refreshFactor;return Math.max(q,this.activeRefreshTime);}else return this.activeRefreshTime;},canAutoRefresh:function(){return this.isAutoRefreshing&&this.allowAutoRefresh;},cancelUpdate:function(){if(this.updateTask){clearTimeout(this.updateTask);this.updateTask=null;}},runUpdatePoll:function(){this.updateTask=null;if(this.canAutoRefresh())this.runAutoRefresh();},runAutoRefresh:function(){var q=50;if(this.getMSSinceLastRefresh()>=this.minRefreshInterval-q)g.inform(j.UPDATE_STREAM);this.schedulePoll(this.getRefreshInterval());},schedulePoll:function(q){this.cancelUpdate();if(this.allowPolling)this.updateTask=setTimeout(this.runUpdatePoll.bind(this),q);},enableAutoRefresh:function(q,r){this.isAutoRefreshing=q;if(q){var s=r?0:this.getRefreshInterval();this.schedulePoll(s);}else this.cancelUpdate();},checkAutoPageRefresh:function(){if(!this.allowAutoRefresh)return;if(this.isAutoRefreshing&&(this.getMSSinceLastActivity()>this.disableAutoRefreshTime))this.isAutoRefreshing=false;if(this.getMSSinceLastRefresh()<this.autoRefreshInactiveTime)return;var q=this.getMSSinceLastActivity();if(q>this.autoRefreshInactiveTime)g.inform(j.REFRESH_STREAM,{});},checkActiveRefresh:function(){if(!this.allowAutoRefresh)return;if(this.getMSSinceLastRefresh()<this.activeRefreshTimeInterval)return;if(this.getMSSinceLastActivity()<this.activeRefreshTimeInterval)g.inform(j.UPDATE_STREAM);},cleanupRefreshInterval:function(){if(this.autoRefreshInterval){clearInterval(this.autoRefreshInterval);this.autoRefreshInterval=null;}if(this.activeRefreshInterval){clearInterval(this.activeRefreshInterval);this.activeRefreshInterval=null;}}});e.exports=p;});
__d("UIIntentionalStream",["Animation","Arbiter","AsyncRequest","AsyncResponse","CSS","DataStore","DOM","DOMScroll","Event","HTML","JSLogger","NavigationMessage","OnVisible","PageTransitions","Run","ScrollAwareDOM","Style","UIIntentionalStreamMessage","UIIntentionalStreamRefresh","UIPagelet","URI","Vector","$","coalesce","copyProperties","createArrayFrom","ge","isEmpty","merge","reportData","startsWith"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncResponse'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('DOMScroll'),o=b('Event'),p=b('HTML'),q=b('JSLogger'),r=b('NavigationMessage'),s=b('OnVisible'),t=b('PageTransitions'),u=b('Run'),v=b('ScrollAwareDOM'),w=b('Style'),x=b('UIIntentionalStreamMessage'),y=b('UIIntentionalStreamRefresh'),z=b('UIPagelet'),aa=b('URI'),ba=b('Vector'),ca=b('$'),da=b('coalesce'),ea=b('copyProperties'),fa=b('createArrayFrom'),ga=b('ge'),ha=b('isEmpty'),ia=b('merge'),ja=b('reportData'),ka=b('startsWith');function la(){h.subscribe(x.SET_AUTO_INSERT,ma);}function ma(oa,pa){if(oa!=x.SET_AUTO_INSERT)return;var qa=na.instance;if(qa)qa.pauseAutoInsert=pa.pause;}function na(oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya){if(!oa)throw new Error('UIIntentionalStream instantiated with no root.');ea(this,{id:oa.id,root:oa,instanceName:pa,newest:qa,oldest:ra,oldestMR:ra,shouldShowHidden:false,defaultFilter:sa,currentFilterKey:xa,sourceType:ta,lastSeenTime:ya,hasPendingRefresh:false,pauseAutoInsert:false,error:m.scry(oa,'div.UIIntentionalStream_Error')[0],pager:m.scry(oa,'div.uiMorePager')[0],filterNullState:m.scry(oa,'div.friendListFilterNullState')[0],streamContent:m.find(oa,'.UIIntentionalStream_Content'),requestNum:0,scrollLoadCount:1,maxScrollLoadCount:1,scrollPosition:0,lastViewStateID:0,cachedScrollQID:0,jslog:q.create('stream'),scrollListener:null,newIndexOffset:0});this.addScrollTrace('init',{});u.onLeave(this.unload.bind(this));if(!na.instances)na.instances={};na.instances[pa]=this;na.instance=this;la();this.setupSubscriptions();}ea(na.prototype,{subscribeToComposerPublish:function(){this.subscriptions.push(h.subscribe('composer/publish',function(event,oa){var pa=ca(oa.composer_id).getAttribute('data-location');if(pa==='maincolumn'&&oa.streamStory)this.addComposerContent(oa.streamStory,500);}.bind(this)));},setupSubscriptions:function(){this.subscriptions=[];this.subscribeToComposerPublish();this.subscriptions.push(h.subscribe(x.UPDATE_STREAM,this.updateStream.bind(this)));this.subscriptions.push(h.subscribe(x.REFRESH_STREAM,this.refreshStream.bind(this)));this.scrollListener=o.listen(window,'scroll',this.checkFirstScroll.bind(this));this.checkFirstScroll();u.onLoad(this.checkFirstStory.bind(this));},tearDownSubscriptions:function(){if(!this.subscriptions)return;this.subscriptions.forEach(h.unsubscribe);this.subscriptions=null;if(this.scrollListener){this.scrollListener.remove();this.scrollListener=null;}},unload:function(){this.addScrollTrace('unload',{});h.inform(x.UNLOAD);this.tearDownSubscriptions();na.instance=null;na.instances[this.instanceName]=null;this.clearScrollLoader(true);window.disableScrollLoad=null;y.instance&&y.instance.unload();},_getUpdateInsertType:function(){return na.REFRESH_PREPEND;},updateStream:function(oa){if(oa!=x.UPDATE_STREAM||this.hasPendingRefresh||this.isAutoRefreshPaused())return;this.loadNewer({showLoader:false,ignoreSelf:true,insertType:this._getUpdateInsertType()});},clearScrollLoader:function(oa){if(this.currentScrollListener){this.currentScrollListener.remove();this.currentScrollListener=null;}if(oa||this.scrollLoadCount>=this.maxScrollLoadCount)window.disableScrollLoad=true;},loadOlderPosts:function(oa){var pa={filter:this.getCurrentFilterKey(),oldest:this.oldest,oldestMR:this.oldestMR,last_seen_time:this.lastSeenTime,scroll_count:this.scrollLoadCount,scroll_position:this.scrollPosition,last_viewstate_id:this.lastViewStateID,cached_scroll_qid:this.cachedScrollQID};this.homeloadID&&(pa.homeload_id=this.homeloadID);pa=ia(pa,oa);this.loadWithParams(pa);},loadWithParams:function(oa){var pa=m.scry(this.root,'div.fbStreamPager.hasMorePosts')[0];if(pa){if(k.hasClass(pa,'async_saving'))return;k.addClass(pa,'async_saving');}this.addScrollTrace('loadwithparams',oa);z.loadFromEndpoint('MoreStoriesPagelet','home_stream',oa,{append:true,usePipe:true});},setScrollLoadCount:function(oa){this.maxScrollLoadCount=oa;},setHomeloadID:function(oa){this.homeloadID=oa;},loadMoreOnScroll:function(oa,pa){if(window.disableScrollLoad)return;var qa=function(){if(window.disableScrollLoad)return;var ta={delay_load_count:pa};this.loadOlderPosts(ta);}.bind(this),ra=m.scry(this.root,'ul.uiStream li.genericStreamStory');if(!ra.length)return;this.addScrollTrace('loadmoreonscroll',{});var sa=ra[ra.length-oa-1];if(sa){this.currentScrollListener=new s(sa,qa,null,0);}else qa();},updateTimeRange:function(oa,pa){if(!this.newest||this.newest<oa){this.newest=oa;this.addScrollTrace('update_newest',{newest:this.newest});}if(!this.oldest||(pa&&(pa<this.oldest))){this.oldest=pa;this.addScrollTrace('update_oldest',{oldest:this.oldest});}},updateOldestMR:function(oa){if(!this.oldestMR||oa<this.oldestMR){this.oldestMR=oa;this.addScrollTrace('update_oldestmr',{oldestmr:this.oldestMR});}},updateScrollPosition:function(oa){this.scrollPosition=oa;this.addScrollTrace('update_scrollposition',{scrollposition:this.scrollPosition});},updateLastViewStateID:function(oa){this.lastViewStateID=oa;this.addScrollTrace('update_lastviewstateid',{lastviewstateid:this.lastViewStateID});},updateCachedScrollQID:function(oa){this.cachedScrollQID=oa;this.addScrollTrace('update_cachedscrollqid',{qid:this.cachedScrollQID});},getID:function(){return this.id;},getCurrentFilterKey:function(){if(this.currentFilterKey)return this.currentFilterKey;var oa=aa.getMostRecentURI().getQueryData();if(oa&&oa.sk){this.currentFilterKey=oa.sk;}else if(oa&&oa.filter){this.currentFilterKey=oa.filter;}else if(this.defaultFilter)this.currentFilterKey=this.defaultFilter;return this.currentFilterKey;},resetFilterKey:function(oa){this.currentFilterKey=oa;},loadOlder:function(oa){oa=oa||{};if(!this.oldest)return;var pa=this.getCurrentParams();pa.oldest=this.oldest;this.refresh(na.REFRESH_APPEND,pa,oa);return this;},loadNewer:function(oa){if(!this.newest)return;oa=oa||{};var pa=this.getCurrentParams();pa.newest=this.newest;if(oa.ignoreSelf)pa.ignore_self=true;pa.load_newer=true;var qa=da(oa.insertType,na.REFRESH_PREPEND);this.refresh(qa,pa,oa);return this;},checkFirstStory:function(){this.logFirstStory('first_story_load');},checkFirstScroll:function(){if(this.scrollListener&&ba.getScrollPosition().y>0){this.scrollListener.remove();this.scrollListener=null;this.logFirstStory('first_scrolling');}},logFirstStory:function(oa){if(!ga('home_stream')||!ga('home_stream').childElementCount||!ga('home_stream').children[0].getAttribute('data-ft'))return;var pa=ga('home_stream').children[0].getAttribute('data-ft'),qa=JSON.parse(pa);if(!(("mf_story_key" in qa)&&("qid" in qa)))return;var ra={mf_story_key:qa.mf_story_key,qid:qa.qid};ja(oa,{ft:ra});},getCurrentParams:function(){var oa={},pa=aa.getMostRecentURI().getQueryData();pa.filter=this.getCurrentFilterKey();var qa=this.getValidParams();if(qa){qa.forEach(function(ra){oa[ra]=pa[ra];});}else oa=pa;return oa;},setHomeFilter:function(oa){this._homeFilter=oa;},setHomeFilterLoading:function(oa){if(this._homeFilter)this._homeFilter.setLoading(oa);},refresh:function(oa,pa,qa){h.inform(x.UPDATE_LAST_REFRESH_TIME);this.homeloadID&&(pa.homeload_id=this.homeloadID);this.addScrollTrace('refresh',{type:oa,data:pa,kwargs:qa});this.currentFilterKey=pa.filter;if(pa.filter==na.FEED_FILTER_KEY_DUAL_NEWS_FEED){this.currentFilterKey=this.defaultFilter;}else if(na.isHighlightsFilter(pa.filter)||pa.filter===na.FEED_FILTER_KEY_NEWS_FEED)this.defaultFilter=this.currentFilterKey;qa=qa||{};var ra=++this.requestNum,sa=da(qa.showLoader,true),ta=this.instanceName,ua=function(ya){na.getInstance(ta).handleResponse(ra,oa,ya,qa);},va=function(ya){na.getInstance(ta).handleError(ra,oa,ya,qa);},wa=function(ya){na.getInstance(ta).handleFinally(oa,pa.filter,ya);};if(!(pa.request_type=oa))pa.request_type='none';if(pa.filter){qa.show_hidden=pa.show_hidden?pa.show_hidden:false;}else qa.show_hidden=this.shouldShowHidden;pa=ea(this.getCurrentParams(),pa);this.hasPendingRefresh=true;var xa=new i().setURI(this.getEndpoint()).setReadOnly(true).setOption('retries',0).setMethod(this.getRefreshMethod()).setData(pa).setHandler(ua).setErrorHandler(va).setFinallyHandler(wa);if(oa==na.REFRESH_APPEND&&sa)xa.setStatusElement(this.pager);xa.send();if(oa==na.REFRESH_TRANSITION){if(this.pager)this.pager.style.display='none';this.clearScrollLoader();this.oldest=this.newest=null;}if(sa)this.setHomeFilterLoading(true);},addComposerContent:function(oa,pa){if(this.isOnNewsFeedFilter())k.addClass(oa,'uiStreamBoulderHighlight');this.addContentPrepend(oa,pa);},applyNewIndexes:function(oa){for(var pa=oa.length-1;pa>=0;pa--)oa[pa].setAttribute('data-insertion-position',--this.newIndexOffset);h.inform('Stream/totalHeadLoadedStories',-this.newIndexOffset);},addContentPrepend:function(oa,pa){if(oa.length){fa(oa).reverse().forEach(function(va){this.addContentPrepend(va,pa);}.bind(this));return;}var qa,ra=ba.getScrollPosition().y,sa=ba.getElementPosition(this.streamContent).y,ta=this.scrollOnPrepend&&ra>=sa;if(ta){var ua=function(va){var wa=m.find(va,'^li.uiStreamStory');if(!wa)return;l.set(wa,'origHeight',wa.offsetHeight);o.listen(va,'load',function(){var xa=l.get(wa,'origHeight');if(wa.offsetHeight!=xa){window.scrollBy(0,wa.offsetHeight-xa);l.set(wa,'origHeight',wa.offsetHeight);}});};qa=g.insert.curry(this.streamContent,oa,(function(va,wa){m.prependContent(this.streamContent,wa);h.inform('reflow');window.scrollBy(0,wa.offsetHeight);m.scry(wa,'img').forEach(ua);}).bind(this));}else qa=(function(){w.set(oa,'opacity',0);v.prependContent(this.streamContent,oa);h.inform('reflow');new g(oa).from('opacity',0).to('opacity',1).duration(400).ondone(function(){h.inform(x.UPDATE_HTML_CONTENT);}).go();}).bind(this);if(pa){k.hide(oa);m.appendContent(document.body,oa);setTimeout(function(){k.show(oa);qa();},pa);}else qa();},addContentAppend:function(oa){m.appendContent(this.streamContent,oa);},handleResponse:function(oa,pa,qa,ra){this.addScrollTrace('handle_response',{requestnum:oa,type:pa,kwargs:ra});ra=ra||{};var sa=qa.getPayload();this.filterNullState&&m.remove(this.filterNullState);if(ha(sa))return;if(sa.autoRefreshConfig)h.inform(x.UPDATE_AUTOREFRESH_CONFIG,sa.autoRefreshConfig);this.setHomeFilterLoading(false);if(pa==na.REFRESH_EXPAND){var ta=m.find(ca(ra.expandStoryID),'div.UIIntentionalStory_CollapsedStories');k.hide(ta);k.removeClass(ta,'UIIntentionalStory_CollapsedStoriesLoading');}if(this.error)this.error.style.display='none';if(oa!=this.requestNum)return;if('show_hidden' in ra)this.shouldShowHidden=ra.show_hidden;if('newestStoryTime' in sa&&sa.newestStoryTime>this.newest)this.newest=sa.newestStoryTime;if(pa!=na.REFRESH_PREPEND){if('oldestStoryTime' in sa&&(!this.oldest||sa.oldestStoryTime<this.oldest))this.oldest=sa.oldestStoryTime;if('scrollPosition' in sa)this.scrollPosition=sa.scrollPosition;if('lastViewStateID' in sa)this.lastViewStateID=sa.lastViewStateID;if('oldestMRStoryTime' in sa)this.oldestMR=sa.oldestMRStoryTime;if('cachedScrollQID' in sa){this.cachedScrollQID=sa.cachedScrollQID;}else this.cachedScrollQID=0;}if(sa.html){var ua=p(sa.html).getNodes();switch(pa){case na.REFRESH_PREPEND:this.applyNewIndexes(ua);this.addContentPrepend(ua);break;case na.REFRESH_APPEND:this.addContentAppend(ua);this.clearScrollLoader(true);break;case na.REFRESH_TRANSITION:m.setContent(this.streamContent,ua);this.scrollLoadCount=1;if(!ra.noScroll)n.scrollTo(new ba(0,0,"document"),false);break;case na.REFRESH_EXPAND:m.insertAfter(ca(ra.expandStoryID),ua);break;case na.DELAYED_STREAM:this.addContentAppend(ua);break;}h.inform(x.UPDATE_HTML_CONTENT);}},handleError:function(oa,pa,qa,ra){if(oa!=this.requestNum)return;this.setHomeFilterLoading(false);var sa=qa.getError();if(sa==1357001)j.defaultErrorHandler(qa);if(pa==na.REFRESH_EXPAND){var ta=m.find(ca(ra.expandStoryID),'div.UIIntentionalStory_CollapsedStories');k.removeClass(ta,'UIIntentionalStory_CollapsedStoriesLoading');}if(!ra.delayLoadCount&&pa!=na.REFRESH_PREPEND&&this.error)w.set(this.error,'display','block');},handleFinally:function(oa,pa){if(oa==na.REFRESH_TRANSITION){t.transitionComplete();h.inform(r.NAVIGATION_COMPLETED);}this.hasPendingRefresh=false;},getValidParams:function(){return na.VALID_PARAMS;},getEndpoint:function(){return na.ENDPOINT;},getRefreshMethod:function(){return na.REFRESH_METHOD;},isOnNewHighlights:function(){var oa=this.getCurrentFilterKey();return (na.isHighlightsFilter(oa)||(oa==na.FEED_FILTER_KEY_DUAL_NEWS_FEED&&na.isHighlightsFilter(this.defaultFilter)));},isLiveStreamBox:function(){var oa=this.getCurrentFilterKey();return oa&&oa.indexOf(na.FEED_FILTER_KEY_LIVE_STREAM_BOX)===0;},isOnNewsFeedFilter:function(){var oa=this.getCurrentFilterKey();return (oa==na.FEED_FILTER_KEY_NEWS_FEED||na.isHighlightsFilter(oa)||oa==na.FEED_FILTER_KEY_DUAL_NEWS_FEED);},isAutoRefreshPaused:function(){if(this.isOnNewHighlights()||this.isLiveStreamBox())return false;return this.pauseAutoInsert;},addScrollTrace:function(oa,pa){this.jslog.debug(oa,pa);},refreshStream:function(oa,pa){if(oa!=x.REFRESH_STREAM)return;var qa=this.getCurrentFilterKey(),ra={filter:qa},sa={filter:qa};pa.noScroll&&(sa.noScroll=1);this.refresh(na.REFRESH_TRANSITION,ra,sa);},getNewest:function(){return this.newest;}});ea(na,{ANIMATION_DURATION:300,REFRESH_METHOD:'GET',REFRESH_TRANSITION:1,REFRESH_PREPEND:2,REFRESH_APPEND:3,REFRESH_EXPAND:5,DELAYED_STREAM:6,FEED_FILTER_KEY_NEW_HIGHLIGHTS:'h',FEED_FILTER_KEY_NEWS_FEED:'lf',FEED_FILTER_KEY_DUAL_NEWS_FEED:'nf',FEED_FILTER_KEY_LIVE_STREAM_BOX:'pub',VALID_PARAMS:['filter','show_hidden'],ENDPOINT:'/ajax/intent.php',getInstance:function(oa){return na.instances[oa];},isHighlightsFilter:function(oa){if(!oa)return false;return ka(oa,na.FEED_FILTER_KEY_NEW_HIGHLIGHTS);},getStoriesByAssoc:function(oa){return m.scry(na.instance.root,'div.aid_'+oa);}});e.exports=na;});
__d("FutureHomeSideNav",["Arbiter","AsyncRequest","CSS","DOM","Event","FutureSideNav","FutureSideNavItem","FutureSideNavSection","NavigationMessage","Parent","UIIntentionalStream","UIPagelet","emptyFunction","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('FutureSideNav'),m=b('FutureSideNavItem'),n=b('FutureSideNavSection'),o=b('NavigationMessage'),p=b('Parent'),q=b('UIIntentionalStream'),r=b('UIPagelet'),s=b('emptyFunction'),t=b('tx');for(var u in l)if(l.hasOwnProperty(u))w[u]=l[u];var v=l===null?null:l.prototype;w.prototype=Object.create(v);w.prototype.constructor=w;w.__superConstructor__=l;function w(){"use strict";if(l!==null)l.apply(this,arguments);}w.prototype.init=function(){"use strict";v.init.apply(this,arguments);this.ajaxPipe=true;this.seeAllEndpoint="/ajax/home/generic.php";this.typeSections={favorites:'pinnedNav',profiles:'pinnedNav',apps:'appsNav',groups:'groupsNav',pages:'pagesNav',lists:'listsNav',interests:'interestsNav',connect_apps:'connectNav'};this._arbiterSubscriptions.push(g.subscribe(o.NAVIGATION_FAVORITE_UPDATE,this.updateFavorite.bind(this)),g.subscribe(o.NAVIGATION_FIRST_RESPONSE,this.navigationFirstResponse.bind(this)));};w.prototype.initMoreLink=function(da){"use strict";this._eventHandlers.push(k.listen(da,'click',this._showMoreSections.bind(this,da)));};w.prototype._showMoreSections=function(da){"use strict";var ea=j.scry(this.root,'div.belowThreshold');i.hide(da);ea.forEach(function(fa){i.removeClass(fa,'belowThreshold');});};w.prototype._initSection=function(da){"use strict";var ea=v._initSection.call(this,da);for(var fa in this.typeSections){var ga=this.typeSections[fa];if(ea.id==ga){var ha=j.scry(ea.node,'h4.navHeader')[0];if(ha){var ia='\/bookmarks\/('+fa+')(\/)?';ea.seeall=this._initItem({node:ha,id:ea.id,endpoint:this.seeAllEndpoint,key:['bookmarks'],path:[{regex:ia}]});}}}return ea;};w.prototype._constructItem=function(da,ea){"use strict";return new ca(da,ea);};w.prototype._constructSection=function(da){"use strict";return new z(da);};w.prototype.getSection=function(da){"use strict";return this.typeSections[da]&&this.sections[this.typeSections[da]];};w.prototype._getItemForKey=function(da){"use strict";var ea=v._getItemForKey.call(this,"nf");if(ea&&ea.matchKey(da)){return ea;}else return v._getItemForKey.call(this,da);};w.prototype._isCurrentPath=function(da){"use strict";return ((da.getDomain()===this.uri.getDomain())&&(da.getPath()==='/'||da.getPath()==='/home.php'));};w.prototype._handleMenuClick=function(da,ea,fa,event){"use strict";if(i.hasClass(fa,'favorite')){g.inform(o.NAVIGATION_FAVORITE_UPDATE,{key:ea.numericKey,favorite:!da.equals(this.getSection("favorites")),movetop:i.hasClass(fa,'movetop')});}else v._handleMenuClick.call(this,da,ea,fa,event);};w.prototype._handleLinkClick=function(da,ea,event){"use strict";var fa=this._getItemForNode(ea);if(fa&&(fa.type=='groups'||fa.type=='pages'||fa.type=='lists'||fa.type=='interests'))fa.setCount(0);v._handleLinkClick.call(this,da,ea,event);};w.prototype.removeItemByKey=function(da){"use strict";g.inform(o.NAVIGATION_ITEM_REMOVED,da);v.removeItemByKey.call(this,da);};w.prototype.toggleItemByKey=function(da,ea){"use strict";var fa=this.getNodeForKey(da);if(!ea){g.inform(o.NAVIGATION_ITEM_HIDDEN,da);fa&&i.hide(fa);}else fa&&i.show(fa);var ga=this._getItemForKey(da);this.getSection(ga.type).refresh();};w.prototype.removeItem=function(da){"use strict";var ea=this.getSection(da.type);v.removeItem.call(this,da);ea.refresh();};w.prototype.updateFavorite=function(da,ea){"use strict";var fa=this._findItem(function(oa){return oa.matchKey(ea.key)&&oa.canFavorite();}),ga=this.getSection("favorites"),ha=s,ia=ea.favorite?ga.addEndpoint:ga.removeEndpoint;if(ea.movetop)ia=ga.editEndpoint;if(!fa&&(ea.favorite||ea.movetop)){if(ea.movetop)var ja=j.scry(this.root,'.expandableSideNav'),ka=ja&&ja.length&&i.hasClass(ja[0],'expandedMode');ha=function(){r.loadFromEndpoint('PinnedNavigationPagelet','pagelet_pinned_nav',{expanded:ka});};}else if(!fa){ha=function(){r.loadFromEndpoint('BookmarkNavigationPagelet','pagelet_bookmark_nav');};}else{if(ea.movetop){i.show(fa.node);this.moveItem(ga,fa);var la=p.byClass(fa.node,'uiSideNav');if(la&&la.childNodes.length){var ma=p.byClass(j.scry(la,'.sortableItem')[0],'sideNavItem');j.insertBefore(ma,fa.node);i.removeClass(fa.node,'hidden');}}else{var na=this.getSection(fa.type);if(ea.favorite){i.show(fa.node);this.moveItem(ga,fa);fa.showFavorite();}else if(!na.equals(ga)){this.moveItem(na,fa,true);fa.hideFavorite();}else this.removeItem(fa);na.refresh();}ga.refresh();ea.key=fa.numericKey;g.inform('NavigationMessage.FAVORITES_UPDATED');}new h().setURI(ia).setData({id:ea.key,movetop:ea.movetop}).setHandler(ha).send();};w.prototype._doPageTransition=function(da,ea){"use strict";this._unloadStreams();var fa=v._doPageTransition.call(this,da,ea);if(fa&&(da.type=='groups'||da.type=='lists'||da.type=='interests')){da.setCount(0);da.hideUnreadDot();}return fa;};w.prototype._unloadStreams=function(){"use strict";var da=window.UIIntentionalStream&&q.instances,ea=['nile','global','friends','blade'];da&&ea.forEach(function(fa){da[fa]&&da[fa].unload();});};w.prototype.navigationFirstResponse=function(){"use strict";this.setSelected(this.loading);};for(var x in n)if(n.hasOwnProperty(x))z[x]=n[x];var y=n===null?null:n.prototype;z.prototype=Object.create(y);z.prototype.constructor=z;z.__superConstructor__=n;function z(da){"use strict";n.call(this,da);this.editEndpoint='/ajax/bookmark/edit/';this.addEndpoint='/ajax/bookmark/add/';this.removeEndpoint='/ajax/bookmark/delete/';}z.prototype.refresh=function(){"use strict";var da=j.scry(this.node,'li.sideNavItem'),ea=j.scry(this.node,'div.actionLinks'),fa=da.some(i.shown);i.conditionShow(j.find(this.node,'h4.navHeader'),fa);ea.length&&i.conditionShow(ea[0],fa);};for(var aa in m)if(m.hasOwnProperty(aa))ca[aa]=m[aa];var ba=m===null?null:m.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=m;function ca(){"use strict";if(m!==null)m.apply(this,arguments);}ca.prototype.canFavorite=function(){"use strict";return !!this._getFavoriteLabel();};ca.prototype.showFavorite=function(){"use strict";j.setContent(this._getFavoriteLabel(),"Remove from Favorites");};ca.prototype.hideFavorite=function(){"use strict";j.setContent(this._getFavoriteLabel(),"Add to Favorites");};ca.prototype.hideUnreadDot=function(){"use strict";var da=j.scry(this.node,'img.unreadDot')[0];da&&i.hide(da);};ca.prototype._getFavoriteLabel=function(){"use strict";return j.scry(this.node,'li.favorite span.itemLabel')[0];};e.exports=w;});
__d("legacy:home-side-nav-future-js",["FutureHomeSideNav"],function(a,b,c,d){a.FutureHomeSideNav=b('FutureHomeSideNav');},3);
__d("AttachmentRelatedShareConstants",[],function(a,b,c,d,e,f){var g={ARTICLE_CLICK:'article_click',VIDEO_CLICK:'video_click'};e.exports=g;});
__d("KeyboardShortcuts",["KeyEventController","Layer","ModalLayer"],function(a,b,c,d,e,f){var g=b('KeyEventController'),h=b('Layer'),i=b('ModalLayer');function j(l,m,n){"use strict";this.key=l;this.handler=m;this.filter=n;this.register();}j.prototype.register=function(){"use strict";this.token=g.registerKey(this.key,this.handler,this.filter);};j.prototype.remove=function(){"use strict";this.token.remove();};var k={_tokens:[[]],register:function(l,m,n){n=n||{};var o=n.allowDefault?m:function(event,s){m.apply(this,arguments);event.prevent();},p=n.baseFilters||[g.defaultFilter],q=function(event,s){for(var t=0,u=p.length;t<u;t++)if(!p[t](event,s))return false;return !n.filter||n.filter(event,s);},r=new j(l,o,q);this._tokens[this._tokens.length-1].push(r);return r;},init:function(){h.subscribe('show',function(l,m){if(m.hasBehavior(i))this.pushLayer();}.bind(this));h.subscribe('hide',function(l,m){if(m.hasBehavior(i))this.popLayer();}.bind(this));},pushLayer:function(){var l=this._tokens[this._tokens.length-1];l&&l.forEach(function(m){m.remove();});this._tokens.push([]);},popLayer:function(){var l=this._tokens.length-1;if(l<0)return;var m=this._tokens[l];m.forEach(function(o){o.remove();});this._tokens.pop();var n=this._tokens[l-1];n&&n.forEach(function(o){o.register();});}};k.init();e.exports=k;});
__d("FeedBaseKeyboardController",["$","Arbiter","AsyncDialog","AsyncRequest","CSS","DOM","DOMScroll","DOMQuery","Event","Focus","KeyboardShortcuts","KeyEventController","LikeConfirmer","NavigationMessage","Parent","Run","SubscriptionsHandler","Vector","ViewportBounds","emptyFunction","ge","getActiveElement","isAsyncScrollQuery","throttle"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('CSS'),l=b('DOM'),m=b('DOMScroll'),n=b('DOMQuery'),o=b('Event'),p=b('Focus'),q=b('KeyboardShortcuts'),r=b('KeyEventController'),s=b('LikeConfirmer'),t=b('NavigationMessage'),u=b('Parent'),v=b('Run'),w=b('SubscriptionsHandler'),x=b('Vector'),y=b('ViewportBounds'),z=b('emptyFunction'),aa=b('ge'),ba=b('getActiveElement'),ca=b('isAsyncScrollQuery'),da=b('throttle'),ea;function fa(){ea=k.hasClass(document.documentElement,'tinyViewport')?0:g('pagelet_bluebar').offsetTop+g('pagelet_bluebar').offsetHeight;}fa.defer();o.listen(window,'resize',da(fa));function ga(ha){"use strict";this.root=ha;this.init();}ga.prototype.getStories=function(){"use strict";};ga.prototype.getParentStory=function(ha){"use strict";};ga.prototype.isStory=function(ha){"use strict";};ga.prototype.isHoldoutStory=function(ha){"use strict";};ga.prototype.getHeadline=function(ha){"use strict";};ga.prototype.getPreviousStory=function(ha){"use strict";};ga.prototype.getNextStory=function(ha){"use strict";};ga.prototype.setSelected=function(ha,ia){"use strict";};ga.prototype.clickLike=function(){"use strict";};ga.prototype.clickComment=function(){"use strict";};ga.prototype.clickShare=function(){"use strict";};ga.prototype.openAttachment=function(){"use strict";};ga.prototype.focusComposer=function(){"use strict";var ha=l.scry(aa('pagelet_composer'),'textarea')[0];if(ha){p.set(ha);m.scrollToTop(true);}};ga.prototype.getScrollOffset=function(){"use strict";return 10;};ga.prototype.getAnimationLength=function(ha){"use strict";return Math.min(Math.abs(x.getElementPosition(ha).y-y.getTop()-document.body.scrollTop),400);};ga.prototype.findTop=function(){"use strict";var ha=this.getStories();for(var ia=0;ia<ha.length;ia++)if(x.getElementPosition(ha[ia]).y>x.getScrollPosition().y)return ha[ia];};ga.prototype.onLeave=function(){"use strict";this.subscriptions&&this.subscriptions.release();};ga.prototype.getHelpDialogRequest=function(){"use strict";if(!this.dialogRequest){this.dialogRequest=new j('/ajax/keyboard_shortcuts');this.dialogRequest.setReadOnly(true);}else if(this.dialogRequest.transport)return null;return this.dialogRequest;};ga.prototype.init=function(){"use strict";v.onLeave(this.onLeave.bind(this));this.subscriptions=new w();this.subscriptions.addSubscriptions(h.subscribe(t.NAVIGATION_BEGIN,this.onLeave.bind(this)),q.register('j',this.vert.bind(this,1)),q.register('k',this.vert.bind(this,-1)),q.register('l',function(){var ha=this.getParentStory(ba());s.like(function(){this.setSelected(ha,false);this.clickLike();}.bind(this),ba());}.bind(this),{filter:this.hasActiveStory.bind(this)}),q.register('c',this.clickComment.bind(this),{filter:this.hasActiveStory.bind(this)}),q.register('o',this.openAttachment.bind(this),{filter:this.hasActiveStory.bind(this)}),q.register('p',this.focusComposer.bind(this),{filter:this.hasActiveStory.bind(this)}),q.register('s',this.clickShare.bind(this),{filter:this.hasActiveStory.bind(this)}),q.register('SLASH',function(){var ha=this.getHelpDialogRequest();ha&&i.send(ha);}.bind(this),{filter:function(event,ha){return event.getModifiers().shift;}}),q.register('ESCAPE',function(){var ha=this.findTop();ha&&this.setFocused(ha);}.bind(this),{baseFilters:[r.filterEventTypes,r.filterEventModifiers]}),o.listen(document,'focusin',function(event){var ha=event.getTarget(),ia=this.getParentStory(ha);if(ia&&(this.selected!=ia)){this.setSelected(ia,false);if(!this.isInteractive(ha))this.setFocused(ia);}}.bind(this)));};ga.prototype.hasActiveStory=function(event,ha){"use strict";var ia=ba();return !(ia&&k.shown(ia))||!!this.getParentStory(ia);};ga.prototype.click=function(ha){"use strict";if(!this.selected)return;var ia;for(var ja=0,ka=arguments.length;ja<ka;ja++){ia=l.scry(this.selected,arguments[ja])[0];if(ia&&k.shown(ia)){ia.click();return;}}};ga.prototype.vert=function(ha){"use strict";if(!this.scrollInitialized){this.subscriptions.addSubscriptions(o.listen(document,'scroll',function(){if(this.selected&&!this.scrolling)this.setSelected(null,false);}.bind(this)));this.scrollInitialized=true;}var ia;if(this.selected){if(this.selected.id=='pagelet_composer'){ia=ha>0?this.getStories()[0]:null;if(this.isHoldoutStory(ia))ia=this.getPreviousStory(ia);}else ia=ha>0?this.getNextStory(this.selected):(this.getPreviousStory(this.selected)||aa('pagelet_composer'));if(!ia){return;}else if(!n.isElementNode(ia)){k.removeClass(this.selected,'selectedStorySimple');this.selected=ia;return this.vert(ha);}}if(!ia||u.byClass(ia,'hidden_elem')||!l.contains(document,ia)){ia=this.findTop();if(ia&&ha<0)ia=this.getPreviousStory(ia);if(this.isHoldoutStory(ia))ia=this.getPreviousStory(ia);}if(!ia)return;this.anim&&this.anim.stop();var ja=(Date.now()-(this.lastScroll||0)>30),ka=this.setFocused.bind(this,ia);if(ca()){ja=false;ka();ka=z;}this.scrolling=true;this.scrollingTimer&&window.clearTimeout(this.scrollingTimer);this.anim=m.scrollTo(ia,ja?this.getAnimationLength(ia):0,false,x.getViewportDimensions().y-ea-this.getScrollOffset(),function(){this.scrollingTimer=window.setTimeout(function(){this.scrolling=false;}.bind(this),300);ka();}.bind(this));this.setSelected(ia,true);this.lastScroll=Date.now();};ga.prototype.isInteractive=function(ha){"use strict";return ((ha.nodeName=='INPUT')||(ha.nodeName=='BUTTON')||(ha.nodeName=='TEXTAREA')||(ha.nodeName=='A')||!!u.byAttribute(ha,'contenteditable'));};ga.prototype.setTabindexOnHeadline=function(ha,ia){"use strict";if(this.isStory(ha)){var ja=this.getHeadline(ha);if(ja)ja.tabIndex=ia;}};ga.prototype.setTabindexOnStory=function(ha,ia){"use strict";if(this.isStory(ha))ha.tabIndex=ia;};ga.prototype.setFocused=function(ha){"use strict";if(this.isStory(ha))p.setWithoutOutline(ha);};e.exports=ga;});
__d("FeedKeyboardController",["CSS","DOM","DOMQuery","FeedBaseKeyboardController","Parent","csx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('DOMQuery'),j=b('FeedBaseKeyboardController'),k=b('Parent'),l=b('csx');for(var m in j)if(j.hasOwnProperty(m))o[m]=j[m];var n=j===null?null:j.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=j;function o(){"use strict";if(j!==null)j.apply(this,arguments);}o.prototype.getStories=function(){"use strict";return h.scry(this.root,'li.uiStreamStory');};o.prototype.getParentStory=function(p){"use strict";if(!h.contains(this.root,p))return;return k.byClass(p,'uiStreamStory');};o.prototype.isStory=function(p){"use strict";return g.hasClass(p,'uiStreamStory');};o.prototype.getHeadline=function(p){"use strict";return i.scry(p,'h5.uiStreamHeadline')[0];};o.prototype.clickLike=function(){"use strict";this.click('.UFILikeLink');};o.prototype.clickComment=function(){"use strict";this.click('.comment_link');};o.prototype.clickShare=function(){"use strict";this.click('.share_action_link');};o.prototype.openAttachment=function(){"use strict";this.click(".uiStreamAttachments ._5dec",'.uiStreamAttachments a.uiVideoThumb','.uiStreamAttachments a.shareText','.uiStreamAttachments a[rel="theater"]','.uiStreamAttachments .shareMediaLink');};o.prototype.isHoldoutStory=function(p){"use strict";return !!p&&g.hasClass(p,'holdoutAdStory');};o.prototype.isRelevantStory=function(p){"use strict";return i.isElementNode(p)&&!this.isHoldoutStory(p);};o.prototype.getPreviousStory=function(p){"use strict";var q=p.previousSibling;while(q&&!this.isRelevantStory(q))q=q.previousSibling;return q;};o.prototype.getNextStory=function(p){"use strict";var q=p.nextSibling;while(q&&!this.isRelevantStory(q))q=q.nextSibling;return q;};o.prototype.setSelected=function(p,q){"use strict";if(p){var r=i.scry(p,'.selectedStoryIndicator');if(!r.length)h.prependContent(p,h.create('div',{'class':'selectedStoryIndicator'}));}this.selected&&this.setTabindexOnHeadline(this.selected,'-1');this.selected&&g.removeClass(this.selected,'selectedStorySimple');this.selected=p;p&&this.setTabindexOnHeadline(p,'0');p&&g.addClass(p,'selectedStorySimple');};e.exports=o;});
__d("FeedTrackingAsync",["Event","collectDataAttributes","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('collectDataAttributes'),i=b('copyProperties');function j(){g.listen(document.documentElement,'AsyncRequest/send',function(event){var k=event.getTarget(),l=event.getData().request,m=l.getData(),n=h(k,['ft']);i(m,n);});}e.exports={init:j};});
__d("MercuryLeftNavCountControl",["Arbiter","CSS","DOM","MercuryThreadlistConstants","MessagingTag","MercuryThreadInformer","MercuryUnreadState","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('MercuryThreadlistConstants'),k=b('MessagingTag'),l=b('MercuryThreadInformer').get(),m=b('MercuryUnreadState').get(),n=b('copyProperties'),o,p,q=function(r,s){o=r;p=s;this.render();this.listenerToken=l.subscribe('unread-updated',this.render.bind(this));this.subscriptions=[g.subscribe('onload/exit',this.cleanup.bind(this))];};n(q.prototype,{render:function(){var r=m.exceedsMaxCount(k.INBOX);if(r){i.setContent(o,j.MAX_UNREAD_COUNT);}else{var s=m.getUnreadCount(k.INBOX);i.setContent(o,s.toString());h.conditionClass(o.parentNode,'hidden_elem',s<=0);}i.setContent(p,r?'+':'');},cleanup:function(){this.subscriptions.forEach(g.unsubscribe);l.unsubscribe(this.listenerToken);}});e.exports=q;});
__d("MercuryLeftNav",["DOM","MercuryServerRequests","MercuryLeftNavCountControl"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryServerRequests').get(),i=b('MercuryLeftNavCountControl');function j(k,l){h.handleUpdate(l);var m=g.scry(k,'span.countValue')[0],n=g.scry(k,'span.maxCountIndicator')[0];new i(m,n);}e.exports=j;});
__d("ViewportTracking",["Arbiter","Banzai","DOM","DOMDimensions","Event","NavigationMessage","Run","Style","SubscriptionsHandler","UIIntentionalStreamMessage","UserActivity","Vector","clickRefAction","collectDataAttributes","copyProperties","debounce","getElementPosition","throttle"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Banzai'),i=b('DOM'),j=b('DOMDimensions'),k=b('Event'),l=b('NavigationMessage'),m=b('Run'),n=b('Style'),o=b('SubscriptionsHandler'),p=b('UIIntentionalStreamMessage'),q=b('UserActivity'),r=b('Vector'),s=b('clickRefAction'),t=b('collectDataAttributes'),u=b('copyProperties'),v=b('debounce'),w=b('getElementPosition'),x=b('throttle'),y=97,z='vpv';function aa(){"use strict";}aa.prototype.init=function(ba){"use strict";this.useBanzai=!!ba.banzai;this.readStoryIDs={};this.minSizeToBeVisible=200;this.minFractionToBeVisibleForTimetracking=.5;this.minFractionForAdditionalView=0;this.timetrackingThrottlingInterval=100;this.minTimeToReportImmediately=500;this.cachedAllStories=null;this.cachedViewportHeight=j.getViewportDimensions().height;this.isTimetrackingEnabled=0;this.storyEnteredVPTimestamp={};this.alreadyLoggedDurationStories=[];this.userInactiveLock=false;this.userActivityPollerTimeoutID=-1;this._headLoadStoryCount=0;this.getDataFromConfig(ba);this.isLoose=!!ba.is_loose;this.maxScrollPosition=0;this.porportionRatio=.5;this.is_proportion=!!ba.is_proportion;if(this.is_proportion)this.proportionRatio=ba.proportion_ratio;if(ba.tracking_duration_config){this.timetrackingThrottlingInterval=ba.tracking_duration_config.timetracking_throttling_interval;this.userActivityPollingInterval=ba.tracking_duration_config.user_activity_polling_interval;this.timeToBeConsideredInactive=ba.tracking_duration_config.time_to_be_considered_inactive;this.minFractionToBeVisibleForTimetracking=ba.tracking_duration_config.min_fraction_to_be_visible;this.minTimeToReportImmediately=ba.tracking_duration_config.min_time_to_report_immediately;this.minFractionForAdditionalView=ba.tracking_duration_config.min_fraction_for_additional_view;}var ca,da=v(this.fireTimer,this.getTimeout(),this);if(this.isLoose){this.minSizeToBeVisible=0;ca=x(function(){this.maxScrollPosition=Math.max(this.maxScrollPosition,r.getScrollPosition().y);da();}.bind(this));}else ca=da;if(!ba.scroll_only)this.fireTimer();var ea=x(this.updateTimeTrackingData.bind(this,false),this.timetrackingThrottlingInterval);this.subscriptions=new o();this.subscriptions.addSubscriptions(this._getScrollListener(ca),k.listen(window,'resize',function(){this.cachedViewportHeight=j.getViewportDimensions().height;ca();}.bind(this)),g.subscribe(p.UPDATE_HTML_CONTENT,function(){if(q.isActive())ca();}.bind(this)),g.subscribe(l.NAVIGATION_BEGIN,this.cleanup.bind(this)),g.subscribe('Stream/totalHeadLoadedStories',function(fa,ga){this._headLoadStoryCount=ga;}.bind(this)));if(this.isTimetrackingEnabled){this.updateTimeTrackingData(false);this.subscriptions.addSubscriptions(this._getScrollListener(ea));this._userActivityPoller();}m.onLeave(this.cleanup.bind(this));};aa.prototype._getScrollListener=function(ba){"use strict";return k.listen(window,'scroll',ba);};aa.prototype.cleanup=function(){"use strict";if(this.subscriptions){this.subscriptions.release();this.subscriptions=null;}if(this.isTimetrackingEnabled){clearTimeout(this.userActivityPollerTimeoutID);this.updateTimeTrackingData(true);}this._headLoadStoryCount=0;};aa.prototype.fireTimer=function(){"use strict";this.getStoriesInView().forEach(this.markStoryRead.bind(this));};aa.prototype._userActivityPoller=function(){"use strict";if(!this.userInactiveLock&&!q.isActive(this.timeToBeConsideredInactive)){this.userInactiveLock=true;this.updateTimeTrackingData(true);q.subscribeOnce(function(){this.updateTimeTrackingData(false);this.userInactiveLock=false;}.bind(this));}this.userActivityPollerTimeoutID=setTimeout(this._userActivityPoller.bind(this),this.userActivityPollingInterval);};aa.prototype.addVisibleStoriesTimestamps=function(ba,ca){"use strict";var da={};for(var ea=0,fa=ba.length;ea<fa;ea++){var ga=this.getStoryID(ba[ea]);da[ga]=true;if(ga in this.storyEnteredVPTimestamp)continue;this.storyEnteredVPTimestamp[ga]={ts:ca,story:ba[ea]};}return da;};aa.prototype.removeTimestampsOfStoriesNotInView=function(ba,ca){"use strict";for(var da in this.storyEnteredVPTimestamp)if(!(da in ba)){this.recordTimeStoryWasInView(this.storyEnteredVPTimestamp[da].story,this.storyEnteredVPTimestamp[da].ts,ca);delete this.storyEnteredVPTimestamp[da];}};aa.prototype.updateTimeTrackingData=function(ba){"use strict";if(!this.storyEnteredVPTimestamp)this.storyEnteredVPTimestamp={};var ca=Date.now(),da={},ea;if(!ba)da=this.getAllStoriesInView();ea=this.addVisibleStoriesTimestamps(da,ca);this.removeTimestampsOfStoriesNotInView(ea,ca);};aa.prototype.getStoriesInView=function(){"use strict";var ba=this.getAllStories(),ca=[],da=false;for(var ea=0;ea<ba.length;ea++){var fa=ba[ea],ga=this.getStoryID(fa);if(this.hasBeenVisible(ga))continue;if(this.isVisible(fa)){if(fa.getAttribute('data-insertion-position')===null)fa.setAttribute('data-insertion-position',ea-this._headLoadStoryCount);ca.push(fa);da=true;}else if(da)break;}return ca;};aa.prototype.getAllStoriesFromCache=function(){"use strict";if(this.cachedAllStories===null)this.cachedAllStories=this.getAllStories();return this.cachedAllStories;};aa.prototype.invalidateAllStoriesCache=function(){"use strict";this.cachedAllStories=null;};aa.prototype.getAllStoriesInView=function(){"use strict";var ba=this.getAllStoriesFromCache(),ca=[],da=false,ea=0,fa=ba.length,ga=1;if(this._indexOfLastVisibleStoryOnPreviousPass>fa/2){ea=fa-1;fa=-1;ga=-ga;}for(var ha=ea;ha!=fa;ha+=ga){var ia=ba[ha];if(this._isVisible(ia,false,this.minFractionToBeVisibleForTimetracking*j.getElementDimensions(ia).height)){if(ia.getAttribute('data-insertion-position')===null)ia.setAttribute('data-insertion-position',ha-this._headLoadStoryCount);ca.push(ia);da=true;}else if(da){this._indexOfLastVisibleStoryOnPreviousPass=ha-ga;break;}}for(ha=this.alreadyLoggedDurationStories.length-1;ha>=0;ha--){ia=this.alreadyLoggedDurationStories[ha];if(!this._isVisible(ia,false,this.minFractionForAdditionalView*j.getElementDimensions(ia).height))this.alreadyLoggedDurationStories.splice(ha,1);}return ca;};aa.prototype.getTimetrackingDataToLog=function(ba,ca,da){"use strict";var ea={evt:y,vpvd_start_timestamp:ca,vpvd_time_delta:da-ca,story_height:j.getElementDimensions(ba).height,viewport_height:this.cachedViewportHeight};return {ft:ea};};aa.prototype.recordTimeStoryWasInView=function(ba,ca,da){"use strict";if(this.isTimetrackingEnabled){if(this.alreadyLoggedDurationStories.indexOf(ba)>-1){return;}else this.alreadyLoggedDurationStories.push(ba);var ea=this.getTimetrackingDataToLog(ba,ca,da),fa=t(ba,['ft']);u(ea.ft,fa.ft);var ga=!!fa.ft.ei&&(ea.ft.vpvd_time_delta>this.minTimeToReportImmediately);delete ea.ei;this.sendDataToLog(ba,ea,ga);}};aa.prototype.hasBeenVisible=function(ba){"use strict";return ba in this.readStoryIDs;};aa.prototype.isVisible=function(ba){"use strict";return this._isVisible(ba,this.isLoose,this.minSizeToBeVisible);};aa.prototype._isVisible=function(ba,ca,da){"use strict";var ea=r.getScrollPosition().y,fa=j.getViewportDimensions().height,ga=w(ba),ha=j.getElementDimensions(ba),ia=fa+this.maxScrollPosition-ea;if(!ga.x&&!ga.y&&!ha.x&&!ha.y)return false;if(ca&&ga.y<ia)return true;var ja=Math.max(ga.y,0),ka=Math.min(ga.y+ha.height,fa),la;if(this.is_proportion){la=ha.height*this.proportionRatio;}else la=Math.min(ha.height,da);return (ka-ja)>=la;};aa.prototype.sendDataToLog=function(ba,ca,da){"use strict";if(this.useBanzai){var ea={};if(da)ea.delay=0;h.post('feed_tracking',ca,ea);}else s(z,ba,null,'FORCE',ca);};aa.prototype.markStoryRead=function(ba){"use strict";var ca=this.getStoryID(ba);if(!ca||this.hasBeenVisible(ca))return;this.readStoryIDs[ca]=true;var da=this.getDataToLog(ba),ea=i.scry(ba,".fbStoryAttachmentImage")[0];if(ea){var fa=j.getElementDimensions(ea).width,ga=j.getElementDimensions(ea).height;da.ft.story_image_height=ga;da.ft.story_image_width=fa;}var ha=t(ba,['ft']);u(da.ft,ha.ft);delete da.ei;this.sendDataToLog(ba,da,false);};e.exports=aa;});
__d("collectSubtreeData",[],function(a,b,c,d,e,f){function g(i,j,k,l,m){if(i.offsetWidth===0&&i.offsetHeight===0)return m;var n={};if(i.getAttribute)for(r=0;r<j.length;r++){t=j[r];var o=i.getAttribute(k[t]);if(o){n[t]={};var p=JSON.parse(o);for(var q in l)if(p[q]!==undefined){n[t][q]=true;if(m[t]===undefined)m[t]={};if(m[t][q]===undefined)m[t][q]=[];if(l[q].length>0)m[t][q].push(l[q]);m[t][q].push('('+p[q]);}}}for(var r=0;r<i.childNodes.length;r++){var s=i.childNodes[r];g(s,j,k,l,m);}for(var t in n)for(var u in n[t]){var v=m[t][u][m[t][u].length-1];if(v.length>0&&v.charAt(0)=='('){m[t][u][m[t][u].length-1]=v.substr(1);}else m[t][u].push(')');}return m;}function h(i,j){var k={};for(var l=0;l<j.length;++l)k[j[l]]='data-'+j[l];var m={tn:"","tn-debug":","},n={};g(i,j,k,m,n);for(var o in n)for(var p in n[o])n[o][p]=n[o][p].join('');return n;}e.exports=h;});
__d("recordTNTreeData",["collectSubtreeData"],function(a,b,c,d,e,f){var g=b('collectSubtreeData');function h(i,j){var k={},l=g(i,['ft']);for(var m in l.ft){k[m+'_tree']=l.ft[m];if(m==='tn-debug')i.setAttribute('tn-debug_subtree',l.ft[m]);}k.evt_value=i.offsetHeight;if(j)k.offset=Math.max(0,i.offsetTop-j.offsetTop);return k;}e.exports=h;});
__d("StoryTopicMap",[],function(a,b,c,d,e,f){var g={},h={registerTopics:function(i,j){g[i]=j;},getTopicsForFTID:function(i){return g[i]||[];}};e.exports=h;});
__d("XPubcontentFeedChainingControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/pubcontent\/feed_chaining\/",{origin:{type:"String",required:true},ft_id:{type:"String"},actor_id:{type:"Int",required:true}});});
__d("XPubcontentRelatedShareChainingControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/pubcontent\/related_share\/",{attachment_div_id:{type:"String",required:true},video_div_id:{type:"String"},global_share_id:{type:"Int",required:true}});});
__d("XPubcontentTopicChainingControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/pubcontent\/topic_chaining\/",{pivotal_topic_ids:{type:"IntVector"}});});
__d("PubcontentFeedChainingController",["Arbiter","AsyncRequest","AttachmentRelatedShareConstants","DOM","PageLikeButton","PubcontentFeedChainingConfig","PubcontentRelatedShareChainingConfig","PubcontentTopicChainingConfig","StoryTopicMap","UFIFeedbackTargets","UFIUIEvents","XPubcontentFeedChainingControllerURIBuilder","XPubcontentRelatedShareChainingControllerURIBuilder","XPubcontentTopicChainingControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AttachmentRelatedShareConstants'),j=b('DOM'),k=b('PageLikeButton'),l=b('PubcontentFeedChainingConfig'),m=b('PubcontentRelatedShareChainingConfig'),n=b('PubcontentTopicChainingConfig'),o=b('StoryTopicMap'),p=b('UFIFeedbackTargets'),q=b('UFIUIEvents'),r=b('XPubcontentFeedChainingControllerURIBuilder'),s=b('XPubcontentRelatedShareChainingControllerURIBuilder'),t=b('XPubcontentTopicChainingControllerURIBuilder'),u='pubcontentFeedChainingWrapper',v='page_story_like_action',w='related_share_article_click',x='related_share_video_click',y='page_share_like_action',z='topic_story_like_action';function aa(){"use strict";this.$PubcontentFeedChainingController0=l;this.$PubcontentFeedChainingController1=m;this.$PubcontentFeedChainingController2=n;this.$PubcontentFeedChainingController3={};g.subscribe(k.LIKED,this.$PubcontentFeedChainingController4.bind(this));g.subscribe(q.UFIActionLinkLike,this.$PubcontentFeedChainingController5.bind(this));g.subscribe(i.ARTICLE_CLICK,this.$PubcontentFeedChainingController6.bind(this));aa.instance=this;}aa.prototype.$PubcontentFeedChainingController4=function(ba,ca){"use strict";this.$PubcontentFeedChainingController7(ca.target,{origin:ca.origin,actor_id:ca.profile_id});};aa.prototype.$PubcontentFeedChainingController5=function(ba,ca){"use strict";if(!ca.ft_id)return;p.getFeedbackTarget(ca.ft_id,function(da,ea){if(ea.isownerpage){this.$PubcontentFeedChainingController7(da,{actor_id:ea.actorid,origin:v});}else if(ea.isshare){this.$PubcontentFeedChainingController7(da,{actor_id:ea.actorid,ft_id:ea.entidentifier,origin:y});}else{var fa=o.getTopicsForFTID(ea.entidentifier);if(fa&&fa.length>0)this.$PubcontentFeedChainingController8(da,{ft_id:ea.entidentifier,origin:z,pivotal_topic_ids:fa});}}.bind(this,ca.target));};aa.prototype.$PubcontentFeedChainingController6=function(ba,ca){"use strict";ca.origin=w;this.$PubcontentFeedChainingController9(ca.attachment,ca);};aa.prototype.$PubcontentFeedChainingControllera=function(ba,ca){"use strict";ca.origin=x;this.$PubcontentFeedChainingController9(ca.attachment,ca);};aa.prototype.$PubcontentFeedChainingControllerb=function(ba){"use strict";return !!(ba&&ba.id&&!(ba.id in this.$PubcontentFeedChainingController3));};aa.prototype.$PubcontentFeedChainingControllerc=function(ba){"use strict";if(!ba)return false;if(ba.origin in this.$PubcontentFeedChainingController0||ba.origin in this.$PubcontentFeedChainingController1){return true;}else{var ca=this.$PubcontentFeedChainingController2[ba.origin];if(!ca||!ca.rate)return false;var da=Math.random();if(da>ca.rate)return false;return true;}};aa.prototype.$PubcontentFeedChainingControllerd=function(ba){"use strict";this.$PubcontentFeedChainingController3[ba]=true;};aa.prototype.$PubcontentFeedChainingControllere=function(ba){"use strict";delete this.$PubcontentFeedChainingController3[ba];};aa.prototype.$PubcontentFeedChainingControllerf=function(ba,ca){"use strict";var da=this.findStory(ba);if(!this.$PubcontentFeedChainingControllerb(da))return null;if(!this.$PubcontentFeedChainingControllerc(ca))return null;var ea=this.findContainer(da);if(!ea)return null;this.$PubcontentFeedChainingControllerd(da.id);var fa=j.create('div',{id:u}),ga=j.appendContent(ea,fa);if(ga.length!==1)return null;return {chainingWrapper:ga[0],story:da};};aa.prototype.$PubcontentFeedChainingController9=function(ba,ca){"use strict";var da=this.$PubcontentFeedChainingControllerf(ba,ca);if(!da)return false;var ea=(new s()).setInt('global_share_id',ca.global_share_id).setString('attachment_div_id',j.getID(ca.attachment));if(ca.video_div_id)ea.setString('video_div_id',ca.video_div_id);var fa=new h().setErrorHandler(this.$PubcontentFeedChainingControllere.bind(this,da.story.id)).setRelativeTo(da.chainingWrapper).setURI(ea.getURI()),ga=JSON.parse(da.story.getAttribute('data-ft'))||{};ga&&fa.setData(ga);fa.send();return true;};aa.prototype.$PubcontentFeedChainingController7=function(ba,ca){"use strict";var da=this.$PubcontentFeedChainingControllerf(ba,ca);if(!da)return false;var ea=(new r()).setInt('actor_id',ca.actor_id).setString('origin',ca.origin);if(ca.ft_id)ea.setString('ft_id',ca.ft_id);new h().setErrorHandler(this.$PubcontentFeedChainingControllere.bind(this,da.story.id)).setRelativeTo(da.chainingWrapper).setURI(ea.getURI()).send();return true;};aa.prototype.$PubcontentFeedChainingController8=function(ba,ca){"use strict";var da=this.$PubcontentFeedChainingControllerf(ba,ca);if(!da)return false;var ea=(new t()).setIntVector('pivotal_topic_ids',ca.pivotal_topic_ids).getURI();new h().setErrorHandler(this.$PubcontentFeedChainingControllere.bind(this,da.story.id)).setRelativeTo(da.chainingWrapper).setURI(ea).send();return true;};e.exports=aa;});
__d("PubcontentLegacyFeedChainingController",["DOM","PubcontentFeedChainingController"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('PubcontentFeedChainingController');for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(){"use strict";if(h!==null)h.apply(this,arguments);}k.prototype.findStory=function(l){"use strict";var m=g.scry(l,'^li.uiStreamStory');return m.length===1?m[0]:null;};k.prototype.findContainer=function(l){"use strict";var m=g.scry(l,'div.storyInnerWrapper');return m.length>=1?m[0]:null;};e.exports=k;new k();});
__d("StreamViewportTracking",["Arbiter","DOM","UIIntentionalStreamMessage","ViewportTracking","ge","recordTNTreeData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('UIIntentionalStreamMessage'),j=b('ViewportTracking'),k=b('ge'),l=b('recordTNTreeData'),m=51;for(var n in j)if(j.hasOwnProperty(n))p[n]=j[n];var o=j===null?null:j.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=j;function p(){"use strict";if(j!==null)j.apply(this,arguments);}p.prototype.init=function(q,r){"use strict";if(r)this.$StreamViewportTracking0=r;o.init.call(this,q);this.initSubscriptions();};p.prototype.initSubscriptions=function(){"use strict";this.subscriptions.addSubscriptions(g.subscribe(i.UPDATE_LAST_REFRESH_TIME,this.invalidateAllStoriesCache.bind(this)),g.subscribe(i.UNLOAD,this.updateTimeTrackingData.bind(this,true)));};p.prototype.getDataFromConfig=function(q){"use strict";this.recordTNTree=q.record_tn_tree;this.timeout=q.record_delay;this.isTimetrackingEnabled=!!q.is_timetracking_enabled;};p.prototype.getTimeout=function(){"use strict";return this.timeout;};p.prototype.getStorySelector=function(){"use strict";return '.uiStreamStory';};p.prototype.getAllStories=function(){"use strict";var q=h.scry(this.getStream(),this.getStorySelector());return q.filter(function(r){return r.getAttribute('data-ft');});};p.prototype.getStoryID=function(q){"use strict";var r=JSON.parse(q.getAttribute('data-ft'));return r.mf_story_key;};p.prototype.getDataToLog=function(q){"use strict";var r={};if(this.recordTNTree){var s=this.getStream();r=l(q,s);var t=q.getAttribute('data-insertion-position');if(t!==null)r.inspos=t;}r.evt=m;return {ft:r};};p.prototype.getStream=function(){"use strict";if(this.$StreamViewportTracking0)return this.$StreamViewportTracking0;return k('home_stream');};p.init=function(q,r){"use strict";p.instance=new p();p.instance.init(q,r);};p.getInstance=function(){"use strict";return p.instance;};e.exports=p;});
__d("legacy:UIIntentionalStream",["UIIntentionalStream"],function(a,b,c,d){a.UIIntentionalStream=b('UIIntentionalStream');},3);
__d("legacy:UIIntentionalStream-message",["UIIntentionalStreamMessage"],function(a,b,c,d){a.UIIntentionalStreamMessage=b('UIIntentionalStreamMessage');},3);
__d("legacy:UIIntentionalStreamRefresh",["UIIntentionalStreamRefresh"],function(a,b,c,d){a.UIIntentionalStreamRefresh=b('UIIntentionalStreamRefresh');},3);