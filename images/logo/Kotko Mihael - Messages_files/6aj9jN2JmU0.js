/*!CK:1329203323!*//*1383776854,173213981*/

if (self.CavalryLogger) { CavalryLogger.start_js(["C3Pqo"]); }

__d("CSSAnimations",["function-extensions","CSS","cx"],function(a,b,c,d,e,f){b('function-extensions');var g=b('CSS'),h=b('cx'),i={bounce:function(j){g.addClass(j,"_3yk");g.removeClass.curry(j,"_3yk").defer(750);}};e.exports=i;});
__d("BlobFactory",["emptyFunction"],function(a,b,c,d,e,f){var g=b('emptyFunction'),h,i=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder;if(a.Blob){var j;try{new a.Blob();j=true;}catch(k){j=false;}h={getBlob:function(l,m){l=l||[];m=m||{};if(j){return new a.Blob(l,m);}else{var n=new i();for(var o=0;o<l.length;o++)n.append(l[o]);return n.getBlob(m.type);}},isSupported:g.thatReturnsTrue};}else h={getBlob:function(){},isSupported:g.thatReturnsFalse};e.exports=h;});
__d("clamp",[],function(a,b,c,d,e,f){function g(h,i,j){return Math.max(h,Math.min(j,i));}e.exports=g;});
__d("ProfilePicRequestCreator",["Form","copyProperties"],function(a,b,c,d,e,f){var g=b('Form'),h=b('copyProperties');function i(j,k,l,m){"use strict";this._fbid=j;this._owner=k;this._profileID=l;this._area=m;}i.prototype.setSuccessURI=function(j){"use strict";this._successURI=j;return this;};i.prototype.setErrorURI=function(j){"use strict";this._errorURI=j;return this;};i.prototype.setIsUnscaled=function(j){"use strict";this._isUnscaled=j;return this;};i.prototype.send=function(){"use strict";var j=h({fbid:this._fbid,owner:this._owner,id:this._profileID,'return':this._successURI,error_return:this._errorURI,is_unscaled:this._isUnscaled},this._area);g.post('/crop_profile_pic.php',j);};e.exports=i;});
__d("PhotocropConstraintConstants",[],function(a,b,c,d,e,f){var g={BOUNDARY:'boundary',SQUARE:'square',WIDE:'wide'};g.getAspectRatioForType=function(h){switch(h){case g.SQUARE:return 1;case g.WIDE:return 16/9;default:return null;}};e.exports=g;});
__d("PhotocropConstraint",["Vector","PhotocropConstraintConstants","clamp"],function(a,b,c,d,e,f){var g=b('Vector'),h=b('PhotocropConstraintConstants'),i=b('clamp');function j(p){"use strict";this.photocrop=p;this.pos=null;}j.prototype.onMouseMove=function(p,q,r){"use strict";var s=p.sub(this.pos);if(q){this.onResize(s,r);}else this.onMove(s);this.pos=this.pos.add(s);};j.prototype.onMouseDown=function(p){"use strict";this.pos=p;};j.prototype.onResize=function(p,q){"use strict";};j.prototype.onMove=function(p){"use strict";var q=this.photocrop.box,r=this.photocrop.wrapper.offsetWidth,s=this.photocrop.wrapper.offsetHeight;p.x=i(-q.l,p.x,r-q.r);p.y=i(-q.t,p.y,s-q.b);this.photocrop.box=q.add(p);};for(var k in j)if(j.hasOwnProperty(k))m[k]=j[k];var l=j===null?null:j.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=j;function m(){"use strict";if(j!==null)j.apply(this,arguments);}m.prototype.onResize=function(p,q){"use strict";var r=this.photocrop.min_width,s=this.photocrop.min_height,t=this.photocrop.box,u=this.photocrop.wrapper.offsetWidth,v=this.photocrop.wrapper.offsetHeight;switch(q){case 'ne':t.r+=p.x=i(t.l+r-t.r,p.x,u-t.r);t.t+=p.y=i(-t.t,p.y,t.b-s-t.t);break;case 'nw':t.l+=p.x=i(-t.l,p.x,t.r-r-t.l);t.t+=p.y=i(-t.t,p.y,t.b-s-t.t);break;case 'se':t.r+=p.x=i(t.l+r-t.r,p.x,u-t.r);t.b+=p.y=i(t.t+s-t.b,p.y,v-t.b);break;case 'sw':t.l+=p.x=i(-t.l,p.x,t.r-r-t.l);t.b+=p.y=i(t.t+s-t.b,p.y,v-t.b);break;}};for(k in j)if(j.hasOwnProperty(k))n[k]=j[k];n.prototype=Object.create(l);n.prototype.constructor=n;n.__superConstructor__=j;function n(){"use strict";if(j!==null)j.apply(this,arguments);}n.prototype.setRatio=function(p){"use strict";this.ratio=p;return this;};n.prototype.onMouseDown=function(p){"use strict";l.onMouseDown.call(this,p);var q=this.photocrop.box,r=q.r-q.l,s=q.b-q.t;this.displacement=new g(r,s);};n.prototype.$AspectRatioConstraint0=function(p,q,r,s,t,u){"use strict";var v,w,x,y,z;v=this.displacement.x/this.displacement.y;w=y=i(p,q,r);x=z=i(s,t,u);if(v>this.ratio){x=i(s,w/this.ratio,u);w=x*this.ratio;}else{w=i(p,x*this.ratio,r);x=w/this.ratio;}return new g(w,x);};n.prototype.onResize=function(p,q){"use strict";var r=this.photocrop.min_width,s=this.photocrop.min_height,t=this.photocrop.box,u=this.photocrop.wrapper.offsetWidth,v=this.photocrop.wrapper.offsetHeight,w;switch(q){case 'ne':this.displacement=this.displacement.add(p.x,-p.y);w=this.$AspectRatioConstraint0(r,this.displacement.x,u-t.l,s,this.displacement.y,t.b);t.r=t.l+w.x;t.t=t.b-w.y;break;case 'nw':this.displacement=this.displacement.add(-p.x,-p.y);w=this.$AspectRatioConstraint0(r,this.displacement.x,t.r,s,this.displacement.y,t.b);t.l=t.r-w.x;t.t=t.b-w.y;break;case 'se':this.displacement=this.displacement.add(p.x,p.y);w=this.$AspectRatioConstraint0(r,this.displacement.x,u-t.l,s,this.displacement.y,v-t.t);t.r=t.l+w.x;t.b=t.t+w.y;break;case 'sw':this.displacement=this.displacement.add(-p.x,p.y);w=this.$AspectRatioConstraint0(r,this.displacement.x,t.r,s,this.displacement.y,v-t.t);t.l=t.r-w.x;t.b=t.t+w.y;break;}};function o(p,q){var r;switch(q){case h.BOUNDARY:r=new m(p);break;case h.WIDE:case h.SQUARE:r=new n(p).setRatio(h.getAspectRatioForType(q));break;default:throw Error('unsupported PhotocropConstraint type');}return r;}e.exports=o;});
__d("Photocrop2",["ArbiterMixin","PhotocropConstraintConstants","CSS","DOM","Event","PhotocropConstraint","PhotosConst","Rect","Vector","copyProperties","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('PhotocropConstraintConstants'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('PhotocropConstraint'),m=b('PhotosConst'),n=b('Rect'),o=b('Vector'),p=b('copyProperties'),q=b('mixin'),r=q(g);for(var s in r)if(r.hasOwnProperty(s))u[s]=r[s];var t=r===null?null:r.prototype;u.prototype=Object.create(t);u.prototype.constructor=u;u.__superConstructor__=r;function u(v,w,x){"use strict";this.photo=v;var y=this.getPhotoDimensions();if(x){this.imageDimensions=new o(x.x,x.y);}else this.imageDimensions=new o(y.x,y.y);p(this,p({target:this.photo.parentNode,create_target:false,target_parent:this.photo.parentNode,width:200,height:200,min_width:m.PIC_NORMAL_FBX_SIZE,min_height:m.PIC_NORMAL_FBX_SIZE,center_x:(y.x||200)/2,center_y:(y.y||200)/2,constraint_type:h.BOUNDARY},w));this.initialMinWidth=this.min_width;this.initialMinHeight=this.min_height;this.setInitialDimensionsAndPos();if(this.create_target){this.target=j.create('div');i.addClass(this.target,'stageCropper');this.target_parent.appendChild(this.target);}i.addClass(this.target,'photocrop');['bg','wrapper','viewport'].forEach(function(z){this[z]=j.create('div');i.addClass(this[z],z);}.bind(this));this.highlight=j.create('img');i.addClass(this.highlight,'highlight');this.setHighlightSource();i.addClass(this.wrapper,'photocropWrapper');this.target.appendChild(this.bg);this.target.appendChild(this.wrapper);this.wrapper.appendChild(this.highlight);this.wrapper.appendChild(this.viewport);['ne','nw','sw','se'].forEach(function(z){var aa=j.create('div');i.addClass(aa,z);aa.setAttribute('data-cropcorner',z);this.viewport.appendChild(aa);i.addClass(aa,'profilePicViewportGrabby');}.bind(this));k.listen(this.viewport,{mousedown:this.mousedown.bind(this),dragstart:k.kill,selectstart:k.kill,click:k.stop});k.listen(document,{mousemove:this.mousemove.bind(this),mouseup:this.mouseup.bind(this)});k.listen(window,{resize:this.adjustForResize.bind(this)});this.realignToPictureSize();this.redraw();}u.prototype.setInitialDimensionsAndPos=function(){"use strict";this._constraint=l(this,this.constraint_type);var v=h.getAspectRatioForType(this.constraint_type),w=this.getPhotoDimensions();this.unscaledMinWidth=this.min_width;this.unscaledMinHeight=this.min_height;if(v!==null){this.unscaledMinWidth=this.min_width;this.unscaledMinHeight=this.unscaledMinWidth/v;}this.setNewRatio();var x=Math.min(this.width,w.x),y=Math.min(this.height,w.y);this.min_width=Math.min(this.min_width,w.x);this.min_height=Math.min(this.min_height,w.y);if(v!==null)if(w.x/w.y>v){y=Math.min(y,w.y);x=y*v;this.min_width=this.min_height*v;}else{x=Math.min(x,w.x);y=x/v;this.min_height=this.min_width/v;}var z=this.center_x-x/2,aa=this.center_y-y/2;this.box=new n(aa,z+x,aa+y,z);};u.prototype.getPhotoDimensions=function(){"use strict";return o.getElementDimensions(this.photo);};u.prototype.getPhotoPosition=function(){"use strict";return new o(this.photo.offsetLeft,this.photo.offsetTop);};u.prototype.setHighlightSource=function(){"use strict";this.highlight.src=this.photo.src;};u.prototype.setConstraintType=function(v){"use strict";this.constraint_type=v;this.min_width=this.initialMinWidth;this.min_height=this.initialMinHeight;this.setInitialDimensionsAndPos();this.adjustForResize();};u.prototype.adjustForResize=function(){"use strict";var v=this.ratio,w=this.setNewRatio(),x=w/v;this.box.t*=x;this.box.l*=x;this.box.b*=x;this.box.r*=x;this.redraw();this.realignToPictureSize();};u.prototype.setNewRatio=function(){"use strict";this.ratio=this.getPhotoDimensions().x/this.imageDimensions.x;this.min_width=this.ratio*this.unscaledMinWidth;this.min_height=this.ratio*this.unscaledMinHeight;return this.ratio;};u.prototype.realignToPictureSize=function(){"use strict";var v=this.photo;if(!v)return;var w=this.getPhotoDimensions(),x=this.getPhotoPosition();[this.bg,this.wrapper].forEach(function(y){y.style.width=w.x+'px';y.style.height=w.y+'px';y.style.top=x.y+'px';y.style.left=x.x+'px';});};u.prototype.redraw=function(){"use strict";var v=[this.box.t,this.box.r,this.box.b,this.box.l],w=this.getPhotoDimensions();this.highlight.style.width=w.x+"px";this.highlight.style.height=w.y+"px";this.highlight.style.clip="rect("+v.join("px ")+"px)";this.viewport.style.top=this.box.t+"px";this.viewport.style.left=this.box.l+"px";this.viewport.style.height=(this.box.b-this.box.t)+"px";this.viewport.style.width=(this.box.r-this.box.l)+"px";};u.prototype.done=function(v){"use strict";this.freezeViewport=true;if(!v){[this.bg,this.wrapper].forEach(j.remove);if(this.create_target){j.remove(this.target);this.target=null;}else i.removeClass(this.target,'photocrop');}var w=Math.round(this.box.l*(1/this.ratio)),x=Math.round(this.box.t*(1/this.ratio)),y=Math.round(this.box.r*(1/this.ratio)),z=Math.round(this.box.b*(1/this.ratio));this.inform('done',v);return {x:Math.max(w,0),y:Math.max(x,0),width:y-Math.max(w,0),height:z-Math.max(x,0)};};u.prototype.mousedown=function(v){"use strict";if(this.freezeViewport)return;this.mouseTarget=v.getTarget();this._constraint.onMouseDown(o.getEventPosition(v));i.addClass(document.body,'draggingMode');return false;};u.prototype.mousemove=function(v){"use strict";if(!this.mouseTarget)return;this._constraint.onMouseMove(o.getEventPosition(v),this.mouseTarget!==this.viewport,this.mouseTarget.getAttribute('data-cropcorner'));this.redraw();return false;};u.prototype.mouseup=function(v){"use strict";this.mouseTarget=null;i.removeClass(document.body,'draggingMode');};e.exports=u;});